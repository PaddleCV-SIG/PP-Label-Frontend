(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(H,k,o){"use strict";o.d(k,{Z:function(){return M}});var L=o(94663),Y=o(80112);function X(g){return Function.toString.call(g).indexOf("[native code]")!==-1}var q=o(18597);function D(g,O,b){return(0,q.Z)()?D=Reflect.construct:D=function(u,U,F){var R=[null];R.push.apply(R,U);var $=Function.bind.apply(u,R),n=new $;return F&&(0,Y.Z)(n,F.prototype),n},D.apply(null,arguments)}function M(g){var O=typeof Map=="function"?new Map:void 0;return M=function(f){if(f===null||!X(f))return f;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(typeof O!="undefined"){if(O.has(f))return O.get(f);O.set(f,u)}function u(){return D(f,arguments,(0,L.Z)(this).constructor)}return u.prototype=Object.create(f.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),(0,Y.Z)(u,f)},M(g)}},72285:function(H){H.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},80212:function(H,k,o){"use strict";o.r(k),o.d(k,{default:function(){return mn}});var L=o(11849),Y=o(57663),X=o(71577),q=o(34669),D=o(54458),M=o(2824),g=o(67294),O=o(72285),b=o.n(O),f=o(8088),u=o(61541),U=o(44434),F=o(5041),R=o(57436),$=o(14836),n=o(85893),an=function(i){return(0,n.jsx)(u.Z,{active:i.active,imgSrc:i.imgSrc||"./pics/buttons/rectangle.png",onClick:i.onClick,children:i.children})},cn=an,sn=o(91220),z=o(65031);function un(t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}function _(t,i){if(!(!t||!i))return{color:t,points:i}}function ln(t,i,A,l,m,S,d){if(!t||!t.lines||!t.lines[0])return[(0,n.jsx)(n.Fragment,{})];var a=t.lines[0].points,v=t.lines[0].color,y=un(v);if(!y)return[(0,n.jsx)(n.Fragment,{})];var C=(d==null?void 0:d.annotationId)==t.annotationId,p=C?.5:.1,j=void 0,Z=[];return a.forEach(function(h,P){if(!j){j=h;return}Z.push((0,n.jsx)(z.Cd,{onMouseDown:function(){m=="mover"&&S(t)},draggable:m=="mover",onDragMove:function(T){console.log("Circle onDrageMove");var W=T.evt.offsetX/l,B=T.evt.offsetY/l;a[P-1]=W,a[P]=B;var G=(0,L.Z)((0,L.Z)({},t),{},{lines:[{color:v,points:a}]});i(G)},onMouseOver:function(){console.log("Circle onMouseOver"),m=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x:j,y:h,radius:5,fill:v})),console.log(P,a),a.length>4&&a.splice(P+1,2),j=void 0}),[(0,n.jsxs)(z.ZA,{children:[(0,n.jsx)(z.UL,{onMouseOver:function(){m=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){m=="mover"&&S(t)},stroke:v,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:a[0],y:a[1],width:a[2]-a[0],height:a[3]-a[1],closed:!0,fill:"rgba(".concat(y.r,", ").concat(y.g,", ").concat(y.b,", ").concat(p,")")}),Z]},t.annotationId)]}function dn(t){var i=0,A=(0,sn.Z)(t),l;try{for(A.s();!(l=A.n()).done;){var m=l.value;!m||m.annotationId>i&&(i=m.annotationId)}}catch(S){A.e(S)}finally{A.f()}return i}function fn(t){var i=function(d,a){var v,y=d.evt.offsetX/a,C=d.evt.offsetY/a,p=_((v=t.currentLabel)===null||v===void 0?void 0:v.color,[y,C]);!p||t.onAnnotationAdd({tool:"polygon",annotationId:dn(t.annotations)+1,label:t.currentLabel,lines:[p]})},A=function(d,a){var v,y;if(!!t.currentAnnotation){var C=d.evt.offsetX/a,p=d.evt.offsetY/a,j=t.currentAnnotation.lines||[],Z=_((v=t.currentLabel)===null||v===void 0?void 0:v.color,(y=j[0])===null||y===void 0?void 0:y.points.concat([C,p]));if(!!Z){var h={tool:"polygon",annotationId:t.currentAnnotation.annotationId,label:t.currentAnnotation.label,lines:[Z]};t.onAnnotationModify(h)}}},l=function(d,a){t.currentTool=="polygon"&&(t.currentAnnotation?A(d,a):i(d,a))},m=function(){t.currentTool=="polygon"&&t.onMouseUp()};return{onMouseDown:l,onMouseMove:function(){},onMouseUp:m,createElementsFunc:ln}}var vn=o(64322),J=40,gn=function(){var i,A=(0,vn.$L)(g.useState,g.useEffect,{label:{oneHot:!0},effectTrigger:{}}),l=(0,M.Z)(A,8),m=l[0],S=l[1],d=l[2],a=l[3],v=l[4],y=l[5],C=l[6],p=l[7],j=(0,g.useState)(void 0),Z=(0,M.Z)(j,2),h=Z[0],P=Z[1],w=(0,g.useState)({color:"",name:""}),T=(0,M.Z)(w,2),W=T[0],B=T[1],G=(0,g.useState)(),nn=(0,M.Z)(G,2),N=nn[0],K=nn[1],yn=(0,g.useState)([]),tn=(0,M.Z)(yn,2),x=tn[0],E=tn[1],I=function(e){K(e),e!=null&&e.label&&B(e.label)};(0,g.useEffect)(function(){localStorage.removeItem("history"),V([])},[]);function V(s,e){var r=localStorage.getItem("history"),c=r?JSON.parse(r):{index:-1,items:[]},rn={currentAnnotation:e,annotations:s};if(JSON.stringify(c.items[c.index])!=JSON.stringify(rn)){var Sn=c.index>J?c.index-J:0,xn=c.items.splice(Sn,c.index==0?1:c.index+1);c.items=xn.concat([rn]),c.index<=J?c.index++:c.index=J+1,localStorage.setItem("history",JSON.stringify(c))}}var pn=function(){var e=localStorage.getItem("history");if(!!e){var r=JSON.parse(e);if(!!r&&!(r.index>=r.items.length-1)){r.index++,localStorage.setItem("history",JSON.stringify(r));var c=r.items[r.index];K(c.currentAnnotation),E(c.annotations)}}},hn=function(){var e=localStorage.getItem("history");if(!!e){var r=JSON.parse(e);if(!(!r||!r.index)&&!(r.index<=0)){r.index--,localStorage.setItem("history",JSON.stringify(r));var c=r.items[r.index];K(c.currentAnnotation),E(c.annotations)}}},en=function(e){for(var r=[],c=0;c<x.length;c++)x[c].annotationId==e.annotationId?r.push(e):r.push(x[c]);I(e),E(r)},on=fn({currentLabel:W,currentTool:h,annotations:x,currentAnnotation:N,onAnnotationAdd:function(e){var r=x.concat([e]);E(r),N||I(e)},onAnnotationModify:en,onMouseUp:function(){V(x,N)}}),Q=on;return(0,n.jsxs)(f.Z,{className:b().det,children:[(0,n.jsxs)(U.Z,{children:[(0,n.jsx)(cn,{active:h=="polygon",onClick:function(){P("polygon"),I(void 0)},children:"Rectangle"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/edit.png",children:"Edit"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){d.change(.1)},children:"Zoom in"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){d.change(-.1)},children:"Zoom out"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/save.png",children:"Save"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){P("mover")},children:"Move"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){hn()},children:"Undo"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){pn()},children:"Redo"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,n.jsxs)("div",{id:"dr",className:b().mainStage,children:[(0,n.jsx)("div",{className:b().draw,children:(0,n.jsx)(R.Z,{width:(i=document.getElementById("dr"))===null||i===void 0?void 0:i.clientWidth,scale:d.curr,annotations:x,currentTool:h,currentAnnotation:N,setCurrentAnnotation:I,onAnnotationModify:en,onAnnotationModifyComplete:function(){V(x,N)},onMouseDown:Q.onMouseDown,onMouseMove:Q.onMouseMove,onMouseUp:Q.onMouseUp,createPolygonFunc:on.createElementsFunc,imgSrc:"/pics/background.png"})}),(0,n.jsx)("div",{className:b().pblock,children:(0,n.jsx)("div",{className:b().progress,children:(0,n.jsx)(D.Z,{percent:50,status:"active"})})})]}),(0,n.jsxs)(U.Z,{disLoc:"right",children:[(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,n.jsx)(u.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"})]}),(0,n.jsxs)("div",{className:b().rightSideBar,children:[(0,n.jsx)("div",{className:b().determinOutline,children:(0,n.jsx)(X.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){I(void 0)},children:"Determine Outline"})}),(0,n.jsx)(F.Z,{labels:p.all,onLabelSelect:function(e){p.onSelect(e),B(e),I(void 0)},onLabelModify:function(){},onLabelDelete:p.remove,onLabelAdd:function(e){return p.create((0,L.Z)((0,L.Z)({},e),{},{projectId:C.curr.projectId}))}}),(0,n.jsx)($.Z,{selectedAnnotation:N,annotations:x,onAnnotationSelect:function(e){e!=null&&e.delete||I(e)},onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:function(e){E(x.filter(function(r){return r.annotationId!=e.annotationId})),I(void 0)}})]})]})},mn=gn}}]);
