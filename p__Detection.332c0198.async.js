(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(J,P,i){"use strict";i.d(P,{Z:function(){return N}});var S=i(94663),T=i(80112);function F(j){return Function.toString.call(j).indexOf("[native code]")!==-1}var X=i(18597);function B(j,O,Y){return(0,X.Z)()?B=Reflect.construct:B=function(C,U,g){var Z=[null];Z.push.apply(Z,U);var E=Function.bind.apply(C,Z),R=new E;return g&&(0,T.Z)(R,g.prototype),R},B.apply(null,arguments)}function N(j){var O=typeof Map=="function"?new Map:void 0;return N=function(m){if(m===null||!F(m))return m;if(typeof m!="function")throw new TypeError("Super expression must either be null or a function");if(typeof O!="undefined"){if(O.has(m))return O.get(m);O.set(m,C)}function C(){return B(m,arguments,(0,S.Z)(this).constructor)}return C.prototype=Object.create(m.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),(0,T.Z)(C,m)},N(j)}},72285:function(J){J.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(J,P,i){"use strict";i.r(P),i.d(P,{default:function(){return on}});var S=i(11849),T=i(20228),F=i(11382),X=i(34669),B=i(54458),N=i(34792),j=i(48086),O=i(2824),Y=i(67294),m=i(72285),C=i.n(m),U=i(8088),g=i(61541),Z=i(44434),E=i(5041),R=i(57436),H=i(14836),o=i(85893),$=function(e){return(0,o.jsx)(g.Z,{active:e.active,imgSrc:e.imgSrc||"./pics/buttons/rectangle.png",onClick:e.onClick,children:e.children})},G=$,L=i(65031);function K(n){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function W(n,e){if(!(!n||!e||e.length<2))return{xmin:e[0],ymin:e[1],xmax:e[2]||void 0,ymax:e[3]||void 0}}function V(n,e,d,l,a,M,f,t){if(console.log("drawRectangle, annotation:",n),!n||!n.result||!n.label||!n.label.color)return[(0,o.jsx)(o.Fragment,{})];var r=JSON.parse(n.result),u=n.label.color,v=K(u);if(!v)return[(0,o.jsx)(o.Fragment,{})];console.log("drawRectangle, points:",r,"color:",u);var x=(f==null?void 0:f.annotationId)==n.annotationId,h=x?.5:.1,b=r.xmax&&r.ymax?(0,o.jsx)(L.UL,{onMouseOver:function(){a=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){a=="mover"&&M(n)},stroke:u,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r.xmin,y:r.ymin,width:r.xmax-r.xmin,height:r.ymax-r.ymin,closed:!0,fill:"rgba(".concat(v.r,", ").concat(v.g,", ").concat(v.b,", ").concat(h,")")}):(0,o.jsx)(o.Fragment,{});return[(0,o.jsxs)(L.ZA,{children:[b,(0,o.jsx)(L.Cd,{onMouseDown:function(){(a=="editor"||a=="mover")&&M(n)},draggable:a=="editor",onDragMove:function(A){if(a=="editor"){var k=(A.evt.offsetX+((t==null?void 0:t.x)||0))/l,I=(A.evt.offsetY+((t==null?void 0:t.y)||0))/l;r.xmin=k,r.ymin=I;var D=(0,S.Z)((0,S.Z)({},n),{},{lines:[{tool:"rectangle",color:u,points:r}]});e(D)}},onMouseOver:function(){a=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:r.xmin,y:r.ymin,radius:5,fill:u}),(0,o.jsx)(L.Cd,{onMouseDown:function(){(a=="editor"||a=="mover")&&M(n)},draggable:a=="editor",onDragMove:function(A){if(a=="editor"){var k=(A.evt.offsetX+((t==null?void 0:t.x)||0))/l,I=(A.evt.offsetY+((t==null?void 0:t.y)||0))/l;r.xmax=k,r.ymax=I;var D=(0,S.Z)((0,S.Z)({},n),{},{lines:[{tool:"rectangle",color:u,points:r}]});e(D)}},onMouseOver:function(){a=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:r.xmax,y:r.ymax,radius:5,fill:u})]},n.annotationId)]}function Q(n){console.log("currentAnnotation",n.currentAnnotation);var e=function(f,t,r,u){var v,x=f.evt.offsetX+t/u,h=f.evt.offsetY+r/u,b=W((v=n.currentLabel)===null||v===void 0?void 0:v.color,[x,h]);!b||n.onAnnotationAdd({type:"rectangle",label:n.currentLabel,result:JSON.stringify(b)})},d=function(f,t,r,u){if(!(!n.currentAnnotation||!n.currentAnnotation.result)){var v=(f.evt.offsetX+t)/u,x=(f.evt.offsetY+r)/u,h=JSON.parse(n.currentAnnotation.result);if(!!h){h.xmax=v,h.ymax=x;var b={type:"rectangle",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,result:JSON.stringify(h)};n.onAnnotationModify(b)}}},l=function(f,t,r,u){n.currentTool=="rectangle"&&(n.currentAnnotation?d(f,t,r,u):e(f,t,r,u))},a=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:l,onMouseMove:function(){},onMouseUp:a,createElementsFunc:V}}var q=i(64322),w=40;function _(){localStorage.removeItem("history"),z([])}function z(n){var e=localStorage.getItem("history"),d=e?JSON.parse(e):{index:-1,items:[]};if(JSON.stringify(d.items[d.index])!=JSON.stringify(n)){var l=d.index>w?d.index-w:0,a=d.items.splice(l,d.index==0?1:d.index+1);d.items=a.concat([n]),d.index<=w?d.index++:d.index=w+1,localStorage.setItem("history",JSON.stringify(d))}}function nn(){var n=localStorage.getItem("history");if(!!n){var e=JSON.parse(n);if(!!e&&!(e.index>=e.items.length-1))return e.index++,localStorage.setItem("history",JSON.stringify(e)),e.items[e.index]}}function en(){var n=localStorage.getItem("history");if(!!n){var e=JSON.parse(n);if(!(!e||!e.index)&&!(e.index<=0))return e.index--,localStorage.setItem("history",JSON.stringify(e)),e.items[e.index]}}var y=i(48971),tn=function(){var e,d=(0,q.$L)(Y.useState,Y.useEffect,{label:{oneHot:!0},effectTrigger:{postTaskChange:_}}),l=(0,O.Z)(d,10),a=l[0],M=l[1],f=l[2],t=l[3],r=l[4],u=l[5],v=l[6],x=l[7],h=l[8],b=l[9],p=function(s){!s||(console.log("modifyAnnotation",s,"anno.label:",s==null?void 0:s.label),s.taskId=r.curr.taskId,s.dataId=u.curr.dataId,t.modify(s))},A=function(s){console.log("onAnnotationModify"),p(s)},k=Q({currentLabel:x.curr,currentTool:a.curr,annotations:t.all,currentAnnotation:t.curr,onAnnotationAdd:t.setCurr,onAnnotationModify:A,onMouseUp:function(){z({annos:t.all,currAnno:t.curr})}}),I=k,D=(0,y.YB)().formatMessage({id:"pages.toolBar.rectangle"}),rn=(0,y.YB)().formatMessage({id:"pages.toolBar.zoomIn"}),an=(0,y.YB)().formatMessage({id:"pages.toolBar.zoomOut"}),sn=(0,y.YB)().formatMessage({id:"pages.toolBar.move"}),cn=(0,y.YB)().formatMessage({id:"pages.toolBar.unDo"}),ln=(0,y.YB)().formatMessage({id:"pages.toolBar.reDo"}),un=(0,y.YB)().formatMessage({id:"pages.toolBar.save"}),dn=(0,y.YB)().formatMessage({id:"pages.toolBar.edit"}),fn=(0,y.YB)().formatMessage({id:"pages.toolBar.clearMark"}),vn=(0,y.YB)().formatMessage({id:"pages.toolBar.undef"}),gn=(0,y.YB)().formatMessage({id:"pages.toolBar.divideData"}),mn=(0,y.YB)().formatMessage({id:"pages.toolBar.export"});return(0,o.jsxs)(U.Z,{className:C().det,children:[(0,o.jsxs)(Z.Z,{children:[(0,o.jsx)(G,{active:a.curr=="rectangle",onClick:function(){if(!x.curr){j.default.error("Please choose a label category first!");return}a.setCurr("rectangle"),t.setCurr(void 0)},children:D}),(0,o.jsx)(g.Z,{active:a.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){a.setCurr("editor")},children:dn}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){f.change(.1)},children:rn}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){f.change(-.1)},children:an}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){j.default.info("Annotations are saved automatically. You don't need to click save.")},children:un}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/move.png",active:a.curr=="mover",onClick:function(){a.setCurr("mover")},children:sn}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var s=en();!s||t.setCurr(s.currAnno)},children:cn}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var s=nn();!s||t.setCurr(s.currAnno)},children:ln}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:fn})]}),(0,o.jsx)("div",{id:"dr",className:"mainStage",children:(0,o.jsxs)(F.Z,{tip:"loading",spinning:!!M.curr,children:[(0,o.jsx)("div",{className:"draw",children:(0,o.jsx)(R.Z,{scale:f.curr,annotations:t.all,currentTool:a.curr,currentAnnotation:t.curr,setCurrentAnnotation:t.setCurr,onAnnotationModify:A,onAnnotationModifyComplete:function(){z({annos:t.all,currAnno:t.curr}),t.setCurr()},onMouseDown:I.onMouseDown,onMouseMove:I.onMouseMove,onMouseUp:I.onMouseUp,createRectangleFunc:k.createElementsFunc,imgSrc:u.imgSrc})}),(0,o.jsx)("div",{className:"pblock",children:(0,o.jsxs)("div",{className:"progress",children:[(0,o.jsx)(B.Z,{className:"progressBar",percent:v.progress,status:"active",showInfo:!1})," ",(0,o.jsxs)("span",{className:"progressDesc",children:["Current labeling ",r.currIdx==null?1:r.currIdx+1," of"," ",(e=r.all)===null||e===void 0?void 0:e.length,". Already labeled ",r.finished(v.progress)||0,"."]})]})}),(0,o.jsx)("div",{className:"prevTask",onClick:r.prevTask}),(0,o.jsx)("div",{className:"nextTask",onClick:r.nextTask})]})}),(0,o.jsxs)(Z.Z,{disLoc:"right",children:[(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){h(v.curr.projectId,{train:.5,validation:.3,test:.2})},children:gn}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/export.png",onClick:function(){b(v.curr.projectId,"/home/lin/Desktop/data/pplabel/export/")},children:mn}),(0,o.jsx)(g.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){t.setCurr(void 0)},children:vn})]}),(0,o.jsxs)("div",{className:"rightSideBar",children:[(0,o.jsx)(E.Z,{labels:x.all,activeIds:x.activeIds,onLabelSelect:function(s){x.onSelect(s),t.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:x.remove,onLabelAdd:function(s){return x.create((0,S.Z)((0,S.Z)({},s),{},{projectId:v.curr.projectId}))}}),(0,o.jsx)(H.Z,{annotations:t.all,currAnnotation:t.curr,onAnnotationSelect:t.setCurr,onAnnotationAdd:function(){t.setCurr(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(s){t.remove(s),t.setCurr(void 0)}})]})]})},on=tn}}]);
