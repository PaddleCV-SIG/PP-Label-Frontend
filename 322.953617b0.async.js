(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(me,re,W){"use strict";W.d(re,{gu:function(){return ue},os:function(){return le},Gd:function(){return ee},$L:function(){return he}});var X=W(11849),Y=W(91220),C=W(3182),be=W(34792),T=W(48086),U=W(2824),ae=W(94043),u=W.n(ae),j=W(37071),N=W(9992),V=localStorage.getItem("basePath"),G=new N.VK(V?{basePath:V}:void 0),B=new N.U(G),ne=new N.sD(G),te=new N.W6(G),z=new N.Cl(G),q=new N.vb(G),ue=function(a){return JSON.parse(JSON.stringify(a))};function le(Z){return Z&&(Z.toLowerCase().replace(/([-_][a-z])/g,function(a){return a.toUpperCase().replace("-","").replace("_","")}),Z)}var x=function(a,f,g){if(!!g){for(var n=typeof a=="number"?a:a[g],b=0;b<f.length;b++)if(n==f[b][g])return b}},se=function(a){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],g=a(1),n=(0,U.Z)(g,2),b=n[0],M=n[1];function w(D){var P=D;P<f[0]&&(P=f[0],T.default.error("Smallest scale is "+f[0])),P>f[1]&&(P=f[1],T.default.error("Largest scale is "+f[1])),M(P)}function i(D){w(b+D)}return{curr:b,change:i,setScale:w}};function ie(Z,a){var f=a.defaultTool,g=Z(f),n=(0,U.Z)(g,2),b=n[0],M=n[1];return{curr:b,setCurr:M}}function fe(Z){var a=Z(!1),f=(0,U.Z)(a,2),g=f[0],n=f[1];return{curr:g,setCurr:n}}var ee=function(a){var f=a(),g=(0,U.Z)(f,2),n=g[0],b=g[1],M=a(),w=(0,U.Z)(M,2),i=w[0],D=w[1],P=a(),R=(0,U.Z)(P,2),O=R[0],S=R[1];function E(){return k.apply(this,arguments)}function k(){return k=(0,C.Z)(u().mark(function l(){var e;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,B.getAll();case 3:return e=h.sent,b(e),h.abrupt("return",e);case 8:return h.prev=8,h.t0=h.catch(0),console.log("project getAll err",h.t0),j.Z.parseError(h.t0,T.default),h.abrupt("return");case 13:case"end":return h.stop()}},l,null,[[0,8]])})),k.apply(this,arguments)}function d(l){return L.apply(this,arguments)}function L(){return L=(0,C.Z)(u().mark(function l(e){var y;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e!=null){r.next=2;break}return r.abrupt("return",void 0);case 2:if(!(n&&n.length>1)){r.next=5;break}return T.default.error("Currently have multiple projects stored, use turnTo instead"),r.abrupt("return");case 5:return r.next=7,B.get(e);case 7:return y=r.sent,b([y]),D(0),r.abrupt("return",y);case 11:case"end":return r.stop()}},l)})),L.apply(this,arguments)}function v(l){return $.apply(this,arguments)}function $(){return $=(0,C.Z)(u().mark(function l(e){return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return D(e),h.abrupt("return",n[e]);case 2:case"end":return h.stop()}},l)})),$.apply(this,arguments)}function K(l){return I.apply(this,arguments)}function I(){return I=(0,C.Z)(u().mark(function l(e){var y;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("remove project",e),y=typeof e=="number"?e:e.projectId,r.next=4,B.remove(y);case 4:E();case 5:case"end":return r.stop()}},l)})),I.apply(this,arguments)}function H(l){return F.apply(this,arguments)}function F(){return F=(0,C.Z)(u().mark(function l(e){var y;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,B.create(e);case 3:return y=r.sent,r.abrupt("return",y);case 7:return r.prev=7,r.t0=r.catch(0),console.log("project create err",r.t0),r.abrupt("return",j.Z.parseError(r.t0,T.default));case 11:case"end":return r.stop()}},l,null,[[0,7]])})),F.apply(this,arguments)}function A(l,e){return s.apply(this,arguments)}function s(){return s=(0,C.Z)(u().mark(function l(e,y){return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:B.update(e,y).then(function(o){console.log("project update res",o)}).catch(function(o){console.log("project update err ",o),j.Z.parseError(o,T.default)});case 1:case"end":return r.stop()}},l)})),s.apply(this,arguments)}function _(){return c.apply(this,arguments)}function c(){return c=(0,C.Z)(u().mark(function l(){var e,y,h,r,o=arguments;return u().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return e=o.length>0&&o[0]!==void 0?o[0]:void 0,p.prev=1,y=e==null?n[i].projectId:e,p.next=5,B.getProgress(y);case 5:if(h=p.sent,!(!h||h.finished==null||h.total==null)){p.next=8;break}throw Error("empty progress");case 8:return r=Math.ceil(h.finished/h.total*100),S(r),p.abrupt("return",r);case 13:return p.prev=13,p.t0=p.catch(1),console.log("get progress err",p.t0),j.Z.parseError(p.t0,T.default),p.abrupt("return",0);case 18:case"end":return p.stop()}},l,null,[[1,13]])})),c.apply(this,arguments)}return{all:n,getAll:E,getCurr:d,turnTo:v,remove:K,create:H,update:A,progress:O,getProgress:_,get curr(){if(!!n)return n[i]}}},de=function(a,f){var g=f.oneHot,n=g===void 0?!0:g,b=f.postSetCurr,M=a(),w=(0,U.Z)(M,2),i=w[0],D=w[1],P=a(),R=(0,U.Z)(P,2),O=R[0],S=R[1],E=a(new Set),k=(0,U.Z)(E,2),d=k[0],L=k[1],v=a(n),$=(0,U.Z)(v,2),K=$[0],I=$[1];function H(o){return F.apply(this,arguments)}function F(){return F=(0,C.Z)(u().mark(function o(m){var p;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(m!=null){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,B.getLabels(m);case 5:return p=t.sent,console.log("label getall:",p),D(p),t.abrupt("return",p);case 11:return t.prev=11,t.t0=t.catch(2),console.log("label getall err ",t.t0),t.abrupt("return",j.Z.parseError(t.t0,T.default));case 15:case"end":return t.stop()}},o,null,[[2,11]])})),F.apply(this,arguments)}function A(o){var m=x(o,i,"labelId");if(m==null)throw Error("label.onSelect label not found");S(m);var p=i[m].labelId;K?d.has(p)?d.clear():(d.clear(),d.add(p)):d.has(p)?d.delete(p):d.add(p),L(new Set(d)),b&&b(i[m])}function s(o){if(console.log("LabelUtils setCurr",o),!!n&&!!o){var m=typeof o=="number"?o:o.labelId;m=x(m,i,"labelId"),m!=null&&(console.log("LabelUtils setCurr index:",m),S(m),L(new Set([o])))}}function _(o){d.clear();var m=(0,Y.Z)(o),p;try{for(m.s();!(p=m.n()).done;){var J=p.value;d.add(J.labelId)}}catch(t){m.e(t)}finally{m.f()}}function c(o){return l.apply(this,arguments)}function l(){return l=(0,C.Z)(u().mark(function o(m){var p;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("create label",m),t.prev=1,t.next=4,q.create(m);case 4:return p=t.sent,H(m.projectId),t.abrupt("return",p);case 9:return t.prev=9,t.t0=t.catch(1),console.log("label create err",t.t0),t.abrupt("return",j.Z.parseError(t.t0,T.default));case 13:case"end":return t.stop()}},o,null,[[1,9]])})),l.apply(this,arguments)}function e(o){return y.apply(this,arguments)}function y(){return y=(0,C.Z)(u().mark(function o(m){var p;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return p=typeof m=="number"?m:m.labelId,t.prev=1,t.next=4,q.remove(p);case 4:i&&i.length&&H(i[0].projectId),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(1),console.log("label remove err",t.t0),j.Z.parseError(t.t0,T.default);case 11:case"end":return t.stop()}},o,null,[[1,7]])})),y.apply(this,arguments)}function h(o){var m=typeof o=="number"?o:o.labelId;return d.has(m)}var r=function(m){m!=null?I(m):I(!K)};return{all:i,getAll:H,activeIds:d,initActive:_,onSelect:A,setCurr:s,isActive:h,create:c,remove:e,toggleOneHot:r,get curr(){if(i!=null)return i[O]}}},pe=function(a){var f=a(),g=(0,U.Z)(f,2),n=g[0],b=g[1],M=a(),w=(0,U.Z)(M,2),i=w[0],D=w[1],P=function(d){return n?d<0?(T.default.error("This is the first image. No previous image."),!1):d==n.length?(T.default.error("This is the final image. No next image."),!1):(D(d),!0):!1},R=function(){var k=(0,C.Z)(u().mark(function d(L,v){var $;return u().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,I.next=3,B.getTasks(L);case 3:if($=I.sent,b($),v==null){I.next=9;break}return console.log("getall turnto"),P(v),I.abrupt("return",[$,$[v]]);case 9:return I.abrupt("return",$);case 12:return I.prev=12,I.t0=I.catch(0),console.log("task getall err ",I.t0),I.abrupt("return",j.Z.parseError(I.t0,T.default));case 16:case"end":return I.stop()}},d,null,[[0,12]])}));return function(L,v){return k.apply(this,arguments)}}();function O(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return k==null||!n?0:Math.round(n.length*k/100)}var S=function(){return P(i+1)},E=function(){return P(i-1)};return{currIdx:i,all:n,turnTo:P,getAll:R,nextTask:S,prevTask:E,finished:O,get curr(){if(!(i==null||n==null))return n[i]}}};function ce(Z,a){var f=a.label,g=f===void 0?void 0:f,n=a.project,b=n===void 0?void 0:n,M=Z(),w=(0,U.Z)(M,2),i=w[0],D=w[1],P=Z(),R=(0,U.Z)(P,2),O=R[0],S=R[1],E=function(){var A=(0,C.Z)(u().mark(function s(_){var c;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("AnnotationUtils getAll, dataId:",_),_!=null){e.next=3;break}return e.abrupt("return",[]);case 3:return e.prev=3,e.next=6,te.getAnnotations(_);case 6:return c=e.sent,console.log("AnnotationUtils getAll, annRes:",c),D(c),e.abrupt("return",c);case 12:return e.prev=12,e.t0=e.catch(3),console.log("AnnotationUtils ann getAll err",e.t0),j.Z.parseError(e.t0,T.default),e.abrupt("return",[]);case 17:case"end":return e.stop()}},s,null,[[3,12]])}));return function(_){return A.apply(this,arguments)}}(),k=function(){var A=(0,C.Z)(u().mark(function s(_){var c,l,e,y=arguments;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return c=y.length>1&&y[1]!==void 0?y[1]:!1,console.log("create label",_.label),r.prev=2,_.label&&(_.labelId=_.label.labelId),_.label=void 0,r.next=7,z.create(_);case 7:if(l=r.sent,v(l),e=[],!_.dataId){r.next=14;break}return r.next=13,E(_.dataId);case 13:e=r.sent;case 14:b&&e.length==1&&b.getProgress(),r.next=21;break;case 17:return r.prev=17,r.t0=r.catch(2),console.log("annotation create err",r.t0),r.abrupt("return",j.Z.parseError(r.t0,T.default));case 21:case"end":return r.stop()}},s,null,[[2,17]])}));return function(_){return A.apply(this,arguments)}}();function d(A){return L.apply(this,arguments)}function L(){return L=(0,C.Z)(u().mark(function A(s){var _,c;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove",s),_=typeof s=="number"?s:s.annotationId,_!=null){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,z.remove(_);case 7:if(!(i&&i.length&&i[0].dataId)){e.next=12;break}return e.next=10,E(i[0].dataId);case 10:c=e.sent,c.length==0&&b.getProgress();case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(4),console.log("annotation remove err",e.t0),e.abrupt("return",j.Z.parseError(e.t0,T.default));case 18:case"end":return e.stop()}},A,null,[[4,14]])})),L.apply(this,arguments)}function v(A){return $.apply(this,arguments)}function $(){return $=(0,C.Z)(u().mark(function A(s){return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(console.log("annotation setcurr",s,"all",i),s!=null){c.next=4;break}return S(void 0),c.abrupt("return");case 4:S(s),g.setCurr(s.labelId);case 6:case"end":return c.stop()}},A)})),$.apply(this,arguments)}function K(A){return I.apply(this,arguments)}function I(){return I=(0,C.Z)(u().mark(function A(s){var _;return u().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.annotationId){l.next=2;break}return l.abrupt("return",[]);case 2:s.taskId=void 0,s.label&&(s.labelId=(_=s.label)===null||_===void 0?void 0:_.labelId),s.label=void 0,z.update(s.annotationId,s).then(function(e){return console.log("annotation update res",e),v(s),E(s.dataId)}).catch(function(e){return console.log("annotation update err ",e),j.Z.parseError(e,T.default),[]});case 6:case"end":return l.stop()}},A)})),I.apply(this,arguments)}function H(A){return F.apply(this,arguments)}function F(){return F=(0,C.Z)(u().mark(function A(s){return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s){c.next=2;break}return c.abrupt("return",void 0);case 2:if(s.annotationId!=null){c.next=7;break}return c.next=5,k(s);case 5:c.next=9;break;case 7:return c.next=9,K(s);case 9:case"end":return c.stop()}},A)})),F.apply(this,arguments)}return{all:i,getAll:E,create:k,remove:d,setCurr:v,update:K,modify:H,curr:O}}var oe=function(a){var f=a(),g=(0,U.Z)(f,2),n=g[0],b=g[1],M=a([]),w=(0,U.Z)(M,2),i=w[0],D=w[1],P=function(){var O=(0,C.Z)(u().mark(function S(E){return u().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:b(E);case 1:case"end":return d.stop()}},S)}));return function(E){return O.apply(this,arguments)}}(),R=function(){var O=(0,C.Z)(u().mark(function S(E,k){var d;return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,ne.getDatas(E);case 3:if(d=v.sent,D(d),k==null){v.next=8;break}return P(k),v.abrupt("return",[d,d[k]]);case 8:return v.abrupt("return",d);case 11:return v.prev=11,v.t0=v.catch(0),console.log("data getall err ",v.t0),v.abrupt("return",j.Z.parseError(v.t0,T.default));case 15:case"end":return v.stop()}},S,null,[[0,11]])}));return function(E,k){return O.apply(this,arguments)}}();return{all:i,getAll:R,turnTo:P,get curr(){if(!(n==null||i==null))return i[n]},get imgSrc(){return i&&i[n]?"".concat(V,"/datas/").concat(i[n].dataId,"/image?sault=").concat(i[n].sault):""}}};function ge(Z,a){return B.exportDataset(Z,{exportDir:a}).then(function(f){console.log(f)}).catch(function(f){console.log("export error",f),j.Z.parseError(f,T.default)})}function ve(Z,a){return Q.apply(this,arguments)}function Q(){return Q=(0,C.Z)(u().mark(function Z(a,f){return u().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("split param",f),n.abrupt("return",B.splitDataset(a,f).then(function(b){console.log(b)}).catch(function(b){console.log("split error",b),j.Z.parseError(b,T.default)}));case 2:case"end":return n.stop()}},Z)})),Q.apply(this,arguments)}var he=function(a,f,g){var n=ie(a,g.tool?g.tool:{}),b=fe(a),M=se(a),w=pe(a),i=oe(a),D=ee(a),P=de(a,g.label?g.label:{}),R=ce(a,(0,X.Z)((0,X.Z)({},g.annotation),{},{label:P,project:D}));return f(function(){var O=j.Z.getQueryVariable("projectId");if(O!=null){var S=parseInt(O);D.getCurr(O).catch(function(E){j.Z.parseError(E,T.default)}),P.getAll(S),w.getAll(S),D.getProgress(S)}},[]),f(function(){w.all&&w.all.length!=0&&w.turnTo(0)},[w.all]),f(function(){if(w.currIdx!=null){var O=function(){var S=(0,C.Z)(u().mark(function E(){var k,d,L,v,$,K,I,H,F,A,s,_;return u().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if((k=w.curr)!==null&&k!==void 0&&k.projectId&&D.getProgress(w.curr.projectId),!((d=w.curr)!==null&&d!==void 0&&d.taskId)){l.next=13;break}return l.next=4,i.getAll(w.curr.taskId,0);case 4:return $=l.sent,K=(0,U.Z)($,2),I=K[0],H=K[1],l.next=10,R.getAll(H.dataId);case 10:if(F=l.sent,P.all){A=(0,Y.Z)(P.all);try{for(A.s();!(s=A.n()).done;)_=s.value,_.active=!1}catch(e){A.e(e)}finally{A.f()}}(L=g.effectTrigger)!==null&&L!==void 0&&L.postTaskChange&&((v=g.effectTrigger)===null||v===void 0||v.postTaskChange(P.all,F));case 13:b.setCurr(!1);case 14:case"end":return l.stop()}},E)}));return function(){return S.apply(this,arguments)}}();O()}},[w.currIdx]),[n,b,M,R,w,i,D,P,ve,ge]}}}]);
