(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(k,B,t){"use strict";t.d(B,{Z:function(){return a}});var C=t(94663),R=t(80112);function N(r){return Function.toString.call(r).indexOf("[native code]")!==-1}var w=t(18597);function m(r,s,b){return(0,w.Z)()?m=Reflect.construct:m=function(P,_,W){var Z=[null];Z.push.apply(Z,_);var y=Function.bind.apply(P,Z),f=new y;return W&&(0,R.Z)(f,W.prototype),f},m.apply(null,arguments)}function a(r){var s=typeof Map=="function"?new Map:void 0;return a=function(d){if(d===null||!N(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof s!="undefined"){if(s.has(d))return s.get(d);s.set(d,P)}function P(){return m(d,arguments,(0,C.Z)(this).constructor)}return P.prototype=Object.create(d.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),(0,R.Z)(P,d)},a(r)}},85024:function(k){k.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(k){k.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(k){k.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(k,B,t){"use strict";t.d(B,{oo:function(){return R}});function C(m){var a=0;if(!m)return a;var r=_createForOfIteratorHelper(m),s;try{for(r.s();!(s=r.n()).done;){var b=s.value;!b||!b.frontendId||b.frontendId>a&&(a=b.frontendId)}}catch(d){r.e(d)}finally{r.f()}return a}function R(m){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(m);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function N(m){var a=m.toString(16);return a.length==1?"0"+a:a}function w(m,a,r){return"#"+N(m)+N(a)+N(r)}},14836:function(k,B,t){"use strict";t.d(B,{Z:function(){return an}});var C=t(54421),R=t(38272),N=t(57663),w=t(71577),m=t(91220),a=t(67294),r=t(56159),s=t.n(r),b=t(49111),d=t(19650),P=t(2824),_=t(8870),W=t(85024),Z=t.n(W),y=t(63097),f=t(85893),en=function(x){var h=(0,_.Z)({},x.annotation),Y=(0,a.useState)(h.invisible),q=(0,P.Z)(Y,2),X=q[0],$=q[1],z=(0,a.useState)(0),K=(0,P.Z)(z,2),V=K[0],G=K[1];(0,a.useEffect)(function(){$(x.annotation.invisible)},[x.annotation.invisible]);var n=(0,f.jsxs)(R.ZP.Item,{className:"".concat(Z().listItem," ").concat(x.active?Z().listItemActive:""),unselectable:"on",onClick:function(){x.onClick(h)},children:[(0,f.jsxs)(d.Z,{align:"center",size:5,children:[(0,f.jsx)("a",{className:Z().eye,style:{backgroundImage:X?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(o){o.stopPropagation(),$(!X),x.onAnnotationModify(h)}})," ",(0,f.jsx)("span",{className:Z().annotationId,children:h.frontendId}),(0,f.jsx)("span",{className:Z().labelName,children:h.label.name}),(0,f.jsx)(y.Z,{color:h.label.color})]}),(0,f.jsx)("a",{className:Z().delete,onClick:function(o){o.stopPropagation();var v=new Date().getTime();v-V<300||(G(v),x.onAnnotationDelete(h))}})]});return n},on=en,rn=t(48971),e=function(x){var h=(0,rn.YB)(),Y=h.formatMessage({id:"component.PPAnnotationList.annotationList"}),q=h.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),X=new Set,$=[],z=(0,m.Z)(x.annotations),K;try{for(z.s();!(K=z.n()).done;){var V=K.value;X.has(V.frontendId)||($.push(V),X.add(V.frontendId))}}catch(G){z.e(G)}finally{z.f()}return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(R.ZP,{className:s().labelList,size:"large",header:(0,f.jsx)("div",{className:s().listHeader,children:Y}),bordered:!0,dataSource:$,renderItem:function(n){var l;return(0,f.jsx)(on,{onClick:x.onAnnotationSelect,annotation:n,active:n.frontendId==((l=x.currAnnotation)===null||l===void 0?void 0:l.frontendId),onAnnotationDelete:x.onAnnotationDelete,onAnnotationModify:x.onAnnotationModify})},footer:(0,f.jsx)("div",{children:(0,f.jsx)(w.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){x.onAnnotationAdd()},block:!0,children:q})})})})},an=e},91861:function(k,B,t){"use strict";t.d(B,{Ad:function(){return R},k3:function(){return N},Vd:function(){return w},td:function(){return m}});var C=40;function R(){localStorage.removeItem("history"),N([])}function N(a){var r=localStorage.getItem("history"),s=r?JSON.parse(r):{index:-1,items:[]};if(JSON.stringify(s.items[s.index])!=JSON.stringify(a)){var b=s.index>C?s.index-C:0,d=s.items.splice(b,s.index==0?1:s.index+1);s.items=d.concat([a]),s.index<=C?s.index++:s.index=C+1,localStorage.setItem("history",JSON.stringify(s))}}function w(){var a=localStorage.getItem("history");if(!!a){var r=JSON.parse(a);if(!!r&&!(r.index>=r.items.length-1))return r.index++,localStorage.setItem("history",JSON.stringify(r)),r.items[r.index]}}function m(){var a=localStorage.getItem("history");if(!!a){var r=JSON.parse(a);if(!(!r||!r.index)&&!(r.index<=0))return r.index--,localStorage.setItem("history",JSON.stringify(r)),r.items[r.index]}}},29396:function(k,B,t){"use strict";t.r(B),t.d(B,{default:function(){return G}});var C=t(8870),R=t(20228),N=t(11382),w=t(34669),m=t(54458),a=t(34792),r=t(48086),s=t(91220),b=t(2824),d=t(67294),P=t(48971),_=t(72285),W=t.n(_),Z=t(8088),y=t(61541),f=t(44434),en=t(5041),on=t(57436),rn=t(14836),e=t(85893),an=function(l){return(0,e.jsx)(y.Z,{active:l.active,imgSrc:l.imgSrc||"./pics/buttons/rectangle.png",onClick:l.onClick,children:l.children})},sn=an,x=t(19424),h=t(91861),Y=t(65031),q=t(57406);function X(n){if(!(!n||n.length<2))return{xmin:n[0],ymin:n[1],xmax:n[2]||void 0,ymax:n[3]||void 0}}function $(n){var l;if(!n.annotation||!n.annotation.lines||!n.annotation.label||!n.annotation.label.color)return[(0,e.jsx)(e.Fragment,{})];var o=n.annotation.lines,v=n.annotation.label.color,p=(0,q.oo)(v);if(!p)return[(0,e.jsx)(e.Fragment,{})];var O=((l=n.currentAnnotation)===null||l===void 0?void 0:l.frontendId)==n.annotation.frontendId,T=O?.5:.1,A=o.xmax!=null&&o.ymax!=null?(0,e.jsx)(Y.UL,{onMouseOver:function(){n.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){n.currentTool=="editor"&&n.onSelect(n.annotation)},stroke:v,strokeWidth:2/n.scale,globalCompositeOperation:"source-over",lineCap:"round",x:o.xmin,y:o.ymin,width:o.xmax-o.xmin,height:o.ymax-o.ymin,closed:!0,fill:"rgba(".concat(p.r,", ").concat(p.g,", ").concat(p.b,", ").concat(T,")")}):(0,e.jsx)(e.Fragment,{});function L(u){if(!u&&(o.xmax==null||o.ymax==null))return(0,e.jsx)(e.Fragment,{});var S=function(j){var D;if(n.currentTool=="editor"){var M=(D=n.stageRef)===null||D===void 0?void 0:D.current,E=M.findOne(".baseImage"),U=!1,g=j.target.x();g>E.width()/2&&(g=E.width()/2,U=!0),g<-E.width()/2&&(g=-E.width()/2,U=!0);var I=j.target.y();I>E.height()/2&&(I=E.height()/2,U=!0),I<-E.height()/2&&(I=-E.height()/2,U=!0),U&&j.target.setPosition({x:g,y:I}),u?(o.xmin=g,o.ymin=I):(o.xmax=g,o.ymax=I);var ln=(0,C.Z)((0,C.Z)({},n.annotation),{},{points:o});n.onDrag(ln)}};return(0,e.jsx)(Y.Cd,{onMouseDown:function(){n.currentTool=="editor"&&n.onSelect(n.annotation)},draggable:n.currentTool=="editor",onDragMove:S,onDragEnd:S,onMouseOver:function(){n.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:u?o.xmin:o.xmax,y:u?o.ymin:o.ymax,radius:5/n.scale,fill:v})}return[(0,e.jsxs)(Y.ZA,{children:[A,L(!0),L(!1)]},n.annotation.annotationId)]}function z(n){var l=1;if(!n||n.length==0)return l;var o=(0,s.Z)(n),v;try{for(o.s();!(v=o.n()).done;){var p=v.value;p.frontendId&&l<=p.frontendId&&(l=p.frontendId+1)}}catch(O){o.e(O)}finally{o.f()}return l}function K(n){var l=function(T,A,L,u){var S=(T.evt.offsetX+A)/u,H=(T.evt.offsetY+L)/u,j=X([S,H]);!j||n.onAnnotationAdd({frontendId:z(n.annotations),type:"rectangle",label:n.currentLabel,lines:j})},o=function(T,A,L,u){if(!(!n.currentAnnotation||!n.currentAnnotation.lines)){var S=(T.evt.offsetX+A)/u,H=(T.evt.offsetY+L)/u,j=n.currentAnnotation.lines;if(!!j){j.xmax=S,j.ymax=H;var D={type:"rectangle",frontendId:n.currentAnnotation.frontendId,label:n.currentAnnotation.label,points:j};n.onAnnotationModify(D)}}},v=function(T,A,L,u){n.currentTool=="rectangle"&&(n.currentAnnotation?o(T,A,L,u):l(T,A,L,u))},p=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:v,onMouseMove:function(){},onMouseUp:p,createElementsFunc:$}}var V=function(){var l,o=(0,x.$L)(d.useState,d.useEffect,{label:{oneHot:!0},tool:{defaultTool:"mover"},effectTrigger:{postTaskChange:h.Ad}}),v=o.tool,p=o.loading,O=o.scale,T=o.annotation,A=o.task,L=o.data,u=o.project,S=o.label,H=(0,d.useState)(),j=(0,b.Z)(H,2),D=j[0],M=j[1],E=(0,d.useState)([]),U=(0,b.Z)(E,2),g=U[0],I=U[1],ln=function(i){if(!i.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(i));g.push(i),I(g),M(i)},un=function(i){if(!i.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(i));var Q=[],J=(0,s.Z)(g),nn;try{for(J.s();!(nn=J.n()).done;){var tn=nn.value;tn.frontendId==i.frontendId?Q.push(i):Q.push(tn)}}catch(dn){J.e(dn)}finally{J.f()}console.log("modifyAnnotation, newAnnos:",Q,"anno:",i),I(Q),M(i)},vn=function(i){if(!i.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(i));var Q=[],J=(0,s.Z)(g),nn;try{for(J.s();!(nn=J.n()).done;){var tn=nn.value;tn.frontendId!=i.frontendId&&Q.push(tn)}}catch(dn){J.e(dn)}finally{J.f()}I(Q),M(void 0)},fn=K({currentLabel:S.curr,currentTool:v.curr,annotations:g,currentAnnotation:D,onAnnotationAdd:ln,onAnnotationModify:un,onMouseUp:function(){(0,h.k3)({annos:g,currAnno:D})}}),cn=fn,F=(0,P.YB)(),mn=F.formatMessage({id:"pages.toolBar.rectangle"}),gn=F.formatMessage({id:"pages.toolBar.zoomIn"}),xn=F.formatMessage({id:"pages.toolBar.zoomOut"}),hn=F.formatMessage({id:"pages.toolBar.move"}),yn=F.formatMessage({id:"pages.toolBar.unDo"}),An=F.formatMessage({id:"pages.toolBar.reDo"}),In=F.formatMessage({id:"pages.toolBar.save"}),Sn=F.formatMessage({id:"pages.toolBar.edit"}),jn=F.formatMessage({id:"pages.toolBar.clearMark"});return(0,e.jsxs)(Z.Z,{className:W().det,children:[(0,e.jsxs)(f.Z,{children:[(0,e.jsx)(sn,{active:v.curr=="rectangle",onClick:function(){if(!S.curr){r.default.error("Please choose a label category first!");return}v.setCurr("rectangle"),M(void 0)},children:mn}),(0,e.jsx)(y.Z,{active:v.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){v.setCurr("editor")},children:Sn}),(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){O.change(.1)},children:gn}),(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){O.change(-.1)},children:xn}),(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){r.default.info("Annotations are saved automatically in this type of project. No need to click save.")},children:In}),(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/move.png",active:v.curr=="mover",onClick:function(){v.setCurr("mover")},children:hn}),(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var i=(0,h.td)();!i||(M(i.currAnno),I(i.annos))},children:yn}),(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var i=(0,h.Vd)();!i||(M(i.currAnno),I(i.annos))},children:An}),(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:jn})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(N.Z,{tip:"loading",spinning:!!p.curr,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(on.Z,{scale:O.curr,annotations:g,currentTool:v.curr,currentAnnotation:D,setCurrentAnnotation:M,onAnnotationModify:un,onAnnotationModifyComplete:function(){(0,h.k3)({annos:g,currAnno:D})},onMouseDown:cn.onMouseDown,onMouseMove:cn.onMouseMove,onMouseUp:cn.onMouseUp,createRectangleFunc:fn.createElementsFunc,imgSrc:L.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(m.Z,{className:"progressBar",percent:u.progress,status:"active",showInfo:!1})," ",(0,e.jsxs)("span",{className:"progressDesc",children:["Current labeling ",A.currIdx==null?1:A.currIdx+1," of"," ",(l=A.all)===null||l===void 0?void 0:l.length,". Already labeled ",A.finished(u.progress)||0,"."]})]})}),(0,e.jsx)("div",{className:"prevTask",onClick:function(){!A.prevTask()||(M(void 0),I([]))}}),(0,e.jsx)("div",{className:"nextTask",onClick:function(){!A.nextTask()||(M(void 0),I([]))}})]})}),(0,e.jsxs)(f.Z,{disLoc:"right",children:[(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){P.m8.push("/project_overview?projectId=".concat(u.curr.projectId))},children:"Project Overview"}),(0,e.jsx)(y.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){P.m8.push("/ml?projectId=".concat(u.curr.projectId))},children:"ML Settings"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)(en.Z,{labels:S.all,activeIds:S.activeIds,onLabelSelect:function(i){S.onSelect(i),M(void 0)},onLabelModify:function(){},onLabelDelete:S.remove,onLabelAdd:function(i){return S.create((0,C.Z)((0,C.Z)({},i),{},{projectId:u.curr.projectId}))}}),(0,e.jsx)(rn.Z,{annotations:g,currAnnotation:D,onAnnotationSelect:M,onAnnotationAdd:function(){M(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(i){vn(i)}})]})]})},G=V}}]);
