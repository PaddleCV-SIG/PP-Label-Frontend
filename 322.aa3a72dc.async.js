(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(ie,Q,U){"use strict";U.d(Q,{gu:function(){return x},os:function(){return ee},Gd:function(){return z},$L:function(){return le}});var H=U(86582),F=U(91220),y=U(3182),ce=U(34792),C=U(48086),L=U(2824),X=U(94043),l=U.n(X),N=U(48971),D=U(37071),R=U(81139),W=localStorage.getItem("basePath"),K=new R.VK(W?{basePath:W}:void 0),j=new R.U(K),Y=new R.sD(K),q=new R.W6(K),G=new R.Cl(K),J=new R.vb(K),x=function(p){return JSON.parse(JSON.stringify(p))};function ee($){return $&&($.toLowerCase().replace(/([-_][a-z])/g,function(p){return p.toUpperCase().replace("-","").replace("_","")}),$)}var V=function(p,b,_){if(!!_){for(var t=typeof p=="number"?p:p[_],w=0;w<b.length;w++)if(t==b[w][_])return w}},re=function(p){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],_=p(1),t=(0,L.Z)(_,2),w=t[0],M=t[1];function E(f){var Z=f;Z<b[0]&&(Z=b[0],C.default.error("Smallest scale is "+b[0])),Z>b[1]&&(Z=b[1],C.default.error("Largest scale is "+b[1])),M(Z)}function i(f){E(w+f)}return{curr:w,change:i,setScale:E}},z=function(p){var b=p(),_=(0,L.Z)(b,2),t=_[0],w=_[1],M=p(),E=(0,L.Z)(M,2),i=E[0],f=E[1];function Z(){return O.apply(this,arguments)}function O(){return O=(0,y.Z)(l().mark(function r(){var c;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getAll();case 3:return c=e.sent,w(c),e.abrupt("return",c);case 8:return e.prev=8,e.t0=e.catch(0),console.log("project getAll err",e.t0),D.Z.parseError(e.t0,C.default),e.abrupt("return");case 13:case"end":return e.stop()}},r,null,[[0,8]])})),O.apply(this,arguments)}function I(r){return T.apply(this,arguments)}function T(){return T=(0,y.Z)(l().mark(function r(c){var o;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c!=null){a.next=2;break}return a.abrupt("return",void 0);case 2:if(!(t&&t.length>1)){a.next=5;break}return C.default.error("Currently have multiple projects stored, use turnTo instead"),a.abrupt("return");case 5:return a.next=7,j.get(c);case 7:return o=a.sent,w([o]),f(0),a.abrupt("return",o);case 11:case"end":return a.stop()}},r)})),T.apply(this,arguments)}function m(r){return d.apply(this,arguments)}function d(){return d=(0,y.Z)(l().mark(function r(c){return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f(c),e.abrupt("return",t[c]);case 2:case"end":return e.stop()}},r)})),d.apply(this,arguments)}function u(r){return h.apply(this,arguments)}function h(){return h=(0,y.Z)(l().mark(function r(c){var o;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("remove project",c),o=typeof c=="number"?c:c.projectId,a.next=4,j.remove(o);case 4:Z();case 5:case"end":return a.stop()}},r)})),h.apply(this,arguments)}function s(r){return n.apply(this,arguments)}function n(){return n=(0,y.Z)(l().mark(function r(c){var o;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,j.create(c);case 3:return o=a.sent,a.abrupt("return",o);case 7:return a.prev=7,a.t0=a.catch(0),console.log("project create err",a.t0),a.abrupt("return",D.Z.parseError(a.t0,C.default));case 11:case"end":return a.stop()}},r,null,[[0,7]])})),n.apply(this,arguments)}function v(r,c){return A.apply(this,arguments)}function A(){return A=(0,y.Z)(l().mark(function r(c,o){return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:j.update(c,o).then(function(k){console.log("project update res",k)}).catch(function(k){console.log("project update err ",k),D.Z.parseError(k,C.default)});case 1:case"end":return a.stop()}},r)})),A.apply(this,arguments)}return{all:t,getAll:Z,getCurr:I,turnTo:m,remove:u,create:s,update:v,get curr(){if(!!t)return t[i]}}},ae=function(p,b){var _=b.oneHot,t=_===void 0?!0:_,w=b.postSetCurr,M=p(),E=(0,L.Z)(M,2),i=E[0],f=E[1],Z=p(),O=(0,L.Z)(Z,2),I=O[0],T=O[1],m=p(t),d=(0,L.Z)(m,2),u=d[0],h=d[1],s=function(){var o=(0,y.Z)(l().mark(function e(a){var k,g,P,B;return l().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,j.getLabels(a);case 3:k=S.sent,g=(0,F.Z)(k);try{for(g.s();!(P=g.n()).done;)B=P.value,B.active=!1}catch(se){g.e(se)}finally{g.f()}return f(k),S.abrupt("return",k);case 10:return S.prev=10,S.t0=S.catch(0),console.log("label getall err ",S.t0),S.abrupt("return",D.Z.parseError(S.t0,C.default));case 14:case"end":return S.stop()}},e,null,[[0,10]])}));return function(a){return o.apply(this,arguments)}}(),n=function(e){var a=V(e,i,"labelId");if(a==null)throw Error("undefined label idx");if(T(a),u){var k=(0,F.Z)(i),g;try{for(k.s();!(g=k.n()).done;){var P=g.value;P.active=!1}}catch(B){k.e(B)}finally{k.f()}i[a].active=!0,console.log("all",i)}else i[a].active=!i[a].active;w&&w(i[a]),f((0,H.Z)(i))},v=function(){var o=(0,y.Z)(l().mark(function e(a){var k;return l().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,J.create(a);case 3:return k=P.sent,k.active=!1,f([].concat((0,H.Z)(i),[k])),P.abrupt("return",k);case 9:return P.prev=9,P.t0=P.catch(0),console.log("label create err",P.t0),P.abrupt("return",D.Z.parseError(P.t0,C.default));case 13:case"end":return P.stop()}},e,null,[[0,9]])}));return function(a){return o.apply(this,arguments)}}(),A=function(){var o=(0,y.Z)(l().mark(function e(a){return l().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return console.log("remove label",a),g.prev=1,g.next=4,J.remove(a.labelId);case 4:f(i.filter(function(P){return P.labelId!=a.labelId})),g.next=11;break;case 7:g.prev=7,g.t0=g.catch(1),console.log("label remove err",g.t0),D.Z.parseError(g.t0,C.default);case 11:case"end":return g.stop()}},e,null,[[1,7]])}));return function(a){return o.apply(this,arguments)}}(),r=function(){},c=function(){h(!u)};return{all:i,getAll:s,setAll:f,setCurr:n,create:v,remove:A,onModify:r,toggleOneHot:c,get curr(){if(I!=null)return i[I]}}},ne=function(p){var b=p(),_=(0,L.Z)(b,2),t=_[0],w=_[1],M=p(),E=(0,L.Z)(M,2),i=E[0],f=E[1],Z=p(),O=(0,L.Z)(Z,2),I=O[0],T=O[1],m=function(v){if(v<0){C.default.error("This is the first image. No previous image.");return}if(v==t.length){C.default.error("This is the final image. No next image.");return}console.log("turning to",v),f(v)},d=function(){var n=(0,y.Z)(l().mark(function v(A,r){var c;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getTasks(A);case 3:if(c=e.sent,w(c),r==null){e.next=9;break}return console.log("getall turnto"),m(r),e.abrupt("return",[c,c[r]]);case 9:return e.abrupt("return",c);case 12:return e.prev=12,e.t0=e.catch(0),console.log("task getall err ",e.t0),e.abrupt("return",D.Z.parseError(e.t0,C.default));case 16:case"end":return e.stop()}},v,null,[[0,12]])}));return function(A,r){return n.apply(this,arguments)}}(),u=function(){var n=(0,y.Z)(l().mark(function v(A){var r,c;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getProgress(A);case 3:if(r=e.sent,!(!r||r.finished==null||r.total==null)){e.next=6;break}throw Error("empty progress");case 6:return c=Math.ceil(r.finished/r.total*100),T(c),e.abrupt("return",c);case 11:return e.prev=11,e.t0=e.catch(0),console.log("get progress err",e.t0),D.Z.parseError(e.t0,C.default),e.abrupt("return",0);case 16:case"end":return e.stop()}},v,null,[[0,11]])}));return function(A){return n.apply(this,arguments)}}(),h=function(){var n=(0,y.Z)(l().mark(function v(){return l().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:m(i+1),console.log("all tasks",t);case 2:case"end":return r.stop()}},v)}));return function(){return n.apply(this,arguments)}}(),s=function(){var n=(0,y.Z)(l().mark(function v(){return l().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:m(i-1);case 1:case"end":return r.stop()}},v)}));return function(){return n.apply(this,arguments)}}();return{currIdx:i,all:t,turnTo:m,getAll:d,getProgress:u,progress:I,nextTask:h,prevTask:s,get curr(){if(!(i==null||t==null))return console.log("task.curr",t[i]),t[i]},get finished(){return Math.floor((t==null?void 0:t.length)*I/100)}}},te=function(p){var b=p(),_=(0,L.Z)(b,2),t=_[0],w=_[1],M=p(),E=(0,L.Z)(M,2),i=E[0],f=E[1],Z=function(){var m=(0,y.Z)(l().mark(function d(u){var h,s,n,v;return l().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,q.getAnnotations(u);case 3:h=r.sent,s=(0,F.Z)(h);try{for(s.s();!(n=s.n()).done;)v=n.value,v.active=!1}catch(c){s.e(c)}finally{s.f()}return w(h),r.abrupt("return",h);case 10:return r.prev=10,r.t0=r.catch(0),console.log("ann getAll err",r.t0),r.abrupt("return",D.Z.parseError(r.t0,C.default));case 14:case"end":return r.stop()}},d,null,[[0,10]])}));return function(u){return m.apply(this,arguments)}}(),O=function(){var m=(0,y.Z)(l().mark(function d(u){var h;return l().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("create",u),n.prev=1,n.next=4,G.create(u);case 4:return h=n.sent,u.dataId&&Z(u.dataId),n.abrupt("return",h);case 9:return n.prev=9,n.t0=n.catch(1),console.log("annotation create err",n.t0),n.abrupt("return",D.Z.parseError(n.t0,C.default));case 13:case"end":return n.stop()}},d,null,[[1,9]])}));return function(u){return m.apply(this,arguments)}}(),I=function(){var m=(0,y.Z)(l().mark(function d(u){var h;return l().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("typeof",typeof u),h=typeof u!="number"?u.annotationId:u,n.prev=2,!h){n.next=6;break}return n.next=6,G.remove(h);case 6:w(t.filter(function(v){return v.annotationId!=h})),n.next=13;break;case 9:return n.prev=9,n.t0=n.catch(2),console.log("annotation remove err",n.t0),n.abrupt("return",D.Z.parseError(n.t0,C.default));case 13:case"end":return n.stop()}},d,null,[[2,9]])}));return function(u){return m.apply(this,arguments)}}(),T=function(){var m=(0,y.Z)(l().mark(function d(u,h){var s,n,v,A,r;return l().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(u!=null){o.next=3;break}return f(void 0),o.abrupt("return");case 3:s=(0,F.Z)(t);try{for(s.s();!(n=s.n()).done;)v=n.value,v.active=!1}catch(e){s.e(e)}finally{s.f()}A=t.filter(function(e){return e.annotationId==u.annotationId})[0],A.active=!u.active,r=V(A,t,"annotationId"),f(r),w((0,H.Z)(t)),console.log("ann on select label",h),h.setCurr(u.labelId);case 12:case"end":return o.stop()}},d)}));return function(u,h){return m.apply(this,arguments)}}();return{all:t,getAll:Z,create:O,remove:I,setCurr:T,get curr(){if(!(!t||!i))return t[i]}}},ue=function(p){var b=p(),_=(0,L.Z)(b,2),t=_[0],w=_[1],M=p([]),E=(0,L.Z)(M,2),i=E[0],f=E[1],Z=function(){var I=(0,y.Z)(l().mark(function T(m){return l().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:w(m);case 1:case"end":return u.stop()}},T)}));return function(m){return I.apply(this,arguments)}}(),O=function(){var I=(0,y.Z)(l().mark(function T(m,d){var u;return l().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Y.getDatas(m);case 3:if(u=s.sent,f(u),d==null){s.next=8;break}return Z(d),s.abrupt("return",[u,u[d]]);case 8:return s.abrupt("return",u);case 11:return s.prev=11,s.t0=s.catch(0),console.log("data getall err ",s.t0),s.abrupt("return",D.Z.parseError(s.t0,C.default));case 15:case"end":return s.stop()}},T,null,[[0,11]])}));return function(m,d){return I.apply(this,arguments)}}();return{all:i,getAll:O,turnTo:Z,get curr(){if(!(t==null||i==null))return i[t]},get imgSrc(){return i&&i[t]?(console.log("imgsrc","".concat(W,"/datas/").concat(i[t].dataId,"/image?sault=").concat(i[t].sault)),"".concat(W,"/datas/").concat(i[t].dataId,"/image?sault=").concat(i[t].sault)):""}}},le=function(p,b,_){_.effectTrigger||(_.effectTrigger={});var t=p(!1),w=(0,L.Z)(t,2),M=w[0],E=w[1],i=re(p),f=ne(p),Z=ue(p),O=z(p),I=ae(p,_.label),T=te(p);return b(function(){var m=D.Z.getQueryVariable("projectId");if(m==null){N.m8.push("/");return}var d=parseInt(m);O.getCurr(m).catch(function(u){D.Z.parseError(u,C.default),N.m8.push("/")}),I.getAll(d),f.getAll(d),f.getProgress(d)},[]),b(function(){f.all&&f.all.length!=0&&f.turnTo(0)},[f.all]),b(function(){if(f.currIdx!=null){var m=function(){var d=(0,y.Z)(l().mark(function u(){var h,s,n,v,A,r,c,o,e,a;return l().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(console.log("onTaskChange",f.curr,I.all,f.progress),(h=f.curr)!==null&&h!==void 0&&h.projectId&&f.getProgress(f.curr.projectId),!((s=f.curr)!==null&&s!==void 0&&s.taskId)){g.next=15;break}return g.next=5,Z.getAll(f.curr.taskId,0);case 5:return n=g.sent,v=(0,L.Z)(n,2),A=v[0],r=v[1],console.log(A),g.next=12,T.getAll(r.dataId);case 12:if(c=g.sent,I.all){o=(0,F.Z)(I.all);try{for(o.s();!(e=o.n()).done;)a=e.value,a.active=!1}catch(P){o.e(P)}finally{o.f()}}_.effectTrigger.postTaskChange&&_.effectTrigger.postTaskChange(I.all,c);case 15:E(!1);case 16:case"end":return g.stop()}},u)}));return function(){return d.apply(this,arguments)}}();m()}},[f.currIdx]),[M,E,i,T,f,Z,O,I]}}}]);
