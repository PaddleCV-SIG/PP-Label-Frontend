(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(_e,ae,R){"use strict";R.d(ae,{gu:function(){return le},os:function(){return se},Gd:function(){return re},$L:function(){return me}});var Y=R(11849),q=R(91220),Z=R(3182),be=R(34792),k=R(48086),D=R(2824),ne=R(94043),u=R.n(ne),x=R(48971),j=R(37071),N=R(81139),z=localStorage.getItem("basePath"),G=new N.VK(z?{basePath:z}:void 0),K=new N.U(G),te=new N.sD(G),ue=new N.W6(G),Q=new N.Cl(G),ee=new N.vb(G),le=function(l){return JSON.parse(JSON.stringify(l))};function se(P){return P&&(P.toLowerCase().replace(/([-_][a-z])/g,function(l){return l.toUpperCase().replace("-","").replace("_","")}),P)}var J=function(l,d,h){if(!!h){for(var s=typeof l=="number"?l:l[h],m=0;m<d.length;m++)if(s==d[m][h])return m}},ie=function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],h=l(1),s=(0,D.Z)(h,2),m=s[0],O=s[1];function _(E){var I=E;I<d[0]&&(I=d[0],k.default.error("Smallest scale is "+d[0])),I>d[1]&&(I=d[1],k.default.error("Largest scale is "+d[1])),O(I)}function i(E){_(m+E)}return{curr:m,change:i,setScale:_}};function ce(P,l){var d=l.defaultTool,h=P(d),s=(0,D.Z)(h,2),m=s[0],O=s[1];return{curr:m,setCurr:O}}function fe(P){var l=P(!1),d=(0,D.Z)(l,2),h=d[0],s=d[1];return{curr:h,setCurr:s}}var re=function(l){var d=l(),h=(0,D.Z)(d,2),s=h[0],m=h[1],O=l(),_=(0,D.Z)(O,2),i=_[0],E=_[1],I=l(),L=(0,D.Z)(I,2),C=L[0],y=L[1];function S(){return b.apply(this,arguments)}function b(){return b=(0,Z.Z)(u().mark(function a(){var r;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,K.getAll();case 3:return r=t.sent,m(r),t.abrupt("return",r);case 8:return t.prev=8,t.t0=t.catch(0),console.log("project getAll err",t.t0),j.Z.parseError(t.t0,k.default),t.abrupt("return");case 13:case"end":return t.stop()}},a,null,[[0,8]])})),b.apply(this,arguments)}function c(a){return $.apply(this,arguments)}function $(){return $=(0,Z.Z)(u().mark(function a(r){var o;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r!=null){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(s&&s.length>1)){e.next=5;break}return k.default.error("Currently have multiple projects stored, use turnTo instead"),e.abrupt("return");case 5:return e.next=7,K.get(r);case 7:return o=e.sent,m([o]),E(0),e.abrupt("return",o);case 11:case"end":return e.stop()}},a)})),$.apply(this,arguments)}function p(a){return T.apply(this,arguments)}function T(){return T=(0,Z.Z)(u().mark(function a(r){return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return E(r),t.abrupt("return",s[r]);case 2:case"end":return t.stop()}},a)})),T.apply(this,arguments)}function F(a){return w.apply(this,arguments)}function w(){return w=(0,Z.Z)(u().mark(function a(r){var o;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("remove project",r),o=typeof r=="number"?r:r.projectId,e.next=4,K.remove(o);case 4:S();case 5:case"end":return e.stop()}},a)})),w.apply(this,arguments)}function W(a){return U.apply(this,arguments)}function U(){return U=(0,Z.Z)(u().mark(function a(r){var o;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K.create(r);case 3:return o=e.sent,e.abrupt("return",o);case 7:return e.prev=7,e.t0=e.catch(0),console.log("project create err",e.t0),e.abrupt("return",j.Z.parseError(e.t0,k.default));case 11:case"end":return e.stop()}},a,null,[[0,7]])})),U.apply(this,arguments)}function M(a,r){return B.apply(this,arguments)}function B(){return B=(0,Z.Z)(u().mark(function a(r,o){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:K.update(r,o).then(function(n){console.log("project update res",n)}).catch(function(n){console.log("project update err ",n),j.Z.parseError(n,k.default)});case 1:case"end":return e.stop()}},a)})),B.apply(this,arguments)}function H(){return A.apply(this,arguments)}function A(){return A=(0,Z.Z)(u().mark(function a(){var r,o,t,e,n=arguments;return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return r=n.length>0&&n[0]!==void 0?n[0]:void 0,v.prev=1,o=r==null?s[i].projectId:r,v.next=5,K.getProgress(o);case 5:if(t=v.sent,!(!t||t.finished==null||t.total==null)){v.next=8;break}throw Error("empty progress");case 8:return e=Math.ceil(t.finished/t.total*100),y(e),v.abrupt("return",e);case 13:return v.prev=13,v.t0=v.catch(1),console.log("get progress err",v.t0),j.Z.parseError(v.t0,k.default),v.abrupt("return",0);case 18:case"end":return v.stop()}},a,null,[[1,13]])})),A.apply(this,arguments)}return{all:s,getAll:S,getCurr:c,turnTo:p,remove:F,create:W,update:M,progress:C,getProgress:H,get curr(){if(!!s)return s[i]}}},pe=function(l,d){var h=d.oneHot,s=h===void 0?!0:h,m=d.postSetCurr,O=l(),_=(0,D.Z)(O,2),i=_[0],E=_[1],I=l(),L=(0,D.Z)(I,2),C=L[0],y=L[1],S=l(new Set),b=(0,D.Z)(S,2),c=b[0],$=b[1],p=l(s),T=(0,D.Z)(p,2),F=T[0],w=T[1];function W(n){return U.apply(this,arguments)}function U(){return U=(0,Z.Z)(u().mark(function n(g){var v;return u().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(console.log("label getall"),g!=null){f.next=3;break}return f.abrupt("return");case 3:return f.prev=3,f.next=6,K.getLabels(g);case 6:return v=f.sent,E(v),f.abrupt("return",v);case 11:return f.prev=11,f.t0=f.catch(3),console.log("label getall err ",f.t0),f.abrupt("return",j.Z.parseError(f.t0,k.default));case 15:case"end":return f.stop()}},n,null,[[3,11]])})),U.apply(this,arguments)}function M(n){var g=J(n,i,"labelId");if(g==null)throw Error("label.onSelect label not found");y(g);var v=i[g].labelId;F?c.has(v)?c.clear():(c.clear(),c.add(v)):c.has(v)?c.delete(v):c.add(v),$(new Set(c)),m&&m(i[g])}function B(n){if(console.log("setCurr",n),!s)throw Error("multi select task doesn't have current label");if(!!n){var g=typeof n=="number"?n:n.labelId;g=J(g,i,"labelId"),g&&(console.log("setCurr index:",g),y(g),$(new Set([g])))}}function H(n){c.clear();var g=(0,q.Z)(n),v;try{for(g.s();!(v=g.n()).done;){var V=v.value;c.add(V.labelId)}}catch(f){g.e(f)}finally{g.f()}}function A(n){return a.apply(this,arguments)}function a(){return a=(0,Z.Z)(u().mark(function n(g){var v;return u().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return console.log("create label",g),f.prev=1,f.next=4,ee.create(g);case 4:return v=f.sent,W(g.projectId),f.abrupt("return",v);case 9:return f.prev=9,f.t0=f.catch(1),console.log("label create err",f.t0),f.abrupt("return",j.Z.parseError(f.t0,k.default));case 13:case"end":return f.stop()}},n,null,[[1,9]])})),a.apply(this,arguments)}function r(n){return o.apply(this,arguments)}function o(){return o=(0,Z.Z)(u().mark(function n(g){var v;return u().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return v=typeof g=="number"?g:g.labelId,f.prev=1,f.next=4,ee.remove(v);case 4:i&&i.length&&W(i[0].projectId),f.next=11;break;case 7:f.prev=7,f.t0=f.catch(1),console.log("label remove err",f.t0),j.Z.parseError(f.t0,k.default);case 11:case"end":return f.stop()}},n,null,[[1,7]])})),o.apply(this,arguments)}function t(n){var g=typeof n=="number"?n:n.labelId;return c.has(g)}var e=function(g){g!=null?w(g):w(!F)};return{all:i,getAll:W,activeIds:c,initActive:H,onSelect:M,setCurr:B,isActive:t,create:A,remove:r,toggleOneHot:e,get curr(){if(i!=null)return i[C]}}},de=function(l){var d=l(),h=(0,D.Z)(d,2),s=h[0],m=h[1],O=l(),_=(0,D.Z)(O,2),i=_[0],E=_[1],I=function(c){if(!!s){if(c<0){k.default.error("This is the first image. No previous image.");return}if(c==s.length){k.default.error("This is the final image. No next image.");return}E(c)}},L=function(){var b=(0,Z.Z)(u().mark(function c($,p){var T;return u().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.prev=0,w.next=3,K.getTasks($);case 3:if(T=w.sent,m(T),p==null){w.next=9;break}return console.log("getall turnto"),I(p),w.abrupt("return",[T,T[p]]);case 9:return w.abrupt("return",T);case 12:return w.prev=12,w.t0=w.catch(0),console.log("task getall err ",w.t0),w.abrupt("return",j.Z.parseError(w.t0,k.default));case 16:case"end":return w.stop()}},c,null,[[0,12]])}));return function($,p){return b.apply(this,arguments)}}();function C(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return b==null||!s?0:Math.round(s.length*b/100)}var y=function(){var b=(0,Z.Z)(u().mark(function c(){return u().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:I(i+1),console.log("all tasks",s);case 2:case"end":return p.stop()}},c)}));return function(){return b.apply(this,arguments)}}(),S=function(){var b=(0,Z.Z)(u().mark(function c(){return u().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:I(i-1);case 1:case"end":return p.stop()}},c)}));return function(){return b.apply(this,arguments)}}();return{currIdx:i,all:s,turnTo:I,getAll:L,nextTask:y,prevTask:S,finished:C,get curr(){if(!(i==null||s==null))return s[i]}}};function oe(P,l){var d=l.label,h=d===void 0?void 0:d,s=l.project,m=s===void 0?void 0:s,O=P(),_=(0,D.Z)(O,2),i=_[0],E=_[1],I=P(),L=(0,D.Z)(I,2),C=L[0],y=L[1],S=P(new Set),b=(0,D.Z)(S,2),c=b[0],$=b[1],p=function(){var A=(0,Z.Z)(u().mark(function a(r){var o;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r!=null){e.next=2;break}return e.abrupt("return",[]);case 2:return e.prev=2,e.next=5,ue.getAnnotations(r);case 5:return o=e.sent,E(o),e.abrupt("return",o);case 10:return e.prev=10,e.t0=e.catch(2),console.log("ann getAll err",e.t0),j.Z.parseError(e.t0,k.default),e.abrupt("return",[]);case 15:case"end":return e.stop()}},a,null,[[2,10]])}));return function(r){return A.apply(this,arguments)}}(),T=function(){var A=(0,Z.Z)(u().mark(function a(r){var o,t;return u().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r.label&&(r.labelId=r.label.id),n.next=4,Q.create(r);case 4:if(o=n.sent,t=[],!r.dataId){n.next=10;break}return n.next=9,p(r.dataId);case 9:t=n.sent;case 10:return m&&t.length==1&&m.getProgress(),n.abrupt("return",o);case 14:return n.prev=14,n.t0=n.catch(0),console.log("annotation create err",n.t0),n.abrupt("return",j.Z.parseError(n.t0,k.default));case 18:case"end":return n.stop()}},a,null,[[0,14]])}));return function(r){return A.apply(this,arguments)}}();function F(A){return w.apply(this,arguments)}function w(){return w=(0,Z.Z)(u().mark(function A(a){var r,o;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove",a),r=typeof a=="number"?a:a.annotationId,r!=null){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Q.remove(r);case 7:if(!(i&&i.length&&i[0].dataId)){e.next=12;break}return e.next=10,p(i[0].dataId);case 10:o=e.sent,o.length==0&&m.getProgress();case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(4),console.log("annotation remove err",e.t0),e.abrupt("return",j.Z.parseError(e.t0,k.default));case 18:case"end":return e.stop()}},A,null,[[4,14]])})),w.apply(this,arguments)}var W=function(){var A=(0,Z.Z)(u().mark(function a(r){var o;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("annotation setcurr",r),r!=null){e.next=4;break}return y(void 0),e.abrupt("return");case 4:if(o=J(r,i,"annotationId"),o){e.next=8;break}return e.next=8,T(r);case 8:y(J(r,i,"annotationId")),$(new Set([r.annotationId])),h.setCurr(r.labelId),console.log(J(r,i,"annotationId"),new Set([r.annotationId]),r.labelId);case 12:case"end":return e.stop()}},a)}));return function(r){return A.apply(this,arguments)}}();function U(A){return M.apply(this,arguments)}function M(){return M=(0,Z.Z)(u().mark(function A(a){return u().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:Q.update(a.annotationId,a).then(function(t){console.log("annotation update res",t),p(a.projectId)}).catch(function(t){console.log("annotation update err ",t),j.Z.parseError(t,k.default)});case 1:case"end":return o.stop()}},A)})),M.apply(this,arguments)}function B(A){return H.apply(this,arguments)}function H(){return H=(0,Z.Z)(u().mark(function A(a){var r;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=a==null?i[C]:a,r.annotationId==null?T(r):U(r);case 2:case"end":return t.stop()}},A)})),H.apply(this,arguments)}return{all:i,getAll:p,create:T,remove:F,setCurr:W,update:U,modify:B,activeIds:c,get curr(){if(!(!i||!C))return i[C]}}}var ge=function(l){var d=l(),h=(0,D.Z)(d,2),s=h[0],m=h[1],O=l([]),_=(0,D.Z)(O,2),i=_[0],E=_[1],I=function(){var C=(0,Z.Z)(u().mark(function y(S){return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:m(S);case 1:case"end":return c.stop()}},y)}));return function(S){return C.apply(this,arguments)}}(),L=function(){var C=(0,Z.Z)(u().mark(function y(S,b){var c;return u().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,te.getDatas(S);case 3:if(c=p.sent,E(c),b==null){p.next=8;break}return I(b),p.abrupt("return",[c,c[b]]);case 8:return p.abrupt("return",c);case 11:return p.prev=11,p.t0=p.catch(0),console.log("data getall err ",p.t0),p.abrupt("return",j.Z.parseError(p.t0,k.default));case 15:case"end":return p.stop()}},y,null,[[0,11]])}));return function(S,b){return C.apply(this,arguments)}}();return{all:i,getAll:L,turnTo:I,get curr(){if(!(s==null||i==null))return i[s]},get imgSrc(){return i&&i[s]?"".concat(z,"/datas/").concat(i[s].dataId,"/image?sault=").concat(i[s].sault):""}}};function ve(P,l){K.exportDataset(P,{exportDir:l}).then(function(d){console.log(d)}).catch(function(d){console.log("export error",d),j.Z.parseError(d,k.default)})}function he(P,l){return X.apply(this,arguments)}function X(){return X=(0,Z.Z)(u().mark(function P(l,d){return u().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:console.log("split param",d),K.splitDataset(l,d).then(function(m){console.log(m)}).catch(function(m){console.log("split error",m),j.Z.parseError(m,k.default)});case 2:case"end":return s.stop()}},P)})),X.apply(this,arguments)}var me=function(l,d,h){var s=ce(l,h.tool?h.tool:{}),m=fe(l),O=ie(l),_=de(l),i=ge(l),E=re(l),I=pe(l,h.label?h.label:{}),L=oe(l,(0,Y.Z)((0,Y.Z)({},h.annotation),{},{label:I,project:E}));return d(function(){var C=j.Z.getQueryVariable("projectId");if(C==null){x.m8.push("/");return}var y=parseInt(C);E.getCurr(C).catch(function(S){j.Z.parseError(S,k.default),x.m8.push("/")}),I.getAll(y),_.getAll(y),E.getProgress(y)},[]),d(function(){_.all&&_.all.length!=0&&_.turnTo(0)},[_.all]),d(function(){if(_.currIdx!=null){var C=function(){var y=(0,Z.Z)(u().mark(function S(){var b,c,$,p,T,F,w,W,U,M,B,H;return u().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if((b=_.curr)!==null&&b!==void 0&&b.projectId&&E.getProgress(_.curr.projectId),!((c=_.curr)!==null&&c!==void 0&&c.taskId)){a.next=13;break}return a.next=4,i.getAll(_.curr.taskId,0);case 4:return T=a.sent,F=(0,D.Z)(T,2),w=F[0],W=F[1],a.next=10,L.getAll(W.dataId);case 10:if(U=a.sent,I.all){M=(0,q.Z)(I.all);try{for(M.s();!(B=M.n()).done;)H=B.value,H.active=!1}catch(r){M.e(r)}finally{M.f()}}($=h.effectTrigger)!==null&&$!==void 0&&$.postTaskChange&&((p=h.effectTrigger)===null||p===void 0||p.postTaskChange(I.all,U));case 13:m.setCurr(!1);case 14:case"end":return a.stop()}},S)}));return function(){return y.apply(this,arguments)}}();C()}},[_.currIdx]),[s,m,O,L,_,i,E,I,he,ve]}}}]);
