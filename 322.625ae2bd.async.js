(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(ue,V,U){"use strict";U.d(V,{gu:function(){return Y},Gd:function(){return J},$L:function(){return le}});var B=U(86582),W=U(91220),O=U(3182),se=U(34792),Z=U(48086),C=U(2824),z=U(94043),s=U.n(z),L=U(37071),R=U(81139),H=localStorage.getItem("basePath"),F=new R.VK(H?{basePath:H}:void 0),$=new R.U(F),Q=new R.sD(F),X=new R.W6(F),N=new R.Cl(F),G=new R.vb(F),Y=function(i){return JSON.parse(JSON.stringify(i))};function ie(I){return I&&(I.toLowerCase().replace(/([-_][a-z])/g,function(i){return i.toUpperCase().replace("-","").replace("_","")}),I)}var q=function(i,v,f){if(!!f){for(var p=0;p<v.length;p++)if(i[f]==v[p][f])return p}},x=function(i){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,3],f=i(1),p=(0,C.Z)(f,2),k=p[0],D=p[1],E=function(m){var n=k;n+=m,n<v[0]&&(n=v[0],Z.default.error("Smallest scale is "+v[0])),n>v[1]&&(n=v[1],Z.default.error("Largest scale is "+v[1])),D(n)};return{curr:k,change:E}},J=function(i){var v=i([]),f=(0,C.Z)(v,2),p=f[0],k=f[1],D=i(),E=(0,C.Z)(D,2),c=E[0],m=E[1],n=function(){var h=(0,O.Z)(s().mark(function t(){var o;return s().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,$.getAll();case 3:return o=l.sent,k(o),l.abrupt("return",o);case 8:l.prev=8,l.t0=l.catch(0),console.log("project getAll err",l.t0),L.Z.parseError(l.t0,Z.default);case 12:case"end":return l.stop()}},t,null,[[0,8]])}));return function(){return h.apply(this,arguments)}}(),g=function(){var h=(0,O.Z)(s().mark(function t(o){var a;return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o!=null){r.next=2;break}return r.abrupt("return",void 0);case 2:if(!(p.length>1)){r.next=5;break}return Z.default.error("Currently have multiple projects stored, use turnTo instead"),r.abrupt("return");case 5:return r.prev=5,r.next=8,$.get(o);case 8:return a=r.sent,k([a]),m(0),r.abrupt("return",a);case 14:r.prev=14,r.t0=r.catch(5),console.log("prject getcurr err",r.t0),L.Z.parseError(r.t0,Z.default);case 18:case"end":return r.stop()}},t,null,[[5,14]])}));return function(o){return h.apply(this,arguments)}}(),b=function(){var h=(0,O.Z)(s().mark(function t(o){return s().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(console.log("remove project",o),typeof o!="number"){l.next=6;break}return l.next=4,$.remove(o);case 4:l.next=8;break;case 6:return l.next=8,$.remove(o.projectId);case 8:n();case 9:case"end":return l.stop()}},t)}));return function(o){return h.apply(this,arguments)}}(),_=function(){var h=(0,O.Z)(s().mark(function t(o){var a;return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,$.create(o);case 3:return a=r.sent,console.log(a),r.abrupt("return",a);case 8:r.prev=8,r.t0=r.catch(0),console.log("project create err",r.t0),L.Z.parseError(r.t0,Z.default);case 12:case"end":return r.stop()}},t,null,[[0,8]])}));return function(o){return h.apply(this,arguments)}}(),e=function(){var h=(0,O.Z)(s().mark(function t(o,a){return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:$.update(o,a).then(function(w){console.log("project update res",w)}).catch(function(w){console.log("project update err ",w),L.Z.parseError(w,Z.default)});case 1:case"end":return r.stop()}},t)}));return function(o,a){return h.apply(this,arguments)}}();return{all:p,getAll:n,getCurr:g,remove:b,create:_,update:e,get curr(){if(c!=null)return p[c]}}},ee=function(i,v){var f=v.oneHot,p=f===void 0?!0:f,k=v.postOnSelect,D=i(),E=(0,C.Z)(D,2),c=E[0],m=E[1],n=i(),g=(0,C.Z)(n,2),b=g[0],_=g[1],e=i(p),h=(0,C.Z)(e,2),t=h[0],o=h[1],a=function(){var S=(0,O.Z)(s().mark(function M(d){var y,P,A,K;return s().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.prev=0,T.next=3,$.getLabels(d);case 3:y=T.sent,P=(0,W.Z)(y);try{for(P.s();!(A=P.n()).done;)K=A.value,K.active=!1}catch(te){P.e(te)}finally{P.f()}return m(y),T.abrupt("return",y);case 10:T.prev=10,T.t0=T.catch(0),console.log("label getall err ",T.t0),L.Z.parseError(T.t0,Z.default);case 14:case"end":return T.stop()}},M,null,[[0,10]])}));return function(d){return S.apply(this,arguments)}}(),l=function(M){var d=q(M,c,"labelId");if(_(d),console.log("onehot",t),t){var y=(0,W.Z)(c),P;try{for(y.s();!(P=y.n()).done;){var A=P.value;A.active=!1}}catch(K){y.e(K)}finally{y.f()}c[d].active=!0,console.log("all",c)}else c[d].active=!c[d].active;k&&k(c[d]),m((0,B.Z)(c))},r=function(){var S=(0,O.Z)(s().mark(function M(d){var y;return s().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.prev=0,A.next=3,G.create(d);case 3:return y=A.sent,y.active=!1,m([].concat((0,B.Z)(c),[y])),A.abrupt("return",y);case 9:A.prev=9,A.t0=A.catch(0),console.log("label create err",A.t0),L.Z.parseError(A.t0,Z.default);case 13:case"end":return A.stop()}},M,null,[[0,9]])}));return function(d){return S.apply(this,arguments)}}(),w=function(){var S=(0,O.Z)(s().mark(function M(d){return s().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return console.log("remove label",d),P.prev=1,P.next=4,G.remove(d.labelId);case 4:m(c.filter(function(A){return A.labelId!=d.labelId})),P.next=11;break;case 7:P.prev=7,P.t0=P.catch(1),console.log("label remove err",P.t0),L.Z.parseError(P.t0,Z.default);case 11:case"end":return P.stop()}},M,null,[[1,7]])}));return function(d){return S.apply(this,arguments)}}(),j=function(){},u=function(){o(!t)};return{all:c,getAll:a,setAll:m,onSelect:l,create:r,remove:w,onModify:j,toggleOneHot:u,get curr(){if(b!=null)return c[b]}}},re=function(i){var v=i(),f=(0,C.Z)(v,2),p=f[0],k=f[1],D=i(),E=(0,C.Z)(D,2),c=E[0],m=E[1],n=i(),g=(0,C.Z)(n,2),b=g[0],_=g[1],e=function(a){if(a<0){Z.default.error("This is the first image. No previous image.");return}if(a==p.length){Z.default.error("This is the final image. No next image.");return}console.log("turning to",a),m(a)},h=function(){var o=(0,O.Z)(s().mark(function a(l,r){var w;return s().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,$.getTasks(l);case 3:if(w=u.sent,k(w),r==null){u.next=9;break}return console.log("getall turnto"),e(r),u.abrupt("return",[w,w[r]]);case 9:return u.abrupt("return",w);case 12:u.prev=12,u.t0=u.catch(0),console.log("task getall err ",u.t0),L.Z.parseError(u.t0,Z.default);case 16:case"end":return u.stop()}},a,null,[[0,12]])}));return function(l,r){return o.apply(this,arguments)}}(),t=function(){var o=(0,O.Z)(s().mark(function a(l){var r,w;return s().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,$.getProgress(l);case 3:return r=u.sent,w=Math.ceil(r.finished/r.total*100),console.log("progress",r,w),_(w),u.abrupt("return",w);case 10:return u.prev=10,u.t0=u.catch(0),console.log("get progress err",u.t0),L.Z.parseError(u.t0,Z.default),u.abrupt("return",0);case 15:case"end":return u.stop()}},a,null,[[0,10]])}));return function(l){return o.apply(this,arguments)}}();return{currIdx:c,all:p,turnTo:e,getAll:h,getProgress:t,progress:b,get curr(){if(!(c==null||p==null))return console.log("task.curr",p[c]),p[c]}}},ae=function(i){var v=i(),f=(0,C.Z)(v,2),p=f[0],k=f[1],D=function(){var m=(0,O.Z)(s().mark(function n(g){var b;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X.getAnnotations(g);case 3:return b=e.sent,e.next=6,k(b);case 6:return e.abrupt("return",b);case 9:e.prev=9,e.t0=e.catch(0),console.log("ann getAll err",e.t0),L.Z.parseError(e.t0,Z.default);case 13:case"end":return e.stop()}},n,null,[[0,9]])}));return function(g){return m.apply(this,arguments)}}(),E=function(){var m=(0,O.Z)(s().mark(function n(g){var b;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create",g),e.prev=1,e.next=4,N.create(g);case 4:return b=e.sent,D(g.dataId),e.abrupt("return",b);case 9:e.prev=9,e.t0=e.catch(1),console.log("annotation create err",e.t0),L.Z.parseError(e.t0,Z.default);case 13:case"end":return e.stop()}},n,null,[[1,9]])}));return function(g){return m.apply(this,arguments)}}(),c=function(){var m=(0,O.Z)(s().mark(function n(g){return s().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:try{N.remove(g)}catch(e){console.log("annotation remove err",e),L.Z.parseError(e,Z.default)}case 1:case"end":return _.stop()}},n)}));return function(g){return m.apply(this,arguments)}}();return{all:p,getAll:D,create:E,remove:c}},ne=function(i){var v=i(),f=(0,C.Z)(v,2),p=f[0],k=f[1],D=i([]),E=(0,C.Z)(D,2),c=E[0],m=E[1],n=function(){var b=(0,O.Z)(s().mark(function _(e){return s().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:k(e);case 1:case"end":return t.stop()}},_)}));return function(e){return b.apply(this,arguments)}}(),g=function(){var b=(0,O.Z)(s().mark(function _(e,h){var t;return s().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Q.getDatas(e);case 3:if(t=a.sent,m(t),h==null){a.next=8;break}return n(h),a.abrupt("return",[t,t[h]]);case 8:return a.abrupt("return",t);case 11:a.prev=11,a.t0=a.catch(0),console.log("data getall err ",a.t0),L.Z.parseError(a.t0,Z.default);case 15:case"end":return a.stop()}},_,null,[[0,11]])}));return function(e,h){return b.apply(this,arguments)}}();return{all:c,getAll:g,turnTo:n,get curr(){if(!(p==null||c==null))return c[p]}}},le=function(i,v){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};f.effectTrigger||(f.effectTrigger={});var p=i(!1),k=(0,C.Z)(p,2),D=k[0],E=k[1],c=x(i),m=ae(i),n=re(i),g=ne(i),b=J(i),_=ee(i,f.label);return v(function(){var e=L.Z.getQueryVariable("projectId");b.getCurr(e),_.getAll(e),n.getAll(e),n.getProgress(e)},[]),v(function(){n.all&&n.all.length!=0&&n.turnTo(0)},[n.all]),v(function(){if(n.currIdx!=null){var e=function(){var h=(0,O.Z)(s().mark(function t(){var o,a,l,r,w,j,u,S;return s().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return console.log("onTaskChange",n.curr,_.all,n.progress),n.getProgress(n.curr.projectId),d.next=4,g.getAll(n.curr.taskId,0);case 4:return o=d.sent,a=(0,C.Z)(o,2),l=a[0],r=a[1],console.log(l),d.next=11,m.getAll(r.dataId);case 11:w=d.sent,j=(0,W.Z)(_.all);try{for(j.s();!(u=j.n()).done;)S=u.value,S.active=!1}catch(y){j.e(y)}finally{j.f()}f.effectTrigger.postTaskChange&&f.effectTrigger.postTaskChange(_.all,w),E(!1);case 16:case"end":return d.stop()}},t)}));return function(){return h.apply(this,arguments)}}();e()}},[n.currIdx]),[D,E,c,m,n,g,b,_]}}}]);
