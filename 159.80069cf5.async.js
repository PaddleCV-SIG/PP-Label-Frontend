(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[159],{13237:function(X){X.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},85024:function(X){X.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(X){X.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},26647:function(X){X.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___1FTWb",toolBarButtonContainer:"toolBarButtonContainer___1Vahn",toolBarButton:"toolBarButton___3mR2H",buttonText:"buttonText___Y0WDm",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3lRZ8",popover:"popover___3zzu2",slider:"slider___ALra-",popoverLeft:"popoverLeft___15lGe"}},8978:function(X,Q,n){"use strict";n.d(Q,{Z:function(){return un}});var K=n(11849),G=n(2824),H=n(91220),Y=n(67294),x=n(85893);function p(e){if(!e||!e.width||!e.color||!e.points||e.points.length<2||e.frontendId==null)return"";var C=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(C,",").concat(e.points.join(","))}function u(e){var C,o=e.canvasRef,m=e.annotation,g=m.result;if(!g)return(0,x.jsx)(x.Fragment,{});var L=(C=o.current)===null||C===void 0?void 0:C.getContext("2d");if(!L)return(0,x.jsx)(x.Fragment,{});for(var D=[],t=0,h=0;h<g.length;h++)g.at(h)==","?(D.push(parseFloat(g.slice(t,h))),t=h+1):g.at(h)=="|"?(D.push(parseFloat(g.slice(t,h))),a(D,L,m),D=[],t=h+1):h==g.length-1&&(D.push(parseFloat(g.slice(t,g.length))),a(D,L,m));return(0,x.jsx)(x.Fragment,{})}function a(e,C,o){var m;if(e.length<4){console.log("found incorrect points:",e);return}var g=e[0],L=e[1];if(g==0){var D;S(C,e.slice(2),(D=o.label)===null||D===void 0?void 0:D.color);return}if(L==0){d(C,g,e.slice(2),void 0);return}d(C,g,e.slice(2),(m=o.label)===null||m===void 0?void 0:m.color)}function d(e,C,o,m){e.beginPath(),e.moveTo(o[0],o[1]);for(var g=0;g<=o.length/2-1;g++){var L=o[2*g],D=o[2*g+1];e.lineTo(L,D)}e.lineCap="round",e.lineJoin="round",e.lineWidth=C,m&&(e.strokeStyle=m),e.globalCompositeOperation=m?"source-over":"destination-out",e.stroke()}function S(e,C,o){e.globalCompositeOperation=o?"source-over":"destination-out",o&&(e.fillStyle=o);for(var m=0;m<=C.length/2-1;m++){var g=C[2*m],L=C[2*m+1];e.fillRect(g,L,1,1)}}function j(e){if(!e||e.length==0)return 0;var C=0,o=(0,H.Z)(e),m;try{for(o.s();!(m=o.n()).done;){var g=m.value;g.frontendId>C&&(C=g.frontendId)}}catch(L){o.e(L)}finally{o.f()}return C}function sn(e,C){return e=="rubber"||C==2?"rubber":"brush"}function un(e){var C=(0,Y.useState)(),o=(0,G.Z)(C,2),m=o[0],g=o[1],L=function(I){var b,w;if(!(e.currentTool!="brush"&&e.currentTool!="rubber"||!((b=e.currentLabel)!==null&&b!==void 0&&b.color)||!e.brushSize)){var rn=I.mouseX,U=I.mouseY,q=sn(e.currentTool,I.e.evt.button);console.log("frontendId: ",e.frontendIdOps.frontendId,"maxId:",j(e.annotations));var z=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:j(e.annotations)+1;z!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(z);var on=p({width:e.brushSize||10,color:(w=e.currentLabel)===null||w===void 0?void 0:w.color,points:[rn,U,rn,U],type:q,frontendId:z});if(!!on){g(q);var R={dataId:e.dataId,label:e.currentLabel,labelId:e.currentLabel.labelId,frontendId:z,result:on,type:"brush"};e.onAnnotationAdd(R)}}},D=function(I){var b;if(!(!m||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((b=e.currentLabel)!==null&&b!==void 0&&b.color))){var w=I.mouseX,rn=I.mouseY,U=e.currentAnnotation.result+",".concat(w,",").concat(rn);e.onAnnotationModify((0,K.Z)((0,K.Z)({},e.currentAnnotation),{},{result:U}))}},t=function(){e.currentTool!="brush"&&e.currentTool!="rubber"||(g(void 0),e.onMouseUp())};return{onMouseDown:L,onMouseMove:D,onMouseUp:t,drawAnnotation:u}}},57406:function(X,Q,n){"use strict";n.d(Q,{pL:function(){return G},oo:function(){return H}});var K=n(91220);function G(p){var u=0;if(!p)return u;var a=(0,K.Z)(p),d;try{for(a.s();!(d=a.n()).done;){var S=d.value;!S||!S.frontendId||S.frontendId>u&&(u=S.frontendId)}}catch(j){a.e(j)}finally{a.f()}return u}function H(p){var u=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return u?{r:parseInt(u[1],16),g:parseInt(u[2],16),b:parseInt(u[3],16)}:null}function Y(p){var u=p.toString(16);return u.length==1?"0"+u:u}function x(p,u,a){return"#"+Y(p)+Y(u)+Y(a)}},14836:function(X,Q,n){"use strict";n.d(Q,{Z:function(){return t}});var K=n(54421),G=n(38272),H=n(57663),Y=n(71577),x=n(91220),p=n(67294),u=n(56159),a=n.n(u),d=n(49111),S=n(19650),j=n(2824),sn=n(11849),un=n(85024),e=n.n(un),C=n(63097),o=n(85893),m=function(I){var b=(0,sn.Z)({},I.annotation),w=(0,p.useState)(b.invisible),rn=(0,j.Z)(w,2),U=rn[0],q=rn[1],z=(0,p.useState)(0),on=(0,j.Z)(z,2),R=on[0],an=on[1];(0,p.useEffect)(function(){q(I.annotation.invisible)},[I.annotation.invisible]);var nn=(0,o.jsxs)(G.ZP.Item,{className:"".concat(e().listItem," ").concat(I.active?e().listItemActive:""),unselectable:"on",onClick:function(){I.onClick(b)},children:[(0,o.jsxs)(S.Z,{align:"center",size:5,children:[(0,o.jsx)("a",{className:e().eye,style:{backgroundImage:U?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(mn){mn.stopPropagation(),q(!U),I.onAnnotationModify(b)}})," ",(0,o.jsx)("span",{className:e().annotationId,children:b.frontendId}),(0,o.jsx)("span",{className:e().labelName,children:b.label.name}),(0,o.jsx)(C.Z,{color:b.label.color})]}),(0,o.jsx)("a",{className:e().delete,onClick:function(mn){mn.stopPropagation();var fn=new Date().getTime();fn-R<300||(an(fn),I.onAnnotationDelete(b))}})]});return nn},g=m,L=n(48971),D=function(I){var b=(0,L.YB)(),w=b.formatMessage({id:"component.PPAnnotationList.annotationList"}),rn=b.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),U=new Set,q=[],z=(0,x.Z)(I.annotations),on;try{for(z.s();!(on=z.n()).done;){var R=on.value;U.has(R.frontendId)||(q.push(R),U.add(R.frontendId))}}catch(an){z.e(an)}finally{z.f()}return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(G.ZP,{className:a().labelList,size:"large",header:(0,o.jsx)("div",{className:a().listHeader,children:w}),bordered:!0,dataSource:q,renderItem:function(nn){var en;return(0,o.jsx)(g,{onClick:I.onAnnotationSelect,annotation:nn,active:nn.frontendId==((en=I.currAnnotation)===null||en===void 0?void 0:en.frontendId),onAnnotationDelete:I.onAnnotationDelete,onAnnotationModify:I.onAnnotationModify})},footer:function(){return I.onAnnotationAdd?(0,o.jsx)("div",{children:(0,o.jsx)(Y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){I.onAnnotationAdd()},block:!0,children:rn})}):(0,o.jsx)("div",{})}})})},t=D},27992:function(X,Q,n){"use strict";var K=n(20136),G=n(55241),H=n(13062),Y=n(71230),x=n(77883),p=n(70507),u=n(89032),a=n(15746),d=n(66126),S=n(75454),j=n(2824),sn=n(67294),un=n(61541),e=n(26647),C=n.n(e),o=n(85893),m=0,g=100,L=10,D=function(h){var I=(0,sn.useState)(on(h.size)),b=(0,j.Z)(I,2),w=b[0],rn=b[1];function U(R){rn(on(R))}var q=h.minSize==null?m:h.minSize,z=h.maxSize==null?g:h.maxSize;function on(R){return R==null?L:R<=q?q:R>=z?z:R}return(0,sn.useEffect)(function(){U(h.size)},[h.size]),(0,o.jsxs)(G.Z,{overlayClassName:"".concat(C().popover," ").concat(h.disLoc=="left"?C().popoverLeft:""),placement:h.disLoc||"right",content:(0,o.jsxs)(Y.Z,{children:[(0,o.jsx)(a.Z,{span:16,children:(0,o.jsx)(S.Z,{className:C().slider,value:w,max:z,min:q,onChange:function(an){var nn;(nn=h.onChange)===null||nn===void 0||nn.call(0,an)},tooltipVisible:!1})}),(0,o.jsx)(a.Z,{span:8,children:(0,o.jsx)(p.Z,{min:q,max:z,value:w,onChange:function(an){var nn;(nn=h.onChange)===null||nn===void 0||nn.call(0,an)},step:10})})]}),trigger:"hover",children:[" ",(0,o.jsx)(un.Z,{imgSrc:h.imgSrc||"",onClick:h.onClick,active:h.active,children:h.children})]})};Q.Z=D},10137:function(X,Q,n){"use strict";var K=n(34669),G=n(54458),H=n(67294),Y=n(85893),x=function(u){var a,d;return(0,Y.jsxs)("div",{className:"progress",children:[(0,Y.jsx)(G.Z,{className:"progressBar",percent:Math.ceil(u.project.finished/((a=u.task.all)===null||a===void 0?void 0:a.length)*100),status:"active",showInfo:!1})," ",(0,Y.jsxs)("span",{className:"progressDesc",children:["Current labeling ",u.task.currIdx==null?1:u.task.currIdx+1," of"," ",(d=u.task.all)===null||d===void 0?void 0:d.length,". Already labeled ",u.project.finished||0,"."]})]})};Q.Z=x},91861:function(X,Q,n){"use strict";n.d(Q,{Ad:function(){return Y},k3:function(){return x},Vd:function(){return p},td:function(){return u}});var K=n(34792),G=n(48086),H=40;function Y(){localStorage.removeItem("history"),x([])}function x(a){var d=localStorage.getItem("history"),S=d?JSON.parse(d):{index:-1,items:[]};if(JSON.stringify(S.items[S.index])!=JSON.stringify(a)){var j=S.index>H?S.index-H:0,sn=S.items.splice(j,S.index==0?1:S.index+1);S.items=sn.concat([a]),S.index<=H?S.index++:S.index=H+1,localStorage.setItem("history",JSON.stringify(S))}}function p(){var a=localStorage.getItem("history");if(!!a){var d=JSON.parse(a);if(!!d){if(d.index>=d.items.length-1){G.default.error("No next history!");return}return d.index++,localStorage.setItem("history",JSON.stringify(d)),d.items[d.index]}}}function u(){var a=localStorage.getItem("history");if(!!a){var d=JSON.parse(a);if(console.log("history",d),!d||!d.index||d.index<=1){G.default.error("No previous history!");return}return d.index--,localStorage.setItem("history",JSON.stringify(d)),d.items[d.index]}}},91159:function(X,Q,n){"use strict";n.r(Q),n.d(Q,{MOST_HISTORY_STEPS:function(){return Zn},default:function(){return Un}});var K=n(11849),G=n(57663),H=n(71577),Y=n(34792),x=n(48086),p=n(91220),u=n(2824),a=n(67294),d=n(48971),S=n(8088),j=n(61541),sn=n(44434),un=n(27992),e=n(5041),C=n(57436),o=n(14836),m=n(91861),g=n(8978),L=n(65031),D=n(57406),t=n(85893);function h(l,M){if(!(!l||!M))return M.join(",")}function I(l){var M,P=l.annotation;if(!P||!P.result||P.result.length<2||!((M=P.label)!==null&&M!==void 0&&M.color))return(0,t.jsx)(t.Fragment,{});var _=P.result.split(",").map(Number),i=P.label.color,y=(0,D.oo)(i);if(!y)return(0,t.jsx)(t.Fragment,{});var k=.3,N=void 0,T=[];return _.forEach(function(W,f){if(!N){N=W;return}T.push((0,t.jsx)(L.Cd,{onMouseDown:function(){l.currentTool=="editor"&&l.onSelect(P)},draggable:l.currentTool=="editor",onDragMove:function(Z){var c;Z.cancelBubble=!0;var A=(c=l.stageRef)===null||c===void 0?void 0:c.current,O=A.findOne(".baseImage"),ln=!1,B=Z.target.x();B>O.width()/2&&(B=O.width()/2,ln=!0),B<-O.width()/2&&(B=-O.width()/2,ln=!0);var E=Z.target.y();E>O.height()/2&&(E=O.height()/2,ln=!0),E<-O.height()/2&&(E=-O.height()/2,ln=!0),ln&&Z.target.setPosition({x:B,y:E}),_[f-1]=B,_[f]=E;var F=(0,K.Z)((0,K.Z)({},P),{},{result:_.join(",")});l.onDrag(F)},onMouseOver:function(){var Z;l.currentTool=="editor"&&(Z=l.stageRef)!==null&&Z!==void 0&&Z.current&&(l.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var Z;(Z=l.stageRef)!==null&&Z!==void 0&&Z.current&&(l.stageRef.current.container().style.cursor="default")},x:N,y:W,radius:5/l.scale,fill:i})),N=void 0}),(0,t.jsxs)(L.ZA,{children:[(0,t.jsx)(L.x1,{onMouseOver:function(){l.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){l.currentTool=="editor"&&l.onSelect(P)},stroke:i,strokeWidth:2/l.scale,globalCompositeOperation:"source-over",lineCap:"round",points:_,tension:0,closed:!0,fill:"rgba(".concat(y.r,", ").concat(y.g,", ").concat(y.b,", ").concat(k,")")}),T]},P.frontendId)}function b(l){var M=0;if(!l)return M;var P=(0,p.Z)(l),_;try{for(P.s();!(_=P.n()).done;){var i=_.value;!i||!i.frontendId||i.frontendId>M&&(M=i.frontendId)}}catch(y){P.e(y)}finally{P.f()}return M}function w(l){var M=function(k,N){var T,W,f=h((T=l.currentLabel)===null||T===void 0?void 0:T.color,[k,N]);!f||(console.log(f),l.onAnnotationAdd({dataId:l.dataId,type:"polygon",frontendId:b(l.annotations)+1,label:l.currentLabel,labelId:(W=l.currentLabel)===null||W===void 0?void 0:W.labelId,result:f}))},P=function(k,N){var T;if(!(!l.currentAnnotation||!l.currentAnnotation.result||!((T=l.currentLabel)!==null&&T!==void 0&&T.color))){var W=l.currentAnnotation.result+",".concat(k,",").concat(N),f=(0,K.Z)((0,K.Z)({},l.currentAnnotation),{},{result:W});l.modifyAnnoByFrontendId(f)}},_=function(k){if(l.currentTool=="polygon"){var N=k.mouseX+k.offsetX,T=k.mouseY+k.offsetY;console.log("currentAnnotation:",l.currentAnnotation),l.currentAnnotation?P(N,T):M(N,T)}},i=function(){l.currentTool=="polygon"&&l.onMouseUp&&l.onMouseUp()};return{onMouseDown:_,onMouseMove:function(){},onMouseUp:i,drawAnnotation:I}}var rn=n(10137),U=n(45194),q=n(71194),z=n(50146),on=n(47673),R=n(24044),an=n(3182),nn=n(9715),en=n(93766),mn=n(43358),fn=n(34041),jn=n(94043),gn=n.n(jn),In=n(37071),xn=function(M){var P,_=(0,d.YB)(),i=(0,U.Gd)(a.useState),y=In.Z.getQueryVariable("projectId"),k=(0,U.RZ)(a.useState),N=fn.Z.Option,T=en.Z.useForm(),W=(0,u.Z)(T,1),f=W[0];(0,a.useEffect)(function(){function c(){return A.apply(this,arguments)}function A(){return A=(0,an.Z)(gn().mark(function O(){var ln,B,E;return gn().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,(0,U.bo)();case 2:if(J.sent){J.next=4;break}return J.abrupt("return");case 4:if(i.getAll(),y){J.next=8;break}return x.default.error("Machine Learning settings are specific to every project. Please choose a project first."),J.abrupt("return");case 8:return J.next=10,i.getCurr(y);case 10:E=J.sent,E!=null&&(ln=E.otherSettings)!==null&&ln!==void 0&&ln.mlBackendUrl&&k.setMlBackendUrl(E==null||(B=E.otherSettings)===null||B===void 0?void 0:B.mlBackendUrl);case 12:case"end":return J.stop()}},O)})),A.apply(this,arguments)}c()},[]),(0,a.useEffect)(function(){if(!!i.curr){var c=i.curr.otherSettings?i.curr.otherSettings:{},A=c.models&&c.perviousModel?c.models[c.perviousModel]:{},O={mlBackendUrl:c.mlBackendUrl,modelName:c.perviousModel,trainBatchSize:A.trainBatchSize};f.setFieldsValue(O),c!=null&&c.mlBackendUrl&&k.setMlBackendUrl(c.mlBackendUrl)}},[i.curr]);function tn(){if(!i.curr){x.default.error("Please choose a project first!");return}var c=f.getFieldValue("mlBackendUrl");k.setMlBackendUrl(c);var A=(0,K.Z)((0,K.Z)({},i.curr.otherSettings),{},{mlBackendUrl:c});i.update(i.curr.projectId,{otherSettings:A})}function Z(c){if(console.log("saveMlsettings",i.curr,c),!i.curr){x.default.error("Please select model first!");return}i.curr.otherSettings||(i.curr.otherSettings={});var A=i.curr.otherSettings.models?i.curr.otherSettings.models:{};A[c.modelName]=c,i.curr.otherSettings.mlBackendUrl=f.getFieldValue("mlBackendUrl"),i.curr.otherSettings.perviousModel=c.modelName,i.curr.otherSettings.models=A,i.update(i.curr.projectId,{otherSettings:i.curr.otherSettings}),x.default.info("Ml setting saved. Let's start trainig or inference!")}return(0,t.jsx)(z.Z,{title:_.formatMessage({id:"pages.toolBar.interactor"}),visible:M.visible,onCancel:M.onCancel,footer:null,children:(0,t.jsxs)(en.Z,{form:f,layout:"horizontal",size:"large",onFinish:function(A){console.log("form finish",A),Z(A)},hidden:i.curr==null,children:[(0,t.jsxs)(R.Z.Group,{compact:!0,children:[(0,t.jsx)(en.Z.Item,{name:"mlBackendUrl",rules:[{required:!0,message:"Please input ml backend url"}],style:{fontSize:"1.5rem"},children:(0,t.jsx)(R.Z,{allowClear:!0,addonBefore:"ML Backend URL ",style:{textAlign:"left"}})}),(0,t.jsx)(H.Z,{type:"primary",onClick:tn,children:"Set"})]}),(0,t.jsx)(en.Z.Item,{name:"modelName",label:"Model",labelCol:{span:6},wrapperCol:{span:16},rules:[{required:!0,message:"Please select a model"}],style:{fontSize:"1.5rem"},children:(0,t.jsx)(fn.Z,{placeholder:"Select a model",children:(P=k.all)===null||P===void 0?void 0:P.map(function(c){return(0,t.jsx)(N,{value:c.name,children:c.name},c.name)})})}),(0,t.jsx)(en.Z.Item,{name:"trainBatchSize",label:"Training Batch Size",labelCol:{span:6},wrapperCol:{span:16},style:{fontSize:"1.5rem"},children:(0,t.jsx)(R.Z,{placeholder:"Training batch size"})}),(0,t.jsxs)(en.Z.Item,{wrapperCol:{span:16,offset:6},children:[(0,t.jsx)(H.Z,{onClick:function(){var A;(A=M.onCancel)===null||A===void 0||A.call(0),f.resetFields()},children:_.formatMessage({id:"component.PPCreater.cancel"})}),(0,t.jsx)(H.Z,{htmlType:"submit",type:"primary",style:{height:"2.5rem",width:"48%"},block:!0,children:"Save"})]})]})})},bn=xn,$n=n(20136),_n=n(55241),Kn=n(13062),On=n(71230),Hn=n(89032),pn=n(15746),En=n(13237),Mn=n.n(En),Ln=function(M){var P,_=(0,U.Gd)(a.useState),i=In.Z.getQueryVariable("projectId"),y=(0,U.RZ)(a.useState),k=fn.Z.Option,N=en.Z.useForm(),T=(0,u.Z)(N,1),W=T[0];return(0,a.useEffect)(function(){function f(){return tn.apply(this,arguments)}function tn(){return tn=(0,an.Z)(gn().mark(function Z(){var c,A,O;return gn().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,U.bo)();case 2:if(B.sent){B.next=4;break}return B.abrupt("return");case 4:if(_.getAll(),i){B.next=8;break}return x.default.error("Machine Learning settings are specific to every project. Please choose a project first."),B.abrupt("return");case 8:return B.next=10,_.getCurr(i);case 10:O=B.sent,O!=null&&(c=O.otherSettings)!==null&&c!==void 0&&c.mlBackendUrl&&y.setMlBackendUrl(O==null||(A=O.otherSettings)===null||A===void 0?void 0:A.mlBackendUrl);case 12:case"end":return B.stop()}},Z)})),tn.apply(this,arguments)}f()},[]),(0,a.useEffect)(function(){if(!!_.curr){var f=_.curr.otherSettings?_.curr.otherSettings:{},tn=f.models&&f.perviousModel?f.models[f.perviousModel]:{},Z={mlBackendUrl:f.mlBackendUrl,modelName:f.perviousModel,trainBatchSize:tn.trainBatchSize};W.setFieldsValue(Z),f!=null&&f.mlBackendUrl&&y.setMlBackendUrl(f.mlBackendUrl)}},[_.curr]),(0,t.jsxs)(_n.Z,{overlayClassName:"".concat(Mn().popover," ").concat(Mn().popoverLeft),placement:"left",content:(0,t.jsx)(On.Z,{children:(0,t.jsx)(pn.Z,{span:24,children:(0,t.jsx)(fn.Z,{placeholder:"Select a model",style:{padding:"0 4px",width:"100%"},children:(P=y.all)===null||P===void 0?void 0:P.map(function(f){return(0,t.jsx)(k,{value:f.name,children:f.name},f.name)})})})}),trigger:"hover",children:[" ",(0,t.jsx)(j.Z,{imgSrc:M.imgSrc||"",onClick:M.onClick,active:M.active,children:M.children})]})},Tn=Ln,Zn=40,Dn=function(){var M,P=(0,a.useState)(0),_=(0,u.Z)(P,2),i=_[0],y=_[1],k=(0,a.useState)(10),N=(0,u.Z)(k,2),T=N[0],W=N[1],f=(0,a.useState)(60),tn=(0,u.Z)(f,2),Z=tn[0],c=tn[1],A=(0,a.useState)(!1),O=(0,u.Z)(A,2),ln=O[0],B=O[1],E=(0,U.$L)(a.useState,a.useEffect,{effectTrigger:{postTaskChange:function(){return(0,m.Ad)()}},label:{oneHot:!0,postSelect:function(){v.setCurr(void 0),y(0)},preUnsetCurr:Rn},tool:{defaultTool:"mover"},task:{push:!0}}),F=E.tool,J=E.task,vn=E.data,hn=E.project,Cn=E.scale,cn=E.label,v=E.annotation;function Rn(){v.setCurr(void 0),y(0),F.setCurr("mover")}var $=function(r){v.setCurr(r),r!=null&&r.frontendId?y(r.frontendId):y(0)};(0,a.useEffect)(function(){(0,m.Ad)()},[]),(0,a.useEffect)(function(){var s=setInterval(function(){var r;console.log("triggered!",vn),v.pushToBackend((r=vn.curr)===null||r===void 0?void 0:r.dataId)},2e4);return function(){clearInterval(s)}},[v,vn,vn.curr]);var Fn=function(r){!r||(v.all.pop(),v.all.push(r),$(r),v.setAll(v.all))},Sn=function(r){var dn=[],Pn=(0,p.Z)(v.all),An;try{for(Pn.s();!(An=Pn.n()).done;){var Bn=An.value;Bn.frontendId==r.frontendId?dn.push(r):dn.push(Bn)}}catch(Wn){Pn.e(Wn)}finally{Pn.f()}$(r),v.setAll(dn)},yn={dataId:(M=vn.curr)===null||M===void 0?void 0:M.dataId,currentLabel:cn.curr,brushSize:T,scale:Cn.curr,currentTool:F.curr,annotations:v.all,currentAnnotation:v.curr,onAnnotationAdd:function(r){var dn=v.all.concat([r]);v.setAll(dn),$(r)},onAnnotationModify:Fn,modifyAnnoByFrontendId:Sn,onMouseUp:function(){(0,m.k3)({annos:v.all,currAnno:v.curr})},frontendIdOps:{frontendId:i,setFrontendId:y}},V=(0,d.YB)(),kn=(0,g.Z)(yn),zn=w(yn),Nn={polygon:zn,brush:kn};return(0,t.jsxs)(S.Z,{className:"segment",children:[(0,t.jsxs)(sn.Z,{children:[(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/polygon.png",active:F.curr=="polygon",onClick:function(){if(!cn.curr){x.default.error("Please select a label first");return}F.setCurr("polygon"),$(void 0)},children:V.formatMessage({id:"pages.toolBar.polygon"})}),(0,t.jsx)(j.Z,{active:F.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){F.setCurr("editor"),$(void 0)},children:V.formatMessage({id:"pages.toolBar.edit"})}),(0,t.jsx)(un.Z,{imgSrc:"./pics/buttons/brush.png",size:T,active:F.curr=="brush",onClick:function(){if(!cn.curr){x.default.error("Please select a label first");return}F.curr!="rubber"&&F.curr!="brush"&&$(void 0),F.setCurr("brush")},onChange:function(r){W(r)},children:V.formatMessage({id:"pages.toolBar.brush"})}),(0,t.jsx)(un.Z,{size:T,active:F.curr=="rubber",onClick:function(){F.curr!="rubber"&&F.curr!="brush"&&$(void 0),F.setCurr("rubber")},onChange:function(r){W(r)},imgSrc:"./pics/buttons/rubber.png",children:V.formatMessage({id:"pages.toolBar.rubber"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){Cn.change(.1)},children:V.formatMessage({id:"pages.toolBar.zoomIn"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){Cn.change(-.1)},children:V.formatMessage({id:"pages.toolBar.zoomOut"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var r;v.pushToBackend((r=vn.curr)===null||r===void 0?void 0:r.dataId)},children:V.formatMessage({id:"pages.toolBar.save"})}),(0,t.jsx)(j.Z,{active:F.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){F.setCurr("mover")},children:V.formatMessage({id:"pages.toolBar.move"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var r=(0,m.td)();r&&(v.setAll(r.annos),$(r.currAnno))},children:V.formatMessage({id:"pages.toolBar.unDo"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var r=(0,m.Vd)();r&&(v.setAll(r.annos),$(r.currAnno))},children:V.formatMessage({id:"pages.toolBar.reDo"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){v.setAll([]),v.setCurr(void 0)},children:V.formatMessage({id:"pages.toolBar.clearMark"})})]}),(0,t.jsxs)("div",{id:"dr",className:"mainStage",children:[(0,t.jsx)("div",{className:"draw",children:(0,t.jsx)(C.Z,{scale:Cn.curr,annotations:v.all,currentTool:F.curr,currentAnnotation:v.curr,setCurrentAnnotation:$,onAnnotationModify:Sn,onAnnotationModifyComplete:function(){(0,m.k3)({annos:v.all,currAnno:v.curr})},frontendIdOps:{frontendId:i,setFrontendId:y},imgSrc:vn.imgSrc,transparency:Z,onAnnotationAdd:function(r){var dn=v.all.concat([r]);v.setAll(dn),v.curr||$(r)},drawTool:Nn})}),(0,t.jsx)("div",{className:"pblock",children:(0,t.jsx)(rn.Z,{task:J,project:hn})}),(0,t.jsx)("div",{className:"prevTask",onClick:function(){!J.prevTask()||$(void 0)}}),(0,t.jsx)("div",{className:"nextTask",onClick:function(){!J.nextTask()||$(void 0)}})]}),(0,t.jsxs)(sn.Z,{disLoc:"right",children:[(0,t.jsx)(Tn,{imgSrc:"./pics/buttons/intelligent_interaction.png",onClick:function(){return B(!0)},children:V.formatMessage({id:"pages.toolBar.interactor"})}),(0,t.jsx)(un.Z,{imgSrc:"./pics/buttons/threshold.png",disLoc:"left",children:V.formatMessage({id:"pages.toolBar.segmentThreshold"})}),(0,t.jsx)(un.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:Z,maxSize:100,minSize:0,onChange:function(r){c(r)},children:V.formatMessage({id:"pages.toolBar.transparency"})}),(0,t.jsx)(un.Z,{imgSrc:"./pics/buttons/radius.png",disLoc:"left",children:V.formatMessage({id:"pages.toolBar.visualRadius"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){d.m8.push("/project_overview?projectId=".concat(hn.curr.projectId))},children:"Project Overview"}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){d.m8.push("/ml?projectId=".concat(hn.curr.projectId))},children:"ML Settings"})]}),(0,t.jsxs)("div",{className:"rightSideBar",children:[(0,t.jsx)("div",{className:"determinOutline",children:(0,t.jsx)(H.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){$(void 0)},children:V.formatMessage({id:"pages.toolBar.determineOutline"})})}),(0,t.jsx)(e.Z,{hideColorPicker:!1,labels:cn.all,activeIds:cn.activeIds,onLabelSelect:cn.onSelect,onLabelModify:function(){},onLabelDelete:cn.remove,onLabelAdd:function(r){cn.create((0,K.Z)((0,K.Z)({},r),{},{projectId:hn.curr.projectId})).then(function(dn){$(void 0),cn.setCurr(dn)})}}),(0,t.jsx)(o.Z,{currAnnotation:v.curr,annotations:v.all,onAnnotationSelect:function(r){r!=null&&r.delete||$(r)},onAnnotationAdd:function(){$(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(r){v.setAll(v.all.filter(function(dn){return dn.frontendId!=r.frontendId})),$(void 0)}})]}),(0,t.jsx)(bn,{visible:ln,onCancel:function(){return B(!1)}})]})},Un=Dn}}]);
