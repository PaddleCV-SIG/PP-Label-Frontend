(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{70830:function(w,C,o){"use strict";o.d(C,{Z:function(){return x}});function x(N){throw new TypeError('"'+N+'" is read-only')}},41435:function(w,C,o){"use strict";o.d(C,{Z:function(){return U}});var x=o(94663),N=o(80112);function B(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var Q=o(18597);function O(I,P,X){return(0,Q.Z)()?O=Reflect.construct:O=function(m,$,F){var D=[null];D.push.apply(D,$);var f=Function.bind.apply(m,D),R=new f;return F&&(0,N.Z)(R,F.prototype),R},O.apply(null,arguments)}function U(I){var P=typeof Map=="function"?new Map:void 0;return U=function(l){if(l===null||!B(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(l))return P.get(l);P.set(l,m)}function m(){return O(l,arguments,(0,x.Z)(this).constructor)}return m.prototype=Object.create(l.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),(0,N.Z)(m,l)},U(I)}},72285:function(w){w.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(w,C,o){"use strict";o.r(C),o.d(C,{default:function(){return hn}});var x=o(11849),N=o(57663),B=o(71577),Q=o(20228),O=o(11382),U=o(34669),I=o(54458),P=o(34792),X=o(48086),l=o(2824),m=o(67294),$=o(72285),F=o.n($),D=o(8088),f=o(61541),R=o(44434),en=o(5041),on=o(57436),rn=o(14836),e=o(85893),an=function(t){return(0,e.jsx)(f.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},sn=an,cn=o(91220),z=o(65031);function un(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function q(n,t){if(!(!n||!t))return{color:n,points:t}}function ln(n,t,a,c,v,h,d){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var r=n.lines[0].points,s=n.lines[0].color,p=un(s);if(!p)return[(0,e.jsx)(e.Fragment,{})];var b=(d==null?void 0:d.annotationId)==n.annotationId,g=b?.5:.1,S=void 0,M=[];return r.forEach(function(y,j){if(!S){S=y;return}M.push((0,e.jsx)(z.Cd,{onMouseDown:function(){v=="mover"&&h(n)},draggable:v=="mover",onDragMove:function(k){console.log("Circle onDrageMove");var Z=k.evt.offsetX/c,K=k.evt.offsetY/c;r[j-1]=Z,r[j]=K;var W=(0,x.Z)((0,x.Z)({},n),{},{lines:[{color:s,points:r}]});t(W)},onMouseOver:function(){console.log("Circle onMouseOver"),v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x:S,y,radius:5,fill:s})),console.log(j,r),r.length>4&&r.splice(j+1,2),S=void 0}),[(0,e.jsxs)(z.ZA,{children:[(0,e.jsx)(z.UL,{onMouseOver:function(){v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){v=="mover"&&h(n)},stroke:s,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r[0],y:r[1],width:r[2]-r[0],height:r[3]-r[1],closed:!0,fill:"rgba(".concat(p.r,", ").concat(p.g,", ").concat(p.b,", ").concat(g,")")}),M]},n.annotationId)]}function dn(n){var t=0,a=(0,cn.Z)(n),c;try{for(a.s();!(c=a.n()).done;){var v=c.value;!v||v.annotationId>t&&(t=v.annotationId)}}catch(h){a.e(h)}finally{a.f()}return t}function fn(n){var t=function(d,r){var s,p=d.evt.offsetX/r,b=d.evt.offsetY/r,g=q((s=n.currentLabel)===null||s===void 0?void 0:s.color,[p,b]);!g||n.onAnnotationAdd({tool:"polygon",annotationId:dn(n.annotations)+1,label:n.currentLabel,lines:[g]})},a=function(d,r){var s,p;if(!!n.currentAnnotation){var b=d.evt.offsetX/r,g=d.evt.offsetY/r,S=n.currentAnnotation.lines||[],M=q((s=n.currentLabel)===null||s===void 0?void 0:s.color,(p=S[0])===null||p===void 0?void 0:p.points.concat([b,g]));if(!!M){var y={tool:"polygon",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[M]};n.onAnnotationModify(y)}}},c=function(d,r){n.currentTool=="polygon"&&(n.currentAnnotation?a(d,r):t(d,r))},v=function(){n.currentTool=="polygon"&&n.onMouseUp()};return{onMouseDown:c,onMouseMove:function(){},onMouseUp:v,createElementsFunc:ln}}var vn=o(64322),J=40;function gn(){localStorage.removeItem("history"),G([])}function G(n){var t=localStorage.getItem("history"),a=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(a.items[a.index])!=JSON.stringify(n)){var c=a.index>J?a.index-J:0,v=a.items.splice(c,a.index==0?1:a.index+1);a.items=v.concat([n]),a.index<=J?a.index++:a.index=J+1,localStorage.setItem("history",JSON.stringify(a))}}function mn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function pn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var yn=function(){var t,a=(0,vn.$L)(m.useState,m.useEffect,{label:{oneHot:!0},effectTrigger:{}}),c=(0,l.Z)(a,8),v=c[0],h=c[1],d=c[2],r=c[3],s=c[4],p=c[5],b=c[6],g=c[7],S=(0,m.useState)(void 0),M=(0,l.Z)(S,2),y=M[0],j=M[1],T=(0,m.useState)(),k=(0,l.Z)(T,2),Z=k[0],K=k[1],W=(0,m.useState)([]),_=(0,l.Z)(W,2),A=_[0],Y=_[1],L=function(i){K(i),i!=null&&i.label&&g.setCurr(i.label)};(0,m.useEffect)(function(){gn()},[]);var nn=function(i){for(var E=[],H=0;H<A.length;H++)A[H].annotationId==i.annotationId?E.push(i):E.push(A[H]);L(i),Y(E)},tn=fn({currentLabel:g.curr,currentTool:y,annotations:A,currentAnnotation:Z,onAnnotationAdd:function(i){var E=A.concat([i]);Y(E),Z||L(i)},onAnnotationModify:nn,onMouseUp:function(){G({annos:A,currAnno:Z})}}),V=tn;return(0,e.jsxs)(D.Z,{className:F().det,children:[(0,e.jsxs)(R.Z,{children:[(0,e.jsx)(sn,{active:y=="polygon",onClick:function(){j("polygon"),L(void 0)},children:"Rectangle"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/edit.png",children:"Edit"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){d.change(.1)},children:"Zoom in"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){d.change(-.1)},children:"Zoom out"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){X.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){j("mover")},children:"Move"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var i=pn();Y(i.annos),L(i.currAnno)},children:"Undo"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var i=mn();Y(i.annos),L(i.currAnno)},children:"Redo"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(O.Z,{tip:"loading",spinning:v,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(on.Z,{scale:d.curr,annotations:A,currentTool:y,currentAnnotation:Z,setCurrentAnnotation:L,onAnnotationModify:nn,onAnnotationModifyComplete:function(){G(A,Z)},onMouseDown:V.onMouseDown,onMouseMove:V.onMouseMove,onMouseUp:V.onMouseUp,createPolygonFunc:tn.createElementsFunc,imgSrc:p.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(I.Z,{percent:s.progress,status:"active"}),s.currIdx," ",(t=s.all)===null||t===void 0?void 0:t.length," ",s.finished]})})]})}),(0,e.jsxs)(R.Z,{disLoc:"right",children:[(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:s.nextTask,children:"Next"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:s.prevTask,children:"Prev"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)("div",{className:"determinOutline",children:(0,e.jsx)(B.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){r.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(en.Z,{labels:g.all,onLabelSelect:function(i){g.setCurr(i),r.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:g.remove,onLabelAdd:function(i){return g.create((0,x.Z)((0,x.Z)({},i),{},{projectId:b.curr.projectId}))}}),(0,e.jsx)(rn.Z,{annotations:r.all,onAnnotationSelect:function(i){return r.setCurr(i,g)},onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:r.remove})]})]})},hn=yn}}]);
