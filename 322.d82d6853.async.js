(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(be,ae,K){"use strict";K.d(ae,{gu:function(){return le},os:function(){return se},Gd:function(){return re},$L:function(){return me}});var X=K(11849),Y=K(91220),E=K(3182),_e=K(34792),T=K(48086),j=K(2824),ne=K(94043),r=K.n(ne),q=K(48971),L=K(37071),N=K(81139),V=localStorage.getItem("basePath"),G=new N.VK(V?{basePath:V}:void 0),B=new N.U(G),te=new N.sD(G),ue=new N.W6(G),z=new N.Cl(G),x=new N.vb(G),le=function(a){return JSON.parse(JSON.stringify(a))};function se(A){return A&&(A.toLowerCase().replace(/([-_][a-z])/g,function(a){return a.toUpperCase().replace("-","").replace("_","")}),A)}var ee=function(a,p,h){if(!!h){for(var n=typeof a=="number"?a:a[h],b=0;b<p.length;b++)if(n==p[b][h])return b}},ie=function(a){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],h=a(1),n=(0,j.Z)(h,2),b=n[0],M=n[1];function w(S){var Z=S;Z<p[0]&&(Z=p[0],T.default.error("Smallest scale is "+p[0])),Z>p[1]&&(Z=p[1],T.default.error("Largest scale is "+p[1])),M(Z)}function i(S){w(b+S)}return{curr:b,change:i,setScale:w}};function ce(A,a){var p=a.defaultTool,h=A(p),n=(0,j.Z)(h,2),b=n[0],M=n[1];return{curr:b,setCurr:M}}function fe(A){var a=A(!1),p=(0,j.Z)(a,2),h=p[0],n=p[1];return{curr:h,setCurr:n}}var re=function(a){var p=a(),h=(0,j.Z)(p,2),n=h[0],b=h[1],M=a(),w=(0,j.Z)(M,2),i=w[0],S=w[1],Z=a(),R=(0,j.Z)(Z,2),U=R[0],D=R[1];function C(){return k.apply(this,arguments)}function k(){return k=(0,E.Z)(r().mark(function u(){var e;return r().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.prev=0,_.next=3,B.getAll();case 3:return e=_.sent,b(e),_.abrupt("return",e);case 8:return _.prev=8,_.t0=_.catch(0),console.log("project getAll err",_.t0),L.Z.parseError(_.t0,T.default),_.abrupt("return");case 13:case"end":return _.stop()}},u,null,[[0,8]])})),k.apply(this,arguments)}function t(u){return $.apply(this,arguments)}function $(){return $=(0,E.Z)(r().mark(function u(e){var d;return r().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(e!=null){f.next=2;break}return f.abrupt("return",void 0);case 2:if(!(n&&n.length>1)){f.next=5;break}return T.default.error("Currently have multiple projects stored, use turnTo instead"),f.abrupt("return");case 5:return f.next=7,B.get(e);case 7:return d=f.sent,b([d]),S(0),f.abrupt("return",d);case 11:case"end":return f.stop()}},u)})),$.apply(this,arguments)}function c(u){return O.apply(this,arguments)}function O(){return O=(0,E.Z)(r().mark(function u(e){return r().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return S(e),_.abrupt("return",n[e]);case 2:case"end":return _.stop()}},u)})),O.apply(this,arguments)}function W(u){return P.apply(this,arguments)}function P(){return P=(0,E.Z)(r().mark(function u(e){var d;return r().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return console.log("remove project",e),d=typeof e=="number"?e:e.projectId,f.next=4,B.remove(d);case 4:C();case 5:case"end":return f.stop()}},u)})),P.apply(this,arguments)}function H(u){return F.apply(this,arguments)}function F(){return F=(0,E.Z)(r().mark(function u(e){var d;return r().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,B.create(e);case 3:return d=f.sent,f.abrupt("return",d);case 7:return f.prev=7,f.t0=f.catch(0),console.log("project create err",f.t0),f.abrupt("return",L.Z.parseError(f.t0,T.default));case 11:case"end":return f.stop()}},u,null,[[0,7]])})),F.apply(this,arguments)}function y(u,e){return s.apply(this,arguments)}function s(){return s=(0,E.Z)(r().mark(function u(e,d){return r().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:B.update(e,d).then(function(m){console.log("project update res",m)}).catch(function(m){console.log("project update err ",m),L.Z.parseError(m,T.default)});case 1:case"end":return f.stop()}},u)})),s.apply(this,arguments)}function I(){return o.apply(this,arguments)}function o(){return o=(0,E.Z)(r().mark(function u(){var e,d,_,f,m=arguments;return r().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return e=m.length>0&&m[0]!==void 0?m[0]:void 0,g.prev=1,d=e==null?n[i].projectId:e,g.next=5,B.getProgress(d);case 5:if(_=g.sent,!(!_||_.finished==null||_.total==null)){g.next=8;break}throw Error("empty progress");case 8:return f=Math.ceil(_.finished/_.total*100),D(f),g.abrupt("return",f);case 13:return g.prev=13,g.t0=g.catch(1),console.log("get progress err",g.t0),L.Z.parseError(g.t0,T.default),g.abrupt("return",0);case 18:case"end":return g.stop()}},u,null,[[1,13]])})),o.apply(this,arguments)}return{all:n,getAll:C,getCurr:t,turnTo:c,remove:W,create:H,update:y,progress:U,getProgress:I,get curr(){if(!!n)return n[i]}}},pe=function(a,p){var h=p.oneHot,n=h===void 0?!0:h,b=p.postSetCurr,M=a(),w=(0,j.Z)(M,2),i=w[0],S=w[1],Z=a(),R=(0,j.Z)(Z,2),U=R[0],D=R[1],C=a(new Set),k=(0,j.Z)(C,2),t=k[0],$=k[1],c=a(n),O=(0,j.Z)(c,2),W=O[0],P=O[1];function H(m){return F.apply(this,arguments)}function F(){return F=(0,E.Z)(r().mark(function m(v){var g;return r().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(v!=null){l.next=2;break}return l.abrupt("return");case 2:return l.prev=2,l.next=5,B.getLabels(v);case 5:return g=l.sent,console.log("label getall:",g),S(g),l.abrupt("return",g);case 11:return l.prev=11,l.t0=l.catch(2),console.log("label getall err ",l.t0),l.abrupt("return",L.Z.parseError(l.t0,T.default));case 15:case"end":return l.stop()}},m,null,[[2,11]])})),F.apply(this,arguments)}function y(m){var v=ee(m,i,"labelId");if(v==null)throw Error("label.onSelect label not found");D(v);var g=i[v].labelId;W?t.has(g)?t.clear():(t.clear(),t.add(g)):t.has(g)?t.delete(g):t.add(g),$(new Set(t)),b&&b(i[v])}function s(m){if(console.log("setCurr",m),!n)throw Error("multi select task doesn't have current label");if(!!m){var v=typeof m=="number"?m:m.labelId;v=ee(v,i,"labelId"),v&&(console.log("setCurr index:",v),D(v),$(new Set([v])))}}function I(m){t.clear();var v=(0,Y.Z)(m),g;try{for(v.s();!(g=v.n()).done;){var J=g.value;t.add(J.labelId)}}catch(l){v.e(l)}finally{v.f()}}function o(m){return u.apply(this,arguments)}function u(){return u=(0,E.Z)(r().mark(function m(v){var g;return r().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return console.log("create label",v),l.prev=1,l.next=4,x.create(v);case 4:return g=l.sent,H(v.projectId),l.abrupt("return",g);case 9:return l.prev=9,l.t0=l.catch(1),console.log("label create err",l.t0),l.abrupt("return",L.Z.parseError(l.t0,T.default));case 13:case"end":return l.stop()}},m,null,[[1,9]])})),u.apply(this,arguments)}function e(m){return d.apply(this,arguments)}function d(){return d=(0,E.Z)(r().mark(function m(v){var g;return r().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return g=typeof v=="number"?v:v.labelId,l.prev=1,l.next=4,x.remove(g);case 4:i&&i.length&&H(i[0].projectId),l.next=11;break;case 7:l.prev=7,l.t0=l.catch(1),console.log("label remove err",l.t0),L.Z.parseError(l.t0,T.default);case 11:case"end":return l.stop()}},m,null,[[1,7]])})),d.apply(this,arguments)}function _(m){var v=typeof m=="number"?m:m.labelId;return t.has(v)}var f=function(v){v!=null?P(v):P(!W)};return{all:i,getAll:H,activeIds:t,initActive:I,onSelect:y,setCurr:s,isActive:_,create:o,remove:e,toggleOneHot:f,get curr(){if(i!=null)return i[U]}}},de=function(a){var p=a(),h=(0,j.Z)(p,2),n=h[0],b=h[1],M=a(),w=(0,j.Z)(M,2),i=w[0],S=w[1],Z=function(t){if(!!n){if(t<0){T.default.error("This is the first image. No previous image.");return}if(t==n.length){T.default.error("This is the final image. No next image.");return}S(t)}},R=function(){var k=(0,E.Z)(r().mark(function t($,c){var O;return r().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,B.getTasks($);case 3:if(O=P.sent,b(O),c==null){P.next=9;break}return console.log("getall turnto"),Z(c),P.abrupt("return",[O,O[c]]);case 9:return P.abrupt("return",O);case 12:return P.prev=12,P.t0=P.catch(0),console.log("task getall err ",P.t0),P.abrupt("return",L.Z.parseError(P.t0,T.default));case 16:case"end":return P.stop()}},t,null,[[0,12]])}));return function($,c){return k.apply(this,arguments)}}();function U(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return k==null||!n?0:Math.round(n.length*k/100)}var D=function(){var k=(0,E.Z)(r().mark(function t(){return r().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:Z(i+1),console.log("all tasks",n);case 2:case"end":return c.stop()}},t)}));return function(){return k.apply(this,arguments)}}(),C=function(){var k=(0,E.Z)(r().mark(function t(){return r().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:Z(i-1);case 1:case"end":return c.stop()}},t)}));return function(){return k.apply(this,arguments)}}();return{currIdx:i,all:n,turnTo:Z,getAll:R,nextTask:D,prevTask:C,finished:U,get curr(){if(!(i==null||n==null))return n[i]}}};function oe(A,a){var p=a.label,h=p===void 0?void 0:p,n=a.project,b=n===void 0?void 0:n,M=A(),w=(0,j.Z)(M,2),i=w[0],S=w[1],Z=A(),R=(0,j.Z)(Z,2),U=R[0],D=R[1],C=function(){var y=(0,E.Z)(r().mark(function s(I){var o;return r().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("getAll, dataId:",I),I!=null){e.next=3;break}return e.abrupt("return",[]);case 3:return e.prev=3,e.next=6,ue.getAnnotations(I);case 6:return o=e.sent,console.log("getAll, annRes:",o),S(o),e.abrupt("return",o);case 12:return e.prev=12,e.t0=e.catch(3),console.log("ann getAll err",e.t0),L.Z.parseError(e.t0,T.default),e.abrupt("return",[]);case 17:case"end":return e.stop()}},s,null,[[3,12]])}));return function(I){return y.apply(this,arguments)}}(),k=function(){var y=(0,E.Z)(r().mark(function s(I){var o,u;return r().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,I.label&&(I.labelId=I.label.id),d.next=4,z.create(I);case 4:if(o=d.sent,c(o),u=[],!I.dataId){d.next=11;break}return d.next=10,C(I.dataId);case 10:u=d.sent;case 11:b&&u.length==1&&b.getProgress(),d.next=18;break;case 14:return d.prev=14,d.t0=d.catch(0),console.log("annotation create err",d.t0),d.abrupt("return",L.Z.parseError(d.t0,T.default));case 18:case"end":return d.stop()}},s,null,[[0,14]])}));return function(I){return y.apply(this,arguments)}}();function t(y){return $.apply(this,arguments)}function $(){return $=(0,E.Z)(r().mark(function y(s){var I,o;return r().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove",s),I=typeof s=="number"?s:s.annotationId,I!=null){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,z.remove(I);case 7:if(!(i&&i.length&&i[0].dataId)){e.next=12;break}return e.next=10,C(i[0].dataId);case 10:o=e.sent,o.length==0&&b.getProgress();case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(4),console.log("annotation remove err",e.t0),e.abrupt("return",L.Z.parseError(e.t0,T.default));case 18:case"end":return e.stop()}},y,null,[[4,14]])})),$.apply(this,arguments)}function c(y){return O.apply(this,arguments)}function O(){return O=(0,E.Z)(r().mark(function y(s){return r().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(console.log("annotation setcurr",s,"all",i),s!=null){o.next=4;break}return D(void 0),o.abrupt("return");case 4:console.log("all:",i),D(s),h.setCurr(s.labelId);case 7:case"end":return o.stop()}},y)})),O.apply(this,arguments)}function W(y){return P.apply(this,arguments)}function P(){return P=(0,E.Z)(r().mark(function y(s){var I;return r().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(s.annotationId){u.next=2;break}return u.abrupt("return",[]);case 2:s.taskId=void 0,s.label&&(s.labelId=(I=s.label)===null||I===void 0?void 0:I.labelId),s.label=void 0,z.update(s.annotationId,s).then(function(e){return console.log("annotation update res",e),c(s),C(s.dataId)}).catch(function(e){return console.log("annotation update err ",e),L.Z.parseError(e,T.default),[]});case 6:case"end":return u.stop()}},y)})),P.apply(this,arguments)}function H(y){return F.apply(this,arguments)}function F(){return F=(0,E.Z)(r().mark(function y(s){return r().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(!s||!s.annotationId)){o.next=2;break}return o.abrupt("return",void 0);case 2:if(s.annotationId!=null){o.next=7;break}return o.next=5,k(s);case 5:o.next=9;break;case 7:return o.next=9,W(s);case 9:case"end":return o.stop()}},y)})),F.apply(this,arguments)}return{all:i,getAll:C,create:k,remove:t,setCurr:c,update:W,modify:H,curr:U}}var ge=function(a){var p=a(),h=(0,j.Z)(p,2),n=h[0],b=h[1],M=a([]),w=(0,j.Z)(M,2),i=w[0],S=w[1],Z=function(){var U=(0,E.Z)(r().mark(function D(C){return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:b(C);case 1:case"end":return t.stop()}},D)}));return function(C){return U.apply(this,arguments)}}(),R=function(){var U=(0,E.Z)(r().mark(function D(C,k){var t;return r().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,te.getDatas(C);case 3:if(t=c.sent,S(t),k==null){c.next=8;break}return Z(k),c.abrupt("return",[t,t[k]]);case 8:return c.abrupt("return",t);case 11:return c.prev=11,c.t0=c.catch(0),console.log("data getall err ",c.t0),c.abrupt("return",L.Z.parseError(c.t0,T.default));case 15:case"end":return c.stop()}},D,null,[[0,11]])}));return function(C,k){return U.apply(this,arguments)}}();return{all:i,getAll:R,turnTo:Z,get curr(){if(!(n==null||i==null))return i[n]},get imgSrc(){return i&&i[n]?"".concat(V,"/datas/").concat(i[n].dataId,"/image?sault=").concat(i[n].sault):""}}};function ve(A,a){B.exportDataset(A,{exportDir:a}).then(function(p){console.log(p)}).catch(function(p){console.log("export error",p),L.Z.parseError(p,T.default)})}function he(A,a){return Q.apply(this,arguments)}function Q(){return Q=(0,E.Z)(r().mark(function A(a,p){return r().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:console.log("split param",p),B.splitDataset(a,p).then(function(b){console.log(b)}).catch(function(b){console.log("split error",b),L.Z.parseError(b,T.default)});case 2:case"end":return n.stop()}},A)})),Q.apply(this,arguments)}var me=function(a,p,h){var n=ce(a,h.tool?h.tool:{}),b=fe(a),M=ie(a),w=de(a),i=ge(a),S=re(a),Z=pe(a,h.label?h.label:{}),R=oe(a,(0,X.Z)((0,X.Z)({},h.annotation),{},{label:Z,project:S}));return p(function(){var U=L.Z.getQueryVariable("projectId");if(U==null){q.m8.push("/");return}var D=parseInt(U);S.getCurr(U).catch(function(C){L.Z.parseError(C,T.default),q.m8.push("/")}),Z.getAll(D),w.getAll(D),S.getProgress(D)},[]),p(function(){w.all&&w.all.length!=0&&w.turnTo(0)},[w.all]),p(function(){if(w.currIdx!=null){var U=function(){var D=(0,E.Z)(r().mark(function C(){var k,t,$,c,O,W,P,H,F,y,s,I;return r().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if((k=w.curr)!==null&&k!==void 0&&k.projectId&&S.getProgress(w.curr.projectId),!((t=w.curr)!==null&&t!==void 0&&t.taskId)){u.next=13;break}return u.next=4,i.getAll(w.curr.taskId,0);case 4:return O=u.sent,W=(0,j.Z)(O,2),P=W[0],H=W[1],u.next=10,R.getAll(H.dataId);case 10:if(F=u.sent,Z.all){y=(0,Y.Z)(Z.all);try{for(y.s();!(s=y.n()).done;)I=s.value,I.active=!1}catch(e){y.e(e)}finally{y.f()}}($=h.effectTrigger)!==null&&$!==void 0&&$.postTaskChange&&((c=h.effectTrigger)===null||c===void 0||c.postTaskChange(Z.all,F));case 13:b.setCurr(!1);case 14:case"end":return u.stop()}},C)}));return function(){return D.apply(this,arguments)}}();U()}},[w.currIdx]),[n,b,M,R,w,i,S,Z,he,ve]}}}]);
