(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(se,Q,S){"use strict";S.d(Q,{gu:function(){return x},Gd:function(){return z},$L:function(){return ue}});var H=S(86582),F=S(91220),k=S(3182),ie=S(34792),E=S(48086),O=S(2824),X=S(94043),i=S.n(X),N=S(48971),L=S(37071),R=S(81139),W=localStorage.getItem("basePath"),K=new R.VK(W?{basePath:W}:void 0),j=new R.U(K),Y=new R.sD(K),q=new R.W6(K),G=new R.Cl(K),J=new R.vb(K),x=function(o){return JSON.parse(JSON.stringify(o))};function ce(M){return M&&(M.toLowerCase().replace(/([-_][a-z])/g,function(o){return o.toUpperCase().replace("-","").replace("_","")}),M)}var V=function(o,h,g){if(!!g){for(var l=0;l<h.length;l++)if(o[g]==h[l][g])return l}},ee=function(o){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,3],g=o(1),l=(0,O.Z)(g,2),A=l[0],U=l[1],y=function(p){var m=A;m+=p,m<h[0]&&(m=h[0],E.default.error("Smallest scale is "+h[0])),m>h[1]&&(m=h[1],E.default.error("Largest scale is "+h[1])),U(m)};return{curr:A,change:y}},z=function(o){var h=o([]),g=(0,O.Z)(h,2),l=g[0],A=g[1],U=o(),y=(0,O.Z)(U,2),c=y[0],p=y[1],m=function(){var f=(0,k.Z)(i().mark(function a(){var u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getAll();case 3:return u=e.sent,A(u),e.abrupt("return",u);case 8:return e.prev=8,e.t0=e.catch(0),console.log("project getAll err",e.t0),L.Z.parseError(e.t0,E.default),e.abrupt("return");case 13:case"end":return e.stop()}},a,null,[[0,8]])}));return function(){return f.apply(this,arguments)}}(),D=function(){var f=(0,k.Z)(i().mark(function a(u){var n;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(u!=null){r.next=2;break}return r.abrupt("return",void 0);case 2:if(!(l.length>1)){r.next=5;break}return E.default.error("Currently have multiple projects stored, use turnTo instead"),r.abrupt("return");case 5:return r.next=7,j.get(u);case 7:return n=r.sent,A([n]),p(0),r.abrupt("return",n);case 11:case"end":return r.stop()}},a)}));return function(u){return f.apply(this,arguments)}}(),Z=function(){var f=(0,k.Z)(i().mark(function a(u){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove project",u),typeof u!="number"){e.next=6;break}return e.next=4,j.remove(u);case 4:e.next=8;break;case 6:return e.next=8,j.remove(u.projectId);case 8:m();case 9:case"end":return e.stop()}},a)}));return function(u){return f.apply(this,arguments)}}(),C=function(){var f=(0,k.Z)(i().mark(function a(u){var n;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,j.create(u);case 3:return n=r.sent,console.log(n),r.abrupt("return",n);case 8:return r.prev=8,r.t0=r.catch(0),console.log("project create err",r.t0),r.abrupt("return",L.Z.parseError(r.t0,E.default));case 12:case"end":return r.stop()}},a,null,[[0,8]])}));return function(u){return f.apply(this,arguments)}}(),d=function(){var f=(0,k.Z)(i().mark(function a(u,n){return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:j.update(u,n).then(function(_){console.log("project update res",_)}).catch(function(_){console.log("project update err ",_),L.Z.parseError(_,E.default)});case 1:case"end":return r.stop()}},a)}));return function(u,n){return f.apply(this,arguments)}}();return{all:l,getAll:m,getCurr:D,remove:Z,create:C,update:d,get curr(){if(c!=null)return l[c]}}},re=function(o,h){var g=h.oneHot,l=g===void 0?!0:g,A=h.postSetCurr,U=o(),y=(0,O.Z)(U,2),c=y[0],p=y[1],m=o(),D=(0,O.Z)(m,2),Z=D[0],C=D[1],d=o(l),f=(0,O.Z)(d,2),a=f[0],u=f[1],n=function(){var b=(0,k.Z)(i().mark(function t(w){var T,v,P,B;return i().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.prev=0,$.next=3,j.getLabels(w);case 3:T=$.sent,v=(0,F.Z)(T);try{for(v.s();!(P=v.n()).done;)B=P.value,B.active=!1}catch(le){v.e(le)}finally{v.f()}return p(T),$.abrupt("return",T);case 10:return $.prev=10,$.t0=$.catch(0),console.log("label getall err ",$.t0),$.abrupt("return",L.Z.parseError($.t0,E.default));case 14:case"end":return $.stop()}},t,null,[[0,10]])}));return function(w){return b.apply(this,arguments)}}(),e=function(t){var w=typeof t=="number"?t:V(t,c,"labelId");if(w=w||0,C(w),console.log("onehot",a),a){var T=(0,F.Z)(c),v;try{for(T.s();!(v=T.n()).done;){var P=v.value;P.active=!1}}catch(B){T.e(B)}finally{T.f()}c[w].active=!0,console.log("all",c)}else c[w].active=!c[w].active;A&&A(c[w]),p((0,H.Z)(c))},r=function(){var b=(0,k.Z)(i().mark(function t(w){var T;return i().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,J.create(w);case 3:return T=P.sent,T.active=!1,p([].concat((0,H.Z)(c),[T])),P.abrupt("return",T);case 9:return P.prev=9,P.t0=P.catch(0),console.log("label create err",P.t0),P.abrupt("return",L.Z.parseError(P.t0,E.default));case 13:case"end":return P.stop()}},t,null,[[0,9]])}));return function(w){return b.apply(this,arguments)}}(),_=function(){var b=(0,k.Z)(i().mark(function t(w){return i().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return console.log("remove label",w),v.prev=1,v.next=4,J.remove(w.labelId);case 4:p(c.filter(function(P){return P.labelId!=w.labelId})),v.next=11;break;case 7:v.prev=7,v.t0=v.catch(1),console.log("label remove err",v.t0),L.Z.parseError(v.t0,E.default);case 11:case"end":return v.stop()}},t,null,[[1,7]])}));return function(w){return b.apply(this,arguments)}}(),s=function(){},I=function(){u(!a)};return{all:c,getAll:n,setAll:p,setCurr:e,create:r,remove:_,onModify:s,toggleOneHot:I,get curr(){if(Z!=null)return c[Z]}}},ae=function(o){var h=o(),g=(0,O.Z)(h,2),l=g[0],A=g[1],U=o(),y=(0,O.Z)(U,2),c=y[0],p=y[1],m=o(),D=(0,O.Z)(m,2),Z=D[0],C=D[1],d=function(r){if(r<0){E.default.error("This is the first image. No previous image.");return}if(r==l.length){E.default.error("This is the final image. No next image.");return}console.log("turning to",r),p(r)},f=function(){var e=(0,k.Z)(i().mark(function r(_,s){var I;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.getTasks(_);case 3:if(I=t.sent,A(I),s==null){t.next=9;break}return console.log("getall turnto"),d(s),t.abrupt("return",[I,I[s]]);case 9:return t.abrupt("return",I);case 12:return t.prev=12,t.t0=t.catch(0),console.log("task getall err ",t.t0),t.abrupt("return",L.Z.parseError(t.t0,E.default));case 16:case"end":return t.stop()}},r,null,[[0,12]])}));return function(_,s){return e.apply(this,arguments)}}(),a=function(){var e=(0,k.Z)(i().mark(function r(_){var s,I;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.getProgress(_);case 3:if(s=t.sent,!(!s||!s.finished||!s.total)){t.next=6;break}throw Error("empty progress");case 6:return I=Math.ceil(s.finished/s.total*100),console.log("progress",s,I),C(I),t.abrupt("return",I);case 12:return t.prev=12,t.t0=t.catch(0),console.log("get progress err",t.t0),L.Z.parseError(t.t0,E.default),t.abrupt("return",0);case 17:case"end":return t.stop()}},r,null,[[0,12]])}));return function(_){return e.apply(this,arguments)}}(),u=function(){var e=(0,k.Z)(i().mark(function r(){return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:d(c+1),console.log("all tasks",l);case 2:case"end":return s.stop()}},r)}));return function(){return e.apply(this,arguments)}}(),n=function(){var e=(0,k.Z)(i().mark(function r(){return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:d(c-1);case 1:case"end":return s.stop()}},r)}));return function(){return e.apply(this,arguments)}}();return{currIdx:c,all:l,turnTo:d,getAll:f,getProgress:a,progress:Z,nextTask:u,prevTask:n,get curr(){if(!(c==null||l==null))return console.log("task.curr",l[c]),l[c]},get finished(){return Math.floor((l==null?void 0:l.length)*Z/100)}}},ne=function(o){var h=o(),g=(0,O.Z)(h,2),l=g[0],A=g[1],U=o(),y=(0,O.Z)(U,2),c=y[0],p=y[1],m=function(){var d=(0,k.Z)(i().mark(function f(a){var u,n,e,r;return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,q.getAnnotations(a);case 3:u=s.sent,n=(0,F.Z)(u);try{for(n.s();!(e=n.n()).done;)r=e.value,r.active=!1}catch(I){n.e(I)}finally{n.f()}return A(u),s.abrupt("return",u);case 10:return s.prev=10,s.t0=s.catch(0),console.log("ann getAll err",s.t0),s.abrupt("return",L.Z.parseError(s.t0,E.default));case 14:case"end":return s.stop()}},f,null,[[0,10]])}));return function(a){return d.apply(this,arguments)}}(),D=function(){var d=(0,k.Z)(i().mark(function f(a){var u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create",a),e.prev=1,e.next=4,G.create(a);case 4:return u=e.sent,a.dataId&&m(a.dataId),e.abrupt("return",u);case 9:return e.prev=9,e.t0=e.catch(1),console.log("annotation create err",e.t0),e.abrupt("return",L.Z.parseError(e.t0,E.default));case 13:case"end":return e.stop()}},f,null,[[1,9]])}));return function(a){return d.apply(this,arguments)}}(),Z=function(){var d=(0,k.Z)(i().mark(function f(a){var u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("typeof",typeof a),u=typeof a!="number"?a.annotationId:a,e.prev=2,!u){e.next=6;break}return e.next=6,G.remove(u);case 6:A(l.filter(function(r){return r.annotationId!=u})),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(2),console.log("annotation remove err",e.t0),e.abrupt("return",L.Z.parseError(e.t0,E.default));case 13:case"end":return e.stop()}},f,null,[[2,9]])}));return function(a){return d.apply(this,arguments)}}(),C=function(){var d=(0,k.Z)(i().mark(function f(a,u){var n,e,r,_,s;return i().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(console.log("annotation onselect",a),a!=null){b.next=4;break}return p(void 0),b.abrupt("return");case 4:n=(0,F.Z)(l);try{for(n.s();!(e=n.n()).done;)r=e.value,r.active=!1}catch(t){n.e(t)}finally{n.f()}_=l.filter(function(t){return t.annotationId==a.annotationId})[0],_.active=!a.active,s=V(_,l,"annotationId"),p(s),u.setCurr(a.labelId),A((0,H.Z)(l));case 12:case"end":return b.stop()}},f)}));return function(a,u){return d.apply(this,arguments)}}();return{all:l,getAll:m,create:D,remove:Z,setCurr:C,get curr(){if(!(!l||!c))return l[c]}}},te=function(o){var h=o(),g=(0,O.Z)(h,2),l=g[0],A=g[1],U=o([]),y=(0,O.Z)(U,2),c=y[0],p=y[1],m=function(){var Z=(0,k.Z)(i().mark(function C(d){return i().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:A(d);case 1:case"end":return a.stop()}},C)}));return function(d){return Z.apply(this,arguments)}}(),D=function(){var Z=(0,k.Z)(i().mark(function C(d,f){var a;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Y.getDatas(d);case 3:if(a=n.sent,p(a),f==null){n.next=8;break}return m(f),n.abrupt("return",[a,a[f]]);case 8:return n.abrupt("return",a);case 11:return n.prev=11,n.t0=n.catch(0),console.log("data getall err ",n.t0),n.abrupt("return",L.Z.parseError(n.t0,E.default));case 15:case"end":return n.stop()}},C,null,[[0,11]])}));return function(d,f){return Z.apply(this,arguments)}}();return{all:c,getAll:D,turnTo:m,get curr(){if(!(l==null||c==null))return c[l]},get imgSrc(){return c&&c[l]?(console.log("imgsrc","".concat(W,"/datas/").concat(c[l].dataId,"/image?sault=").concat(c[l].sault)),"".concat(W,"/datas/").concat(c[l].dataId,"/image?sault=").concat(c[l].sault)):""}}},ue=function(o,h,g){g.effectTrigger||(g.effectTrigger={});var l=o(!1),A=(0,O.Z)(l,2),U=A[0],y=A[1],c=ee(o),p=ae(o),m=te(o),D=z(o),Z=re(o,g.label),C=ne(o);return h(function(){var d=L.Z.getQueryVariable("projectId");if(d==null){N.m8.push("/");return}var f=parseInt(d);D.getCurr(d).catch(function(a){L.Z.parseError(a,E.default),N.m8.push("/")}),Z.getAll(f),p.getAll(f)},[]),h(function(){p.all&&p.all.length!=0&&p.turnTo(0)},[p.all]),h(function(){if(p.currIdx!=null){var d=function(){var f=(0,k.Z)(i().mark(function a(){var u,n,e,r,_,s,I,b,t,w;return i().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(console.log("onTaskChange",p.curr,Z.all,p.progress),(u=p.curr)!==null&&u!==void 0&&u.projectId&&p.getProgress(p.curr.projectId),!((n=p.curr)!==null&&n!==void 0&&n.taskId)){v.next=15;break}return v.next=5,m.getAll(p.curr.taskId,0);case 5:return e=v.sent,r=(0,O.Z)(e,2),_=r[0],s=r[1],console.log(_),v.next=12,C.getAll(s.dataId);case 12:if(I=v.sent,Z.all){b=(0,F.Z)(Z.all);try{for(b.s();!(t=b.n()).done;)w=t.value,w.active=!1}catch(P){b.e(P)}finally{b.f()}}g.effectTrigger.postTaskChange&&g.effectTrigger.postTaskChange(Z.all,I);case 15:y(!1);case 16:case"end":return v.stop()}},a)}));return function(){return f.apply(this,arguments)}}();d()}},[p.currIdx]),[U,y,c,C,p,m,D,Z]}}}]);
