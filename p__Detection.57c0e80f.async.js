(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(B,R,o){"use strict";o.d(R,{Z:function(){return T}});var C=o(94663),H=o(80112);function X(Z){return Function.toString.call(Z).indexOf("[native code]")!==-1}var Q=o(18597);function I(Z,O,$){return(0,Q.Z)()?I=Reflect.construct:I=function(x,z,E){var N=[null];N.push.apply(N,z);var h=Function.bind.apply(x,N),L=new h;return E&&(0,H.Z)(L,E.prototype),L},I.apply(null,arguments)}function T(Z){var O=typeof Map=="function"?new Map:void 0;return T=function(g){if(g===null||!X(g))return g;if(typeof g!="function")throw new TypeError("Super expression must either be null or a function");if(typeof O!="undefined"){if(O.has(g))return O.get(g);O.set(g,x)}function x(){return I(g,arguments,(0,C.Z)(this).constructor)}return x.prototype=Object.create(g.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),(0,H.Z)(x,g)},T(Z)}},72285:function(B){B.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(B,R,o){"use strict";o.r(R),o.d(R,{default:function(){return pn}});var C=o(11849),H=o(57663),X=o(71577),Q=o(20228),I=o(11382),T=o(34669),Z=o(54458),O=o(34792),$=o(48086),g=o(2824),x=o(67294),z=o(72285),E=o.n(z),N=o(8088),h=o(61541),L=o(44434),tn=o(5041),en=o(57436),on=o(14836),e=o(85893),rn=function(t){return(0,e.jsx)(h.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},an=rn,sn=o(91220),G=o(65031);function cn(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function q(n,t){if(!(!n||!t))return{tool:"rectangle",color:n,points:t}}function ln(n,t,i,d,v,p,r,a){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var s=n.lines[0].points,f=n.lines[0].color,l=cn(f);if(!l)return[(0,e.jsx)(e.Fragment,{})];var y=(r==null?void 0:r.annotationId)==n.annotationId,A=y?.5:.1,m=void 0,j=[];return s.forEach(function(S,b){if(!m){m=S;return}j.push((0,e.jsx)(G.Cd,{onMouseDown:function(){(v=="editor"||v=="mover")&&p(n)},draggable:v=="editor",onDragMove:function(F){if(v=="editor"){var W=(F.evt.offsetX+((a==null?void 0:a.x)||0))/d,J=(F.evt.offsetY+((a==null?void 0:a.y)||0))/d;s[b-1]=W,s[b]=J;var M=(0,C.Z)((0,C.Z)({},n),{},{lines:[{tool:"rectangle",color:f,points:s}]});t(M)}},onMouseOver:function(){console.log("Circle onMouseOver"),v=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x:m,y:S,radius:5,fill:f})),s.length>4&&s.splice(b+1,2),m=void 0}),[(0,e.jsxs)(G.ZA,{children:[(0,e.jsx)(G.UL,{onMouseOver:function(){v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){v=="mover"&&p(n)},stroke:f,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:s[0],y:s[1],width:s[2]-s[0],height:s[3]-s[1],closed:!0,fill:"rgba(".concat(l.r,", ").concat(l.g,", ").concat(l.b,", ").concat(A,")")}),j]},n.annotationId)]}function un(n){var t=0,i=(0,sn.Z)(n),d;try{for(i.s();!(d=i.n()).done;){var v=d.value;!v||v.annotationId>t&&(t=v.annotationId)}}catch(p){i.e(p)}finally{i.f()}return t}function dn(n){var t=function(r,a,s,f){var l,y=r.evt.offsetX+a/f,A=r.evt.offsetY+s/f;console.log("evt.offsetX:",r.evt.offsetX,"evt.offsetY:",r.evt.offsetY,"offset:",a,s,"scale:",f,"mouseXY:",y,A);var m=q((l=n.currentLabel)===null||l===void 0?void 0:l.color,[y,A]);!m||n.onAnnotationAdd({tool:"rectangle",annotationId:un(n.annotations)+1,label:n.currentLabel,lines:[m]})},i=function(r,a,s,f){var l,y;if(!!n.currentAnnotation){var A=(r.evt.offsetX+a)/f,m=(r.evt.offsetY+s)/f,j=n.currentAnnotation.lines||[],S=q((l=n.currentLabel)===null||l===void 0?void 0:l.color,(y=j[0])===null||y===void 0?void 0:y.points.concat([A,m]));if(!!S){var b={tool:"rectangle",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[S]};n.onAnnotationModify(b)}}},d=function(r,a,s,f){console.log(r.evt),n.currentTool=="rectangle"&&(n.currentAnnotation?i(r,a,s,f):t(r,a,s,f))},v=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:d,onMouseMove:function(){},onMouseUp:v,createElementsFunc:ln}}var vn=o(64322),U=40;function fn(){localStorage.removeItem("history"),K([])}function K(n){var t=localStorage.getItem("history"),i=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(i.items[i.index])!=JSON.stringify(n)){var d=i.index>U?i.index-U:0,v=i.items.splice(d,i.index==0?1:i.index+1);i.items=v.concat([n]),i.index<=U?i.index++:i.index=U+1,localStorage.setItem("history",JSON.stringify(i))}}function gn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function mn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var hn=function(){var t,i=(0,vn.$L)(x.useState,x.useEffect,{label:{oneHot:!0},effectTrigger:{postTaskChange:fn}}),d=(0,g.Z)(i,7),v=d[0],p=d[1],r=d[2],a=d[3],s=d[4],f=d[5],l=d[6],y=(0,x.useState)(void 0),A=(0,g.Z)(y,2),m=A[0],j=A[1],S=(0,x.useState)(),b=(0,g.Z)(S,2),D=b[0],F=b[1],W=(0,x.useState)([]),J=(0,g.Z)(W,2),M=J[0],Y=J[1],P=function(c){F(c),c!=null&&c.label&&l.setCurr(c.label)},_=function(c){for(var k=[],w=0;w<M.length;w++)M[w].annotationId==c.annotationId?k.push(c):k.push(M[w]);P(c),Y(k)},nn=dn({currentLabel:l.curr,currentTool:m,annotations:M,currentAnnotation:r.curr,onAnnotationAdd:function(c){var k=M.concat([c]);Y(k),D||P(c)},onAnnotationModify:_,onMouseUp:function(){K({annos:M,currAnno:r.curr})}}),V=nn;return(0,e.jsxs)(N.Z,{className:E().det,children:[(0,e.jsxs)(L.Z,{children:[(0,e.jsx)(an,{active:m=="rectangle",onClick:function(){j("rectangle"),P(void 0)},children:"Rectangle"}),(0,e.jsx)(h.Z,{active:m=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){j("editor")},children:"Edit"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){p.change(.1)},children:"Zoom in"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){p.change(-.1)},children:"Zoom out"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){$.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){j("mover")},children:"Move"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var c=mn();Y(c.annos),P(c.currAnno)},children:"Undo"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var c=gn();Y(c.annos),P(c.currAnno)},children:"Redo"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(I.Z,{tip:"loading",spinning:!!v.curr,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(en.Z,{scale:p.curr,annotations:M,currentTool:m,currentAnnotation:r.curr,setCurrentAnnotation:P,onAnnotationModify:_,onAnnotationModifyComplete:function(){K(M,r.curr)},onMouseDown:V.onMouseDown,onMouseMove:V.onMouseMove,onMouseUp:V.onMouseUp,createRectangleFunc:nn.createElementsFunc,imgSrc:s.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(Z.Z,{className:"progressBar",percent:a.progress,status:"active",showInfo:!1})," ",(0,e.jsxs)("span",{className:"progressDesc",children:["Current labeling ",a.currIdx==null?1:a.currIdx+1," of"," ",(t=a.all)===null||t===void 0?void 0:t.length,". Already labeled ",a.finished(f.progress)||0,"."]})]})}),(0,e.jsx)("div",{className:"prevTask",onClick:a.prevTask}),(0,e.jsx)("div",{className:"nextTask",onClick:a.nextTask})]})}),(0,e.jsxs)(L.Z,{disLoc:"right",children:[(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)("div",{className:"determinOutline",children:(0,e.jsx)(X.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){r.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(tn.Z,{labels:l.all,activeIds:l.activeIds,onLabelSelect:function(c){l.onSelect(c)},onLabelModify:function(){},onLabelDelete:l.remove,onLabelAdd:function(c){return l.create((0,C.Z)((0,C.Z)({},c),{},{projectId:f.curr.projectId}))}}),(0,e.jsx)(on.Z,{annotations:r.all,activeIds:r.activeIds,onAnnotationSelect:r.setCurr,onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:r.remove})]})]})},pn=hn}}]);
