(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(L,P,i){"use strict";i.d(P,{Z:function(){return N}});var b=i(94663),w=i(80112);function J(C){return Function.toString.call(C).indexOf("[native code]")!==-1}var Y=i(18597);function O(C,j,I){return(0,Y.Z)()?O=Reflect.construct:O=function(A,T,v){var Z=[null];Z.push.apply(Z,T);var E=Function.bind.apply(A,Z),k=new E;return v&&(0,w.Z)(k,v.prototype),k},O.apply(null,arguments)}function N(C){var j=typeof Map=="function"?new Map:void 0;return N=function(m){if(m===null||!J(m))return m;if(typeof m!="function")throw new TypeError("Super expression must either be null or a function");if(typeof j!="undefined"){if(j.has(m))return j.get(m);j.set(m,A)}function A(){return O(m,arguments,(0,b.Z)(this).constructor)}return A.prototype=Object.create(m.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),(0,w.Z)(A,m)},N(C)}},72285:function(L){L.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(L,P,i){"use strict";i.r(P),i.d(P,{default:function(){return nn}});var b=i(11849),w=i(20228),J=i(11382),Y=i(34669),O=i(54458),N=i(34792),C=i(48086),j=i(2824),I=i(67294),m=i(72285),A=i.n(m),T=i(8088),v=i(61541),Z=i(44434),E=i(5041),k=i(57436),X=i(14836),o=i(85893),H=function(e){return(0,o.jsx)(v.Z,{active:e.active,imgSrc:e.imgSrc||"./pics/buttons/rectangle.png",onClick:e.onClick,children:e.children})},$=H,D=i(65031);function z(n){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function G(n,e){if(!(!n||!e||e.length<2))return{xmin:e[0],ymin:e[1],xmax:e[2]||void 0,ymax:e[3]||void 0}}function K(n,e,u,d,c,p,f,t){if(console.log("drawRectangle, annotation:",n),!n||!n.result||!n.label||!n.label.color)return[(0,o.jsx)(o.Fragment,{})];var r=JSON.parse(n.result),l=n.label.color,g=z(l);if(!g)return[(0,o.jsx)(o.Fragment,{})];console.log("drawRectangle, points:",r,"color:",l);var x=(f==null?void 0:f.annotationId)==n.annotationId,h=x?.5:.1,M=r.xmax&&r.ymax?(0,o.jsx)(D.UL,{onMouseOver:function(){c=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){c=="mover"&&p(n)},stroke:l,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r.xmin,y:r.ymin,width:r.xmax-r.xmin,height:r.ymax-r.ymin,closed:!0,fill:"rgba(".concat(g.r,", ").concat(g.g,", ").concat(g.b,", ").concat(h,")")}):(0,o.jsx)(o.Fragment,{});return[(0,o.jsxs)(D.ZA,{children:[M,(0,o.jsx)(D.Cd,{onMouseDown:function(){(c=="editor"||c=="mover")&&p(n)},draggable:c=="editor",onDragMove:function(S){if(c=="editor"){var s=(S.evt.offsetX+((t==null?void 0:t.x)||0))/d,a=(S.evt.offsetY+((t==null?void 0:t.y)||0))/d;r.xmin=s,r.ymin=a;var F=(0,b.Z)((0,b.Z)({},n),{},{lines:[{tool:"rectangle",color:l,points:r}]});e(F)}},onMouseOver:function(){c=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:r.xmin,y:r.ymin,radius:5,fill:l}),(0,o.jsx)(D.Cd,{onMouseDown:function(){(c=="editor"||c=="mover")&&p(n)},draggable:c=="editor",onDragMove:function(S){if(c=="editor"){var s=(S.evt.offsetX+((t==null?void 0:t.x)||0))/d,a=(S.evt.offsetY+((t==null?void 0:t.y)||0))/d;r.xmax=s,r.ymax=a;var F=(0,b.Z)((0,b.Z)({},n),{},{lines:[{tool:"rectangle",color:l,points:r}]});e(F)}},onMouseOver:function(){c=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:r.xmax,y:r.ymax,radius:5,fill:l})]},n.annotationId)]}function W(n){console.log("currentAnnotation",n.currentAnnotation);var e=function(f,t,r,l){var g,x=f.evt.offsetX+t/l,h=f.evt.offsetY+r/l,M=G((g=n.currentLabel)===null||g===void 0?void 0:g.color,[x,h]);!M||n.onAnnotationAdd({type:"rectangle",label:n.currentLabel,result:JSON.stringify(M)})},u=function(f,t,r,l){if(!(!n.currentAnnotation||!n.currentAnnotation.result)){var g=(f.evt.offsetX+t)/l,x=(f.evt.offsetY+r)/l,h=JSON.parse(n.currentAnnotation.result);if(!!h){h.xmax=g,h.ymax=x;var M={type:"rectangle",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,result:JSON.stringify(h)};n.onAnnotationModify(M)}}},d=function(f,t,r,l){n.currentTool=="rectangle"&&(n.currentAnnotation?u(f,t,r,l):e(f,t,r,l))},c=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:d,onMouseMove:function(){},onMouseUp:c,createElementsFunc:K}}var V=i(64322),R=40;function B(){localStorage.removeItem("history"),U([])}function U(n){var e=localStorage.getItem("history"),u=e?JSON.parse(e):{index:-1,items:[]};if(JSON.stringify(u.items[u.index])!=JSON.stringify(n)){var d=u.index>R?u.index-R:0,c=u.items.splice(d,u.index==0?1:u.index+1);u.items=c.concat([n]),u.index<=R?u.index++:u.index=R+1,localStorage.setItem("history",JSON.stringify(u))}}function Q(){var n=localStorage.getItem("history");if(!!n){var e=JSON.parse(n);if(!!e&&!(e.index>=e.items.length-1))return e.index++,localStorage.setItem("history",JSON.stringify(e)),e.items[e.index]}}function q(){var n=localStorage.getItem("history");if(!!n){var e=JSON.parse(n);if(!(!e||!e.index)&&!(e.index<=0))return e.index--,localStorage.setItem("history",JSON.stringify(e)),e.items[e.index]}}var _=function(){var e,u=(0,V.$L)(I.useState,I.useEffect,{label:{oneHot:!0},effectTrigger:{postTaskChange:B}}),d=(0,j.Z)(u,8),c=d[0],p=d[1],f=d[2],t=d[3],r=d[4],l=d[5],g=d[6],x=d[7],h=function(a){!a||(console.log("modifyAnnotation",a,"anno.label:",a==null?void 0:a.label),a.taskId=r.curr.taskId,a.dataId=l.curr.dataId,t.modify(a))};(0,I.useEffect)(function(){B()},[]);var M=function(a){h(a)},y=W({currentLabel:x.curr,currentTool:c.curr,annotations:t.all,currentAnnotation:t.curr,onAnnotationAdd:t.setCurr,onAnnotationModify:M,onMouseUp:function(){U({annos:t.all,currAnno:t.curr})}}),S=y;return(0,o.jsxs)(T.Z,{className:A().det,children:[(0,o.jsxs)(Z.Z,{children:[(0,o.jsx)($,{active:c.curr=="rectangle",onClick:function(){if(!x.curr){C.default.error("Please choose a label category first!");return}c.setCurr("rectangle"),t.setCurr(void 0)},children:"Rectangle"}),(0,o.jsx)(v.Z,{active:c.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){c.setCurr("editor")},children:"Edit"}),(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){f.change(.1)},children:"Zoom in"}),(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){f.change(-.1)},children:"Zoom out"}),(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){C.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/move.png",active:c.curr=="mover",onClick:function(){c.setCurr("mover")},children:"Move"}),(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var a=q();!a||t.setCurr(a.currAnno)},children:"Undo"}),(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var a=Q();!a||t.setCurr(a.currAnno)},children:"Redo"}),(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:"Clear Mark"})]}),(0,o.jsx)("div",{id:"dr",className:"mainStage",children:(0,o.jsxs)(J.Z,{tip:"loading",spinning:!!p.curr,children:[(0,o.jsx)("div",{className:"draw",children:(0,o.jsx)(k.Z,{scale:f.curr,annotations:t.all,currentTool:c.curr,currentAnnotation:t.curr,setCurrentAnnotation:t.setCurr,onAnnotationModify:M,onAnnotationModifyComplete:function(){U({annos:t.all,currAnno:t.curr}),t.setCurr()},onMouseDown:S.onMouseDown,onMouseMove:S.onMouseMove,onMouseUp:S.onMouseUp,createRectangleFunc:y.createElementsFunc,imgSrc:l.imgSrc})}),(0,o.jsx)("div",{className:"pblock",children:(0,o.jsxs)("div",{className:"progress",children:[(0,o.jsx)(O.Z,{className:"progressBar",percent:g.progress,status:"active",showInfo:!1})," ",(0,o.jsxs)("span",{className:"progressDesc",children:["Current labeling ",r.currIdx==null?1:r.currIdx+1," of"," ",(e=r.all)===null||e===void 0?void 0:e.length,". Already labeled ",r.finished(g.progress)||0,"."]})]})}),(0,o.jsx)("div",{className:"prevTask",onClick:r.prevTask}),(0,o.jsx)("div",{className:"nextTask",onClick:r.nextTask})]})}),(0,o.jsxs)(Z.Z,{disLoc:"right",children:[(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,o.jsx)(v.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"})]}),(0,o.jsxs)("div",{className:"rightSideBar",children:[(0,o.jsx)(E.Z,{labels:x.all,activeIds:x.activeIds,onLabelSelect:function(a){x.onSelect(a),t.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:x.remove,onLabelAdd:function(a){return x.create((0,b.Z)((0,b.Z)({},a),{},{projectId:g.curr.projectId}))}}),(0,o.jsx)(X.Z,{annotations:t.all,activeIds:t.activeIds,onAnnotationSelect:t.setCurr,onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:function(a){t.remove(a),t.setCurr(void 0)}})]})]})},nn=_}}]);
