(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[690],{13237:function(J){J.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},85024:function(J){J.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(J){J.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},26647:function(J){J.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___1FTWb",toolBarButtonContainer:"toolBarButtonContainer___1Vahn",toolBarButton:"toolBarButton___3mR2H",buttonText:"buttonText___Y0WDm",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3lRZ8",popover:"popover___3zzu2",slider:"slider___ALra-",popoverLeft:"popoverLeft___15lGe"}},8978:function(J,X,n){"use strict";n.d(X,{Z:function(){return sn}});var $=n(11849),V=n(2824),Q=n(91220),z=n(67294),T=n(85893);function y(e){if(!e||!e.width||!e.color||!e.points||e.points.length<2||e.frontendId==null)return"";var M=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(M,",").concat(e.points.join(","))}function d(e){var M,a=e.canvasRef,I=e.annotation,P=I.result;if(!P)return(0,T.jsx)(T.Fragment,{});var L=(M=a.current)===null||M===void 0?void 0:M.getContext("2d");if(!L)return(0,T.jsx)(T.Fragment,{});for(var D=[],o=0,m=0;m<P.length;m++)P.at(m)==","?(D.push(parseFloat(P.slice(o,m))),o=m+1):P.at(m)=="|"?(D.push(parseFloat(P.slice(o,m))),l(D,L,I),D=[],o=m+1):m==P.length-1&&(D.push(parseFloat(P.slice(o,P.length))),l(D,L,I));return(0,T.jsx)(T.Fragment,{})}function l(e,M,a){var I;if(e.length<4){console.log("found incorrect points:",e);return}var P=e[0],L=e[1];if(P==0){var D;x(M,e.slice(2),(D=a.label)===null||D===void 0?void 0:D.color);return}if(L==0){v(M,P,e.slice(2),void 0);return}v(M,P,e.slice(2),(I=a.label)===null||I===void 0?void 0:I.color)}function v(e,M,a,I){e.beginPath(),e.moveTo(a[0],a[1]);for(var P=0;P<=a.length/2-1;P++){var L=a[2*P],D=a[2*P+1];e.lineTo(L,D)}e.lineCap="round",e.lineJoin="round",e.lineWidth=M,I&&(e.strokeStyle=I),e.globalCompositeOperation=I?"source-over":"destination-out",e.stroke()}function x(e,M,a){e.globalCompositeOperation=a?"source-over":"destination-out",a&&(e.fillStyle=a);for(var I=0;I<=M.length/2-1;I++){var P=M[2*I],L=M[2*I+1];e.fillRect(P,L,1,1)}}function O(e){if(!e||e.length==0)return 0;var M=0,a=(0,Q.Z)(e),I;try{for(a.s();!(I=a.n()).done;){var P=I.value;P.frontendId>M&&(M=P.frontendId)}}catch(L){a.e(L)}finally{a.f()}return M}function ln(e,M){return e=="rubber"||M==2?"rubber":"brush"}function sn(e){var M=(0,z.useState)(),a=(0,V.Z)(M,2),I=a[0],P=a[1],L=function(S){var B,G;if(!(e.currentTool!="brush"&&e.currentTool!="rubber"||!((B=e.currentLabel)!==null&&B!==void 0&&B.color)||!e.brushSize)){var nn=S.mouseX,K=S.mouseY,un=ln(e.currentTool,S.e.evt.button);console.log("frontendId: ",e.frontendIdOps.frontendId,"maxId:",O(e.annotations));var F=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:O(e.annotations)+1;F!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(F);var w=y({width:e.brushSize||10,color:(G=e.currentLabel)===null||G===void 0?void 0:G.color,points:[nn,K,nn,K],type:un,frontendId:F});if(!!w){P(un);var q={dataId:e.dataId,label:e.currentLabel,labelId:e.currentLabel.labelId,frontendId:F,result:w,type:"brush"};e.onAnnotationAdd(q)}}},D=function(S){var B;if(!(!I||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((B=e.currentLabel)!==null&&B!==void 0&&B.color))){var G=S.mouseX,nn=S.mouseY,K=e.currentAnnotation.result+",".concat(G,",").concat(nn);e.onAnnotationModify((0,$.Z)((0,$.Z)({},e.currentAnnotation),{},{result:K}))}},o=function(){e.currentTool!="brush"&&e.currentTool!="rubber"||(P(void 0),e.onMouseUp())};return{onMouseDown:L,onMouseMove:D,onMouseUp:o,drawAnnotation:d}}},57406:function(J,X,n){"use strict";n.d(X,{pL:function(){return V},oo:function(){return Q}});var $=n(91220);function V(y){var d=0;if(!y)return d;var l=(0,$.Z)(y),v;try{for(l.s();!(v=l.n()).done;){var x=v.value;!x||!x.frontendId||x.frontendId>d&&(d=x.frontendId)}}catch(O){l.e(O)}finally{l.f()}return d}function Q(y){var d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(y);return d?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)}:null}function z(y){var d=y.toString(16);return d.length==1?"0"+d:d}function T(y,d,l){return"#"+z(y)+z(d)+z(l)}},14836:function(J,X,n){"use strict";n.d(X,{Z:function(){return o}});var $=n(54421),V=n(38272),Q=n(57663),z=n(71577),T=n(91220),y=n(67294),d=n(56159),l=n.n(d),v=n(49111),x=n(19650),O=n(2824),ln=n(11849),sn=n(85024),e=n.n(sn),M=n(63097),a=n(85893),I=function(S){var B=(0,ln.Z)({},S.annotation),G=(0,y.useState)(B.invisible),nn=(0,O.Z)(G,2),K=nn[0],un=nn[1],F=(0,y.useState)(0),w=(0,O.Z)(F,2),q=w[0],H=w[1];(0,y.useEffect)(function(){un(S.annotation.invisible)},[S.annotation.invisible]);var p=(0,a.jsxs)(V.ZP.Item,{className:"".concat(e().listItem," ").concat(S.active?e().listItemActive:""),unselectable:"on",onClick:function(){S.onClick(B)},children:[(0,a.jsxs)(x.Z,{align:"center",size:5,children:[(0,a.jsx)("a",{className:e().eye,style:{backgroundImage:K?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(mn){mn.stopPropagation(),un(!K),S.onAnnotationModify(B)}})," ",(0,a.jsx)("span",{className:e().annotationId,children:B.frontendId}),(0,a.jsx)("span",{className:e().labelName,children:B.label.name}),(0,a.jsx)(M.Z,{color:B.label.color})]}),(0,a.jsx)("a",{className:e().delete,onClick:function(mn){mn.stopPropagation();var gn=new Date().getTime();gn-q<300||(H(gn),S.onAnnotationDelete(B))}})]});return p},P=I,L=n(48971),D=function(S){var B=(0,L.YB)(),G=B.formatMessage({id:"component.PPAnnotationList.annotationList"}),nn=B.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),K=new Set,un=[],F=(0,T.Z)(S.annotations),w;try{for(F.s();!(w=F.n()).done;){var q=w.value;K.has(q.frontendId)||(un.push(q),K.add(q.frontendId))}}catch(H){F.e(H)}finally{F.f()}return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(V.ZP,{className:l().labelList,size:"large",header:(0,a.jsx)("div",{className:l().listHeader,children:G}),bordered:!0,dataSource:un,renderItem:function(p){var N;return(0,a.jsx)(P,{onClick:S.onAnnotationSelect,annotation:p,active:p.frontendId==((N=S.currAnnotation)===null||N===void 0?void 0:N.frontendId),onAnnotationDelete:S.onAnnotationDelete,onAnnotationModify:S.onAnnotationModify})},footer:function(){return S.onAnnotationAdd?(0,a.jsx)("div",{children:(0,a.jsx)(z.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){S.onAnnotationAdd()},block:!0,children:nn})}):(0,a.jsx)("div",{})}})})},o=D},27992:function(J,X,n){"use strict";var $=n(20136),V=n(55241),Q=n(13062),z=n(71230),T=n(77883),y=n(70507),d=n(89032),l=n(15746),v=n(66126),x=n(75454),O=n(2824),ln=n(67294),sn=n(61541),e=n(26647),M=n.n(e),a=n(85893),I=0,P=100,L=10,D=function(m){var S=(0,ln.useState)(q(m.size)),B=(0,O.Z)(S,2),G=B[0],nn=B[1];function K(H){nn(q(H))}var un=m.step?m.step:10,F=m.minSize==null?I:m.minSize,w=m.maxSize==null?P:m.maxSize;function q(H){return H==null?L:H<=F?F:H>=w?w:H}return(0,ln.useEffect)(function(){K(m.size)},[m.size]),(0,a.jsxs)(V.Z,{overlayClassName:"".concat(M().popover," ").concat(m.disLoc=="left"?M().popoverLeft:""),placement:m.disLoc||"right",content:(0,a.jsxs)(z.Z,{children:[(0,a.jsx)(l.Z,{span:16,children:(0,a.jsx)(x.Z,{className:M().slider,value:G,max:w,min:F,onChange:function(p){var N;(N=m.onChange)===null||N===void 0||N.call(0,p)},tooltipVisible:!1})}),(0,a.jsx)(l.Z,{span:8,children:(0,a.jsx)(y.Z,{min:F,max:w,value:G,onChange:function(p){var N;(N=m.onChange)===null||N===void 0||N.call(0,p)},step:un})})]}),trigger:"hover",children:[" ",(0,a.jsx)(sn.Z,{imgSrc:m.imgSrc||"",onClick:m.onClick,active:m.active,children:m.children})]})};X.Z=D},10137:function(J,X,n){"use strict";var $=n(34669),V=n(54458),Q=n(67294),z=n(85893),T=function(d){var l,v;return(0,z.jsxs)("div",{className:"progress",children:[(0,z.jsx)(V.Z,{className:"progressBar",percent:Math.ceil(d.project.finished/((l=d.task.all)===null||l===void 0?void 0:l.length)*100),status:"active",showInfo:!1})," ",(0,z.jsxs)("span",{className:"progressDesc",children:["Current labeling ",d.task.currIdx==null?1:d.task.currIdx+1," of"," ",(v=d.task.all)===null||v===void 0?void 0:v.length,". Already labeled ",d.project.finished||0,"."]})]})};X.Z=T},91861:function(J,X,n){"use strict";n.d(X,{Ad:function(){return z},k3:function(){return T},Vd:function(){return y},td:function(){return d}});var $=n(34792),V=n(48086),Q=40;function z(){localStorage.removeItem("history"),T([])}function T(l){var v=localStorage.getItem("history"),x=v?JSON.parse(v):{index:-1,items:[]};if(JSON.stringify(x.items[x.index])!=JSON.stringify(l)){var O=x.index>Q?x.index-Q:0,ln=x.items.splice(O,x.index==0?1:x.index+1);x.items=ln.concat([l]),x.index<=Q?x.index++:x.index=Q+1,localStorage.setItem("history",JSON.stringify(x))}}function y(){var l=localStorage.getItem("history");if(!!l){var v=JSON.parse(l);if(!!v){if(v.index>=v.items.length-1){V.default.error("No next history!");return}return v.index++,localStorage.setItem("history",JSON.stringify(v)),v.items[v.index]}}}function d(){var l=localStorage.getItem("history");if(!!l){var v=JSON.parse(l);if(console.log("history",v),!v||!v.index||v.index<=1){V.default.error("No previous history!");return}return v.index--,localStorage.setItem("history",JSON.stringify(v)),v.items[v.index]}}},1690:function(J,X,n){"use strict";n.r(X),n.d(X,{MOST_HISTORY_STEPS:function(){return Dn},default:function(){return Un}});var $=n(11849),V=n(57663),Q=n(71577),z=n(34792),T=n(48086),y=n(91220),d=n(2824),l=n(67294),v=n(48971),x=n(8088),O=n(61541),ln=n(44434),sn=n(27992),e=n(5041),M=n(57436),a=n(14836),I=n(91861),P=n(8978),L=n(65031),D=n(57406),o=n(85893);function m(t,i){if(!(!t||!i))return i.join(",")}function S(t){var i,u=t.annotation;if(!u||!u.result||u.result.length<2||!((i=u.label)!==null&&i!==void 0&&i.color))return(0,o.jsx)(o.Fragment,{});var f=u.result.split(",").map(Number),C=u.label.color,A=(0,D.oo)(C);if(!A)return(0,o.jsx)(o.Fragment,{});var s=.3,Z=void 0,_=[];return f.forEach(function(b,E){if(!Z){Z=b;return}_.push((0,o.jsx)(L.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(u)},draggable:t.currentTool=="editor",onDragMove:function(g){var en;g.cancelBubble=!0;var dn=(en=t.stageRef)===null||en===void 0?void 0:en.current,R=dn.findOne(".baseImage"),tn=!1,Y=g.target.x();Y>R.width()/2&&(Y=R.width()/2,tn=!0),Y<-R.width()/2&&(Y=-R.width()/2,tn=!0);var rn=g.target.y();rn>R.height()/2&&(rn=R.height()/2,tn=!0),rn<-R.height()/2&&(rn=-R.height()/2,tn=!0),tn&&g.target.setPosition({x:Y,y:rn}),f[E-1]=Y,f[E]=rn;var an=(0,$.Z)((0,$.Z)({},u),{},{result:f.join(",")});t.onDrag(an)},onMouseOver:function(){var g;t.currentTool=="editor"&&(g=t.stageRef)!==null&&g!==void 0&&g.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var g;(g=t.stageRef)!==null&&g!==void 0&&g.current&&(t.stageRef.current.container().style.cursor="default")},x:Z,y:b,radius:5/t.scale,fill:C})),Z=void 0}),(0,o.jsxs)(L.ZA,{children:[(0,o.jsx)(L.x1,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(u)},stroke:C,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",points:f,tension:0,closed:!0,fill:"rgba(".concat(A.r,", ").concat(A.g,", ").concat(A.b,", ").concat(s,")")}),_]},u.frontendId)}function B(t){var i=0;if(!t)return i;var u=(0,y.Z)(t),f;try{for(u.s();!(f=u.n()).done;){var C=f.value;!C||!C.frontendId||C.frontendId>i&&(i=C.frontendId)}}catch(A){u.e(A)}finally{u.f()}return i}function G(t){var i=function(s,Z){var _,b,E=m((_=t.currentLabel)===null||_===void 0?void 0:_.color,[s,Z]);!E||(console.log(E),t.onAnnotationAdd({dataId:t.dataId,type:"polygon",frontendId:B(t.annotations)+1,label:t.currentLabel,labelId:(b=t.currentLabel)===null||b===void 0?void 0:b.labelId,result:E}))},u=function(s,Z){var _;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((_=t.currentLabel)!==null&&_!==void 0&&_.color))){var b=t.currentAnnotation.result+",".concat(s,",").concat(Z),E=(0,$.Z)((0,$.Z)({},t.currentAnnotation),{},{result:b});t.modifyAnnoByFrontendId(E)}},f=function(s){if(t.currentTool=="polygon"){var Z=s.mouseX+s.offsetX,_=s.mouseY+s.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?u(Z,_):i(Z,_)}},C=function(){t.currentTool=="polygon"&&t.onMouseUp&&t.onMouseUp()};return{onMouseDown:f,onMouseMove:function(){},onMouseUp:C,drawAnnotation:S}}var nn=n(10137),K=n(98731),un=n(20136),F=n(55241),w=n(47673),q=n(24044),H=n(9715),p=n(93766),N=n(13237),mn=n.n(N),gn="http://127.0.0.1:1234/model",yn=function(i){var u=p.Z.useForm(),f=(0,d.Z)(u,1),C=f[0],A=i.model,s=i.project;(0,l.useEffect)(function(){var _,b,E,U;if(!!s.curr){var g=s.curr.otherSettings?s.curr.otherSettings:{},en={mlBackendUrl:g.mlBackendUrl,mlModelAbsPath:(_=g.models)===null||_===void 0||(b=_.EISeg)===null||b===void 0?void 0:b.mlModelAbsPath,mlWeightAbsPath:(E=g.models)===null||E===void 0||(U=E.EISeg)===null||U===void 0?void 0:U.mlWeightAbsPath};C.setFieldsValue(en),g!=null&&g.mlBackendUrl?A.setMlBackendUrl(g.mlBackendUrl):A.setMlBackendUrl(gn),g.mlModelAbsPath&&g.mlWeightAbsPath&&A.load(g.mlModelAbsPath,g.mlWeightAbsPath)}},[s.curr]);function Z(_){if(console.log("saveMlsettings",s.curr,_),!s.curr){T.default.error("Please select project first!");return}s.curr.otherSettings||(s.curr.otherSettings={}),s.curr.otherSettings.mlBackendUrl=C.getFieldValue("mlBackendUrl"),s.curr.otherSettings.models={},s.curr.otherSettings.models.EISeg={},s.curr.otherSettings.models.EISeg.mlModelAbsPath=C.getFieldValue("mlModelAbsPath"),s.curr.otherSettings.models.EISeg.mlWeightAbsPath=C.getFieldValue("mlWeightAbsPath"),s.curr.otherSettings.perviousModel=_.modelName,s.update(s.curr.projectId,{otherSettings:s.curr.otherSettings}),A.setMlBackendUrl(s.curr.otherSettings.mlBackendUrl),A.load(s.curr.otherSettings.models.EISeg.mlModelAbsPath,s.curr.otherSettings.models.EISeg.mlWeightAbsPath),T.default.info("Ml setting saved. Let's start trainig or inference!")}return(0,o.jsxs)(F.Z,{overlayClassName:"".concat(mn().popover," ").concat(mn().popoverLeft),placement:"left",content:(0,o.jsxs)(p.Z,{form:C,layout:"horizontal",size:"large",onFinish:function(b){console.log("form finish",b),Z(b)},hidden:s.curr==null,children:[(0,o.jsx)(p.Z.Item,{name:"mlBackendUrl",label:"ML Backend URL",labelCol:{span:6},wrapperCol:{span:18},initialValue:gn,style:{fontSize:"1.5rem"},children:(0,o.jsx)(q.Z,{placeholder:gn})}),(0,o.jsx)(p.Z.Item,{name:"mlModelAbsPath",label:"Model Path",labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"},children:(0,o.jsx)(q.Z,{placeholder:"Absolute path"})}),(0,o.jsx)(p.Z.Item,{name:"mlWeightAbsPath",label:"Weight Path",labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"},children:(0,o.jsx)(q.Z,{placeholder:"Absolute path"})}),(0,o.jsx)(p.Z.Item,{wrapperCol:{span:16,offset:6},children:(0,o.jsx)(Q.Z,{htmlType:"submit",type:"primary",style:{height:"2.5rem",width:"48%"},block:!0,children:"Save"})})]}),trigger:"hover",children:[" ",(0,o.jsx)(O.Z,{imgSrc:i.imgSrc||"",onClick:i.onClick,active:i.active,children:i.children})]})},xn=yn,On=n(3182),Bn=n(94043),Mn=n.n(Bn);function En(t){var i,u=t.canvasRef,f=t.annotation,C=f.result;if(!C)return(0,o.jsx)(o.Fragment,{});var A=JSON.parse(C),s=(i=u.current)===null||i===void 0?void 0:i.getContext("2d");if(!s)return(0,o.jsx)(o.Fragment,{});var Z=t.threshold?t.threshold*.01:.5,_=[],b=0,E=(0,y.Z)(A),U;try{for(E.s();!(U=E.n()).done;){var g=U.value,en=0,dn=(0,y.Z)(g),R;try{for(dn.s();!(R=dn.n()).done;){var tn=R.value;tn>=Z&&_.push(en,b),en++}}catch(Y){dn.e(Y)}finally{dn.f()}b++}}catch(Y){E.e(Y)}finally{E.f()}return jn(_,s,f),(0,o.jsx)(o.Fragment,{})}function jn(t,i,u){var f;if(t.length<4){console.log("found incorrect points:",t);return}Ln(i,t.slice(2),(f=u.label)===null||f===void 0?void 0:f.color)}function Ln(t,i,u){t.globalCompositeOperation=u?"source-over":"destination-out",u&&(t.fillStyle=u);for(var f=0;f<=i.length/2-1;f++){var C=i[2*f],A=i[2*f+1];t.fillRect(C,A,1,1)}}function _n(t){if(!t||t.length==0)return 0;var i=0,u=(0,y.Z)(t),f;try{for(u.s();!(f=u.n()).done;){var C=f.value;C.frontendId>i&&(i=C.frontendId)}}catch(A){u.e(A)}finally{u.f()}return i}function Tn(t){var i=(0,l.useState)([]),u=(0,d.Z)(i,2),f=u[0],C=u[1],A=t.model,s=function(){var b=(0,On.Z)(Mn().mark(function E(U){var g,en,dn,R,tn,Y,rn,an;return Mn().wrap(function(on){for(;;)switch(on.prev=on.next){case 0:if(!(t.currentTool!="interactor"||!((g=t.currentLabel)!==null&&g!==void 0&&g.color))){on.next=2;break}return on.abrupt("return");case 2:if(en=Math.round(U.mouseX),dn=Math.round(U.mouseY),console.log("frontendId: ",t.frontendIdOps.frontendId,"maxId:",_n(t.annotations)),R=t.frontendIdOps.frontendId>0?t.frontendIdOps.frontendId:_n(t.annotations)+1,R!=t.frontendIdOps.frontendId&&t.frontendIdOps.setFrontendId(R),f.push(new Array(en,dn,U.e.evt.button!=2)),C(f),!(!f.length||!U.stageRef.current||R==null)){on.next=11;break}return on.abrupt("return");case 11:return tn=U.stageRef.current,Y=tn.findOne(".baseImage").toDataURL().slice(22),on.next=15,A.predict({format:"b64",img:Y,other:{clicks:f}});case 15:rn=on.sent,an={dataId:t.dataId,label:t.currentLabel,labelId:t.currentLabel.labelId,frontendId:R,result:JSON.stringify(rn.result),type:"interactor"},t.onAnnotationAdd(an);case 18:case"end":return on.stop()}},E)}));return function(U){return b.apply(this,arguments)}}(),Z=function(){},_=function(){t.currentTool=="interactor"&&t.onMouseUp()};return{onMouseDown:s,onMouseMove:Z,onMouseUp:_,drawAnnotation:En}}var Dn=40,Zn=function(){var i,u=(0,l.useState)(0),f=(0,d.Z)(u,2),C=f[0],A=f[1],s=(0,l.useState)(10),Z=(0,d.Z)(s,2),_=Z[0],b=Z[1],E=(0,l.useState)(50),U=(0,d.Z)(E,2),g=U[0],en=U[1],dn=(0,l.useState)(60),R=(0,d.Z)(dn,2),tn=R[0],Y=R[1],rn=(0,K.RZ)(l.useState),an=(0,K.$L)(l.useState,l.useEffect,{effectTrigger:{postTaskChange:function(){return(0,I.Ad)()}},label:{oneHot:!0,postSelect:function(){h.setCurr(void 0),A(0)},preUnsetCurr:Rn},tool:{defaultTool:"mover"},task:{push:!0}}),j=an.tool,on=an.task,vn=an.data,hn=an.project,In=an.scale,fn=an.label,h=an.annotation;function Rn(){h.setCurr(void 0),A(0),j.setCurr("mover")}var W=function(r){h.setCurr(r),r!=null&&r.frontendId?A(r.frontendId):A(0)};(0,l.useEffect)(function(){(0,I.Ad)()},[]),(0,l.useEffect)(function(){var c=setInterval(function(){var r;console.log("triggered!",vn),h.pushToBackend((r=vn.curr)===null||r===void 0?void 0:r.dataId)},2e4);return function(){clearInterval(c)}},[h,vn,vn.curr]);var Fn=function(r){!r||(h.all.pop(),h.all.push(r),W(r),h.setAll(h.all))},Cn=function(r){var cn=[],Pn=(0,y.Z)(h.all),bn;try{for(Pn.s();!(bn=Pn.n()).done;){var Sn=bn.value;Sn.frontendId==r.frontendId?cn.push(r):cn.push(Sn)}}catch(zn){Pn.e(zn)}finally{Pn.f()}W(r),h.setAll(cn)},An={dataId:(i=vn.curr)===null||i===void 0?void 0:i.dataId,currentLabel:fn.curr,brushSize:_,scale:In.curr,currentTool:j.curr,annotations:h.all,currentAnnotation:h.curr,onAnnotationAdd:function(r){var cn=h.all.concat([r]);h.setAll(cn),W(r)},onAnnotationModify:Fn,modifyAnnoByFrontendId:Cn,onMouseUp:function(){j.curr!="interactor"&&(0,I.k3)({annos:h.all,currAnno:h.curr})},frontendIdOps:{frontendId:C,setFrontendId:A},model:rn},k=(0,v.YB)(),Wn={polygon:G(An),brush:(0,P.Z)(An),interactor:Tn(An)};return(0,o.jsxs)(x.Z,{className:"segment",children:[(0,o.jsxs)(ln.Z,{children:[(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/polygon.png",active:j.curr=="polygon",onClick:function(){if(!fn.curr){T.default.error("Please select a label first");return}j.setCurr("polygon"),W(void 0)},children:k.formatMessage({id:"pages.toolBar.polygon"})}),(0,o.jsx)(O.Z,{active:j.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){j.setCurr("editor"),W(void 0)},children:k.formatMessage({id:"pages.toolBar.edit"})}),(0,o.jsx)(sn.Z,{imgSrc:"./pics/buttons/brush.png",size:_,active:j.curr=="brush",onClick:function(){if(!fn.curr){T.default.error("Please select a label first");return}j.curr!="rubber"&&j.curr!="brush"&&W(void 0),j.setCurr("brush")},onChange:function(r){b(r)},children:k.formatMessage({id:"pages.toolBar.brush"})}),(0,o.jsx)(sn.Z,{size:_,active:j.curr=="rubber",onClick:function(){j.curr!="rubber"&&j.curr!="brush"&&W(void 0),j.setCurr("rubber")},onChange:function(r){b(r)},imgSrc:"./pics/buttons/rubber.png",children:k.formatMessage({id:"pages.toolBar.rubber"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){In.change(.1)},children:k.formatMessage({id:"pages.toolBar.zoomIn"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){In.change(-.1)},children:k.formatMessage({id:"pages.toolBar.zoomOut"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var r;h.pushToBackend((r=vn.curr)===null||r===void 0?void 0:r.dataId)},children:k.formatMessage({id:"pages.toolBar.save"})}),(0,o.jsx)(O.Z,{active:j.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){j.setCurr("mover")},children:k.formatMessage({id:"pages.toolBar.move"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var r=(0,I.td)();r&&(h.setAll(r.annos),W(r.currAnno))},children:k.formatMessage({id:"pages.toolBar.unDo"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var r=(0,I.Vd)();r&&(h.setAll(r.annos),W(r.currAnno))},children:k.formatMessage({id:"pages.toolBar.reDo"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){h.setAll([]),h.setCurr(void 0)},children:k.formatMessage({id:"pages.toolBar.clearMark"})})]}),(0,o.jsxs)("div",{id:"dr",className:"mainStage",children:[(0,o.jsx)("div",{className:"draw",children:(0,o.jsx)(M.Z,{scale:In.curr,annotations:h.all,currentTool:j.curr,currentAnnotation:h.curr,setCurrentAnnotation:W,onAnnotationModify:Cn,onAnnotationModifyComplete:function(){j.curr!="interactor"&&(0,I.k3)({annos:h.all,currAnno:h.curr})},frontendIdOps:{frontendId:C,setFrontendId:A},imgSrc:vn.imgSrc,transparency:tn,threshold:g,onAnnotationAdd:function(r){var cn=h.all.concat([r]);h.setAll(cn),h.curr||W(r)},drawTool:Wn})}),(0,o.jsx)("div",{className:"pblock",children:(0,o.jsx)(nn.Z,{task:on,project:hn})}),(0,o.jsx)("div",{className:"prevTask",onClick:function(){!on.prevTask()||W(void 0)}}),(0,o.jsx)("div",{className:"nextTask",onClick:function(){!on.nextTask()||W(void 0)}})]}),(0,o.jsxs)(ln.Z,{disLoc:"right",children:[(0,o.jsx)(xn,{imgSrc:"./pics/buttons/intelligent_interaction.png",active:j.curr=="interactor",onClick:function(){j.setCurr("interactor")},model:rn,project:hn,children:k.formatMessage({id:"pages.toolBar.interactor"})}),(0,o.jsx)(sn.Z,{imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:g,maxSize:100,minSize:10,step:10,onChange:function(r){en(r)},children:k.formatMessage({id:"pages.toolBar.segmentThreshold"})}),(0,o.jsx)(sn.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:tn,maxSize:100,minSize:0,onChange:function(r){Y(r)},children:k.formatMessage({id:"pages.toolBar.transparency"})}),(0,o.jsx)(sn.Z,{imgSrc:"./pics/buttons/radius.png",disLoc:"left",children:k.formatMessage({id:"pages.toolBar.visualRadius"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){v.m8.push("/project_overview?projectId=".concat(hn.curr.projectId))},children:"Project Overview"})]}),(0,o.jsxs)("div",{className:"rightSideBar",children:[(0,o.jsx)("div",{className:"determinOutline",children:(0,o.jsx)(Q.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){W(void 0)},children:k.formatMessage({id:"pages.toolBar.determineOutline"})})}),(0,o.jsx)(e.Z,{hideColorPicker:!1,labels:fn.all,activeIds:fn.activeIds,onLabelSelect:fn.onSelect,onLabelModify:function(){},onLabelDelete:fn.remove,onLabelAdd:function(r){fn.create((0,$.Z)((0,$.Z)({},r),{},{projectId:hn.curr.projectId})).then(function(cn){W(void 0),fn.setCurr(cn)})}}),(0,o.jsx)(a.Z,{currAnnotation:h.curr,annotations:h.all,onAnnotationSelect:function(r){r!=null&&r.delete||W(r)},onAnnotationAdd:function(){W(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(r){h.setAll(h.all.filter(function(cn){return cn.frontendId!=r.frontendId})),W(void 0)}})]})]})},Un=Zn}}]);
