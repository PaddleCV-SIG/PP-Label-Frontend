(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(sr,Q,S){"use strict";S.d(Q,{gu:function(){return x},Gd:function(){return z},$L:function(){return ur}});var H=S(86582),F=S(91220),k=S(3182),ir=S(34792),E=S(48086),O=S(2824),X=S(94043),i=S.n(X),N=S(48971),D=S(37071),R=S(81139),W=localStorage.getItem("basePath"),K=new R.VK(W?{basePath:W}:void 0),j=new R.U(K),Y=new R.sD(K),q=new R.W6(K),G=new R.Cl(K),J=new R.vb(K),x=function(p){return JSON.parse(JSON.stringify(p))};function fr(M){return M&&(M.toLowerCase().replace(/([-_][a-z])/g,function(p){return p.toUpperCase().replace("-","").replace("_","")}),M)}var V=function(p,m,g){if(!!g){for(var l=0;l<m.length;l++)if(p[g]==m[l][g])return l}},rr=function(p){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,3],g=p(1),l=(0,O.Z)(g,2),A=l[0],U=l[1],y=function(c){var h=A;h+=c,h<m[0]&&(h=m[0],E.default.error("Smallest scale is "+m[0])),h>m[1]&&(h=m[1],E.default.error("Largest scale is "+m[1])),U(h)};return{curr:A,change:y}},z=function(p){var m=p([]),g=(0,O.Z)(m,2),l=g[0],A=g[1],U=p(),y=(0,O.Z)(U,2),f=y[0],c=y[1],h=function(){var o=(0,k.Z)(i().mark(function a(){var u;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,j.getAll();case 3:return u=r.sent,A(u),r.abrupt("return",u);case 8:return r.prev=8,r.t0=r.catch(0),console.log("project getAll err",r.t0),D.Z.parseError(r.t0,E.default),r.abrupt("return");case 13:case"end":return r.stop()}},a,null,[[0,8]])}));return function(){return o.apply(this,arguments)}}(),L=function(){var o=(0,k.Z)(i().mark(function a(u){var n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u!=null){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(l.length>1)){e.next=5;break}return E.default.error("Currently have multiple projects stored, use turnTo instead"),e.abrupt("return");case 5:return e.next=7,j.get(u);case 7:return n=e.sent,A([n]),c(0),e.abrupt("return",n);case 11:case"end":return e.stop()}},a)}));return function(u){return o.apply(this,arguments)}}(),_=function(){var o=(0,k.Z)(i().mark(function a(u){return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("remove project",u),typeof u!="number"){r.next=6;break}return r.next=4,j.remove(u);case 4:r.next=8;break;case 6:return r.next=8,j.remove(u.projectId);case 8:h();case 9:case"end":return r.stop()}},a)}));return function(u){return o.apply(this,arguments)}}(),C=function(){var o=(0,k.Z)(i().mark(function a(u){var n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.create(u);case 3:return n=e.sent,console.log(n),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),console.log("project create err",e.t0),e.abrupt("return",D.Z.parseError(e.t0,E.default));case 12:case"end":return e.stop()}},a,null,[[0,8]])}));return function(u){return o.apply(this,arguments)}}(),v=function(){var o=(0,k.Z)(i().mark(function a(u,n){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:j.update(u,n).then(function(b){console.log("project update res",b)}).catch(function(b){console.log("project update err ",b),D.Z.parseError(b,E.default)});case 1:case"end":return e.stop()}},a)}));return function(u,n){return o.apply(this,arguments)}}();return{all:l,getAll:h,getCurr:L,remove:_,create:C,update:v,get curr(){if(f!=null)return l[f]}}},er=function(p,m){var g=m.oneHot,l=g===void 0?!0:g,A=m.postSetCurr,U=p(),y=(0,O.Z)(U,2),f=y[0],c=y[1],h=p(),L=(0,O.Z)(h,2),_=L[0],C=L[1],v=p(l),o=(0,O.Z)(v,2),a=o[0],u=o[1],n=function(){var w=(0,k.Z)(i().mark(function t(P){var T,d,Z,B;return i().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.prev=0,$.next=3,j.getLabels(P);case 3:T=$.sent,d=(0,F.Z)(T);try{for(d.s();!(Z=d.n()).done;)B=Z.value,B.active=!1}catch(lr){d.e(lr)}finally{d.f()}return c(T),$.abrupt("return",T);case 10:return $.prev=10,$.t0=$.catch(0),console.log("label getall err ",$.t0),$.abrupt("return",D.Z.parseError($.t0,E.default));case 14:case"end":return $.stop()}},t,null,[[0,10]])}));return function(P){return w.apply(this,arguments)}}(),r=function(t){var P=typeof t=="number"?t:V(t,f,"labelId");if(P=P||0,C(P),console.log("onehot",a),a){var T=(0,F.Z)(f),d;try{for(T.s();!(d=T.n()).done;){var Z=d.value;Z.active=!1}}catch(B){T.e(B)}finally{T.f()}f[P].active=!0,console.log("all",f)}else f[P].active=!f[P].active;A&&A(f[P]),c((0,H.Z)(f))},e=function(){var w=(0,k.Z)(i().mark(function t(P){var T;return i().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.prev=0,Z.next=3,J.create(P);case 3:return T=Z.sent,T.active=!1,c([].concat((0,H.Z)(f),[T])),Z.abrupt("return",T);case 9:return Z.prev=9,Z.t0=Z.catch(0),console.log("label create err",Z.t0),Z.abrupt("return",D.Z.parseError(Z.t0,E.default));case 13:case"end":return Z.stop()}},t,null,[[0,9]])}));return function(P){return w.apply(this,arguments)}}(),b=function(){var w=(0,k.Z)(i().mark(function t(P){return i().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return console.log("remove label",P),d.prev=1,d.next=4,J.remove(P.labelId);case 4:c(f.filter(function(Z){return Z.labelId!=P.labelId})),d.next=11;break;case 7:d.prev=7,d.t0=d.catch(1),console.log("label remove err",d.t0),D.Z.parseError(d.t0,E.default);case 11:case"end":return d.stop()}},t,null,[[1,7]])}));return function(P){return w.apply(this,arguments)}}(),s=function(){},I=function(){u(!a)};return{all:f,getAll:n,setAll:c,setCurr:r,create:e,remove:b,onModify:s,toggleOneHot:I,get curr(){if(_!=null)return f[_]}}},ar=function(p){var m=p(),g=(0,O.Z)(m,2),l=g[0],A=g[1],U=p(),y=(0,O.Z)(U,2),f=y[0],c=y[1],h=p(),L=(0,O.Z)(h,2),_=L[0],C=L[1],v=function(e){if(e<0){E.default.error("This is the first image. No previous image.");return}if(e==l.length){E.default.error("This is the final image. No next image.");return}console.log("turning to",e),c(e)},o=function(){var r=(0,k.Z)(i().mark(function e(b,s){var I;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.getTasks(b);case 3:if(I=t.sent,A(I),s==null){t.next=9;break}return console.log("getall turnto"),v(s),t.abrupt("return",[I,I[s]]);case 9:return t.abrupt("return",I);case 12:return t.prev=12,t.t0=t.catch(0),console.log("task getall err ",t.t0),t.abrupt("return",D.Z.parseError(t.t0,E.default));case 16:case"end":return t.stop()}},e,null,[[0,12]])}));return function(b,s){return r.apply(this,arguments)}}(),a=function(){var r=(0,k.Z)(i().mark(function e(b){var s,I;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.getProgress(b);case 3:if(s=t.sent,!(!s||!s.finished||!s.total)){t.next=6;break}throw Error("empty progress");case 6:return I=Math.ceil(s.finished/s.total*100),console.log("progress",s,I),C(I),t.abrupt("return",I);case 12:return t.prev=12,t.t0=t.catch(0),console.log("get progress err",t.t0),D.Z.parseError(t.t0,E.default),t.abrupt("return",0);case 17:case"end":return t.stop()}},e,null,[[0,12]])}));return function(b){return r.apply(this,arguments)}}(),u=function(){var r=(0,k.Z)(i().mark(function e(){return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:v(f+1),console.log("all tasks",l);case 2:case"end":return s.stop()}},e)}));return function(){return r.apply(this,arguments)}}(),n=function(){var r=(0,k.Z)(i().mark(function e(){return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:v(f-1);case 1:case"end":return s.stop()}},e)}));return function(){return r.apply(this,arguments)}}();return{currIdx:f,all:l,turnTo:v,getAll:o,getProgress:a,progress:_,nextTask:u,prevTask:n,get curr(){if(!(f==null||l==null))return console.log("task.curr",l[f]),l[f]},get finished(){return Math.floor((l==null?void 0:l.length)*_/100)}}},nr=function(p){var m=p(),g=(0,O.Z)(m,2),l=g[0],A=g[1],U=p(),y=(0,O.Z)(U,2),f=y[0],c=y[1],h=function(){var v=(0,k.Z)(i().mark(function o(a){var u,n,r,e;return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,q.getAnnotations(a);case 3:u=s.sent,n=(0,F.Z)(u);try{for(n.s();!(r=n.n()).done;)e=r.value,e.active=!1}catch(I){n.e(I)}finally{n.f()}return A(u),s.abrupt("return",u);case 10:return s.prev=10,s.t0=s.catch(0),console.log("ann getAll err",s.t0),s.abrupt("return",D.Z.parseError(s.t0,E.default));case 14:case"end":return s.stop()}},o,null,[[0,10]])}));return function(a){return v.apply(this,arguments)}}(),L=function(){var v=(0,k.Z)(i().mark(function o(a){var u;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("create",a),r.prev=1,r.next=4,G.create(a);case 4:return u=r.sent,a.dataId&&h(a.dataId),r.abrupt("return",u);case 9:return r.prev=9,r.t0=r.catch(1),console.log("annotation create err",r.t0),r.abrupt("return",D.Z.parseError(r.t0,E.default));case 13:case"end":return r.stop()}},o,null,[[1,9]])}));return function(a){return v.apply(this,arguments)}}(),_=function(){var v=(0,k.Z)(i().mark(function o(a){var u;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("typeof",typeof a),u=typeof a!="number"?a.annotationId:a,r.prev=2,!u){r.next=6;break}return r.next=6,G.remove(u);case 6:A(l.filter(function(e){return e.annotationId!=u})),r.next=13;break;case 9:return r.prev=9,r.t0=r.catch(2),console.log("annotation remove err",r.t0),r.abrupt("return",D.Z.parseError(r.t0,E.default));case 13:case"end":return r.stop()}},o,null,[[2,9]])}));return function(a){return v.apply(this,arguments)}}(),C=function(){var v=(0,k.Z)(i().mark(function o(a,u){var n,r,e,b,s;return i().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(console.log("annotation onselect",a),a!=null){w.next=4;break}return c(void 0),w.abrupt("return");case 4:n=(0,F.Z)(l);try{for(n.s();!(r=n.n()).done;)e=r.value,e.active=!1}catch(t){n.e(t)}finally{n.f()}b=l.filter(function(t){return t.annotationId==a.annotationId})[0],b.active=!a.active,s=V(b,l,"annotationId"),c(s),u.setCurr(a.labelId),A((0,H.Z)(l));case 12:case"end":return w.stop()}},o)}));return function(a,u){return v.apply(this,arguments)}}();return{all:l,getAll:h,create:L,remove:_,setCurr:C,get curr(){if(!(!l||!f))return l[f]}}},tr=function(p){var m=p(),g=(0,O.Z)(m,2),l=g[0],A=g[1],U=p([]),y=(0,O.Z)(U,2),f=y[0],c=y[1],h=function(){var _=(0,k.Z)(i().mark(function C(v){return i().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:A(v);case 1:case"end":return a.stop()}},C)}));return function(v){return _.apply(this,arguments)}}(),L=function(){var _=(0,k.Z)(i().mark(function C(v,o){var a;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Y.getDatas(v);case 3:if(a=n.sent,c(a),o==null){n.next=8;break}return h(o),n.abrupt("return",[a,a[o]]);case 8:return n.abrupt("return",a);case 11:return n.prev=11,n.t0=n.catch(0),console.log("data getall err ",n.t0),n.abrupt("return",D.Z.parseError(n.t0,E.default));case 15:case"end":return n.stop()}},C,null,[[0,11]])}));return function(v,o){return _.apply(this,arguments)}}();return{all:f,getAll:L,turnTo:h,get curr(){if(!(l==null||f==null))return f[l]},get imgSrc(){return f&&f[l]?(console.log("imgsrc","".concat(W,"/datas/").concat(f[l].dataId,"/image?sault=").concat(f[l].sault)),"".concat(W,"/datas/").concat(f[l].dataId,"/image?sault=").concat(f[l].sault)):""}}},ur=function(p,m){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};g.effectTrigger||(g.effectTrigger={});var l=p(!1),A=(0,O.Z)(l,2),U=A[0],y=A[1],f=rr(p),c=ar(p),h=tr(p),L=z(p),_=er(p,g.label),C=nr(p);return m(function(){var v=D.Z.getQueryVariable("projectId");if(v==null){N.m8.push("/");return}var o=parseInt(v);L.getCurr(v).catch(function(a){D.Z.parseError(a,E.default),N.m8.push("/")}),_.getAll(o),c.getAll(o),c.getProgress(o)},[_,L,c]),m(function(){c.all&&c.all.length!=0&&c.turnTo(0)},[c,c.all]),m(function(){if(c.currIdx!=null){var v=function(){var o=(0,k.Z)(i().mark(function a(){var u,n,r,e,b,s,I,w,t,P;return i().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(console.log("onTaskChange",c.curr,_.all,c.progress),(u=c.curr)!==null&&u!==void 0&&u.projectId&&c.getProgress(c.curr.projectId),!((n=c.curr)!==null&&n!==void 0&&n.taskId)){d.next=15;break}return d.next=5,h.getAll(c.curr.taskId,0);case 5:return r=d.sent,e=(0,O.Z)(r,2),b=e[0],s=e[1],console.log(b),d.next=12,C.getAll(s.dataId);case 12:if(I=d.sent,_.all){w=(0,F.Z)(_.all);try{for(w.s();!(t=w.n()).done;)P=t.value,P.active=!1}catch(Z){w.e(Z)}finally{w.f()}}g.effectTrigger.postTaskChange&&g.effectTrigger.postTaskChange(_.all,I);case 15:y(!1);case 16:case"end":return d.stop()}},a)}));return function(){return o.apply(this,arguments)}}();v()}},[C,h,_.all,g.effectTrigger,c,c.currIdx]),[U,y,f,C,c,h,L,_]}}}]);
