(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(y,h,n){"use strict";n.d(h,{Z:function(){return R}});var E=n(94663),F=n(80112);function Q(N){return Function.toString.call(N).indexOf("[native code]")!==-1}var tn=n(18597);function k(N,C,Y){return(0,tn.Z)()?k=Reflect.construct:k=function(U,S,X){var f=[null];f.push.apply(f,S);var J=Function.bind.apply(U,f),A=new J;return X&&(0,F.Z)(A,X.prototype),A},k.apply(null,arguments)}function R(N){var C=typeof Map=="function"?new Map:void 0;return R=function(l){if(l===null||!Q(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof C!="undefined"){if(C.has(l))return C.get(l);C.set(l,U)}function U(){return k(l,arguments,(0,E.Z)(this).constructor)}return U.prototype=Object.create(l.prototype,{constructor:{value:U,enumerable:!1,writable:!0,configurable:!0}}),(0,F.Z)(U,l)},R(N)}},6277:function(y){y.exports={modal:"modal___26yNn"}},45092:function(y){y.exports={modal:"modal___1H_FQ"}},72285:function(y){y.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},85871:function(y,h,n){"use strict";var E=n(71194),F=n(50146),Q=n(49111),tn=n(19650),k=n(57663),R=n(71577),N=n(13062),C=n(71230),Y=n(89032),l=n(15746),U=n(77883),S=n(70507),X=n(34792),f=n(48086),J=n(9715),A=n(93766),V=n(2824),x=n(67294),t=n(48971),vn=n(6277),K=n.n(vn),d=n(85893),sn=function(Z){var en=(0,t.YB)(),dn=(0,x.useState)(60),on=(0,V.Z)(dn,2),T=on[0],an=on[1],w=(0,x.useState)(20),L=(0,V.Z)(w,2),$=L[0],v=L[1],gn=(0,x.useState)(20),_n=(0,V.Z)(gn,2),rn=_n[0],Mn=_n[1],e=(0,x.useState)(!1),o=(0,V.Z)(e,2),c=o[0],u=o[1],s=(0,t.YB)().formatMessage({id:"pages.toolBar.divideData"}),I=(0,t.YB)().formatMessage({id:"component.PPDivideDataModal.train"}),_=(0,t.YB)().formatMessage({id:"component.PPDivideDataModal.validation"}),p=(0,t.YB)().formatMessage({id:"component.PPDivideDataModal.test"}),r=(0,t.YB)().formatMessage({id:"component.PPCreater.cancel"}),g=(0,t.YB)().formatMessage({id:"component.PPSegMode.ok"}),P=A.Z.useForm(),D=(0,V.Z)(P,1),O=D[0];return(0,d.jsx)(F.Z,{className:K().modal,title:s,visible:Z.visible,onCancel:Z.onCancel,footer:null,children:(0,d.jsxs)(A.Z,{form:O,name:"basic",labelCol:{span:8},wrapperCol:{span:16},initialValues:{remember:!1},onFinish:function(){if(T+$+rn!=100){f.default.error("Train, Validation and Test total percent should equal 100!");return}console.log("x trainData: ".concat(T,", validationData: ").concat($,", testData: ").concat(rn,", props.project.curr.projectId: ").concat(Z.project.curr.projectId)),u(!0),Z.splitDataset(Z.project.curr.projectId,{train:T*.01,validation:$*.01,test:rn*.01}).then(function(){var j;console.log("success"),f.default.success(en.formatMessage({id:"component.PPDivideDataModal.success"})),(j=Z.onFinish)===null||j===void 0||j.call(0)}).finally(function(){u(!1)})},autoComplete:"off",layout:"vertical",children:[(0,d.jsxs)(C.Z,{children:[(0,d.jsx)(l.Z,{span:8,children:(0,d.jsx)(A.Z.Item,{label:I,name:"train",children:(0,d.jsx)(S.Z,{addonAfter:"%",defaultValue:60,precision:0,min:0,max:100,value:T,onChange:an})})}),(0,d.jsx)(l.Z,{span:8,children:(0,d.jsx)(A.Z.Item,{label:_,name:"validation",children:(0,d.jsx)(S.Z,{addonAfter:"%",defaultValue:20,precision:0,min:0,max:100,value:$,onChange:v})})}),(0,d.jsx)(l.Z,{span:8,children:(0,d.jsx)(A.Z.Item,{label:p,name:"test",children:(0,d.jsx)(S.Z,{addonAfter:"%",defaultValue:20,precision:0,min:0,max:100,value:rn,onChange:Mn})})})]}),(0,d.jsx)(A.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,d.jsxs)(tn.Z,{children:[(0,d.jsx)(R.Z,{onClick:function(){var j;(j=Z.onCancel)===null||j===void 0||j.call(0),O.resetFields()},children:r}),(0,d.jsx)(R.Z,{type:"primary",htmlType:"submit",loading:c,children:g})]})})]})})};h.Z=sn},62850:function(y,h,n){"use strict";var E=n(71194),F=n(50146),Q=n(49111),tn=n(19650),k=n(57663),R=n(71577),N=n(47673),C=n(24044),Y=n(34792),l=n(48086),U=n(9715),S=n(93766),X=n(2824),f=n(67294),J=n(48971),A=n(45092),V=n.n(A),x=n(85893),t=function(K){var d=(0,J.YB)(),sn=(0,f.useState)(!1),ln=(0,X.Z)(sn,2),Z=ln[0],en=ln[1],dn=(0,J.YB)().formatMessage({id:"component.PPCreater.cancel"}),on=S.Z.useForm(),T=(0,X.Z)(on,1),an=T[0];return(0,x.jsx)(F.Z,{className:V().modal,title:(0,J.YB)().formatMessage({id:"component.PPExportModal.title"}),visible:K.visible,onCancel:K.onCancel,footer:null,children:(0,x.jsxs)(S.Z,{form:an,name:"basic",labelCol:{span:6},wrapperCol:{span:16},initialValues:{remember:!1},onFinish:function(L){console.log(L);var $=L.path;if(!$){l.default.error(d.formatMessage({id:"component.PPExportModal.pathNotNull"}));return}en(!0),K.exportDataset(K.project.curr.projectId,$).then(function(){var v;l.default.success(d.formatMessage({id:"component.PPExportModal.exportSuccess"})),(v=K.onFinish)===null||v===void 0||v.call(0)}).finally(function(){en(!1)})},autoComplete:"off",children:[(0,x.jsx)(S.Z.Item,{label:d.formatMessage({id:"component.PPExportModal.path"}),name:"path",children:(0,x.jsx)(C.Z,{})}),(0,x.jsx)(S.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,x.jsxs)(tn.Z,{children:[(0,x.jsx)(R.Z,{onClick:function(){var L;(L=K.onCancel)===null||L===void 0||L.call(0),an.resetFields()},children:dn}),(0,x.jsx)(R.Z,{type:"primary",htmlType:"submit",loading:Z,children:d.formatMessage({id:"component.PPExportModal.export"})})]})})]})})};h.Z=t},33549:function(y,h,n){"use strict";n.r(h),n.d(h,{default:function(){return Mn}});var E=n(11849),F=n(20228),Q=n(11382),tn=n(34669),k=n(54458),R=n(34792),N=n(48086),C=n(91220),Y=n(2824),l=n(67294),U=n(72285),S=n.n(U),X=n(8088),f=n(61541),J=n(44434),A=n(5041),V=n(57436),x=n(14836),t=n(85893),vn=function(o){return(0,t.jsx)(f.Z,{active:o.active,imgSrc:o.imgSrc||"./pics/buttons/rectangle.png",onClick:o.onClick,children:o.children})},K=vn,d=n(65031);function sn(e){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}function ln(e){if(!(!e||e.length<2))return{xmin:e[0],ymin:e[1],xmax:e[2]||void 0,ymax:e[3]||void 0}}function Z(e,o,c,u,s,I,_,p){if(!e||!e.points||!e.label||!e.label.color)return[(0,t.jsx)(t.Fragment,{})];var r=e.points,g=e.label.color,P=sn(g);if(!P)return[(0,t.jsx)(t.Fragment,{})];var D=(p==null?void 0:p.frontendId)==e.frontendId,O=D?.5:.1,q=r.xmax!=null&&r.ymax!=null?(0,t.jsx)(d.UL,{onMouseOver:function(){s=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){s=="editor"&&I(e)},stroke:g,strokeWidth:2/u,globalCompositeOperation:"source-over",lineCap:"round",x:r.xmin,y:r.ymin,width:r.xmax-r.xmin,height:r.ymax-r.ymin,closed:!0,fill:"rgba(".concat(P.r,", ").concat(P.g,", ").concat(P.b,", ").concat(O,")")}):(0,t.jsx)(t.Fragment,{});function j(W){if(!W&&(r.xmax==null||r.ymax==null))return(0,t.jsx)(t.Fragment,{});var G=function(cn){if(s=="editor"){var mn=_==null?void 0:_.current,m=mn.findOne(".baseImage"),B=!1,H=cn.target.x();H>m.width()/2&&(H=m.width()/2,B=!0),H<-m.width()/2&&(H=-m.width()/2,B=!0);var b=cn.target.y();b>m.height()/2&&(b=m.height()/2,B=!0),b<-m.height()/2&&(b=-m.height()/2,B=!0),B&&cn.target.setPosition({x:H,y:b}),W?(r.xmin=H,r.ymin=b):(r.xmax=H,r.ymax=b);var En=(0,E.Z)((0,E.Z)({},e),{},{points:r});o(En)}};return(0,t.jsx)(d.Cd,{onMouseDown:function(){(s=="editor"||s=="mover")&&I(e)},draggable:s=="editor",onDragMove:G,onDragEnd:G,onMouseOver:function(){s=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:W?r.xmin:r.xmax,y:W?r.ymin:r.ymax,radius:5/u,fill:g})}return[(0,t.jsxs)(d.ZA,{children:[q,j(!0),j(!1)]},e.annotationId)]}function en(e){var o=1;if(!e||e.length==0)return o;var c=(0,C.Z)(e),u;try{for(c.s();!(u=c.n()).done;){var s=u.value;s.frontendId&&o<=s.frontendId&&(o=s.frontendId+1)}}catch(I){c.e(I)}finally{c.f()}return o}function dn(e){var o=function(_,p,r,g){var P=(_.evt.offsetX+p)/g,D=(_.evt.offsetY+r)/g,O=ln([P,D]);!O||e.onAnnotationAdd({frontendId:en(e.annotations),type:"rectangle",label:e.currentLabel,points:O})},c=function(_,p,r,g){if(!(!e.currentAnnotation||!e.currentAnnotation.points)){var P=(_.evt.offsetX+p)/g,D=(_.evt.offsetY+r)/g,O=e.currentAnnotation.points;if(!!O){O.xmax=P,O.ymax=D;var q={type:"rectangle",frontendId:e.currentAnnotation.frontendId,label:e.currentAnnotation.label,points:O};e.onAnnotationModify(q)}}},u=function(_,p,r,g){e.currentTool=="rectangle"&&(e.currentAnnotation?c(_,p,r,g):o(_,p,r,g))},s=function(){e.currentTool=="rectangle"&&e.onMouseUp()};return{onMouseDown:u,onMouseMove:function(){},onMouseUp:s,createElementsFunc:Z}}var on=n(64322),T=40;function an(){localStorage.removeItem("history"),w([])}function w(e){var o=localStorage.getItem("history"),c=o?JSON.parse(o):{index:-1,items:[]};if(JSON.stringify(c.items[c.index])!=JSON.stringify(e)){var u=c.index>T?c.index-T:0,s=c.items.splice(u,c.index==0?1:c.index+1);c.items=s.concat([e]),c.index<=T?c.index++:c.index=T+1,localStorage.setItem("history",JSON.stringify(c))}}function L(){var e=localStorage.getItem("history");if(!!e){var o=JSON.parse(e);if(!!o&&!(o.index>=o.items.length-1))return o.index++,localStorage.setItem("history",JSON.stringify(o)),o.items[o.index]}}function $(){var e=localStorage.getItem("history");if(!!e){var o=JSON.parse(e);if(!(!o||!o.index)&&!(o.index<=0))return o.index--,localStorage.setItem("history",JSON.stringify(o)),o.items[o.index]}}var v=n(48971),gn=n(85871),_n=n(62850),rn=function(){var o,c=(0,on.$L)(l.useState,l.useEffect,{label:{oneHot:!0},effectTrigger:{postTaskChange:an}}),u=(0,Y.Z)(c,10),s=u[0],I=u[1],_=u[2],p=u[3],r=u[4],g=u[5],P=u[6],D=u[7],O=u[8],q=u[9],j=(0,l.useState)(),W=(0,Y.Z)(j,2),G=W[0],M=W[1],cn=(0,l.useState)([]),mn=(0,Y.Z)(cn,2),m=mn[0],B=mn[1],H=(0,l.useState)(!1),b=(0,Y.Z)(H,2),En=b[0],Pn=b[1],Cn=(0,l.useState)(!1),pn=(0,Y.Z)(Cn,2),An=pn[0],xn=pn[1],In=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));m.push(a),B(m),M(a)},On=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));var nn=[],z=(0,C.Z)(m),un;try{for(z.s();!(un=z.n()).done;){var fn=un.value;fn.frontendId==a.frontendId?nn.push(a):nn.push(fn)}}catch(hn){z.e(hn)}finally{z.f()}console.log("modifyAnnotation, newAnnos:",nn,"anno:",a),B(nn),M(a)},Bn=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));var nn=[],z=(0,C.Z)(m),un;try{for(z.s();!(un=z.n()).done;){var fn=un.value;fn.frontendId!=a.frontendId&&nn.push(fn)}}catch(hn){z.e(hn)}finally{z.f()}B(nn),M(void 0)},Yn=function(a){!a||(console.log("modifyAnnotation",a,"anno.label:",a==null?void 0:a.label),a.taskId=r.curr.taskId,a.dataId=g.curr.dataId,p.modify(a))},yn=dn({currentLabel:D.curr,currentTool:s.curr,annotations:m,currentAnnotation:G,onAnnotationAdd:In,onAnnotationModify:On,onMouseUp:function(){w({annos:m,currAnno:G})}}),Dn=yn,Sn=(0,v.YB)().formatMessage({id:"pages.toolBar.rectangle"}),jn=(0,v.YB)().formatMessage({id:"pages.toolBar.zoomIn"}),Zn=(0,v.YB)().formatMessage({id:"pages.toolBar.zoomOut"}),Tn=(0,v.YB)().formatMessage({id:"pages.toolBar.move"}),Ln=(0,v.YB)().formatMessage({id:"pages.toolBar.unDo"}),Rn=(0,v.YB)().formatMessage({id:"pages.toolBar.reDo"}),Un=(0,v.YB)().formatMessage({id:"pages.toolBar.save"}),Kn=(0,v.YB)().formatMessage({id:"pages.toolBar.edit"}),Wn=(0,v.YB)().formatMessage({id:"pages.toolBar.clearMark"}),bn=(0,v.YB)().formatMessage({id:"pages.toolBar.undef"}),Fn=(0,v.YB)().formatMessage({id:"pages.toolBar.divideData"}),Nn=(0,v.YB)().formatMessage({id:"pages.toolBar.export"});return(0,t.jsxs)(X.Z,{className:S().det,children:[(0,t.jsxs)(J.Z,{children:[(0,t.jsx)(K,{active:s.curr=="rectangle",onClick:function(){if(!D.curr){N.default.error("Please choose a label category first!");return}s.setCurr("rectangle"),M(void 0)},children:Sn}),(0,t.jsx)(f.Z,{active:s.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){s.setCurr("editor")},children:Kn}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){_.change(.1)},children:jn}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){_.change(-.1)},children:Zn}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){N.default.info("Annotations are saved automatically. You don't need to click save.")},children:Un}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/move.png",active:s.curr=="mover",onClick:function(){s.setCurr("mover")},children:Tn}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var a=$();!a||(M(a.currAnno),B(a.annos))},children:Ln}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var a=L();!a||(M(a.currAnno),B(a.annos))},children:Rn}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:Wn})]}),(0,t.jsx)("div",{id:"dr",className:"mainStage",children:(0,t.jsxs)(Q.Z,{tip:"loading",spinning:!!I.curr,children:[(0,t.jsx)("div",{className:"draw",children:(0,t.jsx)(V.Z,{scale:_.curr,annotations:m,currentTool:s.curr,currentAnnotation:G,setCurrentAnnotation:M,onAnnotationModify:On,onAnnotationModifyComplete:function(){w({annos:m,currAnno:G})},onMouseDown:Dn.onMouseDown,onMouseMove:Dn.onMouseMove,onMouseUp:Dn.onMouseUp,createRectangleFunc:yn.createElementsFunc,imgSrc:g.imgSrc})}),(0,t.jsx)("div",{className:"pblock",children:(0,t.jsxs)("div",{className:"progress",children:[(0,t.jsx)(k.Z,{className:"progressBar",percent:P.progress,status:"active",showInfo:!1})," ",(0,t.jsxs)("span",{className:"progressDesc",children:["Current labeling ",r.currIdx==null?1:r.currIdx+1," of"," ",(o=r.all)===null||o===void 0?void 0:o.length,". Already labeled ",r.finished(P.progress)||0,"."]})]})}),(0,t.jsx)("div",{className:"prevTask",onClick:function(){!r.prevTask()||(M(void 0),B([]))}}),(0,t.jsx)("div",{className:"nextTask",onClick:function(){!r.nextTask()||(M(void 0),B([]))}})]})}),(0,t.jsxs)(J.Z,{disLoc:"right",children:[(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){Pn(!0)},children:Fn}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/export.png",onClick:function(){xn(!0)},children:Nn}),(0,t.jsx)(f.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){M(void 0)},children:bn})]}),(0,t.jsxs)("div",{className:"rightSideBar",children:[(0,t.jsx)(A.Z,{labels:D.all,activeIds:D.activeIds,onLabelSelect:function(a){D.onSelect(a),M(void 0)},onLabelModify:function(){},onLabelDelete:D.remove,onLabelAdd:function(a){return D.create((0,E.Z)((0,E.Z)({},a),{},{projectId:P.curr.projectId}))}}),(0,t.jsx)(x.Z,{annotations:m,currAnnotation:G,onAnnotationSelect:M,onAnnotationAdd:function(){M(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(a){Bn(a)}})]}),(0,t.jsx)(gn.Z,{visible:En,splitDataset:O,project:P,onCancel:function(){Pn(!1)},onFinish:function(){Pn(!1)}}),(0,t.jsx)(_n.Z,{visible:An,exportDataset:q,project:P,onCancel:function(){xn(!1)},onFinish:function(){xn(!1)}})]})},Mn=rn},15746:function(y,h,n){"use strict";var E=n(21584);h.Z=E.Z},89032:function(y,h,n){"use strict";var E=n(38663),F=n.n(E),Q=n(6999)},71230:function(y,h,n){"use strict";var E=n(92820);h.Z=E.Z},13062:function(y,h,n){"use strict";var E=n(38663),F=n.n(E),Q=n(6999)}}]);
