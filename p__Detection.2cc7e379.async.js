(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(H,k,o){"use strict";o.d(k,{Z:function(){return E}});var C=o(94663),w=o(80112);function B(O){return Function.toString.call(O).indexOf("[native code]")!==-1}var Q=o(18597);function Z(O,I,X){return(0,Q.Z)()?Z=Reflect.construct:Z=function(g,$,U){var L=[null];L.push.apply(L,$);var f=Function.bind.apply(g,L),N=new f;return U&&(0,w.Z)(N,U.prototype),N},Z.apply(null,arguments)}function E(O){var I=typeof Map=="function"?new Map:void 0;return E=function(u){if(u===null||!B(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof I!="undefined"){if(I.has(u))return I.get(u);I.set(u,g)}function g(){return Z(u,arguments,(0,C.Z)(this).constructor)}return g.prototype=Object.create(u.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),(0,w.Z)(g,u)},E(O)}},72285:function(H){H.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(H,k,o){"use strict";o.r(k),o.d(k,{default:function(){return hn}});var C=o(11849),w=o(57663),B=o(71577),Q=o(20228),Z=o(11382),E=o(34669),O=o(54458),I=o(34792),X=o(48086),u=o(2824),g=o(67294),$=o(72285),U=o.n($),L=o(8088),f=o(61541),N=o(44434),en=o(5041),on=o(57436),rn=o(14836),e=o(85893),an=function(t){return(0,e.jsx)(f.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},sn=an,cn=o(91220),z=o(65031);function ln(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function q(n,t){if(!(!n||!t))return{color:n,points:t}}function un(n,t,i,c,v,h,d){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var r=n.lines[0].points,s=n.lines[0].color,p=ln(s);if(!p)return[(0,e.jsx)(e.Fragment,{})];var A=(d==null?void 0:d.annotationId)==n.annotationId,m=A?.5:.1,x=void 0,S=[];return r.forEach(function(y,b){if(!x){x=y;return}S.push((0,e.jsx)(z.Cd,{onMouseDown:function(){v=="mover"&&h(n)},draggable:v=="mover",onDragMove:function(R){console.log("Circle onDrageMove");var j=R.evt.offsetX/c,K=R.evt.offsetY/c;r[b-1]=j,r[b]=K;var W=(0,C.Z)((0,C.Z)({},n),{},{lines:[{color:s,points:r}]});t(W)},onMouseOver:function(){console.log("Circle onMouseOver"),v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x,y,radius:5,fill:s})),console.log(b,r),r.length>4&&r.splice(b+1,2),x=void 0}),[(0,e.jsxs)(z.ZA,{children:[(0,e.jsx)(z.UL,{onMouseOver:function(){v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){v=="mover"&&h(n)},stroke:s,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r[0],y:r[1],width:r[2]-r[0],height:r[3]-r[1],closed:!0,fill:"rgba(".concat(p.r,", ").concat(p.g,", ").concat(p.b,", ").concat(m,")")}),S]},n.annotationId)]}function dn(n){var t=0,i=(0,cn.Z)(n),c;try{for(i.s();!(c=i.n()).done;){var v=c.value;!v||v.annotationId>t&&(t=v.annotationId)}}catch(h){i.e(h)}finally{i.f()}return t}function fn(n){var t=function(d,r){var s,p=d.evt.offsetX/r,A=d.evt.offsetY/r,m=q((s=n.currentLabel)===null||s===void 0?void 0:s.color,[p,A]);!m||n.onAnnotationAdd({tool:"polygon",annotationId:dn(n.annotations)+1,label:n.currentLabel,lines:[m]})},i=function(d,r){var s,p;if(!!n.currentAnnotation){var A=d.evt.offsetX/r,m=d.evt.offsetY/r,x=n.currentAnnotation.lines||[],S=q((s=n.currentLabel)===null||s===void 0?void 0:s.color,(p=x[0])===null||p===void 0?void 0:p.points.concat([A,m]));if(!!S){var y={tool:"polygon",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[S]};n.onAnnotationModify(y)}}},c=function(d,r){n.currentTool=="polygon"&&(n.currentAnnotation?i(d,r):t(d,r))},v=function(){n.currentTool=="polygon"&&n.onMouseUp()};return{onMouseDown:c,onMouseMove:function(){},onMouseUp:v,createElementsFunc:un}}var vn=o(64322),F=40;function gn(){localStorage.removeItem("history"),G([])}function G(n){var t=localStorage.getItem("history"),i=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(i.items[i.index])!=JSON.stringify(n)){var c=i.index>F?i.index-F:0,v=i.items.splice(c,i.index==0?1:i.index+1);i.items=v.concat([n]),i.index<=F?i.index++:i.index=F+1,localStorage.setItem("history",JSON.stringify(i))}}function mn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function pn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var yn=function(){var t,i=(0,vn.$L)(g.useState,g.useEffect,{label:{oneHot:!0},effectTrigger:{}}),c=(0,u.Z)(i,8),v=c[0],h=c[1],d=c[2],r=c[3],s=c[4],p=c[5],A=c[6],m=c[7],x=(0,g.useState)(void 0),S=(0,u.Z)(x,2),y=S[0],b=S[1],D=(0,g.useState)(),R=(0,u.Z)(D,2),j=R[0],K=R[1],W=(0,g.useState)([]),_=(0,u.Z)(W,2),M=_[0],J=_[1],P=function(a){K(a),a!=null&&a.label&&m.setCurr(a.label)};(0,g.useEffect)(function(){gn()},[]);var nn=function(a){for(var T=[],Y=0;Y<M.length;Y++)M[Y].annotationId==a.annotationId?T.push(a):T.push(M[Y]);P(a),J(T)},tn=fn({currentLabel:m.curr,currentTool:y,annotations:M,currentAnnotation:j,onAnnotationAdd:function(a){var T=M.concat([a]);J(T),j||P(a)},onAnnotationModify:nn,onMouseUp:function(){G({annos:M,currAnno:j})}}),V=tn;return(0,e.jsxs)(L.Z,{className:U().det,children:[(0,e.jsxs)(N.Z,{children:[(0,e.jsx)(sn,{active:y=="polygon",onClick:function(){b("polygon"),P(void 0)},children:"Rectangle"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/edit.png",children:"Edit"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){d.change(.1)},children:"Zoom in"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){d.change(-.1)},children:"Zoom out"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){X.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){b("mover")},children:"Move"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var a=pn();J(a.annos),P(a.currAnno)},children:"Undo"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var a=mn();J(a.annos),P(a.currAnno)},children:"Redo"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(Z.Z,{tip:"loading",spinning:v,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(on.Z,{scale:d.curr,annotations:M,currentTool:y,currentAnnotation:j,setCurrentAnnotation:P,onAnnotationModify:nn,onAnnotationModifyComplete:function(){G(M,j)},onMouseDown:V.onMouseDown,onMouseMove:V.onMouseMove,onMouseUp:V.onMouseUp,createPolygonFunc:tn.createElementsFunc,imgSrc:p.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(O.Z,{percent:s.progress,status:"active"}),s.currIdx," ",(t=s.all)===null||t===void 0?void 0:t.length," ",s.finished]})})]})}),(0,e.jsxs)(N.Z,{disLoc:"right",children:[(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:s.nextTask,children:"Next"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:s.prevTask,children:"Prev"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)("div",{className:"determinOutline",children:(0,e.jsx)(B.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){r.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(en.Z,{labels:m.all,onLabelSelect:function(a){m.setCurr(a),r.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:m.remove,onLabelAdd:function(a){return m.create((0,C.Z)((0,C.Z)({},a),{},{projectId:A.curr.projectId}))}}),(0,e.jsx)(rn.Z,{annotations:r.all,onAnnotationSelect:r.setCurr,onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:r.remove})]})]})},hn=yn}}]);
