(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(N,T,n){"use strict";n.d(T,{Z:function(){return s}});var h=n(94663),Z=n(80112);function R(t){return Function.toString.call(t).indexOf("[native code]")!==-1}var C=n(18597);function p(t,o,S){return(0,C.Z)()?p=Reflect.construct:p=function(b,w,I){var O=[null];O.push.apply(O,w);var V=Function.bind.apply(b,O),x=new V;return I&&(0,Z.Z)(x,I.prototype),x},p.apply(null,arguments)}function s(t){var o=typeof Map=="function"?new Map:void 0;return s=function(u){if(u===null||!R(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof o!="undefined"){if(o.has(u))return o.get(u);o.set(u,b)}function b(){return p(u,arguments,(0,h.Z)(this).constructor)}return b.prototype=Object.create(u.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),(0,Z.Z)(b,u)},s(t)}},85024:function(N){N.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(N){N.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(N){N.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(N,T,n){"use strict";n.d(T,{pL:function(){return Z},oo:function(){return R}});var h=n(91220);function Z(s){var t=0;if(!s)return t;var o=(0,h.Z)(s),S;try{for(o.s();!(S=o.n()).done;){var u=S.value;!u||!u.frontendId||u.frontendId>t&&(t=u.frontendId)}}catch(b){o.e(b)}finally{o.f()}return t}function R(s){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function C(s){var t=s.toString(16);return t.length==1?"0"+t:t}function p(s,t,o){return"#"+C(s)+C(t)+C(o)}},14836:function(N,T,n){"use strict";n.d(T,{Z:function(){return q}});var h=n(54421),Z=n(38272),R=n(57663),C=n(71577),p=n(91220),s=n(67294),t=n(56159),o=n.n(t),S=n(49111),u=n(19650),b=n(2824),w=n(11849),I=n(85024),O=n.n(I),V=n(63097),x=n(85893),tn=function(A){var L=(0,w.Z)({},A.annotation),Q=(0,s.useState)(L.invisible),X=(0,b.Z)(Q,2),K=X[0],Y=X[1],e=(0,s.useState)(0),j=(0,b.Z)(e,2),v=j[0],y=j[1];(0,s.useEffect)(function(){Y(A.annotation.invisible)},[A.annotation.invisible]);var l=(0,x.jsxs)(Z.ZP.Item,{className:"".concat(O().listItem," ").concat(A.active?O().listItemActive:""),unselectable:"on",onClick:function(){A.onClick(L)},children:[(0,x.jsxs)(u.Z,{align:"center",size:5,children:[(0,x.jsx)("a",{className:O().eye,style:{backgroundImage:K?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(d){d.stopPropagation(),Y(!K),A.onAnnotationModify(L)}})," ",(0,x.jsx)("span",{className:O().annotationId,children:L.frontendId}),(0,x.jsx)("span",{className:O().labelName,children:L.label.name}),(0,x.jsx)(V.Z,{color:L.label.color})]}),(0,x.jsx)("a",{className:O().delete,onClick:function(d){d.stopPropagation();var m=new Date().getTime();m-v<300||(y(m),A.onAnnotationDelete(L))}})]});return l},en=tn,J=n(48971),G=function(A){var L=(0,J.YB)(),Q=L.formatMessage({id:"component.PPAnnotationList.annotationList"}),X=L.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),K=new Set,Y=[],e=(0,p.Z)(A.annotations),j;try{for(e.s();!(j=e.n()).done;){var v=j.value;K.has(v.frontendId)||(Y.push(v),K.add(v.frontendId))}}catch(y){e.e(y)}finally{e.f()}return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(Z.ZP,{className:o().labelList,size:"large",header:(0,x.jsx)("div",{className:o().listHeader,children:Q}),bordered:!0,dataSource:Y,renderItem:function(l){var f;return(0,x.jsx)(en,{onClick:A.onAnnotationSelect,annotation:l,active:l.frontendId==((f=A.currAnnotation)===null||f===void 0?void 0:f.frontendId),onAnnotationDelete:A.onAnnotationDelete,onAnnotationModify:A.onAnnotationModify})},footer:(0,x.jsx)("div",{children:(0,x.jsx)(C.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){A.onAnnotationAdd()},block:!0,children:X})})})})},q=G},10137:function(N,T,n){"use strict";var h=n(34669),Z=n(54458),R=n(67294),C=n(85893),p=function(t){var o,S;return(0,C.jsxs)("div",{className:"progress",children:[(0,C.jsx)(Z.Z,{className:"progressBar",percent:Math.ceil(t.project.finished/((o=t.task.all)===null||o===void 0?void 0:o.length)*100),status:"active",showInfo:!1})," ",(0,C.jsxs)("span",{className:"progressDesc",children:["Current labeling ",t.task.currIdx==null?1:t.task.currIdx+1," of"," ",(S=t.task.all)===null||S===void 0?void 0:S.length,". Already labeled ",t.project.finished||0,"."]})]})};T.Z=p},91861:function(N,T,n){"use strict";n.d(T,{Ad:function(){return Z},k3:function(){return R},Vd:function(){return C},td:function(){return p}});var h=40;function Z(){localStorage.removeItem("history"),R([])}function R(s){var t=localStorage.getItem("history"),o=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(o.items[o.index])!=JSON.stringify(s)){var S=o.index>h?o.index-h:0,u=o.items.splice(S,o.index==0?1:o.index+1);o.items=u.concat([s]),o.index<=h?o.index++:o.index=h+1,localStorage.setItem("history",JSON.stringify(o))}}function C(){var s=localStorage.getItem("history");if(!!s){var t=JSON.parse(s);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function p(){var s=localStorage.getItem("history");if(!!s){var t=JSON.parse(s);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}},58857:function(N,T,n){"use strict";n.r(T),n.d(T,{default:function(){return Y}});var h=n(11849),Z=n(20228),R=n(11382),C=n(34792),p=n(48086),s=n(91220),t=n(2824),o=n(67294),S=n(48971),u=n(72285),b=n.n(u),w=n(8088),I=n(61541),O=n(44434),V=n(5041),x=n(57436),tn=n(14836),en=n(45194),J=n(91861),G=n(65031),q=n(57406),r=n(85893);function A(e){if(!(!e||e.length<2))return e.join(",")}function L(e){var j,v=e.annotation;if(!v||!v.result||!v.label||!v.label.color)return(0,r.jsx)(r.Fragment,{});var y=v.result.split(","),l={xmin:parseInt(y[0]),ymin:parseInt(y[1]),xmax:y.length>=3?parseInt(y[2]):void 0,ymax:y.length>=4?parseInt(y[3]):void 0},f=v.label.color,d=(0,q.oo)(f);if(!d)return(0,r.jsx)(r.Fragment,{});var m=((j=e.currentAnnotation)===null||j===void 0?void 0:j.frontendId)==v.frontendId,M=m?.5:.1,D=l.xmax!=null&&l.ymax!=null?(0,r.jsx)(G.UL,{onMouseOver:function(){e.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){e.currentTool=="editor"&&e.onSelect(v)},stroke:f,strokeWidth:2/e.scale,globalCompositeOperation:"source-over",lineCap:"round",x:l.xmin,y:l.ymin,width:l.xmax-l.xmin,height:l.ymax-l.ymin,closed:!0,fill:"rgba(".concat(d.r,", ").concat(d.g,", ").concat(d.b,", ").concat(M,")")}):(0,r.jsx)(r.Fragment,{});function i(k){if(!k&&(l.xmax==null||l.ymax==null))return(0,r.jsx)(r.Fragment,{});var U=function(g){var _;if(e.currentTool=="editor"){var P=(_=e.stageRef)===null||_===void 0?void 0:_.current,B=P.findOne(".baseImage"),W=!1,F=g.target.x();F>B.width()/2&&(F=B.width()/2,W=!0),F<-B.width()/2&&(F=-B.width()/2,W=!0);var H=g.target.y();H>B.height()/2&&(H=B.height()/2,W=!0),H<-B.height()/2&&(H=-B.height()/2,W=!0),W&&g.target.setPosition({x:F,y:H}),k?(l.xmin=F,l.ymin=H):(l.xmax=F,l.ymax=H);var on=(0,h.Z)((0,h.Z)({},v),{},{result:"".concat(l.xmin,",").concat(l.ymin,",").concat(l.xmax,",").concat(l.ymax)});e.onDrag(on)}};return(0,r.jsx)(G.Cd,{onMouseDown:function(){e.currentTool=="editor"&&e.onSelect(v)},draggable:e.currentTool=="editor",onDragMove:U,onDragEnd:U,onMouseOver:function(){var g;e.currentTool=="editor"&&(g=e.stageRef)!==null&&g!==void 0&&g.current&&(e.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var g;(g=e.stageRef)!==null&&g!==void 0&&g.current&&(e.stageRef.current.container().style.cursor="default")},x:k?l.xmin:l.xmax,y:k?l.ymin:l.ymax,radius:5/e.scale,fill:f})}return(0,r.jsxs)(G.ZA,{children:[D,i(!0),i(!1)]},v.annotationId)}function Q(e){var j=function(d,m){var M,D=A([d,m]);!D||!e.dataId||(console.log(D),e.onAnnotationAdd({dataId:e.dataId,type:"rectangle",frontendId:(0,q.pL)(e.annotations)+1,label:e.currentLabel,labelId:(M=e.currentLabel)===null||M===void 0?void 0:M.labelId,result:D}))},v=function(d,m){var M;if(!(!e.currentAnnotation||!e.currentAnnotation.result||!((M=e.currentLabel)!==null&&M!==void 0&&M.color))){var D=e.currentAnnotation.result+",".concat(d,",").concat(m),i=(0,h.Z)((0,h.Z)({},e.currentAnnotation),{},{result:D});e.modifyAnnoByFrontendId(i)}},y=function(d){if(e.currentTool=="rectangle"){var m=d.mouseX+d.offsetX,M=d.mouseY+d.offsetY;console.log("currentAnnotation:",e.currentAnnotation),e.currentAnnotation?v(m,M):j(m,M)}},l=function(){e.currentTool=="rectangle"&&e.onMouseUp&&e.onMouseUp()};return{onMouseDown:y,onMouseMove:function(){},onMouseUp:l,drawAnnotation:L,onFinishEdit:e.onFinishEdit}}var X=n(10137),K=function(){var j,v=(0,o.useState)(0),y=(0,t.Z)(v,2),l=y[0],f=y[1],d=(0,en.$L)(o.useState,o.useEffect,{effectTrigger:{postTaskChange:function(){return(0,J.Ad)()}},label:{oneHot:!0,postSelect:function(){i.setCurr(void 0),f(0)},preUnsetCurr:_},tool:{defaultTool:"mover"}}),m=d.tool,M=d.loading,D=d.scale,i=d.annotation,k=d.task,U=d.data,z=d.project,g=d.label;function _(){i.setCurr(void 0),f(0),m.setCurr("mover")}var P=function(a){i.setCurr(a),a!=null&&a.frontendId?f(a.frontendId):f(0)},B=function(a){var E=[],nn=(0,s.Z)(i.all),rn;try{for(nn.s();!(rn=nn.n()).done;){var an=rn.value;an.frontendId==a.frontendId?E.push(a):E.push(an)}}catch(xn){nn.e(xn)}finally{nn.f()}P(a),i.setAll(E)};(0,o.useEffect)(function(){(0,J.Ad)()},[]),(0,o.useEffect)(function(){var c=setInterval(function(){},2e4);return function(){clearInterval(c)}},[i,U,U.curr]);function W(){(0,J.k3)({annos:i.all,currAnno:i.curr}),console.log("finish before",i.curr),i.curr.annotationId==null||i.update(i.curr),console.log("finish after",i.curr)}var F={dataId:(j=U.curr)===null||j===void 0?void 0:j.dataId,currentLabel:g.curr,scale:D.curr,currentTool:m.curr,annotations:i.all,currentAnnotation:i.curr,onAnnotationAdd:function(a){var E=i.all.concat([a]);i.setAll(E),P(a)},onAnnotationModify:B,modifyAnnoByFrontendId:B,onFinishEdit:W,frontendIdOps:{frontendId:l,setFrontendId:f}},H=Q(F),on={polygon:H,brush:void 0},$=(0,S.YB)(),ln=$.formatMessage({id:"pages.toolBar.rectangle"}),sn=$.formatMessage({id:"pages.toolBar.zoomIn"}),cn=$.formatMessage({id:"pages.toolBar.zoomOut"}),dn=$.formatMessage({id:"pages.toolBar.move"}),un=$.formatMessage({id:"pages.toolBar.unDo"}),fn=$.formatMessage({id:"pages.toolBar.reDo"}),vn=$.formatMessage({id:"pages.toolBar.save"}),mn=$.formatMessage({id:"pages.toolBar.edit"}),gn=$.formatMessage({id:"pages.toolBar.clearMark"});return(0,r.jsxs)(w.Z,{className:b().det,children:[(0,r.jsxs)(O.Z,{children:[(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/rectangle.png",active:m.curr=="rectangle",onClick:function(){if(!g.curr){p.default.error("Please choose a label category first!");return}m.setCurr("rectangle"),P(void 0)},children:ln}),(0,r.jsx)(I.Z,{active:m.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){m.setCurr("editor")},children:mn}),(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){D.change(.1)},children:sn}),(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){D.change(-.1)},children:cn}),(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var a;i.pushToBackend((a=U.curr)===null||a===void 0?void 0:a.dataId)},children:vn}),(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/move.png",active:m.curr=="mover",onClick:function(){m.setCurr("mover")},children:dn}),(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var a=(0,J.td)();a&&(i.setAll(a.annos),P(a.currAnno))},children:un}),(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var a=(0,J.Vd)();a&&(i.setAll(a.annos),P(a.currAnno))},children:fn}),(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:gn})]}),(0,r.jsx)("div",{id:"dr",className:"mainStage",children:(0,r.jsxs)(R.Z,{tip:"loading",spinning:!!M.curr,children:[(0,r.jsx)("div",{className:"draw",children:(0,r.jsx)(x.Z,{scale:D.curr,annotations:i.all,currentTool:m.curr,currentAnnotation:i.curr,setCurrentAnnotation:P,onAnnotationModify:B,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:l,setFrontendId:f},imgSrc:U.imgSrc,transparency:100,onAnnotationAdd:function(a){var E=i.all.concat([a]);i.setAll(E),i.curr||P(a)},drawTool:on})}),(0,r.jsx)("div",{className:"pblock",children:(0,r.jsx)(X.Z,{task:k,project:z})}),(0,r.jsx)("div",{className:"prevTask",onClick:function(){!k.prevTask()||P(void 0)}}),(0,r.jsx)("div",{className:"nextTask",onClick:function(){!k.nextTask()||P(void 0)}})]})}),(0,r.jsxs)(O.Z,{disLoc:"right",children:[(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){S.m8.push("/project_overview?projectId=".concat(z.curr.projectId))},children:"Project Overview"}),(0,r.jsx)(I.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){S.m8.push("/ml?projectId=".concat(z.curr.projectId))},children:"ML Settings"})]}),(0,r.jsxs)("div",{className:"rightSideBar",children:[(0,r.jsx)(V.Z,{labels:g.all,activeIds:g.activeIds,onLabelSelect:g.onSelect,onLabelModify:function(){},onLabelDelete:g.remove,onLabelAdd:function(a){g.create((0,h.Z)((0,h.Z)({},a),{},{projectId:z.curr.projectId})).then(function(E){P(void 0),g.setCurr(E)})}}),(0,r.jsx)(tn.Z,{currAnnotation:i.curr,annotations:i.all,onAnnotationSelect:function(a){a!=null&&a.delete||P(a)},onAnnotationAdd:function(){P(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(a){i.setAll(i.all.filter(function(E){return E.frontendId!=a.frontendId})),P(void 0)}})]})]})},Y=K}}]);
