(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(J,R,r){"use strict";r.d(R,{Z:function(){return T}});var j=r(94663),w=r(80112);function B(C){return Function.toString.call(C).indexOf("[native code]")!==-1}var z=r(18597);function Z(C,A,O){return(0,z.Z)()?Z=Reflect.construct:Z=function(b,H,m){var P=[null];P.push.apply(P,H);var Y=Function.bind.apply(b,P),E=new Y;return m&&(0,w.Z)(E,m.prototype),E},Z.apply(null,arguments)}function T(C){var A=typeof Map=="function"?new Map:void 0;return T=function(h){if(h===null||!B(h))return h;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(typeof A!="undefined"){if(A.has(h))return A.get(h);A.set(h,b)}function b(){return Z(h,arguments,(0,j.Z)(this).constructor)}return b.prototype=Object.create(h.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),(0,w.Z)(b,h)},T(C)}},72285:function(J){J.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(J,R,r){"use strict";r.r(R),r.d(R,{default:function(){return sn}});var j=r(11849),w=r(20228),B=r(11382),z=r(34669),Z=r(54458),T=r(34792),C=r(48086),A=r(2824),O=r(67294),h=r(72285),b=r.n(h),H=r(8088),m=r(61541),P=r(44434),Y=r(5041),E=r(57436),W=r(14836),e=r(85893),V=function(t){return(0,e.jsx)(m.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},Q=V,q=r(91220),$=r(65031);function _(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function G(n,t){if(!(!n||!t))return{tool:"rectangle",color:n,points:t}}function nn(n,t,s,u,c,M,d,i){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var a=n.lines[0].points,f=n.lines[0].color,v=_(f);if(!v)return[(0,e.jsx)(e.Fragment,{})];var g=(d==null?void 0:d.annotationId)==n.annotationId,I=g?.5:.1,y=void 0,p=[];return a.forEach(function(x,S){if(!y){y=x;return}p.push((0,e.jsx)($.Cd,{onMouseDown:function(){(c=="editor"||c=="mover")&&M(n)},draggable:c=="editor",onDragMove:function(k){if(c=="editor"){var L=(k.evt.offsetX+((i==null?void 0:i.x)||0))/u,l=(k.evt.offsetY+((i==null?void 0:i.y)||0))/u;a[S-1]=L,a[S]=l;var o=(0,j.Z)((0,j.Z)({},n),{},{lines:[{tool:"rectangle",color:f,points:a}]});t(o)}},onMouseOver:function(){c=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:y,y:x,radius:5,fill:f})),a.length>4&&a.splice(S+1,2),y=void 0}),[(0,e.jsxs)($.ZA,{children:[(0,e.jsx)($.UL,{onMouseOver:function(){c=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){c=="mover"&&M(n)},stroke:f,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:a[0],y:a[1],width:a[2]-a[0],height:a[3]-a[1],closed:!0,fill:"rgba(".concat(v.r,", ").concat(v.g,", ").concat(v.b,", ").concat(I,")")}),p]},n.annotationId)]}function tn(n){var t=0,s=(0,q.Z)(n),u;try{for(s.s();!(u=s.n()).done;){var c=u.value;!c||c.annotationId>t&&(t=c.annotationId)}}catch(M){s.e(M)}finally{s.f()}return t}function en(n){console.log("currentAnnotation",n.currentAnnotation);var t=function(d,i,a,f){var v,g=d.evt.offsetX+i/f,I=d.evt.offsetY+a/f,y=G((v=n.currentLabel)===null||v===void 0?void 0:v.color,[g,I]);!y||n.onAnnotationAdd({tool:"rectangle",annotationId:tn(n.annotations)+1,label:n.currentLabel,lines:[y]})},s=function(d,i,a,f){var v,g;if(!!n.currentAnnotation){var I=(d.evt.offsetX+i)/f,y=(d.evt.offsetY+a)/f,p=n.currentAnnotation.lines||[],x=G((v=n.currentLabel)===null||v===void 0?void 0:v.color,(g=p[0])===null||g===void 0?void 0:g.points.concat([I,y]));if(!!x){var S={tool:"rectangle",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[x]};n.onAnnotationModify(S)}}},u=function(d,i,a,f){n.currentTool=="rectangle"&&(n.currentAnnotation?s(d,i,a,f):t(d,i,a,f))},c=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:u,onMouseMove:function(){},onMouseUp:c,createElementsFunc:nn}}var on=r(64322),U=40;function K(){localStorage.removeItem("history"),X([])}function X(n){var t=localStorage.getItem("history"),s=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(s.items[s.index])!=JSON.stringify(n)){var u=s.index>U?s.index-U:0,c=s.items.splice(u,s.index==0?1:s.index+1);s.items=c.concat([n]),s.index<=U?s.index++:s.index=U+1,localStorage.setItem("history",JSON.stringify(s))}}function rn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function an(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var cn=function(){var t,s=(0,on.$L)(O.useState,O.useEffect,{label:{oneHot:!0},effectTrigger:{postTaskChange:K}}),u=(0,A.Z)(s,8),c=u[0],M=u[1],d=u[2],i=u[3],a=u[4],f=u[5],v=u[6],g=u[7],I=(0,O.useState)([]),y=(0,A.Z)(I,2),p=y[0],x=y[1],S=function(o){!o||(console.log("setCurrentAnnotation",o,"anno.label:",o==null?void 0:o.label),o.taskId=a.curr.taskId,o.dataId=f.curr.dataId,i.setCurr(o),console.log(i.curr),o!=null&&o.label&&g.setCurr(o.label))};(0,O.useEffect)(function(){K()},[]);var N=function(o){for(var D=[],F=0;F<p.length;F++)p[F].annotationId==o.annotationId?D.push(o):D.push(p[F]);S(o),x(D)},k=en({currentLabel:g.curr,currentTool:c.curr,annotations:p,currentAnnotation:i.curr,onAnnotationAdd:function(o){var D=p.concat([o]);x(D),i.curr||S(o)},onAnnotationModify:N,onMouseUp:function(){X({annos:p,currAnno:i.curr})}}),L=k;return(0,e.jsxs)(H.Z,{className:b().det,children:[(0,e.jsxs)(P.Z,{children:[(0,e.jsx)(Q,{active:c.curr=="rectangle",onClick:function(){if(!g.curr){C.default.error("Please choose a label category first!");return}c.setCurr("rectangle"),S(void 0)},children:"Rectangle"}),(0,e.jsx)(m.Z,{active:c.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){c.setCurr("editor")},children:"Edit"}),(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){d.change(.1)},children:"Zoom in"}),(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){d.change(-.1)},children:"Zoom out"}),(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){C.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/move.png",active:c.curr=="mover",onClick:function(){c.setCurr("mover")},children:"Move"}),(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=an();!o||(x(o.annos),S(o.currAnno))},children:"Undo"}),(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=rn();!o||(x(o.annos),S(o.currAnno))},children:"Redo"}),(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(B.Z,{tip:"loading",spinning:!!M.curr,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(E.Z,{scale:d.curr,annotations:p,currentTool:c.curr,currentAnnotation:i.curr,setCurrentAnnotation:S,onAnnotationModify:N,onAnnotationModifyComplete:function(){X({annos:p,currAnno:i.curr}),i.modify()},onMouseDown:L.onMouseDown,onMouseMove:L.onMouseMove,onMouseUp:L.onMouseUp,createRectangleFunc:k.createElementsFunc,imgSrc:f.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(Z.Z,{className:"progressBar",percent:v.progress,status:"active",showInfo:!1})," ",(0,e.jsxs)("span",{className:"progressDesc",children:["Current labeling ",a.currIdx==null?1:a.currIdx+1," of"," ",(t=a.all)===null||t===void 0?void 0:t.length,". Already labeled ",a.finished(v.progress)||0,"."]})]})}),(0,e.jsx)("div",{className:"prevTask",onClick:a.prevTask}),(0,e.jsx)("div",{className:"nextTask",onClick:a.nextTask})]})}),(0,e.jsxs)(P.Z,{disLoc:"right",children:[(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(m.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)(Y.Z,{labels:g.all,activeIds:g.activeIds,onLabelSelect:function(o){g.onSelect(o),i.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:g.remove,onLabelAdd:function(o){return g.create((0,j.Z)((0,j.Z)({},o),{},{projectId:v.curr.projectId}))}}),(0,e.jsx)(W.Z,{annotations:i.all,activeIds:i.activeIds,onAnnotationSelect:i.setCurr,onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:function(o){i.remove(o),i.setCurr(void 0)}})]})]})},sn=cn}}]);
