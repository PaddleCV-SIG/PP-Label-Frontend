(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(N,T,n){"use strict";n.d(T,{Z:function(){return s}});var h=n(94663),Z=n(80112);function F(t){return Function.toString.call(t).indexOf("[native code]")!==-1}var C=n(18597);function M(t,r,S){return(0,C.Z)()?M=Reflect.construct:M=function(b,w,I){var O=[null];O.push.apply(O,w);var V=Function.bind.apply(b,O),x=new V;return I&&(0,Z.Z)(x,I.prototype),x},M.apply(null,arguments)}function s(t){var r=typeof Map=="function"?new Map:void 0;return s=function(d){if(d===null||!F(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(d))return r.get(d);r.set(d,b)}function b(){return M(d,arguments,(0,h.Z)(this).constructor)}return b.prototype=Object.create(d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),(0,Z.Z)(b,d)},s(t)}},85024:function(N){N.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(N){N.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(N){N.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(N,T,n){"use strict";n.d(T,{pL:function(){return Z},oo:function(){return F}});var h=n(91220);function Z(s){var t=0;if(!s)return t;var r=(0,h.Z)(s),S;try{for(r.s();!(S=r.n()).done;){var d=S.value;!d||!d.frontendId||d.frontendId>t&&(t=d.frontendId)}}catch(b){r.e(b)}finally{r.f()}return t}function F(s){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function C(s){var t=s.toString(16);return t.length==1?"0"+t:t}function M(s,t,r){return"#"+C(s)+C(t)+C(r)}},14836:function(N,T,n){"use strict";n.d(T,{Z:function(){return q}});var h=n(54421),Z=n(38272),F=n(57663),C=n(71577),M=n(91220),s=n(67294),t=n(56159),r=n.n(t),S=n(49111),d=n(19650),b=n(2824),w=n(11849),I=n(85024),O=n.n(I),V=n(63097),x=n(85893),tn=function(A){var L=(0,w.Z)({},A.annotation),Q=(0,s.useState)(L.invisible),X=(0,b.Z)(Q,2),K=X[0],Y=X[1],e=(0,s.useState)(0),j=(0,b.Z)(e,2),v=j[0],y=j[1];(0,s.useEffect)(function(){Y(A.annotation.invisible)},[A.annotation.invisible]);var i=(0,x.jsxs)(Z.ZP.Item,{className:"".concat(O().listItem," ").concat(A.active?O().listItemActive:""),unselectable:"on",onClick:function(){A.onClick(L)},children:[(0,x.jsxs)(d.Z,{align:"center",size:5,children:[(0,x.jsx)("a",{className:O().eye,style:{backgroundImage:K?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(u){u.stopPropagation(),Y(!K),A.onAnnotationModify(L)}})," ",(0,x.jsx)("span",{className:O().annotationId,children:L.frontendId}),(0,x.jsx)("span",{className:O().labelName,children:L.label.name}),(0,x.jsx)(V.Z,{color:L.label.color})]}),(0,x.jsx)("a",{className:O().delete,onClick:function(u){u.stopPropagation();var m=new Date().getTime();m-v<300||(y(m),A.onAnnotationDelete(L))}})]});return i},en=tn,z=n(48971),G=function(A){var L=(0,z.YB)(),Q=L.formatMessage({id:"component.PPAnnotationList.annotationList"}),X=L.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),K=new Set,Y=[],e=(0,M.Z)(A.annotations),j;try{for(e.s();!(j=e.n()).done;){var v=j.value;K.has(v.frontendId)||(Y.push(v),K.add(v.frontendId))}}catch(y){e.e(y)}finally{e.f()}return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(Z.ZP,{className:r().labelList,size:"large",header:(0,x.jsx)("div",{className:r().listHeader,children:Q}),bordered:!0,dataSource:Y,renderItem:function(i){var f;return(0,x.jsx)(en,{onClick:A.onAnnotationSelect,annotation:i,active:i.frontendId==((f=A.currAnnotation)===null||f===void 0?void 0:f.frontendId),onAnnotationDelete:A.onAnnotationDelete,onAnnotationModify:A.onAnnotationModify})},footer:(0,x.jsx)("div",{children:(0,x.jsx)(C.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){A.onAnnotationAdd()},block:!0,children:X})})})})},q=G},10137:function(N,T,n){"use strict";var h=n(34669),Z=n(54458),F=n(67294),C=n(85893),M=function(t){var r,S;return(0,C.jsxs)("div",{className:"progress",children:[(0,C.jsx)(Z.Z,{className:"progressBar",percent:Math.ceil(t.project.finished/((r=t.task.all)===null||r===void 0?void 0:r.length)*100),status:"active",showInfo:!1})," ",(0,C.jsxs)("span",{className:"progressDesc",children:["Current labeling ",t.task.currIdx==null?1:t.task.currIdx+1," of"," ",(S=t.task.all)===null||S===void 0?void 0:S.length,". Already labeled ",t.project.finished||0,"."]})]})};T.Z=M},91861:function(N,T,n){"use strict";n.d(T,{Ad:function(){return Z},k3:function(){return F},Vd:function(){return C},td:function(){return M}});var h=40;function Z(){localStorage.removeItem("history"),F([])}function F(s){var t=localStorage.getItem("history"),r=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(r.items[r.index])!=JSON.stringify(s)){var S=r.index>h?r.index-h:0,d=r.items.splice(S,r.index==0?1:r.index+1);r.items=d.concat([s]),r.index<=h?r.index++:r.index=h+1,localStorage.setItem("history",JSON.stringify(r))}}function C(){var s=localStorage.getItem("history");if(!!s){var t=JSON.parse(s);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function M(){var s=localStorage.getItem("history");if(!!s){var t=JSON.parse(s);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}},58857:function(N,T,n){"use strict";n.r(T),n.d(T,{default:function(){return Y}});var h=n(11849),Z=n(20228),F=n(11382),C=n(34792),M=n(48086),s=n(91220),t=n(2824),r=n(67294),S=n(48971),d=n(72285),b=n.n(d),w=n(8088),I=n(61541),O=n(44434),V=n(5041),x=n(57436),tn=n(14836),en=n(45194),z=n(91861),G=n(65031),q=n(57406),a=n(85893);function A(e){if(!(!e||e.length<2))return e.join(",")}function L(e){var j,v=e.annotation;if(!v||!v.result||!v.label||!v.label.color)return(0,a.jsx)(a.Fragment,{});var y=v.result.split(","),i={xmin:parseInt(y[0]),ymin:parseInt(y[1]),xmax:y.length>=3?parseInt(y[2]):void 0,ymax:y.length>=4?parseInt(y[3]):void 0},f=v.label.color,u=(0,q.oo)(f);if(!u)return(0,a.jsx)(a.Fragment,{});var m=((j=e.currentAnnotation)===null||j===void 0?void 0:j.frontendId)==v.frontendId,p=m?.5:.1,D=i.xmax!=null&&i.ymax!=null?(0,a.jsx)(G.UL,{onMouseOver:function(){e.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){e.currentTool=="editor"&&e.onSelect(v)},stroke:f,strokeWidth:2/e.scale,globalCompositeOperation:"source-over",lineCap:"round",x:i.xmin,y:i.ymin,width:i.xmax-i.xmin,height:i.ymax-i.ymin,closed:!0,fill:"rgba(".concat(u.r,", ").concat(u.g,", ").concat(u.b,", ").concat(p,")")}):(0,a.jsx)(a.Fragment,{});function l(k){if(!k&&(i.xmax==null||i.ymax==null))return(0,a.jsx)(a.Fragment,{});var $=function(g){var _;if(e.currentTool=="editor"){var P=(_=e.stageRef)===null||_===void 0?void 0:_.current,B=P.findOne(".baseImage"),W=!1,H=g.target.x();H>B.width()/2&&(H=B.width()/2,W=!0),H<-B.width()/2&&(H=-B.width()/2,W=!0);var U=g.target.y();U>B.height()/2&&(U=B.height()/2,W=!0),U<-B.height()/2&&(U=-B.height()/2,W=!0),W&&g.target.setPosition({x:H,y:U}),k?(i.xmin=H,i.ymin=U):(i.xmax=H,i.ymax=U);var E=(0,h.Z)((0,h.Z)({},v),{},{result:"".concat(i.xmin,",").concat(i.ymin,",").concat(i.xmax,",").concat(i.ymax)});e.onDrag(E)}};return(0,a.jsx)(G.Cd,{onMouseDown:function(){e.currentTool=="editor"&&e.onSelect(v)},draggable:e.currentTool=="editor",onDragMove:$,onDragEnd:$,onMouseOver:function(){var g;e.currentTool=="editor"&&(g=e.stageRef)!==null&&g!==void 0&&g.current&&(e.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var g;(g=e.stageRef)!==null&&g!==void 0&&g.current&&(e.stageRef.current.container().style.cursor="default")},x:k?i.xmin:i.xmax,y:k?i.ymin:i.ymax,radius:5/e.scale,fill:f})}return(0,a.jsxs)(G.ZA,{children:[D,l(!0),l(!1)]},v.annotationId)}function Q(e){var j=function(u,m){var p,D=A([u,m]);!D||!e.dataId||(console.log(D),e.onAnnotationAdd({dataId:e.dataId,type:"rectangle",frontendId:(0,q.pL)(e.annotations)+1,label:e.currentLabel,labelId:(p=e.currentLabel)===null||p===void 0?void 0:p.labelId,result:D}))},v=function(u,m){var p;if(!(!e.currentAnnotation||!e.currentAnnotation.result||!((p=e.currentLabel)!==null&&p!==void 0&&p.color))){var D=e.currentAnnotation.result+",".concat(u,",").concat(m),l=(0,h.Z)((0,h.Z)({},e.currentAnnotation),{},{result:D});e.modifyAnnoByFrontendId(l)}},y=function(u){if(e.currentTool=="rectangle"){var m=u.mouseX+u.offsetX,p=u.mouseY+u.offsetY;console.log("currentAnnotation:",e.currentAnnotation),e.currentAnnotation?v(m,p):j(m,p)}},i=function(){e.currentTool=="rectangle"&&e.onMouseUp()};return{onMouseDown:y,onMouseMove:function(){},onMouseUp:i,drawAnnotation:L}}var X=n(10137),K=function(){var j,v=(0,r.useState)(0),y=(0,t.Z)(v,2),i=y[0],f=y[1],u=(0,en.$L)(r.useState,r.useEffect,{effectTrigger:{postTaskChange:function(){return(0,z.Ad)()}},label:{oneHot:!0,postSelect:function(){l.setCurr(void 0),f(0)},preUnsetCurr:_},tool:{defaultTool:"mover"}}),m=u.tool,p=u.loading,D=u.scale,l=u.annotation,k=u.task,$=u.data,J=u.project,g=u.label;function _(){l.setCurr(void 0),f(0),m.setCurr("mover")}var P=function(o){l.setCurr(o),o!=null&&o.frontendId?f(o.frontendId):f(0)},B=function(o){var R=[],nn=(0,s.Z)(l.all),on;try{for(nn.s();!(on=nn.n()).done;){var rn=on.value;rn.frontendId==o.frontendId?R.push(o):R.push(rn)}}catch(gn){nn.e(gn)}finally{nn.f()}P(o),l.setAll(R)};(0,r.useEffect)(function(){(0,z.Ad)()},[]),(0,r.useEffect)(function(){var c=setInterval(function(){var o;l.pushToBackend((o=$.curr)===null||o===void 0?void 0:o.dataId)},2e4);return function(){clearInterval(c)}},[l,$,$.curr]);var W={dataId:(j=$.curr)===null||j===void 0?void 0:j.dataId,currentLabel:g.curr,scale:D.curr,currentTool:m.curr,annotations:l.all,currentAnnotation:l.curr,onAnnotationAdd:function(o){var R=l.all.concat([o]);l.setAll(R),P(o)},onAnnotationModify:B,modifyAnnoByFrontendId:B,onMouseUp:function(){(0,z.k3)({annos:l.all,currAnno:l.curr})},frontendIdOps:{frontendId:i,setFrontendId:f}},H=Q(W),U={polygon:H,brush:void 0},E=(0,S.YB)(),an=E.formatMessage({id:"pages.toolBar.rectangle"}),ln=E.formatMessage({id:"pages.toolBar.zoomIn"}),sn=E.formatMessage({id:"pages.toolBar.zoomOut"}),cn=E.formatMessage({id:"pages.toolBar.move"}),un=E.formatMessage({id:"pages.toolBar.unDo"}),dn=E.formatMessage({id:"pages.toolBar.reDo"}),fn=E.formatMessage({id:"pages.toolBar.save"}),vn=E.formatMessage({id:"pages.toolBar.edit"}),mn=E.formatMessage({id:"pages.toolBar.clearMark"});return(0,a.jsxs)(w.Z,{className:b().det,children:[(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/rectangle.png",active:m.curr=="rectangle",onClick:function(){if(!g.curr){M.default.error("Please choose a label category first!");return}m.setCurr("rectangle"),P(void 0)},children:an}),(0,a.jsx)(I.Z,{active:m.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){m.setCurr("editor")},children:vn}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){D.change(.1)},children:ln}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){D.change(-.1)},children:sn}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var o;l.pushToBackend((o=$.curr)===null||o===void 0?void 0:o.dataId)},children:fn}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/move.png",active:m.curr=="mover",onClick:function(){m.setCurr("mover")},children:cn}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=(0,z.td)();o&&(l.setAll(o.annos),P(o.currAnno))},children:un}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=(0,z.Vd)();o&&(l.setAll(o.annos),P(o.currAnno))},children:dn}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:mn})]}),(0,a.jsx)("div",{id:"dr",className:"mainStage",children:(0,a.jsxs)(F.Z,{tip:"loading",spinning:!!p.curr,children:[(0,a.jsx)("div",{className:"draw",children:(0,a.jsx)(x.Z,{scale:D.curr,annotations:l.all,currentTool:m.curr,currentAnnotation:l.curr,setCurrentAnnotation:P,onAnnotationModify:B,onAnnotationModifyComplete:function(){(0,z.k3)({annos:l.all,currAnno:l.curr})},frontendIdOps:{frontendId:i,setFrontendId:f},imgSrc:$.imgSrc,transparency:100,onAnnotationAdd:function(o){var R=l.all.concat([o]);l.setAll(R),l.curr||P(o)},drawTool:U})}),(0,a.jsx)("div",{className:"pblock",children:(0,a.jsx)(X.Z,{task:k,project:J})}),(0,a.jsx)("div",{className:"prevTask",onClick:function(){!k.prevTask()||P(void 0)}}),(0,a.jsx)("div",{className:"nextTask",onClick:function(){!k.nextTask()||P(void 0)}})]})}),(0,a.jsxs)(O.Z,{disLoc:"right",children:[(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){S.m8.push("/project_overview?projectId=".concat(J.curr.projectId))},children:"Project Overview"}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){S.m8.push("/ml?projectId=".concat(J.curr.projectId))},children:"ML Settings"})]}),(0,a.jsxs)("div",{className:"rightSideBar",children:[(0,a.jsx)(V.Z,{labels:g.all,activeIds:g.activeIds,onLabelSelect:g.onSelect,onLabelModify:function(){},onLabelDelete:g.remove,onLabelAdd:function(o){g.create((0,h.Z)((0,h.Z)({},o),{},{projectId:J.curr.projectId})).then(function(R){P(void 0),g.setCurr(R)})}}),(0,a.jsx)(tn.Z,{currAnnotation:l.curr,annotations:l.all,onAnnotationSelect:function(o){o!=null&&o.delete||P(o)},onAnnotationAdd:function(){P(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(o){l.setAll(l.all.filter(function(R){return R.frontendId!=o.frontendId})),P(void 0)}})]})]})},Y=K}}]);
