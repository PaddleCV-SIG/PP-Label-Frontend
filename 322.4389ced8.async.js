(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(se,Q,$){"use strict";$.d(Q,{gu:function(){return x},Gd:function(){return z},$L:function(){return ue}});var H=$(86582),F=$(91220),E=$(3182),ie=$(34792),y=$(48086),L=$(2824),X=$(94043),f=$.n(X),N=$(48971),D=$(37071),R=$(81139),W=localStorage.getItem("basePath"),K=new R.VK(W?{basePath:W}:void 0),j=new R.U(K),Y=new R.sD(K),q=new R.W6(K),G=new R.Cl(K),J=new R.vb(K),x=function(o){return JSON.parse(JSON.stringify(o))};function fe(S){return S&&(S.toLowerCase().replace(/([-_][a-z])/g,function(o){return o.toUpperCase().replace("-","").replace("_","")}),S)}var V=function(o,h,g){if(!!g){for(var s=typeof o=="number"?o:o[g],m=0;m<h.length;m++)if(s==h[m][g])return m}},ee=function(o){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],g=o(1),s=(0,L.Z)(g,2),m=s[0],M=s[1],P=function(I){var Z=I;Z<h[0]&&(Z=h[0],y.default.error("Smallest scale is "+h[0])),Z>h[1]&&(Z=h[1],y.default.error("Largest scale is "+h[1])),M(Z)};function i(p){P(m+p)}return{curr:m,change:i,setScale:P}},z=function(o){var h=o([]),g=(0,L.Z)(h,2),s=g[0],m=g[1],M=o(),P=(0,L.Z)(M,2),i=P[0],p=P[1],I=function(){var c=(0,E.Z)(f().mark(function a(){var u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getAll();case 3:return u=e.sent,m(u),e.abrupt("return",u);case 8:return e.prev=8,e.t0=e.catch(0),console.log("project getAll err",e.t0),D.Z.parseError(e.t0,y.default),e.abrupt("return");case 13:case"end":return e.stop()}},a,null,[[0,8]])}));return function(){return c.apply(this,arguments)}}(),Z=function(){var c=(0,E.Z)(f().mark(function a(u){var n;return f().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(u!=null){r.next=2;break}return r.abrupt("return",void 0);case 2:if(!(s.length>1)){r.next=5;break}return y.default.error("Currently have multiple projects stored, use turnTo instead"),r.abrupt("return");case 5:return r.next=7,j.get(u);case 7:return n=r.sent,m([n]),p(0),r.abrupt("return",n);case 11:case"end":return r.stop()}},a)}));return function(u){return c.apply(this,arguments)}}(),k=function(){var c=(0,E.Z)(f().mark(function a(u){return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove project",u),typeof u!="number"){e.next=6;break}return e.next=4,j.remove(u);case 4:e.next=8;break;case 6:return e.next=8,j.remove(u.projectId);case 8:I();case 9:case"end":return e.stop()}},a)}));return function(u){return c.apply(this,arguments)}}(),T=function(){var c=(0,E.Z)(f().mark(function a(u){var n;return f().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,j.create(u);case 3:return n=r.sent,console.log(n),r.abrupt("return",n);case 8:return r.prev=8,r.t0=r.catch(0),console.log("project create err",r.t0),r.abrupt("return",D.Z.parseError(r.t0,y.default));case 12:case"end":return r.stop()}},a,null,[[0,8]])}));return function(u){return c.apply(this,arguments)}}(),v=function(){var c=(0,E.Z)(f().mark(function a(u,n){return f().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:j.update(u,n).then(function(_){console.log("project update res",_)}).catch(function(_){console.log("project update err ",_),D.Z.parseError(_,y.default)});case 1:case"end":return r.stop()}},a)}));return function(u,n){return c.apply(this,arguments)}}();return{all:s,getAll:I,getCurr:Z,remove:k,create:T,update:v,get curr(){if(i!=null)return s[i]}}},re=function(o,h){var g=h.oneHot,s=g===void 0?!0:g,m=h.postSetCurr,M=o(),P=(0,L.Z)(M,2),i=P[0],p=P[1],I=o(),Z=(0,L.Z)(I,2),k=Z[0],T=Z[1],v=o(s),c=(0,L.Z)(v,2),a=c[0],u=c[1],n=function(){var b=(0,E.Z)(f().mark(function t(A){var O,d,w,B;return f().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.prev=0,U.next=3,j.getLabels(A);case 3:O=U.sent,d=(0,F.Z)(O);try{for(d.s();!(w=d.n()).done;)B=w.value,B.active=!1}catch(le){d.e(le)}finally{d.f()}return p(O),U.abrupt("return",O);case 10:return U.prev=10,U.t0=U.catch(0),console.log("label getall err ",U.t0),U.abrupt("return",D.Z.parseError(U.t0,y.default));case 14:case"end":return U.stop()}},t,null,[[0,10]])}));return function(A){return b.apply(this,arguments)}}(),e=function(t){var A=V(t,i,"labelId");if(A==null)throw Error("undefined label idx");if(T(A),a){var O=(0,F.Z)(i),d;try{for(O.s();!(d=O.n()).done;){var w=d.value;w.active=!1}}catch(B){O.e(B)}finally{O.f()}i[A].active=!0,console.log("all",i)}else i[A].active=!i[A].active;m&&m(i[A]),p((0,H.Z)(i))},r=function(){var b=(0,E.Z)(f().mark(function t(A){var O;return f().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.prev=0,w.next=3,J.create(A);case 3:return O=w.sent,O.active=!1,p([].concat((0,H.Z)(i),[O])),w.abrupt("return",O);case 9:return w.prev=9,w.t0=w.catch(0),console.log("label create err",w.t0),w.abrupt("return",D.Z.parseError(w.t0,y.default));case 13:case"end":return w.stop()}},t,null,[[0,9]])}));return function(A){return b.apply(this,arguments)}}(),_=function(){var b=(0,E.Z)(f().mark(function t(A){return f().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return console.log("remove label",A),d.prev=1,d.next=4,J.remove(A.labelId);case 4:p(i.filter(function(w){return w.labelId!=A.labelId})),d.next=11;break;case 7:d.prev=7,d.t0=d.catch(1),console.log("label remove err",d.t0),D.Z.parseError(d.t0,y.default);case 11:case"end":return d.stop()}},t,null,[[1,7]])}));return function(A){return b.apply(this,arguments)}}(),l=function(){},C=function(){u(!a)};return{all:i,getAll:n,setAll:p,setCurr:e,create:r,remove:_,onModify:l,toggleOneHot:C,get curr(){if(k!=null)return i[k]}}},ae=function(o){var h=o(),g=(0,L.Z)(h,2),s=g[0],m=g[1],M=o(),P=(0,L.Z)(M,2),i=P[0],p=P[1],I=o(),Z=(0,L.Z)(I,2),k=Z[0],T=Z[1],v=function(r){if(r<0){y.default.error("This is the first image. No previous image.");return}if(r==s.length){y.default.error("This is the final image. No next image.");return}console.log("turning to",r),p(r)},c=function(){var e=(0,E.Z)(f().mark(function r(_,l){var C;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.getTasks(_);case 3:if(C=t.sent,m(C),l==null){t.next=9;break}return console.log("getall turnto"),v(l),t.abrupt("return",[C,C[l]]);case 9:return t.abrupt("return",C);case 12:return t.prev=12,t.t0=t.catch(0),console.log("task getall err ",t.t0),t.abrupt("return",D.Z.parseError(t.t0,y.default));case 16:case"end":return t.stop()}},r,null,[[0,12]])}));return function(_,l){return e.apply(this,arguments)}}(),a=function(){var e=(0,E.Z)(f().mark(function r(_){var l,C;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.getProgress(_);case 3:if(l=t.sent,!(!l||l.finished==null||l.total==null)){t.next=6;break}throw Error("empty progress");case 6:return C=Math.ceil(l.finished/l.total*100),T(C),t.abrupt("return",C);case 11:return t.prev=11,t.t0=t.catch(0),console.log("get progress err",t.t0),D.Z.parseError(t.t0,y.default),t.abrupt("return",0);case 16:case"end":return t.stop()}},r,null,[[0,11]])}));return function(_){return e.apply(this,arguments)}}(),u=function(){var e=(0,E.Z)(f().mark(function r(){return f().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:v(i+1),console.log("all tasks",s);case 2:case"end":return l.stop()}},r)}));return function(){return e.apply(this,arguments)}}(),n=function(){var e=(0,E.Z)(f().mark(function r(){return f().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:v(i-1);case 1:case"end":return l.stop()}},r)}));return function(){return e.apply(this,arguments)}}();return{currIdx:i,all:s,turnTo:v,getAll:c,getProgress:a,progress:k,nextTask:u,prevTask:n,get curr(){if(!(i==null||s==null))return console.log("task.curr",s[i]),s[i]},get finished(){return Math.floor((s==null?void 0:s.length)*k/100)}}},ne=function(o){var h=o(),g=(0,L.Z)(h,2),s=g[0],m=g[1],M=o(),P=(0,L.Z)(M,2),i=P[0],p=P[1],I=function(){var v=(0,E.Z)(f().mark(function c(a){var u,n,e,r;return f().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,q.getAnnotations(a);case 3:u=l.sent,n=(0,F.Z)(u);try{for(n.s();!(e=n.n()).done;)r=e.value,r.active=!1}catch(C){n.e(C)}finally{n.f()}return m(u),l.abrupt("return",u);case 10:return l.prev=10,l.t0=l.catch(0),console.log("ann getAll err",l.t0),l.abrupt("return",D.Z.parseError(l.t0,y.default));case 14:case"end":return l.stop()}},c,null,[[0,10]])}));return function(a){return v.apply(this,arguments)}}(),Z=function(){var v=(0,E.Z)(f().mark(function c(a){var u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create",a),e.prev=1,e.next=4,G.create(a);case 4:return u=e.sent,a.dataId&&I(a.dataId),e.abrupt("return",u);case 9:return e.prev=9,e.t0=e.catch(1),console.log("annotation create err",e.t0),e.abrupt("return",D.Z.parseError(e.t0,y.default));case 13:case"end":return e.stop()}},c,null,[[1,9]])}));return function(a){return v.apply(this,arguments)}}(),k=function(){var v=(0,E.Z)(f().mark(function c(a){var u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("typeof",typeof a),u=typeof a!="number"?a.annotationId:a,e.prev=2,!u){e.next=6;break}return e.next=6,G.remove(u);case 6:m(s.filter(function(r){return r.annotationId!=u})),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(2),console.log("annotation remove err",e.t0),e.abrupt("return",D.Z.parseError(e.t0,y.default));case 13:case"end":return e.stop()}},c,null,[[2,9]])}));return function(a){return v.apply(this,arguments)}}(),T=function(){var v=(0,E.Z)(f().mark(function c(a,u){var n,e,r,_,l;return f().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(a!=null){b.next=3;break}return p(void 0),b.abrupt("return");case 3:n=(0,F.Z)(s);try{for(n.s();!(e=n.n()).done;)r=e.value,r.active=!1}catch(t){n.e(t)}finally{n.f()}_=s.filter(function(t){return t.annotationId==a.annotationId})[0],_.active=!a.active,l=V(_,s,"annotationId"),p(l),m((0,H.Z)(s)),console.log("ann on select label",u),u.setCurr(a.labelId);case 12:case"end":return b.stop()}},c)}));return function(a,u){return v.apply(this,arguments)}}();return{all:s,getAll:I,create:Z,remove:k,setCurr:T,get curr(){if(!(!s||!i))return s[i]}}},te=function(o){var h=o(),g=(0,L.Z)(h,2),s=g[0],m=g[1],M=o([]),P=(0,L.Z)(M,2),i=P[0],p=P[1],I=function(){var k=(0,E.Z)(f().mark(function T(v){return f().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:m(v);case 1:case"end":return a.stop()}},T)}));return function(v){return k.apply(this,arguments)}}(),Z=function(){var k=(0,E.Z)(f().mark(function T(v,c){var a;return f().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Y.getDatas(v);case 3:if(a=n.sent,p(a),c==null){n.next=8;break}return I(c),n.abrupt("return",[a,a[c]]);case 8:return n.abrupt("return",a);case 11:return n.prev=11,n.t0=n.catch(0),console.log("data getall err ",n.t0),n.abrupt("return",D.Z.parseError(n.t0,y.default));case 15:case"end":return n.stop()}},T,null,[[0,11]])}));return function(v,c){return k.apply(this,arguments)}}();return{all:i,getAll:Z,turnTo:I,get curr(){if(!(s==null||i==null))return i[s]},get imgSrc(){return i&&i[s]?(console.log("imgsrc","".concat(W,"/datas/").concat(i[s].dataId,"/image?sault=").concat(i[s].sault)),"".concat(W,"/datas/").concat(i[s].dataId,"/image?sault=").concat(i[s].sault)):""}}},ue=function(o,h,g){g.effectTrigger||(g.effectTrigger={});var s=o(!1),m=(0,L.Z)(s,2),M=m[0],P=m[1],i=ee(o),p=ae(o),I=te(o),Z=z(o),k=re(o,g.label),T=ne(o);return h(function(){var v=D.Z.getQueryVariable("projectId");if(v==null){N.m8.push("/");return}var c=parseInt(v);Z.getCurr(v).catch(function(a){D.Z.parseError(a,y.default),N.m8.push("/")}),k.getAll(c),p.getAll(c),p.getProgress(c)},[]),h(function(){p.all&&p.all.length!=0&&p.turnTo(0)},[p.all]),h(function(){if(p.currIdx!=null){var v=function(){var c=(0,E.Z)(f().mark(function a(){var u,n,e,r,_,l,C,b,t,A;return f().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(console.log("onTaskChange",p.curr,k.all,p.progress),(u=p.curr)!==null&&u!==void 0&&u.projectId&&p.getProgress(p.curr.projectId),!((n=p.curr)!==null&&n!==void 0&&n.taskId)){d.next=15;break}return d.next=5,I.getAll(p.curr.taskId,0);case 5:return e=d.sent,r=(0,L.Z)(e,2),_=r[0],l=r[1],console.log(_),d.next=12,T.getAll(l.dataId);case 12:if(C=d.sent,k.all){b=(0,F.Z)(k.all);try{for(b.s();!(t=b.n()).done;)A=t.value,A.active=!1}catch(w){b.e(w)}finally{b.f()}}g.effectTrigger.postTaskChange&&g.effectTrigger.postTaskChange(k.all,C);case 15:P(!1);case 16:case"end":return d.stop()}},a)}));return function(){return c.apply(this,arguments)}}();v()}},[p.currIdx]),[M,P,i,T,p,I,Z,k]}}}]);
