(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[159],{13237:function(X){X.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},85024:function(X){X.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(X){X.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},26647:function(X){X.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___1FTWb",toolBarButtonContainer:"toolBarButtonContainer___1Vahn",toolBarButton:"toolBarButton___3mR2H",buttonText:"buttonText___Y0WDm",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3lRZ8",popover:"popover___3zzu2",slider:"slider___ALra-",popoverLeft:"popoverLeft___15lGe"}},8978:function(X,Q,e){"use strict";e.d(Q,{Z:function(){return se}});var K=e(11849),G=e(2824),H=e(91220),Y=e(67294),x=e(85893);function E(n){if(!n||!n.width||!n.color||!n.points||n.points.length<2||n.frontendId==null)return"";var P=n.type=="rubber"?0:n.frontendId;return"".concat(n.width,",").concat(P,",").concat(n.points.join(","))}function s(n){var P,o=n.canvasRef,m=n.annotation,g=m.result;if(!g)return(0,x.jsx)(x.Fragment,{});var p=(P=o.current)===null||P===void 0?void 0:P.getContext("2d");if(!p)return(0,x.jsx)(x.Fragment,{});for(var D=[],t=0,h=0;h<g.length;h++)g.at(h)==","?(D.push(parseFloat(g.slice(t,h))),t=h+1):g.at(h)=="|"?(D.push(parseFloat(g.slice(t,h))),a(D,p,m),D=[],t=h+1):h==g.length-1&&(D.push(parseFloat(g.slice(t,g.length))),a(D,p,m));return(0,x.jsx)(x.Fragment,{})}function a(n,P,o){var m;if(n.length<4){console.log("found incorrect points:",n);return}var g=n[0],p=n[1];if(g==0){var D;S(P,n.slice(2),(D=o.label)===null||D===void 0?void 0:D.color);return}if(p==0){c(P,g,n.slice(2),void 0);return}c(P,g,n.slice(2),(m=o.label)===null||m===void 0?void 0:m.color)}function c(n,P,o,m){n.beginPath(),n.moveTo(o[0],o[1]);for(var g=0;g<=o.length/2-1;g++){var p=o[2*g],D=o[2*g+1];n.lineTo(p,D)}n.lineCap="round",n.lineJoin="round",n.lineWidth=P,m&&(n.strokeStyle=m),n.globalCompositeOperation=m?"source-over":"destination-out",n.stroke()}function S(n,P,o){n.globalCompositeOperation=o?"source-over":"destination-out",o&&(n.fillStyle=o);for(var m=0;m<=P.length/2-1;m++){var g=P[2*m],p=P[2*m+1];n.fillRect(g,p,1,1)}}function j(n){if(!n||n.length==0)return 0;var P=0,o=(0,H.Z)(n),m;try{for(o.s();!(m=o.n()).done;){var g=m.value;g.frontendId>P&&(P=g.frontendId)}}catch(p){o.e(p)}finally{o.f()}return P}function ie(n,P){return n=="rubber"||P==2?"rubber":"brush"}function se(n){var P=(0,Y.useState)(),o=(0,G.Z)(P,2),m=o[0],g=o[1],p=function(I){var b,w;if(!(n.currentTool!="brush"&&n.currentTool!="rubber"||!((b=n.currentLabel)!==null&&b!==void 0&&b.color)||!n.brushSize)){var re=I.mouseX,U=I.mouseY,q=ie(n.currentTool,I.e.evt.button);console.log("frontendId: ",n.frontendIdOps.frontendId,"maxId:",j(n.annotations));var k=n.frontendIdOps.frontendId>0?n.frontendIdOps.frontendId:j(n.annotations)+1;k!=n.frontendIdOps.frontendId&&n.frontendIdOps.setFrontendId(k);var oe=E({width:n.brushSize||10,color:(w=n.currentLabel)===null||w===void 0?void 0:w.color,points:[re,U,re,U],type:q,frontendId:k});if(!!oe){g(q);var R={dataId:n.dataId,label:n.currentLabel,labelId:n.currentLabel.labelId,frontendId:k,result:oe,type:"brush"};n.onAnnotationAdd(R)}}},D=function(I){var b;if(!(!m||!n.currentAnnotation||!n.currentAnnotation.result||n.currentAnnotation.result.length<2||!((b=n.currentLabel)!==null&&b!==void 0&&b.color))){var w=I.mouseX,re=I.mouseY,U=n.currentAnnotation.result+",".concat(w,",").concat(re);n.onAnnotationModify((0,K.Z)((0,K.Z)({},n.currentAnnotation),{},{result:U}))}},t=function(){n.currentTool!="brush"&&n.currentTool!="rubber"||(g(void 0),n.onMouseUp())};return{onMouseDown:p,onMouseMove:D,onMouseUp:t,drawAnnotation:s}}},57406:function(X,Q,e){"use strict";e.d(Q,{pL:function(){return G},oo:function(){return H}});var K=e(91220);function G(E){var s=0;if(!E)return s;var a=(0,K.Z)(E),c;try{for(a.s();!(c=a.n()).done;){var S=c.value;!S||!S.frontendId||S.frontendId>s&&(s=S.frontendId)}}catch(j){a.e(j)}finally{a.f()}return s}function H(E){var s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(E);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:null}function Y(E){var s=E.toString(16);return s.length==1?"0"+s:s}function x(E,s,a){return"#"+Y(E)+Y(s)+Y(a)}},14836:function(X,Q,e){"use strict";e.d(Q,{Z:function(){return t}});var K=e(54421),G=e(38272),H=e(57663),Y=e(71577),x=e(91220),E=e(67294),s=e(56159),a=e.n(s),c=e(49111),S=e(19650),j=e(2824),ie=e(11849),se=e(85024),n=e.n(se),P=e(63097),o=e(85893),m=function(I){var b=(0,ie.Z)({},I.annotation),w=(0,E.useState)(b.invisible),re=(0,j.Z)(w,2),U=re[0],q=re[1],k=(0,E.useState)(0),oe=(0,j.Z)(k,2),R=oe[0],ae=oe[1];(0,E.useEffect)(function(){q(I.annotation.invisible)},[I.annotation.invisible]);var ee=(0,o.jsxs)(G.ZP.Item,{className:"".concat(n().listItem," ").concat(I.active?n().listItemActive:""),unselectable:"on",onClick:function(){I.onClick(b)},children:[(0,o.jsxs)(S.Z,{align:"center",size:5,children:[(0,o.jsx)("a",{className:n().eye,style:{backgroundImage:U?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(ve){ve.stopPropagation(),q(!U),I.onAnnotationModify(b)}})," ",(0,o.jsx)("span",{className:n().annotationId,children:b.frontendId}),(0,o.jsx)("span",{className:n().labelName,children:b.label.name}),(0,o.jsx)(P.Z,{color:b.label.color})]}),(0,o.jsx)("a",{className:n().delete,onClick:function(ve){ve.stopPropagation();var ce=new Date().getTime();ce-R<300||(ae(ce),I.onAnnotationDelete(b))}})]});return ee},g=m,p=e(48971),D=function(I){var b=(0,p.YB)(),w=b.formatMessage({id:"component.PPAnnotationList.annotationList"}),re=b.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),U=new Set,q=[],k=(0,x.Z)(I.annotations),oe;try{for(k.s();!(oe=k.n()).done;){var R=oe.value;U.has(R.frontendId)||(q.push(R),U.add(R.frontendId))}}catch(ae){k.e(ae)}finally{k.f()}return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(G.ZP,{className:a().labelList,size:"large",header:(0,o.jsx)("div",{className:a().listHeader,children:w}),bordered:!0,dataSource:q,renderItem:function(ee){var ne;return(0,o.jsx)(g,{onClick:I.onAnnotationSelect,annotation:ee,active:ee.frontendId==((ne=I.currAnnotation)===null||ne===void 0?void 0:ne.frontendId),onAnnotationDelete:I.onAnnotationDelete,onAnnotationModify:I.onAnnotationModify})},footer:function(){return I.onAnnotationAdd?(0,o.jsx)("div",{children:(0,o.jsx)(Y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){I.onAnnotationAdd()},block:!0,children:re})}):(0,o.jsx)("div",{})}})})},t=D},27992:function(X,Q,e){"use strict";var K=e(20136),G=e(55241),H=e(13062),Y=e(71230),x=e(77883),E=e(70507),s=e(89032),a=e(15746),c=e(66126),S=e(75454),j=e(2824),ie=e(67294),se=e(61541),n=e(26647),P=e.n(n),o=e(85893),m=0,g=100,p=10,D=function(h){var I=(0,ie.useState)(oe(h.size)),b=(0,j.Z)(I,2),w=b[0],re=b[1];function U(R){re(oe(R))}var q=h.minSize==null?m:h.minSize,k=h.maxSize==null?g:h.maxSize;function oe(R){return R==null?p:R<=q?q:R>=k?k:R}return(0,ie.useEffect)(function(){U(h.size)},[h.size]),(0,o.jsxs)(G.Z,{overlayClassName:"".concat(P().popover," ").concat(h.disLoc=="left"?P().popoverLeft:""),placement:h.disLoc||"right",content:(0,o.jsxs)(Y.Z,{children:[(0,o.jsx)(a.Z,{span:16,children:(0,o.jsx)(S.Z,{className:P().slider,value:w,max:k,min:q,onChange:function(ae){var ee;(ee=h.onChange)===null||ee===void 0||ee.call(0,ae)},tooltipVisible:!1})}),(0,o.jsx)(a.Z,{span:8,children:(0,o.jsx)(E.Z,{min:q,max:k,value:w,onChange:function(ae){var ee;(ee=h.onChange)===null||ee===void 0||ee.call(0,ae)},step:10})})]}),trigger:"hover",children:[" ",(0,o.jsx)(se.Z,{imgSrc:h.imgSrc||"",onClick:h.onClick,active:h.active,children:h.children})]})};Q.Z=D},10137:function(X,Q,e){"use strict";var K=e(34669),G=e(54458),H=e(67294),Y=e(85893),x=function(s){var a,c;return(0,Y.jsxs)("div",{className:"progress",children:[(0,Y.jsx)(G.Z,{className:"progressBar",percent:Math.ceil(s.project.finished/((a=s.task.all)===null||a===void 0?void 0:a.length)*100),status:"active",showInfo:!1})," ",(0,Y.jsxs)("span",{className:"progressDesc",children:["Current labeling ",s.task.currIdx==null?1:s.task.currIdx+1," of"," ",(c=s.task.all)===null||c===void 0?void 0:c.length,". Already labeled ",s.project.finished||0,"."]})]})};Q.Z=x},91861:function(X,Q,e){"use strict";e.d(Q,{Ad:function(){return Y},k3:function(){return x},Vd:function(){return E},td:function(){return s}});var K=e(34792),G=e(48086),H=40;function Y(){localStorage.removeItem("history"),x([])}function x(a){var c=localStorage.getItem("history"),S=c?JSON.parse(c):{index:-1,items:[]};if(JSON.stringify(S.items[S.index])!=JSON.stringify(a)){var j=S.index>H?S.index-H:0,ie=S.items.splice(j,S.index==0?1:S.index+1);S.items=ie.concat([a]),S.index<=H?S.index++:S.index=H+1,localStorage.setItem("history",JSON.stringify(S))}}function E(){var a=localStorage.getItem("history");if(!!a){var c=JSON.parse(a);if(!!c){if(c.index>=c.items.length-1){G.default.error("No next history!");return}return c.index++,localStorage.setItem("history",JSON.stringify(c)),c.items[c.index]}}}function s(){var a=localStorage.getItem("history");if(!!a){var c=JSON.parse(a);if(console.log("history",c),!c||!c.index||c.index<=1){G.default.error("No previous history!");return}return c.index--,localStorage.setItem("history",JSON.stringify(c)),c.items[c.index]}}},91159:function(X,Q,e){"use strict";e.r(Q),e.d(Q,{MOST_HISTORY_STEPS:function(){return Te},default:function(){return De}});var K=e(11849),G=e(57663),H=e(71577),Y=e(34792),x=e(48086),E=e(91220),s=e(2824),a=e(67294),c=e(48971),S=e(8088),j=e(61541),ie=e(44434),se=e(27992),n=e(5041),P=e(57436),o=e(14836),m=e(91861),g=e(8978),p=e(65031),D=e(57406),t=e(85893);function h(l,M){if(!(!l||!M))return M.join(",")}function I(l){var M,C=l.annotation;if(!C||!C.result||C.result.length<2||!((M=C.label)!==null&&M!==void 0&&M.color))return(0,t.jsx)(t.Fragment,{});var _=C.result.split(",").map(Number),i=C.label.color,y=(0,D.oo)(i);if(!y)return(0,t.jsx)(t.Fragment,{});var z=.3,N=void 0,T=[];return _.forEach(function(W,f){if(!N){N=W;return}T.push((0,t.jsx)(p.Cd,{onMouseDown:function(){l.currentTool=="editor"&&l.onSelect(C)},draggable:l.currentTool=="editor",onDragMove:function(Z){var u;Z.cancelBubble=!0;var A=(u=l.stageRef)===null||u===void 0?void 0:u.current,O=A.findOne(".baseImage"),le=!1,B=Z.target.x();B>O.width()/2&&(B=O.width()/2,le=!0),B<-O.width()/2&&(B=-O.width()/2,le=!0);var L=Z.target.y();L>O.height()/2&&(L=O.height()/2,le=!0),L<-O.height()/2&&(L=-O.height()/2,le=!0),le&&Z.target.setPosition({x:B,y:L}),_[f-1]=B,_[f]=L;var F=(0,K.Z)((0,K.Z)({},C),{},{result:_.join(",")});l.onDrag(F)},onMouseOver:function(){var Z;l.currentTool=="editor"&&(Z=l.stageRef)!==null&&Z!==void 0&&Z.current&&(l.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var Z;(Z=l.stageRef)!==null&&Z!==void 0&&Z.current&&(l.stageRef.current.container().style.cursor="default")},x:N,y:W,radius:5/l.scale,fill:i})),N=void 0}),(0,t.jsxs)(p.ZA,{children:[(0,t.jsx)(p.x1,{onMouseOver:function(){l.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){l.currentTool=="editor"&&l.onSelect(C)},stroke:i,strokeWidth:2/l.scale,globalCompositeOperation:"source-over",lineCap:"round",points:_,tension:0,closed:!0,fill:"rgba(".concat(y.r,", ").concat(y.g,", ").concat(y.b,", ").concat(z,")")}),T]},C.frontendId)}function b(l){var M=0;if(!l)return M;var C=(0,E.Z)(l),_;try{for(C.s();!(_=C.n()).done;){var i=_.value;!i||!i.frontendId||i.frontendId>M&&(M=i.frontendId)}}catch(y){C.e(y)}finally{C.f()}return M}function w(l){var M=function(z,N){var T,W,f=h((T=l.currentLabel)===null||T===void 0?void 0:T.color,[z,N]);!f||(console.log(f),l.onAnnotationAdd({dataId:l.dataId,type:"polygon",frontendId:b(l.annotations)+1,label:l.currentLabel,labelId:(W=l.currentLabel)===null||W===void 0?void 0:W.labelId,result:f}))},C=function(z,N){var T;if(!(!l.currentAnnotation||!l.currentAnnotation.result||!((T=l.currentLabel)!==null&&T!==void 0&&T.color))){var W=l.currentAnnotation.result+",".concat(z,",").concat(N),f=(0,K.Z)((0,K.Z)({},l.currentAnnotation),{},{result:W});l.modifyAnnoByFrontendId(f)}},_=function(z){if(l.currentTool=="polygon"){var N=z.mouseX+z.offsetX,T=z.mouseY+z.offsetY;console.log("currentAnnotation:",l.currentAnnotation),l.currentAnnotation?C(N,T):M(N,T)}},i=function(){l.currentTool=="polygon"&&l.onMouseUp&&l.onMouseUp()};return{onMouseDown:_,onMouseMove:function(){},onMouseUp:i,drawAnnotation:I}}var re=e(10137),U=e(45194),q=e(71194),k=e(50146),oe=e(47673),R=e(24044),ae=e(3182),ee=e(9715),ne=e(93766),ve=e(43358),ce=e(34041),Be=e(94043),me=e.n(Be),Ce=e(37071),xe=function(M){var C,_=(0,c.YB)(),i=(0,U.Gd)(a.useState),y=Ce.Z.getQueryVariable("projectId"),z=(0,U.RZ)(a.useState),N=ce.Z.Option,T=ne.Z.useForm(),W=(0,s.Z)(T,1),f=W[0];(0,a.useEffect)(function(){function u(){return A.apply(this,arguments)}function A(){return A=(0,ae.Z)(me().mark(function O(){var le,B,L;return me().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,(0,U.bo)();case 2:if(J.sent){J.next=4;break}return J.abrupt("return");case 4:if(i.getAll(),y){J.next=8;break}return x.default.error("Machine Learning settings are specific to every project. Please choose a project first."),J.abrupt("return");case 8:return J.next=10,i.getCurr(y);case 10:L=J.sent,L!=null&&(le=L.otherSettings)!==null&&le!==void 0&&le.mlBackendUrl&&z.setMlBackendUrl(L==null||(B=L.otherSettings)===null||B===void 0?void 0:B.mlBackendUrl);case 12:case"end":return J.stop()}},O)})),A.apply(this,arguments)}u()},[]),(0,a.useEffect)(function(){if(!!i.curr){var u=i.curr.otherSettings?i.curr.otherSettings:{},A=u.models&&u.perviousModel?u.models[u.perviousModel]:{},O={mlBackendUrl:u.mlBackendUrl,modelName:u.perviousModel,trainBatchSize:A.trainBatchSize};f.setFieldsValue(O),u!=null&&u.mlBackendUrl&&z.setMlBackendUrl(u.mlBackendUrl)}},[i.curr]);function te(){if(!i.curr){x.default.error("Please choose a project first!");return}var u=f.getFieldValue("mlBackendUrl");z.setMlBackendUrl(u);var A=(0,K.Z)((0,K.Z)({},i.curr.otherSettings),{},{mlBackendUrl:u});i.update(i.curr.projectId,{otherSettings:A})}function Z(u){if(console.log("saveMlsettings",i.curr,u),!i.curr){x.default.error("Please select model first!");return}i.curr.otherSettings||(i.curr.otherSettings={});var A=i.curr.otherSettings.models?i.curr.otherSettings.models:{};A[u.modelName]=u,i.curr.otherSettings.mlBackendUrl=f.getFieldValue("mlBackendUrl"),i.curr.otherSettings.perviousModel=u.modelName,i.curr.otherSettings.models=A,i.update(i.curr.projectId,{otherSettings:i.curr.otherSettings}),x.default.info("Ml setting saved. Let's start trainig or inference!")}return(0,t.jsx)(k.Z,{title:_.formatMessage({id:"pages.toolBar.interactor"}),visible:M.visible,onCancel:M.onCancel,footer:null,children:(0,t.jsxs)(ne.Z,{form:f,layout:"horizontal",size:"large",onFinish:function(A){console.log("form finish",A),Z(A)},hidden:i.curr==null,children:[(0,t.jsxs)(R.Z.Group,{compact:!0,children:[(0,t.jsx)(ne.Z.Item,{name:"mlBackendUrl",rules:[{required:!0,message:"Please input ml backend url"}],style:{fontSize:"1.5rem"},children:(0,t.jsx)(R.Z,{allowClear:!0,addonBefore:"ML Backend URL ",style:{textAlign:"left"}})}),(0,t.jsx)(H.Z,{type:"primary",onClick:te,children:"Set"})]}),(0,t.jsx)(ne.Z.Item,{name:"modelName",label:"Model",labelCol:{span:6},wrapperCol:{span:16},rules:[{required:!0,message:"Please select a model"}],style:{fontSize:"1.5rem"},children:(0,t.jsx)(ce.Z,{placeholder:"Select a model",children:(C=z.all)===null||C===void 0?void 0:C.map(function(u){return(0,t.jsx)(N,{value:u.name,children:u.name},u.name)})})}),(0,t.jsx)(ne.Z.Item,{name:"trainBatchSize",label:"Training Batch Size",labelCol:{span:6},wrapperCol:{span:16},style:{fontSize:"1.5rem"},children:(0,t.jsx)(R.Z,{placeholder:"Training batch size"})}),(0,t.jsxs)(ne.Z.Item,{wrapperCol:{span:16,offset:6},children:[(0,t.jsx)(H.Z,{onClick:function(){var A;(A=M.onCancel)===null||A===void 0||A.call(0),f.resetFields()},children:_.formatMessage({id:"component.PPCreater.cancel"})}),(0,t.jsx)(H.Z,{htmlType:"submit",type:"primary",style:{height:"2.5rem",width:"48%"},block:!0,children:"Save"})]})]})})},je=xe,We=e(20136),be=e(55241),$e=e(13062),_e=e(71230),Ke=e(89032),Oe=e(15746),Ee=e(13237),Ie=e.n(Ee),Le=function(M){var C,_=(0,U.Gd)(a.useState),i=Ce.Z.getQueryVariable("projectId"),y=(0,U.RZ)(a.useState),z=ce.Z.Option,N=ne.Z.useForm(),T=(0,s.Z)(N,1),W=T[0];return(0,a.useEffect)(function(){function f(){return te.apply(this,arguments)}function te(){return te=(0,ae.Z)(me().mark(function Z(){var u,A,O;return me().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,U.bo)();case 2:if(B.sent){B.next=4;break}return B.abrupt("return");case 4:if(_.getAll(),i){B.next=8;break}return x.default.error("Machine Learning settings are specific to every project. Please choose a project first."),B.abrupt("return");case 8:return B.next=10,_.getCurr(i);case 10:O=B.sent,O!=null&&(u=O.otherSettings)!==null&&u!==void 0&&u.mlBackendUrl&&y.setMlBackendUrl(O==null||(A=O.otherSettings)===null||A===void 0?void 0:A.mlBackendUrl);case 12:case"end":return B.stop()}},Z)})),te.apply(this,arguments)}f()},[]),(0,a.useEffect)(function(){if(!!_.curr){var f=_.curr.otherSettings?_.curr.otherSettings:{},te=f.models&&f.perviousModel?f.models[f.perviousModel]:{},Z={mlBackendUrl:f.mlBackendUrl,modelName:f.perviousModel,trainBatchSize:te.trainBatchSize};W.setFieldsValue(Z),f!=null&&f.mlBackendUrl&&y.setMlBackendUrl(f.mlBackendUrl)}},[_.curr]),(0,t.jsxs)(be.Z,{overlayClassName:"".concat(Ie().popover," ").concat(Ie().popoverLeft),placement:"left",content:(0,t.jsx)(_e.Z,{children:(0,t.jsx)(Oe.Z,{span:24,children:(0,t.jsx)(ce.Z,{placeholder:"Select a model",style:{padding:"0 4px",width:"100%"},children:(C=y.all)===null||C===void 0?void 0:C.map(function(f){return(0,t.jsx)(z,{value:f.name,children:f.name},f.name)})})})}),trigger:"hover",children:[" ",(0,t.jsx)(j.Z,{imgSrc:M.imgSrc||"",onClick:M.onClick,active:M.active,children:M.children})]})},pe=Le,Te=40,Ze=function(){var M,C=(0,a.useState)(0),_=(0,s.Z)(C,2),i=_[0],y=_[1],z=(0,a.useState)(10),N=(0,s.Z)(z,2),T=N[0],W=N[1],f=(0,a.useState)(60),te=(0,s.Z)(f,2),Z=te[0],u=te[1],A=(0,a.useState)(!1),O=(0,s.Z)(A,2),le=O[0],B=O[1],L=(0,U.$L)(a.useState,a.useEffect,{effectTrigger:{postTaskChange:function(){return(0,m.Ad)()}},label:{oneHot:!0,postSelect:function(){v.setCurr(void 0),y(0)},preUnsetCurr:Ue},tool:{defaultTool:"mover"},task:{push:!0}}),F=L.tool,J=L.task,fe=L.data,Pe=L.project,ge=L.scale,de=L.label,v=L.annotation;function Ue(){v.setCurr(void 0),y(0),F.setCurr("mover")}var $=function(r){v.setCurr(r),r!=null&&r.frontendId?y(r.frontendId):y(0)};(0,a.useEffect)(function(){(0,m.Ad)()},[]),(0,a.useEffect)(function(){var d=setInterval(function(){var r;console.log("triggered!",fe),v.pushToBackend((r=fe.curr)===null||r===void 0?void 0:r.dataId)},2e4);return function(){clearInterval(d)}},[v,fe,fe.curr]);var Re=function(r){!r||(v.all.pop(),v.all.push(r),$(r),v.setAll(v.all))},Me=function(r){var ue=[],he=(0,E.Z)(v.all),ye;try{for(he.s();!(ye=he.n()).done;){var Ae=ye.value;Ae.frontendId==r.frontendId?ue.push(r):ue.push(Ae)}}catch(Ne){he.e(Ne)}finally{he.f()}$(r),v.setAll(ue)},Se={dataId:(M=fe.curr)===null||M===void 0?void 0:M.dataId,currentLabel:de.curr,brushSize:T,scale:ge.curr,currentTool:F.curr,annotations:v.all,currentAnnotation:v.curr,onAnnotationAdd:function(r){var ue=v.all.concat([r]);v.setAll(ue),$(r)},onAnnotationModify:Re,modifyAnnoByFrontendId:Me,onMouseUp:function(){(0,m.k3)({annos:v.all,currAnno:v.curr})},frontendIdOps:{frontendId:i,setFrontendId:y}},V=(0,c.YB)(),Fe=(0,g.Z)(Se),ze=w(Se),ke={polygon:ze,brush:Fe};return(0,t.jsxs)(S.Z,{className:"segment",children:[(0,t.jsxs)(ie.Z,{children:[(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/polygon.png",active:F.curr=="polygon",onClick:function(){if(!de.curr){x.default.error("Please select a label first");return}F.setCurr("polygon"),$(void 0)},children:V.formatMessage({id:"pages.toolBar.polygon"})}),(0,t.jsx)(j.Z,{active:F.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){F.setCurr("editor"),$(void 0)},children:V.formatMessage({id:"pages.toolBar.edit"})}),(0,t.jsx)(se.Z,{imgSrc:"./pics/buttons/brush.png",size:T,active:F.curr=="brush",onClick:function(){if(!de.curr){x.default.error("Please select a label first");return}F.curr!="rubber"&&F.curr!="brush"&&$(void 0),F.setCurr("brush")},onChange:function(r){W(r)},children:V.formatMessage({id:"pages.toolBar.brush"})}),(0,t.jsx)(se.Z,{size:T,active:F.curr=="rubber",onClick:function(){F.curr!="rubber"&&F.curr!="brush"&&$(void 0),F.setCurr("rubber")},onChange:function(r){W(r)},imgSrc:"./pics/buttons/rubber.png",children:V.formatMessage({id:"pages.toolBar.rubber"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){ge.change(.1)},children:V.formatMessage({id:"pages.toolBar.zoomIn"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){ge.change(-.1)},children:V.formatMessage({id:"pages.toolBar.zoomOut"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var r;v.pushToBackend((r=fe.curr)===null||r===void 0?void 0:r.dataId)},children:V.formatMessage({id:"pages.toolBar.save"})}),(0,t.jsx)(j.Z,{active:F.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){F.setCurr("mover")},children:V.formatMessage({id:"pages.toolBar.move"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var r=(0,m.td)();r&&(v.setAll(r.annos),$(r.currAnno))},children:V.formatMessage({id:"pages.toolBar.unDo"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var r=(0,m.Vd)();r&&(v.setAll(r.annos),$(r.currAnno))},children:V.formatMessage({id:"pages.toolBar.reDo"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){v.setAll([]),v.setCurr(void 0)},children:V.formatMessage({id:"pages.toolBar.clearMark"})})]}),(0,t.jsxs)("div",{id:"dr",className:"mainStage",children:[(0,t.jsx)("div",{className:"draw",children:(0,t.jsx)(P.Z,{scale:ge.curr,annotations:v.all,currentTool:F.curr,currentAnnotation:v.curr,setCurrentAnnotation:$,onAnnotationModify:Me,onAnnotationModifyComplete:function(){(0,m.k3)({annos:v.all,currAnno:v.curr})},frontendIdOps:{frontendId:i,setFrontendId:y},imgSrc:fe.imgSrc,transparency:Z,onAnnotationAdd:function(r){var ue=v.all.concat([r]);v.setAll(ue),v.curr||$(r)},drawTool:ke})}),(0,t.jsx)("div",{className:"pblock",children:(0,t.jsx)(re.Z,{task:J,project:Pe})}),(0,t.jsx)("div",{className:"prevTask",onClick:function(){!J.prevTask()||$(void 0)}}),(0,t.jsx)("div",{className:"nextTask",onClick:function(){!J.nextTask()||$(void 0)}})]}),(0,t.jsxs)(ie.Z,{disLoc:"right",children:[(0,t.jsx)(pe,{imgSrc:"./pics/buttons/intelligent_interaction.png",onClick:function(){return B(!0)},children:V.formatMessage({id:"pages.toolBar.interactor"})}),(0,t.jsx)(se.Z,{imgSrc:"./pics/buttons/threshold.png",disLoc:"left",children:V.formatMessage({id:"pages.toolBar.segmentThreshold"})}),(0,t.jsx)(se.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:Z,maxSize:100,minSize:0,onChange:function(r){u(r)},children:V.formatMessage({id:"pages.toolBar.transparency"})}),(0,t.jsx)(se.Z,{imgSrc:"./pics/buttons/radius.png",disLoc:"left",children:V.formatMessage({id:"pages.toolBar.visualRadius"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){c.m8.push("/project_overview?projectId=".concat(Pe.curr.projectId))},children:"Project Overview"})]}),(0,t.jsxs)("div",{className:"rightSideBar",children:[(0,t.jsx)("div",{className:"determinOutline",children:(0,t.jsx)(H.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){$(void 0)},children:V.formatMessage({id:"pages.toolBar.determineOutline"})})}),(0,t.jsx)(n.Z,{hideColorPicker:!1,labels:de.all,activeIds:de.activeIds,onLabelSelect:de.onSelect,onLabelModify:function(){},onLabelDelete:de.remove,onLabelAdd:function(r){de.create((0,K.Z)((0,K.Z)({},r),{},{projectId:Pe.curr.projectId})).then(function(ue){$(void 0),de.setCurr(ue)})}}),(0,t.jsx)(o.Z,{currAnnotation:v.curr,annotations:v.all,onAnnotationSelect:function(r){r!=null&&r.delete||$(r)},onAnnotationAdd:function(){$(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(r){v.setAll(v.all.filter(function(ue){return ue.frontendId!=r.frontendId})),$(void 0)}})]}),(0,t.jsx)(je,{visible:le,onCancel:function(){return B(!1)}})]})},De=Ze}}]);
