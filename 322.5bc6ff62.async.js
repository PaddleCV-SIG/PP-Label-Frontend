(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(ue,V,$){"use strict";$.d(V,{gu:function(){return Y},Gd:function(){return J},$L:function(){return le}});var H=$(86582),B=$(91220),Z=$(3182),se=$(34792),k=$(48086),I=$(2824),z=$(94043),t=$.n(z),L=$(37071),R=$(81139),K=localStorage.getItem("basePath"),F=new R.VK(K?{basePath:K}:void 0),j=new R.U(F),Q=new R.sD(F),X=new R.W6(F),N=new R.Cl(F),G=new R.vb(F),Y=function(c){return JSON.parse(JSON.stringify(c))};function ie(S){return S&&(S.toLowerCase().replace(/([-_][a-z])/g,function(c){return c.toUpperCase().replace("-","").replace("_","")}),S)}var q=function(c,d,p){if(!!p){for(var i=0;i<d.length;i++)if(c[p]==d[i][p])return i}},x=function(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,3],p=c(1),i=(0,I.Z)(p,2),y=i[0],D=i[1],E=function(h){var a=y;a+=h,a<d[0]&&(a=d[0],k.default.error("Smallest scale is "+d[0])),a>d[1]&&(a=d[1],k.default.error("Largest scale is "+d[1])),D(a)};return{curr:y,change:E}},J=function(c){var d=c([]),p=(0,I.Z)(d,2),i=p[0],y=p[1],D=c(),E=(0,I.Z)(D,2),u=E[0],h=E[1],a=function(){var w=(0,Z.Z)(t().mark(function o(){var f;return t().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,j.getAll();case 3:return f=l.sent,y(f),l.abrupt("return",f);case 8:l.prev=8,l.t0=l.catch(0),console.log("project getAll err",l.t0),L.Z.parseError(l.t0,k.default);case 12:case"end":return l.stop()}},o,null,[[0,8]])}));return function(){return w.apply(this,arguments)}}(),_=function(){var w=(0,Z.Z)(t().mark(function o(f){var s;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f!=null){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(i.length>1)){e.next=5;break}return k.default.error("Currently have multiple projects stored, use turnTo instead"),e.abrupt("return");case 5:return e.prev=5,e.next=8,j.get(f);case 8:return s=e.sent,y([s]),h(0),e.abrupt("return",s);case 14:e.prev=14,e.t0=e.catch(5),console.log("prject getcurr err",e.t0),L.Z.parseError(e.t0,k.default);case 18:case"end":return e.stop()}},o,null,[[5,14]])}));return function(f){return w.apply(this,arguments)}}(),b=function(){var w=(0,Z.Z)(t().mark(function o(f){return t().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(console.log("remove project",f),typeof f!="number"){l.next=6;break}return l.next=4,j.remove(f);case 4:l.next=8;break;case 6:return l.next=8,j.remove(f.projectId);case 8:a();case 9:case"end":return l.stop()}},o)}));return function(f){return w.apply(this,arguments)}}(),m=function(){var w=(0,Z.Z)(t().mark(function o(f){var s;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.create(f);case 3:return s=e.sent,console.log(s),e.abrupt("return",s);case 8:e.prev=8,e.t0=e.catch(0),console.log("project create err",e.t0),L.Z.parseError(e.t0,k.default);case 12:case"end":return e.stop()}},o,null,[[0,8]])}));return function(f){return w.apply(this,arguments)}}(),r=function(){var w=(0,Z.Z)(t().mark(function o(f,s){return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:j.update(f,s).then(function(T){console.log("project update res",T)}).catch(function(T){console.log("project update err ",T),L.Z.parseError(T,k.default)});case 1:case"end":return e.stop()}},o)}));return function(f,s){return w.apply(this,arguments)}}();return{all:i,getAll:a,getCurr:_,remove:b,create:m,update:r,get curr(){if(u!=null)return i[u]}}},ee=function(c,d){var p=d.oneHot,i=p===void 0?!0:p,y=d.postOnSelect,D=c(),E=(0,I.Z)(D,2),u=E[0],h=E[1],a=c(),_=(0,I.Z)(a,2),b=_[0],m=_[1],r=c(i),w=(0,I.Z)(r,2),o=w[0],f=w[1],s=function(){var U=(0,Z.Z)(t().mark(function n(g){var O,P,A,W;return t().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.prev=0,M.next=3,j.getLabels(g);case 3:O=M.sent,P=(0,B.Z)(O);try{for(P.s();!(A=P.n()).done;)W=A.value,W.active=!1}catch(te){P.e(te)}finally{P.f()}return h(O),M.abrupt("return",O);case 10:M.prev=10,M.t0=M.catch(0),console.log("label getall err ",M.t0),L.Z.parseError(M.t0,k.default);case 14:case"end":return M.stop()}},n,null,[[0,10]])}));return function(g){return U.apply(this,arguments)}}(),l=function(n){var g=q(n,u,"labelId");if(m(g),console.log("onehot",o),o){var O=(0,B.Z)(u),P;try{for(O.s();!(P=O.n()).done;){var A=P.value;A.active=!1}}catch(W){O.e(W)}finally{O.f()}u[g].active=!0,console.log("all",u)}else u[g].active=!u[g].active;y&&y(u[g]),h((0,H.Z)(u))},e=function(){var U=(0,Z.Z)(t().mark(function n(g){var O;return t().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.prev=0,A.next=3,G.create(g);case 3:return O=A.sent,O.active=!1,h([].concat((0,H.Z)(u),[O])),A.abrupt("return",O);case 9:A.prev=9,A.t0=A.catch(0),console.log("label create err",A.t0),L.Z.parseError(A.t0,k.default);case 13:case"end":return A.stop()}},n,null,[[0,9]])}));return function(g){return U.apply(this,arguments)}}(),T=function(){var U=(0,Z.Z)(t().mark(function n(g){return t().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return console.log("remove label",g),P.prev=1,P.next=4,G.remove(g.labelId);case 4:h(u.filter(function(A){return A.labelId!=g.labelId})),P.next=11;break;case 7:P.prev=7,P.t0=P.catch(1),console.log("label remove err",P.t0),L.Z.parseError(P.t0,k.default);case 11:case"end":return P.stop()}},n,null,[[1,7]])}));return function(g){return U.apply(this,arguments)}}(),v=function(){},C=function(){f(!o)};return{all:u,getAll:s,setAll:h,onSelect:l,create:e,remove:T,onModify:v,toggleOneHot:C,get curr(){if(b!=null)return u[b]}}},re=function(c){var d=c(),p=(0,I.Z)(d,2),i=p[0],y=p[1],D=c(),E=(0,I.Z)(D,2),u=E[0],h=E[1],a=c(),_=(0,I.Z)(a,2),b=_[0],m=_[1],r=function(e){if(e<0){k.default.error("This is the first image. No previous image.");return}if(e==i.length){k.default.error("This is the final image. No next image.");return}console.log("turning to",e),h(e)},w=function(){var l=(0,Z.Z)(t().mark(function e(T,v){var C;return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,j.getTasks(T);case 3:if(C=n.sent,y(C),v==null){n.next=9;break}return console.log("getall turnto"),r(v),n.abrupt("return",[C,C[v]]);case 9:return n.abrupt("return",C);case 12:n.prev=12,n.t0=n.catch(0),console.log("task getall err ",n.t0),L.Z.parseError(n.t0,k.default);case 16:case"end":return n.stop()}},e,null,[[0,12]])}));return function(T,v){return l.apply(this,arguments)}}(),o=function(){var l=(0,Z.Z)(t().mark(function e(T){var v,C;return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,j.getProgress(T);case 3:return v=n.sent,C=Math.ceil(v.finished/v.total*100),console.log("progress",v,C),m(C),n.abrupt("return",C);case 10:return n.prev=10,n.t0=n.catch(0),console.log("get progress err",n.t0),L.Z.parseError(n.t0,k.default),n.abrupt("return",0);case 15:case"end":return n.stop()}},e,null,[[0,10]])}));return function(T){return l.apply(this,arguments)}}(),f=function(){var l=(0,Z.Z)(t().mark(function e(){return t().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r(u+1),console.log("all tasks",i);case 2:case"end":return v.stop()}},e)}));return function(){return l.apply(this,arguments)}}(),s=function(){var l=(0,Z.Z)(t().mark(function e(){return t().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r(u-1);case 1:case"end":return v.stop()}},e)}));return function(){return l.apply(this,arguments)}}();return{currIdx:u,all:i,turnTo:r,getAll:w,getProgress:o,progress:b,nextTask:f,prevTask:s,get curr(){if(!(u==null||i==null))return console.log("task.curr",i[u]),i[u]},get finished(){return Math.floor((i==null?void 0:i.length)*b/100)}}},ae=function(c){var d=c(),p=(0,I.Z)(d,2),i=p[0],y=p[1],D=function(){var h=(0,Z.Z)(t().mark(function a(_){var b;return t().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,X.getAnnotations(_);case 3:return b=r.sent,r.next=6,y(b);case 6:return r.abrupt("return",b);case 9:r.prev=9,r.t0=r.catch(0),console.log("ann getAll err",r.t0),L.Z.parseError(r.t0,k.default);case 13:case"end":return r.stop()}},a,null,[[0,9]])}));return function(_){return h.apply(this,arguments)}}(),E=function(){var h=(0,Z.Z)(t().mark(function a(_){var b;return t().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("create",_),r.prev=1,r.next=4,N.create(_);case 4:return b=r.sent,D(_.dataId),r.abrupt("return",b);case 9:r.prev=9,r.t0=r.catch(1),console.log("annotation create err",r.t0),L.Z.parseError(r.t0,k.default);case 13:case"end":return r.stop()}},a,null,[[1,9]])}));return function(_){return h.apply(this,arguments)}}(),u=function(){var h=(0,Z.Z)(t().mark(function a(_){return t().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:try{N.remove(_)}catch(r){console.log("annotation remove err",r),L.Z.parseError(r,k.default)}case 1:case"end":return m.stop()}},a)}));return function(_){return h.apply(this,arguments)}}();return{all:i,getAll:D,create:E,remove:u}},ne=function(c){var d=c(),p=(0,I.Z)(d,2),i=p[0],y=p[1],D=c([]),E=(0,I.Z)(D,2),u=E[0],h=E[1],a=function(){var b=(0,Z.Z)(t().mark(function m(r){return t().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:y(r);case 1:case"end":return o.stop()}},m)}));return function(r){return b.apply(this,arguments)}}(),_=function(){var b=(0,Z.Z)(t().mark(function m(r,w){var o;return t().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Q.getDatas(r);case 3:if(o=s.sent,h(o),w==null){s.next=8;break}return a(w),s.abrupt("return",[o,o[w]]);case 8:return s.abrupt("return",o);case 11:s.prev=11,s.t0=s.catch(0),console.log("data getall err ",s.t0),L.Z.parseError(s.t0,k.default);case 15:case"end":return s.stop()}},m,null,[[0,11]])}));return function(r,w){return b.apply(this,arguments)}}();return{all:u,getAll:_,turnTo:a,get curr(){if(!(i==null||u==null))return u[i]},get imgSrc(){if(u&&u[i])return console.log("imgsrc","".concat(K,"/datas/").concat(u[i].dataId,"/image")),"".concat(K,"/datas/").concat(u[i].dataId,"/image")}}},le=function(c,d){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.effectTrigger||(p.effectTrigger={});var i=c(!1),y=(0,I.Z)(i,2),D=y[0],E=y[1],u=x(c),h=ae(c),a=re(c),_=ne(c),b=J(c),m=ee(c,p.label);return d(function(){var r=L.Z.getQueryVariable("projectId");b.getCurr(r),m.getAll(r),a.getAll(r),a.getProgress(r)},[]),d(function(){a.all&&a.all.length!=0&&a.turnTo(0)},[a.all]),d(function(){if(a.currIdx!=null){var r=function(){var w=(0,Z.Z)(t().mark(function o(){var f,s,l,e,T,v,C,U;return t().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return console.log("onTaskChange",a.curr,m.all,a.progress),a.getProgress(a.curr.projectId),g.next=4,_.getAll(a.curr.taskId,0);case 4:return f=g.sent,s=(0,I.Z)(f,2),l=s[0],e=s[1],console.log(l),g.next=11,h.getAll(e.dataId);case 11:T=g.sent,v=(0,B.Z)(m.all);try{for(v.s();!(C=v.n()).done;)U=C.value,U.active=!1}catch(O){v.e(O)}finally{v.f()}p.effectTrigger.postTaskChange&&p.effectTrigger.postTaskChange(m.all,T),E(!1);case 16:case"end":return g.stop()}},o)}));return function(){return w.apply(this,arguments)}}();r()}},[a.currIdx]),[D,E,u,h,a,_,b,m]}}}]);
