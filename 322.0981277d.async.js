(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(ue,z,S){"use strict";S.d(z,{gu:function(){return q},Gd:function(){return V},$L:function(){return te}});var H=S(86582),F=S(91220),P=S(3182),se=S(34792),E=S(48086),L=S(2824),Q=S(94043),i=S.n(Q),O=S(37071),R=S(81139),W=localStorage.getItem("basePath"),K=new R.VK(W?{basePath:W}:void 0),j=new R.U(K),X=new R.sD(K),Y=new R.W6(K),N=new R.Cl(K),G=new R.vb(K),q=function(p){return JSON.parse(JSON.stringify(p))};function ie(U){return U&&(U.toLowerCase().replace(/([-_][a-z])/g,function(p){return p.toUpperCase().replace("-","").replace("_","")}),U)}var J=function(p,g,d){if(!!d){for(var l=0;l<g.length;l++)if(p[d]==g[l][d])return l}},x=function(p){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,3],d=p(1),l=(0,L.Z)(d,2),Z=l[0],M=l[1],A=function(k){var c=Z;c+=k,c<g[0]&&(c=g[0],E.default.error("Smallest scale is "+g[0])),c>g[1]&&(c=g[1],E.default.error("Largest scale is "+g[1])),M(c)};return{curr:Z,change:A}},V=function(p){var g=p([]),d=(0,L.Z)(g,2),l=d[0],Z=d[1],M=p(),A=(0,L.Z)(M,2),o=A[0],k=A[1],c=function(){var f=(0,P.Z)(i().mark(function a(){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getAll();case 3:return t=e.sent,Z(t),e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(0),console.log("project getAll err",e.t0),O.Z.parseError(e.t0,E.default);case 12:case"end":return e.stop()}},a,null,[[0,8]])}));return function(){return f.apply(this,arguments)}}(),D=function(){var f=(0,P.Z)(i().mark(function a(t){var n;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t!=null){r.next=2;break}return r.abrupt("return",void 0);case 2:if(!(l.length>1)){r.next=5;break}return E.default.error("Currently have multiple projects stored, use turnTo instead"),r.abrupt("return");case 5:return r.prev=5,r.next=8,j.get(t);case 8:return n=r.sent,Z([n]),k(0),r.abrupt("return",n);case 14:r.prev=14,r.t0=r.catch(5),console.log("prject getcurr err",r.t0),O.Z.parseError(r.t0,E.default);case 18:case"end":return r.stop()}},a,null,[[5,14]])}));return function(t){return f.apply(this,arguments)}}(),T=function(){var f=(0,P.Z)(i().mark(function a(t){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove project",t),typeof t!="number"){e.next=6;break}return e.next=4,j.remove(t);case 4:e.next=8;break;case 6:return e.next=8,j.remove(t.projectId);case 8:c();case 9:case"end":return e.stop()}},a)}));return function(t){return f.apply(this,arguments)}}(),w=function(){var f=(0,P.Z)(i().mark(function a(t){var n;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,j.create(t);case 3:return n=r.sent,console.log(n),r.abrupt("return",n);case 8:r.prev=8,r.t0=r.catch(0),console.log("project create err",r.t0),O.Z.parseError(r.t0,E.default);case 12:case"end":return r.stop()}},a,null,[[0,8]])}));return function(t){return f.apply(this,arguments)}}(),v=function(){var f=(0,P.Z)(i().mark(function a(t,n){return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:j.update(t,n).then(function(m){console.log("project update res",m)}).catch(function(m){console.log("project update err ",m),O.Z.parseError(m,E.default)});case 1:case"end":return r.stop()}},a)}));return function(t,n){return f.apply(this,arguments)}}();return{all:l,getAll:c,getCurr:D,remove:T,create:w,update:v,get curr(){if(o!=null)return l[o]}}},ee=function(p,g){var d=g.oneHot,l=d===void 0?!0:d,Z=g.postSetCurr,M=p(),A=(0,L.Z)(M,2),o=A[0],k=A[1],c=p(),D=(0,L.Z)(c,2),T=D[0],w=D[1],v=p(l),f=(0,L.Z)(v,2),a=f[0],t=f[1],n=function(){var C=(0,P.Z)(i().mark(function s(h){var I,b,y,B;return i().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.prev=0,$.next=3,j.getLabels(h);case 3:I=$.sent,b=(0,F.Z)(I);try{for(b.s();!(y=b.n()).done;)B=y.value,B.active=!1}catch(le){b.e(le)}finally{b.f()}return k(I),$.abrupt("return",I);case 10:$.prev=10,$.t0=$.catch(0),console.log("label getall err ",$.t0),O.Z.parseError($.t0,E.default);case 14:case"end":return $.stop()}},s,null,[[0,10]])}));return function(h){return C.apply(this,arguments)}}(),e=function(s){var h=J(s,o,"labelId");if(w(h),console.log("onehot",a),a){var I=(0,F.Z)(o),b;try{for(I.s();!(b=I.n()).done;){var y=b.value;y.active=!1}}catch(B){I.e(B)}finally{I.f()}o[h].active=!0,console.log("all",o)}else o[h].active=!o[h].active;Z&&Z(o[h]),k((0,H.Z)(o))},r=function(){var C=(0,P.Z)(i().mark(function s(h){var I;return i().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.prev=0,y.next=3,G.create(h);case 3:return I=y.sent,I.active=!1,k([].concat((0,H.Z)(o),[I])),y.abrupt("return",I);case 9:y.prev=9,y.t0=y.catch(0),console.log("label create err",y.t0),O.Z.parseError(y.t0,E.default);case 13:case"end":return y.stop()}},s,null,[[0,9]])}));return function(h){return C.apply(this,arguments)}}(),m=function(){var C=(0,P.Z)(i().mark(function s(h){return i().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return console.log("remove label",h),b.prev=1,b.next=4,G.remove(h.labelId);case 4:k(o.filter(function(y){return y.labelId!=h.labelId})),b.next=11;break;case 7:b.prev=7,b.t0=b.catch(1),console.log("label remove err",b.t0),O.Z.parseError(b.t0,E.default);case 11:case"end":return b.stop()}},s,null,[[1,7]])}));return function(h){return C.apply(this,arguments)}}(),u=function(){},_=function(){t(!a)};return{all:o,getAll:n,setAll:k,setCurr:e,create:r,remove:m,onModify:u,toggleOneHot:_,get curr(){if(T!=null)return o[T]}}},re=function(p){var g=p(),d=(0,L.Z)(g,2),l=d[0],Z=d[1],M=p(),A=(0,L.Z)(M,2),o=A[0],k=A[1],c=p(),D=(0,L.Z)(c,2),T=D[0],w=D[1],v=function(r){if(r<0){E.default.error("This is the first image. No previous image.");return}if(r==l.length){E.default.error("This is the final image. No next image.");return}console.log("turning to",r),k(r)},f=function(){var e=(0,P.Z)(i().mark(function r(m,u){var _;return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,j.getTasks(m);case 3:if(_=s.sent,Z(_),u==null){s.next=9;break}return console.log("getall turnto"),v(u),s.abrupt("return",[_,_[u]]);case 9:return s.abrupt("return",_);case 12:s.prev=12,s.t0=s.catch(0),console.log("task getall err ",s.t0),O.Z.parseError(s.t0,E.default);case 16:case"end":return s.stop()}},r,null,[[0,12]])}));return function(m,u){return e.apply(this,arguments)}}(),a=function(){var e=(0,P.Z)(i().mark(function r(m){var u,_;return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,j.getProgress(m);case 3:return u=s.sent,_=Math.ceil(u.finished/u.total*100),console.log("progress",u,_),w(_),s.abrupt("return",_);case 10:return s.prev=10,s.t0=s.catch(0),console.log("get progress err",s.t0),O.Z.parseError(s.t0,E.default),s.abrupt("return",0);case 15:case"end":return s.stop()}},r,null,[[0,10]])}));return function(m){return e.apply(this,arguments)}}(),t=function(){var e=(0,P.Z)(i().mark(function r(){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:v(o+1),console.log("all tasks",l);case 2:case"end":return u.stop()}},r)}));return function(){return e.apply(this,arguments)}}(),n=function(){var e=(0,P.Z)(i().mark(function r(){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:v(o-1);case 1:case"end":return u.stop()}},r)}));return function(){return e.apply(this,arguments)}}();return{currIdx:o,all:l,turnTo:v,getAll:f,getProgress:a,progress:T,nextTask:t,prevTask:n,get curr(){if(!(o==null||l==null))return console.log("task.curr",l[o]),l[o]},get finished(){return Math.floor((l==null?void 0:l.length)*T/100)}}},ae=function(p){var g=p(),d=(0,L.Z)(g,2),l=d[0],Z=d[1],M=p(),A=(0,L.Z)(M,2),o=A[0],k=A[1],c=function(){var v=(0,P.Z)(i().mark(function f(a){var t,n,e,r;return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,Y.getAnnotations(a);case 3:t=u.sent,n=(0,F.Z)(t);try{for(n.s();!(e=n.n()).done;)r=e.value,r.active=!1}catch(_){n.e(_)}finally{n.f()}return u.next=8,Z(t);case 8:return u.abrupt("return",t);case 11:u.prev=11,u.t0=u.catch(0),console.log("ann getAll err",u.t0),O.Z.parseError(u.t0,E.default);case 15:case"end":return u.stop()}},f,null,[[0,11]])}));return function(a){return v.apply(this,arguments)}}(),D=function(){var v=(0,P.Z)(i().mark(function f(a){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create",a),e.prev=1,e.next=4,N.create(a);case 4:return t=e.sent,c(a.dataId),e.abrupt("return",t);case 9:e.prev=9,e.t0=e.catch(1),console.log("annotation create err",e.t0),O.Z.parseError(e.t0,E.default);case 13:case"end":return e.stop()}},f,null,[[1,9]])}));return function(a){return v.apply(this,arguments)}}(),T=function(){var v=(0,P.Z)(i().mark(function f(a){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a,console.log("typeof",typeof a),typeof a!="number"&&(t=a.annotationId),e.prev=3,e.next=6,N.remove(t);case 6:Z(l.filter(function(r){return r.annotationId!=a.annotationId})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),console.log("annotation remove err",e.t0),O.Z.parseError(e.t0,E.default);case 13:case"end":return e.stop()}},f,null,[[3,9]])}));return function(a){return v.apply(this,arguments)}}(),w=function(){var v=(0,P.Z)(i().mark(function f(a){var t,n,e,r,m;return i().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:console.log("annotation onselect",a),a==null&&k(void 0),t=(0,F.Z)(l);try{for(t.s();!(n=t.n()).done;)e=n.value,e.active=!1}catch(C){t.e(C)}finally{t.f()}r=l.filter(function(C){return C.annotationId==a.annotationId})[0],r.active=!a.active,m=J(r,l,"annotationId"),k(m),Z((0,H.Z)(l));case 9:case"end":return _.stop()}},f)}));return function(a){return v.apply(this,arguments)}}();return{all:l,getAll:c,create:D,remove:T,setCurr:w,get curr(){if(!!l)return l[o]}}},ne=function(p){var g=p(),d=(0,L.Z)(g,2),l=d[0],Z=d[1],M=p([]),A=(0,L.Z)(M,2),o=A[0],k=A[1],c=function(){var T=(0,P.Z)(i().mark(function w(v){return i().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:Z(v);case 1:case"end":return a.stop()}},w)}));return function(v){return T.apply(this,arguments)}}(),D=function(){var T=(0,P.Z)(i().mark(function w(v,f){var a;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,X.getDatas(v);case 3:if(a=n.sent,k(a),f==null){n.next=8;break}return c(f),n.abrupt("return",[a,a[f]]);case 8:return n.abrupt("return",a);case 11:n.prev=11,n.t0=n.catch(0),console.log("data getall err ",n.t0),O.Z.parseError(n.t0,E.default);case 15:case"end":return n.stop()}},w,null,[[0,11]])}));return function(v,f){return T.apply(this,arguments)}}();return{all:o,getAll:D,turnTo:c,get curr(){if(!(l==null||o==null))return o[l]},get imgSrc(){if(o&&o[l])return console.log("imgsrc","".concat(W,"/datas/").concat(o[l].dataId,"/image")),"".concat(W,"/datas/").concat(o[l].dataId,"/image")}}},te=function(p,g){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};d.effectTrigger||(d.effectTrigger={});var l=p(!1),Z=(0,L.Z)(l,2),M=Z[0],A=Z[1],o=x(p),k=ae(p),c=re(p),D=ne(p),T=V(p),w=ee(p,d.label);return g(function(){var v=O.Z.getQueryVariable("projectId");T.getCurr(v),w.getAll(v),c.getAll(v),c.getProgress(v)},[]),g(function(){c.all&&c.all.length!=0&&c.turnTo(0)},[c.all]),g(function(){if(c.currIdx!=null){var v=function(){var f=(0,P.Z)(i().mark(function a(){var t,n,e,r,m,u,_,C;return i().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return console.log("onTaskChange",c.curr,w.all,c.progress),c.getProgress(c.curr.projectId),h.next=4,D.getAll(c.curr.taskId,0);case 4:return t=h.sent,n=(0,L.Z)(t,2),e=n[0],r=n[1],console.log(e),h.next=11,k.getAll(r.dataId);case 11:if(m=h.sent,w.all){u=(0,F.Z)(w.all);try{for(u.s();!(_=u.n()).done;)C=_.value,C.active=!1}catch(I){u.e(I)}finally{u.f()}}d.effectTrigger.postTaskChange&&d.effectTrigger.postTaskChange(w.all,m),A(!1);case 15:case"end":return h.stop()}},a)}));return function(){return f.apply(this,arguments)}}();v()}},[c.currIdx]),[M,A,o,k,c,D,T,w]}}}]);
