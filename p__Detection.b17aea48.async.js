(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(B,k,o){"use strict";o.d(k,{Z:function(){return E}});var j=o(94663),H=o(80112);function Y(O){return Function.toString.call(O).indexOf("[native code]")!==-1}var K=o(18597);function Z(O,I,$){return(0,K.Z)()?Z=Reflect.construct:Z=function(v,X,h){var P=[null];P.push.apply(P,X);var f=Function.bind.apply(v,P),L=new f;return h&&(0,H.Z)(L,h.prototype),L},Z.apply(null,arguments)}function E(O){var I=typeof Map=="function"?new Map:void 0;return E=function(d){if(d===null||!Y(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof I!="undefined"){if(I.has(d))return I.get(d);I.set(d,v)}function v(){return Z(d,arguments,(0,j.Z)(this).constructor)}return v.prototype=Object.create(d.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),(0,H.Z)(v,d)},E(O)}},72285:function(B){B.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(B,k,o){"use strict";o.r(k),o.d(k,{default:function(){return gn}});var j=o(11849),H=o(57663),Y=o(71577),K=o(20228),Z=o(11382),E=o(34669),O=o(54458),I=o(34792),$=o(48086),d=o(2824),v=o(67294),X=o(72285),h=o.n(X),P=o(8088),f=o(61541),L=o(44434),_=o(5041),nn=o(57436),tn=o(14836),e=o(85893),en=function(t){return(0,e.jsx)(f.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},on=en,rn=o(91220),z=o(65031);function an(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function V(n,t){if(!(!n||!t))return{color:n,points:t}}function sn(n,t,i,p,a,y,g){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var r=n.lines[0].points,s=n.lines[0].color,l=an(s);if(!l)return[(0,e.jsx)(e.Fragment,{})];var C=(g==null?void 0:g.annotationId)==n.annotationId,A=C?.5:.1,m=void 0,b=[];return r.forEach(function(x,S){if(!m){m=x;return}b.push((0,e.jsx)(z.Cd,{onMouseDown:function(){a=="mover"&&y(n)},draggable:a=="mover",onDragMove:function(F){console.log("Circle onDrageMove");var J=F.evt.offsetX/p,M=F.evt.offsetY/p;r[S-1]=J,r[S]=M;var T=(0,j.Z)((0,j.Z)({},n),{},{lines:[{color:s,points:r}]});t(T)},onMouseOver:function(){console.log("Circle onMouseOver"),a=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x:m,y:x,radius:5,fill:s})),console.log(S,r),r.length>4&&r.splice(S+1,2),m=void 0}),[(0,e.jsxs)(z.ZA,{children:[(0,e.jsx)(z.UL,{onMouseOver:function(){a=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){a=="mover"&&y(n)},stroke:s,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r[0],y:r[1],width:r[2]-r[0],height:r[3]-r[1],closed:!0,fill:"rgba(".concat(l.r,", ").concat(l.g,", ").concat(l.b,", ").concat(A,")")}),b]},n.annotationId)]}function cn(n){var t=0,i=(0,rn.Z)(n),p;try{for(i.s();!(p=i.n()).done;){var a=p.value;!a||a.annotationId>t&&(t=a.annotationId)}}catch(y){i.e(y)}finally{i.f()}return t}function ln(n){var t=function(g,r){var s,l=g.evt.offsetX/r,C=g.evt.offsetY/r,A=V((s=n.currentLabel)===null||s===void 0?void 0:s.color,[l,C]);!A||n.onAnnotationAdd({tool:"polygon",annotationId:cn(n.annotations)+1,label:n.currentLabel,lines:[A]})},i=function(g,r){var s,l;if(!!n.currentAnnotation){var C=g.evt.offsetX/r,A=g.evt.offsetY/r,m=n.currentAnnotation.lines||[],b=V((s=n.currentLabel)===null||s===void 0?void 0:s.color,(l=m[0])===null||l===void 0?void 0:l.points.concat([C,A]));if(!!b){var x={tool:"polygon",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[b]};n.onAnnotationModify(x)}}},p=function(g,r){n.currentTool=="polygon"&&(n.currentAnnotation?i(g,r):t(g,r))},a=function(){n.currentTool=="polygon"&&n.onMouseUp()};return{onMouseDown:p,onMouseMove:function(){},onMouseUp:a,createElementsFunc:sn}}var un=o(64322),U=40;function dn(){localStorage.removeItem("history"),W([])}function W(n){var t=localStorage.getItem("history"),i=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(i.items[i.index])!=JSON.stringify(n)){var p=i.index>U?i.index-U:0,a=i.items.splice(p,i.index==0?1:i.index+1);i.items=a.concat([n]),i.index<=U?i.index++:i.index=U+1,localStorage.setItem("history",JSON.stringify(i))}}function mn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function fn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var vn=function(){var t,i,p=(0,un.$L)(v.useState,v.useEffect,{label:{oneHot:!0},effectTrigger:{}}),a=(0,d.Z)(p,8),y=a[0],g=a[1],r=a[2],s=a[3],l=a[4],C=a[5],A=a[6],m=a[7];s.const[currentTool,setCurrentTool]=(0,v.useState)(void 0);var b=(0,v.useState)(),x=(0,d.Z)(b,2),S=x[0],N=x[1],F=(0,v.useState)([]),J=(0,d.Z)(F,2),M=J[0],T=J[1],D=function(c){N(c),c!=null&&c.label&&m.setCurr(c.label)};(0,v.useEffect)(function(){dn()},[]);var Q=function(c){for(var R=[],w=0;w<M.length;w++)M[w].annotationId==c.annotationId?R.push(c):R.push(M[w]);D(c),T(R)},q=ln({currentLabel:m.curr,currentTool,annotations:M,currentAnnotation:S,onAnnotationAdd:function(c){var R=M.concat([c]);T(R),S||D(c)},onAnnotationModify:Q,onMouseUp:function(){W({annos:M,currAnno:S})}}),G=q;return(0,e.jsxs)(P.Z,{className:h().det,children:[(0,e.jsxs)(L.Z,{children:[(0,e.jsx)(on,{active:currentTool=="polygon",onClick:function(){setCurrentTool("polygon"),D(void 0)},children:"Rectangle"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/edit.png",children:"Edit"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){r.change(.1)},children:"Zoom in"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){r.change(-.1)},children:"Zoom out"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){$.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){setCurrentTool("mover")},children:"Move"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var c=fn();T(c.annos),D(c.currAnno)},children:"Undo"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){forwardHistory()},children:"Redo"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:h().mainStage,children:(0,e.jsxs)(Z.Z,{tip:"loading",spinning:y,children:[(0,e.jsx)("div",{className:h().draw,children:(0,e.jsx)(nn.Z,{width:(t=document.getElementById("dr"))===null||t===void 0?void 0:t.clientWidth,scale:r.curr,annotations:M,currentTool,currentAnnotation:S,setCurrentAnnotation:D,onAnnotationModify:Q,onAnnotationModifyComplete:function(){W(M,S)},onMouseDown:G.onMouseDown,onMouseMove:G.onMouseMove,onMouseUp:G.onMouseUp,createPolygonFunc:q.createElementsFunc,imgSrc:C.imgSrc})}),(0,e.jsx)("div",{className:h().pblock,children:(0,e.jsxs)("div",{className:h().progress,children:[(0,e.jsx)(O.Z,{percent:l.progress,status:"active"}),l.currIdx," ",(i=l.all)===null||i===void 0?void 0:i.length," ",l.finished]})})]})}),(0,e.jsxs)(L.Z,{disLoc:"right",children:[(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:l.nextTask,children:"Next"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:l.prevTask,children:"Prev"})]}),(0,e.jsxs)("div",{className:h().rightSideBar,children:[(0,e.jsx)("div",{className:h().determinOutline,children:(0,e.jsx)(Y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){s.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(_.Z,{labels:m.all,onLabelSelect:function(c){m.setCurr(c),s.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:m.remove,onLabelAdd:function(c){return m.create((0,j.Z)((0,j.Z)({},c),{},{projectId:A.curr.projectId}))}}),(0,e.jsx)(tn.Z,{annotations:s.all,onAnnotationSelect:s.setCurr,onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:s.remove})]})]})},gn=vn}}]);
