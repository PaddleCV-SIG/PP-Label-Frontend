(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(B,k,o){"use strict";o.d(k,{Z:function(){return E}});var Z=o(94663),H=o(80112);function Y(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var Q=o(18597);function O(I,P,$){return(0,Q.Z)()?O=Reflect.construct:O=function(v,X,h){var N=[null];N.push.apply(N,X);var f=Function.bind.apply(v,N),D=new f;return h&&(0,H.Z)(D,h.prototype),D},O.apply(null,arguments)}function E(I){var P=typeof Map=="function"?new Map:void 0;return E=function(d){if(d===null||!Y(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(d))return P.get(d);P.set(d,v)}function v(){return O(d,arguments,(0,Z.Z)(this).constructor)}return v.prototype=Object.create(d.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),(0,H.Z)(v,d)},E(I)}},72285:function(B){B.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(B,k,o){"use strict";o.r(k),o.d(k,{default:function(){return yn}});var Z=o(11849),H=o(57663),Y=o(71577),Q=o(20228),O=o(11382),E=o(34669),I=o(54458),P=o(34792),$=o(48086),d=o(2824),v=o(67294),X=o(72285),h=o.n(X),N=o(8088),f=o(61541),D=o(44434),en=o(5041),on=o(57436),rn=o(14836),e=o(85893),an=function(t){return(0,e.jsx)(f.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},sn=an,cn=o(91220),z=o(65031);function ln(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function q(n,t){if(!(!n||!t))return{color:n,points:t}}function un(n,t,i,p,a,y,g){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var r=n.lines[0].points,c=n.lines[0].color,l=ln(c);if(!l)return[(0,e.jsx)(e.Fragment,{})];var b=(g==null?void 0:g.annotationId)==n.annotationId,S=b?.5:.1,m=void 0,j=[];return r.forEach(function(x,M){if(!m){m=x;return}j.push((0,e.jsx)(z.Cd,{onMouseDown:function(){a=="mover"&&y(n)},draggable:a=="mover",onDragMove:function(F){console.log("Circle onDrageMove");var J=F.evt.offsetX/p,C=F.evt.offsetY/p;r[M-1]=J,r[M]=C;var G=(0,Z.Z)((0,Z.Z)({},n),{},{lines:[{color:c,points:r}]});t(G)},onMouseOver:function(){console.log("Circle onMouseOver"),a=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x:m,y:x,radius:5,fill:c})),console.log(M,r),r.length>4&&r.splice(M+1,2),m=void 0}),[(0,e.jsxs)(z.ZA,{children:[(0,e.jsx)(z.UL,{onMouseOver:function(){a=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){a=="mover"&&y(n)},stroke:c,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r[0],y:r[1],width:r[2]-r[0],height:r[3]-r[1],closed:!0,fill:"rgba(".concat(l.r,", ").concat(l.g,", ").concat(l.b,", ").concat(S,")")}),j]},n.annotationId)]}function dn(n){var t=0,i=(0,cn.Z)(n),p;try{for(i.s();!(p=i.n()).done;){var a=p.value;!a||a.annotationId>t&&(t=a.annotationId)}}catch(y){i.e(y)}finally{i.f()}return t}function fn(n){var t=function(g,r){var c,l=g.evt.offsetX/r,b=g.evt.offsetY/r,S=q((c=n.currentLabel)===null||c===void 0?void 0:c.color,[l,b]);!S||n.onAnnotationAdd({tool:"polygon",annotationId:dn(n.annotations)+1,label:n.currentLabel,lines:[S]})},i=function(g,r){var c,l;if(!!n.currentAnnotation){var b=g.evt.offsetX/r,S=g.evt.offsetY/r,m=n.currentAnnotation.lines||[],j=q((c=n.currentLabel)===null||c===void 0?void 0:c.color,(l=m[0])===null||l===void 0?void 0:l.points.concat([b,S]));if(!!j){var x={tool:"polygon",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[j]};n.onAnnotationModify(x)}}},p=function(g,r){n.currentTool=="polygon"&&(n.currentAnnotation?i(g,r):t(g,r))},a=function(){n.currentTool=="polygon"&&n.onMouseUp()};return{onMouseDown:p,onMouseMove:function(){},onMouseUp:a,createElementsFunc:un}}var vn=o(64322),U=40;function gn(){localStorage.removeItem("history"),W([])}function W(n){var t=localStorage.getItem("history"),i=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(i.items[i.index])!=JSON.stringify(n)){var p=i.index>U?i.index-U:0,a=i.items.splice(p,i.index==0?1:i.index+1);i.items=a.concat([n]),i.index<=U?i.index++:i.index=U+1,localStorage.setItem("history",JSON.stringify(i))}}function xn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function mn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var pn=function(){var t,i,p=(0,vn.$L)(v.useState,v.useEffect,{label:{oneHot:!0},effectTrigger:{}}),a=(0,d.Z)(p,8),y=a[0],g=a[1],r=a[2],c=a[3],l=a[4],b=a[5],S=a[6],m=a[7],j=(0,v.useState)(void 0),x=(0,d.Z)(j,2),M=x[0],L=x[1],F=(0,v.useState)(),J=(0,d.Z)(F,2),C=J[0],G=J[1],hn=(0,v.useState)([]),_=(0,d.Z)(hn,2),A=_[0],K=_[1],R=function(s){G(s),s!=null&&s.label&&m.setCurr(s.label)};(0,v.useEffect)(function(){gn()},[]);var nn=function(s){for(var T=[],w=0;w<A.length;w++)A[w].annotationId==s.annotationId?T.push(s):T.push(A[w]);R(s),K(T)},tn=fn({currentLabel:m.curr,currentTool:M,annotations:A,currentAnnotation:C,onAnnotationAdd:function(s){var T=A.concat([s]);K(T),C||R(s)},onAnnotationModify:nn,onMouseUp:function(){W({annos:A,currAnno:C})}}),V=tn;return(0,e.jsxs)(N.Z,{className:h().det,children:[(0,e.jsxs)(D.Z,{children:[(0,e.jsx)(sn,{active:M=="polygon",onClick:function(){L("polygon"),R(void 0)},children:"Rectangle"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/edit.png",children:"Edit"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){r.change(.1)},children:"Zoom in"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){r.change(-.1)},children:"Zoom out"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){$.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){L("mover")},children:"Move"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var s=mn();K(s.annos),R(s.currAnno)},children:"Undo"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){forwardHistory()},children:"Redo"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:h().mainStage,children:(0,e.jsxs)(O.Z,{tip:"loading",spinning:y,children:[(0,e.jsx)("div",{className:h().draw,children:(0,e.jsx)(on.Z,{width:(t=document.getElementById("dr"))===null||t===void 0?void 0:t.clientWidth,scale:r.curr,annotations:A,currentTool:M,currentAnnotation:C,setCurrentAnnotation:R,onAnnotationModify:nn,onAnnotationModifyComplete:function(){W(A,C)},onMouseDown:V.onMouseDown,onMouseMove:V.onMouseMove,onMouseUp:V.onMouseUp,createPolygonFunc:tn.createElementsFunc,imgSrc:b.imgSrc})}),(0,e.jsx)("div",{className:h().pblock,children:(0,e.jsxs)("div",{className:h().progress,children:[(0,e.jsx)(I.Z,{percent:l.progress,status:"active"}),l.currIdx," ",(i=l.all)===null||i===void 0?void 0:i.length," ",l.finished]})})]})}),(0,e.jsxs)(D.Z,{disLoc:"right",children:[(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/next.png",onClick:l.nextTask,children:"Next"}),(0,e.jsx)(f.Z,{imgSrc:"./pics/buttons/prev.png",onClick:l.prevTask,children:"Prev"})]}),(0,e.jsxs)("div",{className:h().rightSideBar,children:[(0,e.jsx)("div",{className:h().determinOutline,children:(0,e.jsx)(Y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){c.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(en.Z,{labels:m.all,onLabelSelect:function(s){m.setCurr(s),c.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:m.remove,onLabelAdd:function(s){return m.create((0,Z.Z)((0,Z.Z)({},s),{},{projectId:S.curr.projectId}))}}),(0,e.jsx)(rn.Z,{annotations:c.all,onAnnotationSelect:c.setCurr,onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:c.remove})]})]})},yn=pn}}]);
