(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(A,O,t){"use strict";t.d(O,{Z:function(){return z}});var P=t(94663),J=t(80112);function V(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var fn=t(18597);function U(I,E,C){return(0,fn.Z)()?U=Reflect.construct:U=function(N,nn,w){var h=[null];h.push.apply(h,nn);var X=Function.bind.apply(N,h),G=new X;return w&&(0,J.Z)(G,w.prototype),G},U.apply(null,arguments)}function z(I){var E=typeof Map=="function"?new Map:void 0;return z=function(d){if(d===null||!V(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof E!="undefined"){if(E.has(d))return E.get(d);E.set(d,N)}function N(){return U(d,arguments,(0,P.Z)(this).constructor)}return N.prototype=Object.create(d.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),(0,J.Z)(N,d)},z(I)}},6277:function(A){A.exports={modal:"modal___26yNn"}},45092:function(A){A.exports={modal:"modal___1H_FQ"}},72285:function(A){A.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},3059:function(A,O,t){"use strict";t.r(O),t.d(O,{default:function(){return Jn}});var P=t(11849),J=t(20228),V=t(11382),fn=t(34669),U=t(54458),z=t(34792),I=t(48086),E=t(91220),C=t(2824),d=t(67294),N=t(72285),nn=t.n(N),w=t(8088),h=t(61541),X=t(44434),G=t(5041),xn=t(57436),hn=t(14836),n=t(85893),yn=function(e){return(0,n.jsx)(h.Z,{active:e.active,imgSrc:e.imgSrc||"./pics/buttons/rectangle.png",onClick:e.onClick,children:e.children})},Mn=yn,tn=t(65031);function Sn(o){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function Pn(o){if(!(!o||o.length<2))return{xmin:o[0],ymin:o[1],xmax:o[2]||void 0,ymax:o[3]||void 0}}function Cn(o,e,s,v,i,p,m){if(!o||!o.points||!o.label||!o.label.color)return[(0,n.jsx)(n.Fragment,{})];var r=o.points,c=o.label.color,u=Sn(c);if(!u)return[(0,n.jsx)(n.Fragment,{})];var y=(m==null?void 0:m.annotationId)==o.annotationId,x=y?.5:.1,g=r.xmax!=null&&r.ymax!=null?(0,n.jsx)(tn.UL,{onMouseOver:function(){i=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){i=="mover"&&p(o)},stroke:c,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r.xmin,y:r.ymin,width:r.xmax-r.xmin,height:r.ymax-r.ymin,closed:!0,fill:"rgba(".concat(u.r,", ").concat(u.g,", ").concat(u.b,", ").concat(x,")")}):(0,n.jsx)(n.Fragment,{});function j(S){if(!S&&(r.xmax==null||r.ymax==null))return(0,n.jsx)(n.Fragment,{});var T=function(M){if(i=="editor"){var Y=M.target.x(),L=M.target.y();S?(r.xmin=Y,r.ymin=L):(r.xmax=Y,r.ymax=L);var D=(0,P.Z)((0,P.Z)({},o),{},{points:r});e(D)}};return(0,n.jsx)(tn.Cd,{onMouseDown:function(){(i=="editor"||i=="mover")&&p(o)},draggable:i=="editor",onDragMove:T,onDragEnd:T,onMouseOver:function(){i=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:S?r.xmin:r.xmax,y:S?r.ymin:r.ymax,radius:5,fill:c})}return[(0,n.jsxs)(tn.ZA,{children:[g,j(!0),j(!1)]},o.annotationId)]}function jn(o){var e=1;if(!o||o.length==0)return e;var s=(0,E.Z)(o),v;try{for(s.s();!(v=s.n()).done;){var i=v.value;i.frontendId&&e<=i.frontendId&&(e=i.frontendId+1)}}catch(p){s.e(p)}finally{s.f()}return e}function Dn(o){var e=function(m,r,c,u){var y=(m.evt.offsetX+r)/u,x=(m.evt.offsetY+c)/u,g=Pn([y,x]);!g||o.onAnnotationAdd({frontendId:jn(o.annotations),type:"rectangle",label:o.currentLabel,points:g})},s=function(m,r,c,u){if(!(!o.currentAnnotation||!o.currentAnnotation.points)){var y=(m.evt.offsetX+r)/u,x=(m.evt.offsetY+c)/u,g=o.currentAnnotation.points;if(!!g){g.xmax=y,g.ymax=x;var j={type:"rectangle",frontendId:o.currentAnnotation.frontendId,label:o.currentAnnotation.label,points:g};o.onAnnotationModify(j)}}},v=function(m,r,c,u){o.currentTool=="rectangle"&&(o.currentAnnotation?s(m,r,c,u):e(m,r,c,u))},i=function(){o.currentTool=="rectangle"&&o.onMouseUp()};return{onMouseDown:v,onMouseMove:function(){},onMouseUp:i,createElementsFunc:Cn}}var Zn=t(64322),Q=40;function An(){localStorage.removeItem("history"),en([])}function en(o){var e=localStorage.getItem("history"),s=e?JSON.parse(e):{index:-1,items:[]};if(JSON.stringify(s.items[s.index])!=JSON.stringify(o)){var v=s.index>Q?s.index-Q:0,i=s.items.splice(v,s.index==0?1:s.index+1);s.items=i.concat([o]),s.index<=Q?s.index++:s.index=Q+1,localStorage.setItem("history",JSON.stringify(s))}}function In(){var o=localStorage.getItem("history");if(!!o){var e=JSON.parse(o);if(!!e&&!(e.index>=e.items.length-1))return e.index++,localStorage.setItem("history",JSON.stringify(e)),e.items[e.index]}}function Bn(){var o=localStorage.getItem("history");if(!!o){var e=JSON.parse(o);if(!(!e||!e.index)&&!(e.index<=0))return e.index--,localStorage.setItem("history",JSON.stringify(e)),e.items[e.index]}}var f=t(48971),ot=t(71194),vn=t(50146),at=t(49111),mn=t(19650),rt=t(57663),_=t(71577),it=t(13062),On=t(71230),st=t(89032),on=t(15746),lt=t(77883),an=t(70507),dt=t(9715),b=t(93766),bn=t(6277),En=t.n(bn),Fn=function(e){var s=(0,f.YB)(),v=(0,d.useState)(60),i=(0,C.Z)(v,2),p=i[0],m=i[1],r=(0,d.useState)(20),c=(0,C.Z)(r,2),u=c[0],y=c[1],x=(0,d.useState)(20),g=(0,C.Z)(x,2),j=g[0],S=g[1],T=(0,d.useState)(!1),Z=(0,C.Z)(T,2),M=Z[0],Y=Z[1],L=(0,f.YB)().formatMessage({id:"pages.toolBar.divideData"}),D=(0,f.YB)().formatMessage({id:"component.PPDivideDataModal.train"}),R=(0,f.YB)().formatMessage({id:"component.PPDivideDataModal.validation"}),rn=(0,f.YB)().formatMessage({id:"component.PPDivideDataModal.test"}),q=(0,f.YB)().formatMessage({id:"component.PPCreater.cancel"}),sn=(0,f.YB)().formatMessage({id:"component.PPSegMode.ok"}),$=b.Z.useForm(),ln=(0,C.Z)($,1),K=ln[0];return(0,n.jsx)(vn.Z,{className:En().modal,title:L,visible:e.visible,onCancel:e.onCancel,footer:null,children:(0,n.jsxs)(b.Z,{form:K,name:"basic",labelCol:{span:8},wrapperCol:{span:16},initialValues:{remember:!1},onFinish:function(){if(p+u+j!=100){I.default.error("Train, Validation and Test total percent should equal 100!");return}console.log("x trainData: ".concat(p,", validationData: ").concat(u,", testData: ").concat(j,", props.project.curr.projectId: ").concat(e.project.curr.projectId)),Y(!0),e.splitDataset(e.project.curr.projectId,{train:p*.01,validation:u*.01,test:j*.01}).then(function(){var B;console.log("success"),I.default.success(s.formatMessage({id:"component.PPDivideDataModal.success"})),(B=e.onFinish)===null||B===void 0||B.call(0)}).finally(function(){Y(!1)})},autoComplete:"off",layout:"vertical",children:[(0,n.jsxs)(On.Z,{children:[(0,n.jsx)(on.Z,{span:8,children:(0,n.jsx)(b.Z.Item,{label:D,name:"train",children:(0,n.jsx)(an.Z,{addonAfter:"%",defaultValue:60,precision:0,min:0,max:100,value:p,onChange:m})})}),(0,n.jsx)(on.Z,{span:8,children:(0,n.jsx)(b.Z.Item,{label:R,name:"validation",children:(0,n.jsx)(an.Z,{addonAfter:"%",defaultValue:20,precision:0,min:0,max:100,value:u,onChange:y})})}),(0,n.jsx)(on.Z,{span:8,children:(0,n.jsx)(b.Z.Item,{label:rn,name:"test",children:(0,n.jsx)(an.Z,{addonAfter:"%",defaultValue:20,precision:0,min:0,max:100,value:j,onChange:S})})})]}),(0,n.jsx)(b.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,n.jsxs)(mn.Z,{children:[(0,n.jsx)(_.Z,{onClick:function(){var B;(B=e.onCancel)===null||B===void 0||B.call(0),K.resetFields()},children:q}),(0,n.jsx)(_.Z,{type:"primary",htmlType:"submit",loading:M,children:sn})]})})]})})},Nn=Fn,ct=t(47673),Tn=t(24044),Yn=t(45092),Ln=t.n(Yn),Rn=function(e){var s=(0,f.YB)(),v=(0,d.useState)(!1),i=(0,C.Z)(v,2),p=i[0],m=i[1],r=(0,f.YB)().formatMessage({id:"component.PPCreater.cancel"}),c=b.Z.useForm(),u=(0,C.Z)(c,1),y=u[0];return(0,n.jsx)(vn.Z,{className:Ln().modal,title:(0,f.YB)().formatMessage({id:"component.PPExportModal.title"}),visible:e.visible,onCancel:e.onCancel,footer:null,children:(0,n.jsxs)(b.Z,{form:y,name:"basic",labelCol:{span:6},wrapperCol:{span:16},initialValues:{remember:!1},onFinish:function(g){console.log(g);var j=g.path;if(!j){I.default.error(s.formatMessage({id:"component.PPExportModal.pathNotNull"}));return}m(!0),e.exportDataset(e.project.curr.projectId,j).then(function(){var S;I.default.success(s.formatMessage({id:"component.PPExportModal.exportSuccess"})),(S=e.onFinish)===null||S===void 0||S.call(0)}).finally(function(){m(!1)})},autoComplete:"off",children:[(0,n.jsx)(b.Z.Item,{label:s.formatMessage({id:"component.PPExportModal.path"}),name:"path",children:(0,n.jsx)(Tn.Z,{})}),(0,n.jsx)(b.Z.Item,{wrapperCol:{offset:6,span:16},children:(0,n.jsxs)(mn.Z,{children:[(0,n.jsx)(_.Z,{onClick:function(){var g;(g=e.onCancel)===null||g===void 0||g.call(0),y.resetFields()},children:r}),(0,n.jsx)(_.Z,{type:"primary",htmlType:"submit",loading:p,children:s.formatMessage({id:"component.PPExportModal.imagenet"})})]})})]})})},kn=Rn,Un=function(){var e,s=(0,Zn.$L)(d.useState,d.useEffect,{label:{oneHot:!0},effectTrigger:{postTaskChange:An}}),v=(0,C.Z)(s,10),i=v[0],p=v[1],m=v[2],r=v[3],c=v[4],u=v[5],y=v[6],x=v[7],g=v[8],j=v[9],S=(0,d.useState)(),T=(0,C.Z)(S,2),Z=T[0],M=T[1],Y=(0,d.useState)([]),L=(0,C.Z)(Y,2),D=L[0],R=L[1],rn=(0,d.useState)(!1),q=(0,C.Z)(rn,2),sn=q[0],$=q[1],ln=(0,d.useState)(!1),K=(0,C.Z)(ln,2),dn=K[0],B=K[1],Vn=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));D.push(a),R(D),M(a)},$n=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));var k=[],F=(0,E.Z)(D),W;try{for(F.s();!(W=F.n()).done;){var H=W.value;H.frontendId==a.frontendId?k.push(a):k.push(H)}}catch(un){F.e(un)}finally{F.f()}console.log("modifyAnnotation, newAnnos:",k,"anno:",a),R(k),M(a)},Kn=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));var k=[],F=(0,E.Z)(D),W;try{for(F.s();!(W=F.n()).done;){var H=W.value;H.frontendId!=a.frontendId&&k.push(H)}}catch(un){F.e(un)}finally{F.f()}R(k),M(void 0)},ut=function(a){!a||(console.log("modifyAnnotation",a,"anno.label:",a==null?void 0:a.label),a.taskId=c.curr.taskId,a.dataId=u.curr.dataId,r.modify(a))},gn=function(a){console.log("onAnnotationModify"),$n(a)},pn=Dn({currentLabel:x.curr,currentTool:i.curr,annotations:D,currentAnnotation:Z,onAnnotationAdd:Vn,onAnnotationModify:gn,onMouseUp:function(){en({annos:D,currAnno:Z})}}),cn=pn,Wn=(0,f.YB)().formatMessage({id:"pages.toolBar.rectangle"}),Hn=(0,f.YB)().formatMessage({id:"pages.toolBar.zoomIn"}),zn=(0,f.YB)().formatMessage({id:"pages.toolBar.zoomOut"}),wn=(0,f.YB)().formatMessage({id:"pages.toolBar.move"}),Xn=(0,f.YB)().formatMessage({id:"pages.toolBar.unDo"}),Gn=(0,f.YB)().formatMessage({id:"pages.toolBar.reDo"}),Qn=(0,f.YB)().formatMessage({id:"pages.toolBar.save"}),_n=(0,f.YB)().formatMessage({id:"pages.toolBar.edit"}),qn=(0,f.YB)().formatMessage({id:"pages.toolBar.clearMark"}),nt=(0,f.YB)().formatMessage({id:"pages.toolBar.undef"}),tt=(0,f.YB)().formatMessage({id:"pages.toolBar.divideData"}),et=(0,f.YB)().formatMessage({id:"pages.toolBar.export"});return(0,n.jsxs)(w.Z,{className:nn().det,children:[(0,n.jsxs)(X.Z,{children:[(0,n.jsx)(Mn,{active:i.curr=="rectangle",onClick:function(){if(!x.curr){I.default.error("Please choose a label category first!");return}i.setCurr("rectangle"),M(void 0)},children:Wn}),(0,n.jsx)(h.Z,{active:i.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){i.setCurr("editor")},children:_n}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){m.change(.1)},children:Hn}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){m.change(-.1)},children:zn}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){I.default.info("Annotations are saved automatically. You don't need to click save.")},children:Qn}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/move.png",active:i.curr=="mover",onClick:function(){i.setCurr("mover")},children:wn}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var a=Bn();!a||(M(a.currAnno),R(a.annos))},children:Xn}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var a=In();!a||(M(a.currAnno),R(a.annos))},children:Gn}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:qn})]}),(0,n.jsx)("div",{id:"dr",className:"mainStage",children:(0,n.jsxs)(V.Z,{tip:"loading",spinning:!!p.curr,children:[(0,n.jsx)("div",{className:"draw",children:(0,n.jsx)(xn.Z,{scale:m.curr,annotations:D,currentTool:i.curr,currentAnnotation:Z,setCurrentAnnotation:M,onAnnotationModify:gn,onAnnotationModifyComplete:function(){en({annos:D,currAnno:Z})},onMouseDown:cn.onMouseDown,onMouseMove:cn.onMouseMove,onMouseUp:cn.onMouseUp,createRectangleFunc:pn.createElementsFunc,imgSrc:u.imgSrc})}),(0,n.jsx)("div",{className:"pblock",children:(0,n.jsxs)("div",{className:"progress",children:[(0,n.jsx)(U.Z,{className:"progressBar",percent:y.progress,status:"active",showInfo:!1})," ",(0,n.jsxs)("span",{className:"progressDesc",children:["Current labeling ",c.currIdx==null?1:c.currIdx+1," of"," ",(e=c.all)===null||e===void 0?void 0:e.length,". Already labeled ",c.finished(y.progress)||0,"."]})]})}),(0,n.jsx)("div",{className:"prevTask",onClick:c.prevTask}),(0,n.jsx)("div",{className:"nextTask",onClick:c.nextTask})]})}),(0,n.jsxs)(X.Z,{disLoc:"right",children:[(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){$(!0)},children:tt}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/export.png",onClick:function(){B(!0)},children:et}),(0,n.jsx)(h.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){M(void 0)},children:nt})]}),(0,n.jsxs)("div",{className:"rightSideBar",children:[(0,n.jsx)(G.Z,{labels:x.all,activeIds:x.activeIds,onLabelSelect:function(a){x.onSelect(a),M(void 0)},onLabelModify:function(){},onLabelDelete:x.remove,onLabelAdd:function(a){return x.create((0,P.Z)((0,P.Z)({},a),{},{projectId:y.curr.projectId}))}}),(0,n.jsx)(hn.Z,{annotations:D,currAnnotation:Z,onAnnotationSelect:M,onAnnotationAdd:function(){M(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(a){Kn(a)}})]}),(0,n.jsx)(Nn,{visible:sn,splitDataset:g,project:y,onCancel:function(){$(!1)},onFinish:function(){$(!1)}}),(0,n.jsx)(kn,{visible:dn,exportDataset:j,project:y,onCancel:function(){B(!1)},onFinish:function(){B(!1)}})]})},Jn=Un},15746:function(A,O,t){"use strict";var P=t(21584);O.Z=P.Z},89032:function(A,O,t){"use strict";var P=t(38663),J=t.n(P),V=t(6999)},71230:function(A,O,t){"use strict";var P=t(92820);O.Z=P.Z},13062:function(A,O,t){"use strict";var P=t(38663),J=t.n(P),V=t(6999)}}]);
