(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[159],{13237:function(X){X.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},85024:function(X){X.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(X){X.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},26647:function(X){X.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___1FTWb",toolBarButtonContainer:"toolBarButtonContainer___1Vahn",toolBarButton:"toolBarButton___3mR2H",buttonText:"buttonText___Y0WDm",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3lRZ8",popover:"popover___3zzu2",slider:"slider___ALra-",popoverLeft:"popoverLeft___15lGe"}},8978:function(X,Q,e){"use strict";e.d(Q,{Z:function(){return se}});var K=e(11849),G=e(2824),H=e(91220),Y=e(67294),x=e(85893);function p(n){if(!n||!n.width||!n.color||!n.points||n.points.length<2||n.frontendId==null)return"";var C=n.type=="rubber"?0:n.frontendId;return"".concat(n.width,",").concat(C,",").concat(n.points.join(","))}function u(n){var C,o=n.canvasRef,m=n.annotation,g=m.result;if(!g)return(0,x.jsx)(x.Fragment,{});var L=(C=o.current)===null||C===void 0?void 0:C.getContext("2d");if(!L)return(0,x.jsx)(x.Fragment,{});for(var D=[],t=0,h=0;h<g.length;h++)g.at(h)==","?(D.push(parseFloat(g.slice(t,h))),t=h+1):g.at(h)=="|"?(D.push(parseFloat(g.slice(t,h))),a(D,L,m),D=[],t=h+1):h==g.length-1&&(D.push(parseFloat(g.slice(t,g.length))),a(D,L,m));return(0,x.jsx)(x.Fragment,{})}function a(n,C,o){var m;if(n.length<4){console.log("found incorrect points:",n);return}var g=n[0],L=n[1];if(g==0){var D;M(C,n.slice(2),(D=o.label)===null||D===void 0?void 0:D.color);return}if(L==0){d(C,g,n.slice(2),void 0);return}d(C,g,n.slice(2),(m=o.label)===null||m===void 0?void 0:m.color)}function d(n,C,o,m){n.beginPath(),n.moveTo(o[0],o[1]);for(var g=0;g<=o.length/2-1;g++){var L=o[2*g],D=o[2*g+1];n.lineTo(L,D)}n.lineCap="round",n.lineJoin="round",n.lineWidth=C,m&&(n.strokeStyle=m),n.globalCompositeOperation=m?"source-over":"destination-out",n.stroke()}function M(n,C,o){n.globalCompositeOperation=o?"source-over":"destination-out",o&&(n.fillStyle=o);for(var m=0;m<=C.length/2-1;m++){var g=C[2*m],L=C[2*m+1];n.fillRect(g,L,1,1)}}function j(n){if(!n||n.length==0)return 0;var C=0,o=(0,H.Z)(n),m;try{for(o.s();!(m=o.n()).done;){var g=m.value;g.frontendId>C&&(C=g.frontendId)}}catch(L){o.e(L)}finally{o.f()}return C}function ie(n,C){return n=="rubber"||C==2?"rubber":"brush"}function se(n){var C=(0,Y.useState)(),o=(0,G.Z)(C,2),m=o[0],g=o[1],L=function(S){var b,w;if(!(n.currentTool!="brush"&&n.currentTool!="rubber"||!((b=n.currentLabel)!==null&&b!==void 0&&b.color)||!n.brushSize)){var te=S.mouseX,U=S.mouseY,q=ie(n.currentTool,S.e.evt.button);console.log("frontendId: ",n.frontendIdOps.frontendId,"maxId:",j(n.annotations));var z=n.frontendIdOps.frontendId>0?n.frontendIdOps.frontendId:j(n.annotations)+1;z!=n.frontendIdOps.frontendId&&n.frontendIdOps.setFrontendId(z);var oe=p({width:n.brushSize||10,color:(w=n.currentLabel)===null||w===void 0?void 0:w.color,points:[te,U,te,U],type:q,frontendId:z});if(!!oe){g(q);var R={dataId:n.dataId,label:n.currentLabel,labelId:n.currentLabel.labelId,frontendId:z,result:oe,type:"brush"};n.onAnnotationAdd(R)}}},D=function(S){var b;if(!(!m||!n.currentAnnotation||!n.currentAnnotation.result||n.currentAnnotation.result.length<2||!((b=n.currentLabel)!==null&&b!==void 0&&b.color))){var w=S.mouseX,te=S.mouseY,U=n.currentAnnotation.result+",".concat(w,",").concat(te);n.onAnnotationModify((0,K.Z)((0,K.Z)({},n.currentAnnotation),{},{result:U}))}},t=function(){n.currentTool!="brush"&&n.currentTool!="rubber"||(g(void 0),n.onMouseUp())};return{onMouseDown:L,onMouseMove:D,onMouseUp:t,drawAnnotation:u}}},57406:function(X,Q,e){"use strict";e.d(Q,{pL:function(){return G},oo:function(){return H}});var K=e(91220);function G(p){var u=0;if(!p)return u;var a=(0,K.Z)(p),d;try{for(a.s();!(d=a.n()).done;){var M=d.value;!M||!M.frontendId||M.frontendId>u&&(u=M.frontendId)}}catch(j){a.e(j)}finally{a.f()}return u}function H(p){var u=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return u?{r:parseInt(u[1],16),g:parseInt(u[2],16),b:parseInt(u[3],16)}:null}function Y(p){var u=p.toString(16);return u.length==1?"0"+u:u}function x(p,u,a){return"#"+Y(p)+Y(u)+Y(a)}},14836:function(X,Q,e){"use strict";e.d(Q,{Z:function(){return t}});var K=e(54421),G=e(38272),H=e(57663),Y=e(71577),x=e(91220),p=e(67294),u=e(56159),a=e.n(u),d=e(49111),M=e(19650),j=e(2824),ie=e(11849),se=e(85024),n=e.n(se),C=e(63097),o=e(85893),m=function(S){var b=(0,ie.Z)({},S.annotation),w=(0,p.useState)(b.invisible),te=(0,j.Z)(w,2),U=te[0],q=te[1],z=(0,p.useState)(0),oe=(0,j.Z)(z,2),R=oe[0],ae=oe[1];(0,p.useEffect)(function(){q(S.annotation.invisible)},[S.annotation.invisible]);var re=(0,o.jsxs)(G.ZP.Item,{className:"".concat(n().listItem," ").concat(S.active?n().listItemActive:""),unselectable:"on",onClick:function(){S.onClick(b)},children:[(0,o.jsxs)(M.Z,{align:"center",size:5,children:[(0,o.jsx)("a",{className:n().eye,style:{backgroundImage:U?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(ve){ve.stopPropagation(),q(!U),S.onAnnotationModify(b)}})," ",(0,o.jsx)("span",{className:n().annotationId,children:b.frontendId}),(0,o.jsx)("span",{className:n().labelName,children:b.label.name}),(0,o.jsx)(C.Z,{color:b.label.color})]}),(0,o.jsx)("a",{className:n().delete,onClick:function(ve){ve.stopPropagation();var ce=new Date().getTime();ce-R<300||(ae(ce),S.onAnnotationDelete(b))}})]});return re},g=m,L=e(48971),D=function(S){var b=(0,L.YB)(),w=b.formatMessage({id:"component.PPAnnotationList.annotationList"}),te=b.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),U=new Set,q=[],z=(0,x.Z)(S.annotations),oe;try{for(z.s();!(oe=z.n()).done;){var R=oe.value;U.has(R.frontendId)||(q.push(R),U.add(R.frontendId))}}catch(ae){z.e(ae)}finally{z.f()}return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(G.ZP,{className:a().labelList,size:"large",header:(0,o.jsx)("div",{className:a().listHeader,children:w}),bordered:!0,dataSource:q,renderItem:function(re){var ee;return(0,o.jsx)(g,{onClick:S.onAnnotationSelect,annotation:re,active:re.frontendId==((ee=S.currAnnotation)===null||ee===void 0?void 0:ee.frontendId),onAnnotationDelete:S.onAnnotationDelete,onAnnotationModify:S.onAnnotationModify})},footer:(0,o.jsx)("div",{children:(0,o.jsx)(Y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){S.onAnnotationAdd()},block:!0,children:te})})})})},t=D},27992:function(X,Q,e){"use strict";var K=e(20136),G=e(55241),H=e(13062),Y=e(71230),x=e(77883),p=e(70507),u=e(89032),a=e(15746),d=e(66126),M=e(75454),j=e(2824),ie=e(67294),se=e(61541),n=e(26647),C=e.n(n),o=e(85893),m=0,g=100,L=10,D=function(h){var S=(0,ie.useState)(oe(h.size)),b=(0,j.Z)(S,2),w=b[0],te=b[1];function U(R){te(oe(R))}var q=h.minSize==null?m:h.minSize,z=h.maxSize==null?g:h.maxSize;function oe(R){return R==null?L:R<=q?q:R>=z?z:R}return(0,ie.useEffect)(function(){U(h.size)},[h.size]),(0,o.jsxs)(G.Z,{overlayClassName:"".concat(C().popover," ").concat(h.disLoc=="left"?C().popoverLeft:""),placement:h.disLoc||"right",content:(0,o.jsxs)(Y.Z,{children:[(0,o.jsx)(a.Z,{span:16,children:(0,o.jsx)(M.Z,{className:C().slider,value:w,max:z,min:q,onChange:function(ae){var re;(re=h.onChange)===null||re===void 0||re.call(0,ae)},tooltipVisible:!1})}),(0,o.jsx)(a.Z,{span:8,children:(0,o.jsx)(p.Z,{min:q,max:z,value:w,onChange:function(ae){var re;(re=h.onChange)===null||re===void 0||re.call(0,ae)},step:10})})]}),trigger:"hover",children:[" ",(0,o.jsx)(se.Z,{imgSrc:h.imgSrc||"",onClick:h.onClick,active:h.active,children:h.children})]})};Q.Z=D},10137:function(X,Q,e){"use strict";var K=e(34669),G=e(54458),H=e(67294),Y=e(85893),x=function(u){var a,d;return(0,Y.jsxs)("div",{className:"progress",children:[(0,Y.jsx)(G.Z,{className:"progressBar",percent:Math.ceil(u.project.finished/((a=u.task.all)===null||a===void 0?void 0:a.length)*100),status:"active",showInfo:!1})," ",(0,Y.jsxs)("span",{className:"progressDesc",children:["Current labeling ",u.task.currIdx==null?1:u.task.currIdx+1," of"," ",(d=u.task.all)===null||d===void 0?void 0:d.length,". Already labeled ",u.project.finished||0,"."]})]})};Q.Z=x},91861:function(X,Q,e){"use strict";e.d(Q,{Ad:function(){return Y},k3:function(){return x},Vd:function(){return p},td:function(){return u}});var K=e(34792),G=e(48086),H=40;function Y(){localStorage.removeItem("history"),x([])}function x(a){var d=localStorage.getItem("history"),M=d?JSON.parse(d):{index:-1,items:[]};if(JSON.stringify(M.items[M.index])!=JSON.stringify(a)){var j=M.index>H?M.index-H:0,ie=M.items.splice(j,M.index==0?1:M.index+1);M.items=ie.concat([a]),M.index<=H?M.index++:M.index=H+1,localStorage.setItem("history",JSON.stringify(M))}}function p(){var a=localStorage.getItem("history");if(!!a){var d=JSON.parse(a);if(!!d){if(d.index>=d.items.length-1){G.default.error("No next history!");return}return d.index++,localStorage.setItem("history",JSON.stringify(d)),d.items[d.index]}}}function u(){var a=localStorage.getItem("history");if(!!a){var d=JSON.parse(a);if(console.log("history",d),!d||!d.index||d.index<=1){G.default.error("No previous history!");return}return d.index--,localStorage.setItem("history",JSON.stringify(d)),d.items[d.index]}}},91159:function(X,Q,e){"use strict";e.r(Q),e.d(Q,{MOST_HISTORY_STEPS:function(){return Te},default:function(){return De}});var K=e(11849),G=e(57663),H=e(71577),Y=e(34792),x=e(48086),p=e(91220),u=e(2824),a=e(67294),d=e(48971),M=e(8088),j=e(61541),ie=e(44434),se=e(27992),n=e(5041),C=e(57436),o=e(14836),m=e(91861),g=e(8978),L=e(65031),D=e(57406),t=e(85893);function h(l,I){if(!(!l||!I))return I.join(",")}function S(l){var I,P=l.annotation;if(!P||!P.result||P.result.length<2||!((I=P.label)!==null&&I!==void 0&&I.color))return(0,t.jsx)(t.Fragment,{});var _=P.result.split(",").map(Number),i=P.label.color,y=(0,D.oo)(i);if(!y)return(0,t.jsx)(t.Fragment,{});var k=.3,N=void 0,T=[];return _.forEach(function(W,f){if(!N){N=W;return}T.push((0,t.jsx)(L.Cd,{onMouseDown:function(){l.currentTool=="editor"&&l.onSelect(P)},draggable:l.currentTool=="editor",onDragMove:function(Z){var c;Z.cancelBubble=!0;var A=(c=l.stageRef)===null||c===void 0?void 0:c.current,O=A.findOne(".baseImage"),le=!1,B=Z.target.x();B>O.width()/2&&(B=O.width()/2,le=!0),B<-O.width()/2&&(B=-O.width()/2,le=!0);var E=Z.target.y();E>O.height()/2&&(E=O.height()/2,le=!0),E<-O.height()/2&&(E=-O.height()/2,le=!0),le&&Z.target.setPosition({x:B,y:E}),_[f-1]=B,_[f]=E;var F=(0,K.Z)((0,K.Z)({},P),{},{result:_.join(",")});l.onDrag(F)},onMouseOver:function(){var Z;l.currentTool=="editor"&&(Z=l.stageRef)!==null&&Z!==void 0&&Z.current&&(l.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var Z;(Z=l.stageRef)!==null&&Z!==void 0&&Z.current&&(l.stageRef.current.container().style.cursor="default")},x:N,y:W,radius:5/l.scale,fill:i})),N=void 0}),(0,t.jsxs)(L.ZA,{children:[(0,t.jsx)(L.x1,{onMouseOver:function(){l.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){l.currentTool=="editor"&&l.onSelect(P)},stroke:i,strokeWidth:2/l.scale,globalCompositeOperation:"source-over",lineCap:"round",points:_,tension:0,closed:!0,fill:"rgba(".concat(y.r,", ").concat(y.g,", ").concat(y.b,", ").concat(k,")")}),T]},P.frontendId)}function b(l){var I=0;if(!l)return I;var P=(0,p.Z)(l),_;try{for(P.s();!(_=P.n()).done;){var i=_.value;!i||!i.frontendId||i.frontendId>I&&(I=i.frontendId)}}catch(y){P.e(y)}finally{P.f()}return I}function w(l){var I=function(k,N){var T,W,f=h((T=l.currentLabel)===null||T===void 0?void 0:T.color,[k,N]);!f||(console.log(f),l.onAnnotationAdd({dataId:l.dataId,type:"polygon",frontendId:b(l.annotations)+1,label:l.currentLabel,labelId:(W=l.currentLabel)===null||W===void 0?void 0:W.labelId,result:f}))},P=function(k,N){var T;if(!(!l.currentAnnotation||!l.currentAnnotation.result||!((T=l.currentLabel)!==null&&T!==void 0&&T.color))){var W=l.currentAnnotation.result+",".concat(k,",").concat(N),f=(0,K.Z)((0,K.Z)({},l.currentAnnotation),{},{result:W});l.modifyAnnoByFrontendId(f)}},_=function(k){if(l.currentTool=="polygon"){var N=k.mouseX+k.offsetX,T=k.mouseY+k.offsetY;console.log("currentAnnotation:",l.currentAnnotation),l.currentAnnotation?P(N,T):I(N,T)}},i=function(){l.currentTool=="polygon"&&l.onMouseUp&&l.onMouseUp()};return{onMouseDown:_,onMouseMove:function(){},onMouseUp:i,drawAnnotation:S}}var te=e(10137),U=e(45194),q=e(71194),z=e(50146),oe=e(47673),R=e(24044),ae=e(3182),re=e(9715),ee=e(93766),ve=e(43358),ce=e(34041),Be=e(94043),me=e.n(Be),Pe=e(37071),je=function(I){var P,_=(0,d.YB)(),i=(0,U.Gd)(a.useState),y=Pe.Z.getQueryVariable("projectId"),k=(0,U.RZ)(a.useState),N=ce.Z.Option,T=ee.Z.useForm(),W=(0,u.Z)(T,1),f=W[0];(0,a.useEffect)(function(){function c(){return A.apply(this,arguments)}function A(){return A=(0,ae.Z)(me().mark(function O(){var le,B,E;return me().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,(0,U.bo)();case 2:if(J.sent){J.next=4;break}return J.abrupt("return");case 4:if(i.getAll(),y){J.next=8;break}return x.default.error("Machine Learning settings are specific to every project. Please choose a project first."),J.abrupt("return");case 8:return J.next=10,i.getCurr(y);case 10:E=J.sent,E!=null&&(le=E.otherSettings)!==null&&le!==void 0&&le.mlBackendUrl&&k.setMlBackendUrl(E==null||(B=E.otherSettings)===null||B===void 0?void 0:B.mlBackendUrl);case 12:case"end":return J.stop()}},O)})),A.apply(this,arguments)}c()},[]),(0,a.useEffect)(function(){if(!!i.curr){var c=i.curr.otherSettings?i.curr.otherSettings:{},A=c.models&&c.perviousModel?c.models[c.perviousModel]:{},O={mlBackendUrl:c.mlBackendUrl,modelName:c.perviousModel,trainBatchSize:A.trainBatchSize};f.setFieldsValue(O),c!=null&&c.mlBackendUrl&&k.setMlBackendUrl(c.mlBackendUrl)}},[i.curr]);function ne(){if(!i.curr){x.default.error("Please choose a project first!");return}var c=f.getFieldValue("mlBackendUrl");k.setMlBackendUrl(c);var A=(0,K.Z)((0,K.Z)({},i.curr.otherSettings),{},{mlBackendUrl:c});i.update(i.curr.projectId,{otherSettings:A})}function Z(c){if(console.log("saveMlsettings",i.curr,c),!i.curr){x.default.error("Please select model first!");return}i.curr.otherSettings||(i.curr.otherSettings={});var A=i.curr.otherSettings.models?i.curr.otherSettings.models:{};A[c.modelName]=c,i.curr.otherSettings.mlBackendUrl=f.getFieldValue("mlBackendUrl"),i.curr.otherSettings.perviousModel=c.modelName,i.curr.otherSettings.models=A,i.update(i.curr.projectId,{otherSettings:i.curr.otherSettings}),x.default.info("Ml setting saved. Let's start trainig or inference!")}return(0,t.jsx)(z.Z,{title:_.formatMessage({id:"pages.toolBar.interactor"}),visible:I.visible,onCancel:I.onCancel,footer:null,children:(0,t.jsxs)(ee.Z,{form:f,layout:"horizontal",size:"large",onFinish:function(A){console.log("form finish",A),Z(A)},hidden:i.curr==null,children:[(0,t.jsxs)(R.Z.Group,{compact:!0,children:[(0,t.jsx)(ee.Z.Item,{name:"mlBackendUrl",rules:[{required:!0,message:"Please input ml backend url"}],style:{fontSize:"1.5rem"},children:(0,t.jsx)(R.Z,{allowClear:!0,addonBefore:"ML Backend URL ",style:{textAlign:"left"}})}),(0,t.jsx)(H.Z,{type:"primary",onClick:ne,children:"Set"})]}),(0,t.jsx)(ee.Z.Item,{name:"modelName",label:"Model",labelCol:{span:6},wrapperCol:{span:16},rules:[{required:!0,message:"Please select a model"}],style:{fontSize:"1.5rem"},children:(0,t.jsx)(ce.Z,{placeholder:"Select a model",children:(P=k.all)===null||P===void 0?void 0:P.map(function(c){return(0,t.jsx)(N,{value:c.name,children:c.name},c.name)})})}),(0,t.jsx)(ee.Z.Item,{name:"trainBatchSize",label:"Training Batch Size",labelCol:{span:6},wrapperCol:{span:16},style:{fontSize:"1.5rem"},children:(0,t.jsx)(R.Z,{placeholder:"Training batch size"})}),(0,t.jsxs)(ee.Z.Item,{wrapperCol:{span:16,offset:6},children:[(0,t.jsx)(H.Z,{onClick:function(){var A;(A=I.onCancel)===null||A===void 0||A.call(0),f.resetFields()},children:_.formatMessage({id:"component.PPCreater.cancel"})}),(0,t.jsx)(H.Z,{htmlType:"submit",type:"primary",style:{height:"2.5rem",width:"48%"},block:!0,children:"Save"})]})]})})},xe=je,We=e(20136),be=e(55241),$e=e(13062),_e=e(71230),Ke=e(89032),Oe=e(15746),pe=e(13237),Ie=e.n(pe),Ee=function(I){var P,_=(0,U.Gd)(a.useState),i=Pe.Z.getQueryVariable("projectId"),y=(0,U.RZ)(a.useState),k=ce.Z.Option,N=ee.Z.useForm(),T=(0,u.Z)(N,1),W=T[0];return(0,a.useEffect)(function(){function f(){return ne.apply(this,arguments)}function ne(){return ne=(0,ae.Z)(me().mark(function Z(){var c,A,O;return me().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,U.bo)();case 2:if(B.sent){B.next=4;break}return B.abrupt("return");case 4:if(_.getAll(),i){B.next=8;break}return x.default.error("Machine Learning settings are specific to every project. Please choose a project first."),B.abrupt("return");case 8:return B.next=10,_.getCurr(i);case 10:O=B.sent,O!=null&&(c=O.otherSettings)!==null&&c!==void 0&&c.mlBackendUrl&&y.setMlBackendUrl(O==null||(A=O.otherSettings)===null||A===void 0?void 0:A.mlBackendUrl);case 12:case"end":return B.stop()}},Z)})),ne.apply(this,arguments)}f()},[]),(0,a.useEffect)(function(){if(!!_.curr){var f=_.curr.otherSettings?_.curr.otherSettings:{},ne=f.models&&f.perviousModel?f.models[f.perviousModel]:{},Z={mlBackendUrl:f.mlBackendUrl,modelName:f.perviousModel,trainBatchSize:ne.trainBatchSize};W.setFieldsValue(Z),f!=null&&f.mlBackendUrl&&y.setMlBackendUrl(f.mlBackendUrl)}},[_.curr]),(0,t.jsxs)(be.Z,{overlayClassName:"".concat(Ie().popover," ").concat(Ie().popoverLeft),placement:"left",content:(0,t.jsx)(_e.Z,{children:(0,t.jsx)(Oe.Z,{span:24,children:(0,t.jsx)(ce.Z,{placeholder:"Select a model",style:{padding:"0 4px",width:"100%"},children:(P=y.all)===null||P===void 0?void 0:P.map(function(f){return(0,t.jsx)(k,{value:f.name,children:f.name},f.name)})})})}),trigger:"hover",children:[" ",(0,t.jsx)(j.Z,{imgSrc:I.imgSrc||"",onClick:I.onClick,active:I.active,children:I.children})]})},Le=Ee,Te=40,Ze=function(){var I,P=(0,a.useState)(0),_=(0,u.Z)(P,2),i=_[0],y=_[1],k=(0,a.useState)(10),N=(0,u.Z)(k,2),T=N[0],W=N[1],f=(0,a.useState)(60),ne=(0,u.Z)(f,2),Z=ne[0],c=ne[1],A=(0,a.useState)(!1),O=(0,u.Z)(A,2),le=O[0],B=O[1],E=(0,U.$L)(a.useState,a.useEffect,{effectTrigger:{postTaskChange:function(){return(0,m.Ad)()}},label:{oneHot:!0,postSelect:function(){v.setCurr(void 0),y(0)},preUnsetCurr:Ue},tool:{defaultTool:"mover"},task:{push:!0}}),F=E.tool,J=E.task,fe=E.data,ge=E.project,he=E.scale,de=E.label,v=E.annotation;function Ue(){v.setCurr(void 0),y(0),F.setCurr("mover")}var $=function(r){v.setCurr(r),r!=null&&r.frontendId?y(r.frontendId):y(0)};(0,a.useEffect)(function(){(0,m.Ad)()},[]),(0,a.useEffect)(function(){var s=setInterval(function(){var r;console.log("triggered!",fe),v.pushToBackend((r=fe.curr)===null||r===void 0?void 0:r.dataId)},2e4);return function(){clearInterval(s)}},[v,fe,fe.curr]);var Re=function(r){!r||(v.all.pop(),v.all.push(r),$(r),v.setAll(v.all))},Me=function(r){var ue=[],Ce=(0,p.Z)(v.all),ye;try{for(Ce.s();!(ye=Ce.n()).done;){var Ae=ye.value;Ae.frontendId==r.frontendId?ue.push(r):ue.push(Ae)}}catch(Ne){Ce.e(Ne)}finally{Ce.f()}$(r),v.setAll(ue)},Se={dataId:(I=fe.curr)===null||I===void 0?void 0:I.dataId,currentLabel:de.curr,brushSize:T,scale:he.curr,currentTool:F.curr,annotations:v.all,currentAnnotation:v.curr,onAnnotationAdd:function(r){var ue=v.all.concat([r]);v.setAll(ue),$(r)},onAnnotationModify:Re,modifyAnnoByFrontendId:Me,onMouseUp:function(){(0,m.k3)({annos:v.all,currAnno:v.curr})},frontendIdOps:{frontendId:i,setFrontendId:y}},V=(0,d.YB)(),Fe=(0,g.Z)(Se),ke=w(Se),ze={polygon:ke,brush:Fe};return(0,t.jsxs)(M.Z,{className:"segment",children:[(0,t.jsxs)(ie.Z,{children:[(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/polygon.png",active:F.curr=="polygon",onClick:function(){if(!de.curr){x.default.error("Please select a label first");return}F.setCurr("polygon"),$(void 0)},children:V.formatMessage({id:"pages.toolBar.polygon"})}),(0,t.jsx)(j.Z,{active:F.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){F.setCurr("editor"),$(void 0)},children:V.formatMessage({id:"pages.toolBar.edit"})}),(0,t.jsx)(se.Z,{imgSrc:"./pics/buttons/brush.png",size:T,active:F.curr=="brush",onClick:function(){if(!de.curr){x.default.error("Please select a label first");return}F.curr!="rubber"&&F.curr!="brush"&&$(void 0),F.setCurr("brush")},onChange:function(r){W(r)},children:V.formatMessage({id:"pages.toolBar.brush"})}),(0,t.jsx)(se.Z,{size:T,active:F.curr=="rubber",onClick:function(){F.curr!="rubber"&&F.curr!="brush"&&$(void 0),F.setCurr("rubber")},onChange:function(r){W(r)},imgSrc:"./pics/buttons/rubber.png",children:V.formatMessage({id:"pages.toolBar.rubber"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){he.change(.1)},children:V.formatMessage({id:"pages.toolBar.zoomIn"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){he.change(-.1)},children:V.formatMessage({id:"pages.toolBar.zoomOut"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var r;v.pushToBackend((r=fe.curr)===null||r===void 0?void 0:r.dataId)},children:V.formatMessage({id:"pages.toolBar.save"})}),(0,t.jsx)(j.Z,{active:F.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){F.setCurr("mover")},children:V.formatMessage({id:"pages.toolBar.move"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var r=(0,m.td)();r&&(v.setAll(r.annos),$(r.currAnno))},children:V.formatMessage({id:"pages.toolBar.unDo"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var r=(0,m.Vd)();r&&(v.setAll(r.annos),$(r.currAnno))},children:V.formatMessage({id:"pages.toolBar.reDo"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){v.setAll([]),v.setCurr(void 0)},children:V.formatMessage({id:"pages.toolBar.clearMark"})})]}),(0,t.jsxs)("div",{id:"dr",className:"mainStage",children:[(0,t.jsx)("div",{className:"draw",children:(0,t.jsx)(C.Z,{scale:he.curr,annotations:v.all,currentTool:F.curr,currentAnnotation:v.curr,setCurrentAnnotation:$,onAnnotationModify:Me,onAnnotationModifyComplete:function(){(0,m.k3)({annos:v.all,currAnno:v.curr})},frontendIdOps:{frontendId:i,setFrontendId:y},imgSrc:fe.imgSrc,transparency:Z,onAnnotationAdd:function(r){var ue=v.all.concat([r]);v.setAll(ue),v.curr||$(r)},drawTool:ze})}),(0,t.jsx)("div",{className:"pblock",children:(0,t.jsx)(te.Z,{task:J,project:ge})}),(0,t.jsx)("div",{className:"prevTask",onClick:function(){!J.prevTask()||$(void 0)}}),(0,t.jsx)("div",{className:"nextTask",onClick:function(){!J.nextTask()||$(void 0)}})]}),(0,t.jsxs)(ie.Z,{disLoc:"right",children:[(0,t.jsx)(Le,{imgSrc:"./pics/buttons/intelligent_interaction.png",onClick:function(){return B(!0)},children:V.formatMessage({id:"pages.toolBar.interactor"})}),(0,t.jsx)(se.Z,{imgSrc:"./pics/buttons/threshold.png",disLoc:"left",children:V.formatMessage({id:"pages.toolBar.segmentThreshold"})}),(0,t.jsx)(se.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:Z,maxSize:100,minSize:0,onChange:function(r){c(r)},children:V.formatMessage({id:"pages.toolBar.transparency"})}),(0,t.jsx)(se.Z,{imgSrc:"./pics/buttons/radius.png",disLoc:"left",children:V.formatMessage({id:"pages.toolBar.visualRadius"})}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){d.m8.push("/project_overview?projectId=".concat(ge.curr.projectId))},children:"Project Overview"}),(0,t.jsx)(j.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){d.m8.push("/ml?projectId=".concat(ge.curr.projectId))},children:"ML Settings"})]}),(0,t.jsxs)("div",{className:"rightSideBar",children:[(0,t.jsx)("div",{className:"determinOutline",children:(0,t.jsx)(H.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){$(void 0)},children:V.formatMessage({id:"pages.toolBar.determineOutline"})})}),(0,t.jsx)(n.Z,{hideColorPicker:!1,labels:de.all,activeIds:de.activeIds,onLabelSelect:de.onSelect,onLabelModify:function(){},onLabelDelete:de.remove,onLabelAdd:function(r){de.create((0,K.Z)((0,K.Z)({},r),{},{projectId:ge.curr.projectId})).then(function(ue){$(void 0),de.setCurr(ue)})}}),(0,t.jsx)(o.Z,{currAnnotation:v.curr,annotations:v.all,onAnnotationSelect:function(r){r!=null&&r.delete||$(r)},onAnnotationAdd:function(){$(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(r){v.setAll(v.all.filter(function(ue){return ue.frontendId!=r.frontendId})),$(void 0)}})]}),(0,t.jsx)(xe,{visible:le,onCancel:function(){return B(!1)}})]})},De=Ze}}]);
