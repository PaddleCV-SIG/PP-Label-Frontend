(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[690],{13237:function(J){J.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},85024:function(J){J.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(J){J.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},26647:function(J){J.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___1FTWb",toolBarButtonContainer:"toolBarButtonContainer___1Vahn",toolBarButton:"toolBarButton___3mR2H",buttonText:"buttonText___Y0WDm",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3lRZ8",popover:"popover___3zzu2",slider:"slider___ALra-",popoverLeft:"popoverLeft___15lGe"}},8978:function(J,Q,n){"use strict";n.d(Q,{Z:function(){return an}});var X=n(11849),G=n(2824),w=n(91220),H=n(67294),D=n(85893);function L(e){if(!e||!e.width||!e.color||!e.points||e.points.length<2||e.frontendId==null)return"";var M=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(M,",").concat(e.points.join(","))}function d(e){var M,i=e.canvasRef,I=e.annotation,P=I.result;if(!P)return(0,D.jsx)(D.Fragment,{});var Z=(M=i.current)===null||M===void 0?void 0:M.getContext("2d");if(!Z)return(0,D.jsx)(D.Fragment,{});for(var R=[],o=0,v=0;v<P.length;v++)P.at(v)==","?(R.push(parseFloat(P.slice(o,v))),o=v+1):P.at(v)=="|"?(R.push(parseFloat(P.slice(o,v))),l(R,Z,I),R=[],o=v+1):v==P.length-1&&(R.push(parseFloat(P.slice(o,P.length))),l(R,Z,I));return(0,D.jsx)(D.Fragment,{})}function l(e,M,i){var I;if(e.length<4){console.log("found incorrect points:",e);return}var P=e[0],Z=e[1];if(P==0){var R;x(M,e.slice(2),(R=i.label)===null||R===void 0?void 0:R.color);return}if(Z==0){f(M,P,e.slice(2),void 0);return}f(M,P,e.slice(2),(I=i.label)===null||I===void 0?void 0:I.color)}function f(e,M,i,I){e.beginPath(),e.moveTo(i[0],i[1]);for(var P=0;P<=i.length/2-1;P++){var Z=i[2*P],R=i[2*P+1];e.lineTo(Z,R)}e.lineCap="round",e.lineJoin="round",e.lineWidth=M,I&&(e.strokeStyle=I),e.globalCompositeOperation=I?"source-over":"destination-out",e.stroke()}function x(e,M,i){e.globalCompositeOperation=i?"source-over":"destination-out",i&&(e.fillStyle=i);for(var I=0;I<=M.length/2-1;I++){var P=M[2*I],Z=M[2*I+1];e.fillRect(P,Z,1,1)}}function E(e){if(!e||e.length==0)return 0;var M=0,i=(0,w.Z)(e),I;try{for(i.s();!(I=i.n()).done;){var P=I.value;P.frontendId>M&&(M=P.frontendId)}}catch(Z){i.e(Z)}finally{i.f()}return M}function rn(e,M){return e=="rubber"||M==2?"rubber":"brush"}function an(e){var M=(0,H.useState)(),i=(0,G.Z)(M,2),I=i[0],P=i[1],Z=function(_){var T,q;if(!(e.currentTool!="brush"&&e.currentTool!="rubber"||!((T=e.currentLabel)!==null&&T!==void 0&&T.color)||!e.brushSize)){var tn=_.mouseX,F=_.mouseY,ln=rn(e.currentTool,_.e.evt.button);console.log("frontendId: ",e.frontendIdOps.frontendId,"maxId:",E(e.annotations));var z=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:E(e.annotations)+1;z!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(z);var nn=L({width:e.brushSize||10,color:(q=e.currentLabel)===null||q===void 0?void 0:q.color,points:[tn,F,tn,F],type:ln,frontendId:z});if(!!nn){P(ln);var en={dataId:e.dataId,label:e.currentLabel,labelId:e.currentLabel.labelId,frontendId:z,result:nn,type:"brush"};e.onAnnotationAdd(en)}}},R=function(_){var T;if(!(!I||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((T=e.currentLabel)!==null&&T!==void 0&&T.color))){var q=_.mouseX,tn=_.mouseY,F=e.currentAnnotation.result+",".concat(q,",").concat(tn);e.onAnnotationModify((0,X.Z)((0,X.Z)({},e.currentAnnotation),{},{result:F}))}},o=function(){e.currentTool!="brush"&&e.currentTool!="rubber"||(P(void 0),e.onMouseUp())};return{onMouseDown:Z,onMouseMove:R,onMouseUp:o,drawAnnotation:d}}},57406:function(J,Q,n){"use strict";n.d(Q,{pL:function(){return G},oo:function(){return w}});var X=n(91220);function G(L){var d=0;if(!L)return d;var l=(0,X.Z)(L),f;try{for(l.s();!(f=l.n()).done;){var x=f.value;!x||!x.frontendId||x.frontendId>d&&(d=x.frontendId)}}catch(E){l.e(E)}finally{l.f()}return d}function w(L){var d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(L);return d?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)}:null}function H(L){var d=L.toString(16);return d.length==1?"0"+d:d}function D(L,d,l){return"#"+H(L)+H(d)+H(l)}},14836:function(J,Q,n){"use strict";n.d(Q,{Z:function(){return o}});var X=n(54421),G=n(38272),w=n(57663),H=n(71577),D=n(91220),L=n(67294),d=n(56159),l=n.n(d),f=n(49111),x=n(19650),E=n(2824),rn=n(11849),an=n(85024),e=n.n(an),M=n(63097),i=n(85893),I=function(_){var T=(0,rn.Z)({},_.annotation),q=(0,L.useState)(T.invisible),tn=(0,E.Z)(q,2),F=tn[0],ln=tn[1],z=(0,L.useState)(0),nn=(0,E.Z)(z,2),en=nn[0],k=nn[1];(0,L.useEffect)(function(){ln(_.annotation.invisible)},[_.annotation.invisible]);var dn=(0,i.jsxs)(G.ZP.Item,{className:"".concat(e().listItem," ").concat(_.active?e().listItemActive:""),unselectable:"on",onClick:function(){_.onClick(T)},children:[(0,i.jsxs)(x.Z,{align:"center",size:5,children:[(0,i.jsx)("a",{className:e().eye,style:{backgroundImage:F?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(gn){gn.stopPropagation(),ln(!F),_.onAnnotationModify(T)}})," ",(0,i.jsx)("span",{className:e().annotationId,children:T.frontendId}),(0,i.jsx)("span",{className:e().labelName,children:T.label.name}),(0,i.jsx)(M.Z,{color:T.label.color})]}),(0,i.jsx)("a",{className:e().delete,onClick:function(gn){gn.stopPropagation();var vn=new Date().getTime();vn-en<300||(k(vn),_.onAnnotationDelete(T))}})]});return dn},P=I,Z=n(48971),R=function(_){var T=(0,Z.YB)(),q=T.formatMessage({id:"component.PPAnnotationList.annotationList"}),tn=T.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),F=new Set,ln=[],z=(0,D.Z)(_.annotations),nn;try{for(z.s();!(nn=z.n()).done;){var en=nn.value;F.has(en.frontendId)||(ln.push(en),F.add(en.frontendId))}}catch(k){z.e(k)}finally{z.f()}return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(G.ZP,{className:l().labelList,size:"large",header:(0,i.jsx)("div",{className:l().listHeader,children:q}),bordered:!0,dataSource:ln,renderItem:function(dn){var p;return(0,i.jsx)(P,{onClick:_.onAnnotationSelect,annotation:dn,active:dn.frontendId==((p=_.currAnnotation)===null||p===void 0?void 0:p.frontendId),onAnnotationDelete:_.onAnnotationDelete,onAnnotationModify:_.onAnnotationModify})},footer:function(){return _.onAnnotationAdd?(0,i.jsx)("div",{children:(0,i.jsx)(H.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){_.onAnnotationAdd()},block:!0,children:tn})}):(0,i.jsx)("div",{})}})})},o=R},27992:function(J,Q,n){"use strict";var X=n(20136),G=n(55241),w=n(13062),H=n(71230),D=n(77883),L=n(70507),d=n(89032),l=n(15746),f=n(66126),x=n(75454),E=n(2824),rn=n(67294),an=n(61541),e=n(26647),M=n.n(e),i=n(85893),I=0,P=100,Z=10,R=function(v){var _=(0,rn.useState)(en(v.size)),T=(0,E.Z)(_,2),q=T[0],tn=T[1];function F(k){tn(en(k))}var ln=v.step?v.step:10,z=v.minSize==null?I:v.minSize,nn=v.maxSize==null?P:v.maxSize;function en(k){return k==null?Z:k<=z?z:k>=nn?nn:k}return(0,rn.useEffect)(function(){F(v.size)},[v.size]),(0,i.jsxs)(G.Z,{overlayClassName:"".concat(M().popover," ").concat(v.disLoc=="left"?M().popoverLeft:""),placement:v.disLoc||"right",content:(0,i.jsxs)(H.Z,{children:[(0,i.jsx)(l.Z,{span:16,children:(0,i.jsx)(x.Z,{className:M().slider,value:q,max:nn,min:z,onChange:function(dn){var p;(p=v.onChange)===null||p===void 0||p.call(0,dn)},tooltipVisible:!1})}),(0,i.jsx)(l.Z,{span:8,children:(0,i.jsx)(L.Z,{min:z,max:nn,value:q,onChange:function(dn){var p;(p=v.onChange)===null||p===void 0||p.call(0,dn)},step:ln})})]}),trigger:"hover",children:[" ",(0,i.jsx)(an.Z,{imgSrc:v.imgSrc||"",onClick:v.onClick,active:v.active,children:v.children})]})};Q.Z=R},10137:function(J,Q,n){"use strict";var X=n(34669),G=n(54458),w=n(67294),H=n(85893),D=function(d){var l,f;return(0,H.jsxs)("div",{className:"progress",children:[(0,H.jsx)(G.Z,{className:"progressBar",percent:Math.ceil(d.project.finished/((l=d.task.all)===null||l===void 0?void 0:l.length)*100),status:"active",showInfo:!1})," ",(0,H.jsxs)("span",{className:"progressDesc",children:["Current labeling ",d.task.currIdx==null?1:d.task.currIdx+1," of"," ",(f=d.task.all)===null||f===void 0?void 0:f.length,". Already labeled ",d.project.finished||0,"."]})]})};Q.Z=D},91861:function(J,Q,n){"use strict";n.d(Q,{Ad:function(){return H},k3:function(){return D},Vd:function(){return L},td:function(){return d}});var X=n(34792),G=n(48086),w=40;function H(){localStorage.removeItem("history"),D([])}function D(l){var f=localStorage.getItem("history"),x=f?JSON.parse(f):{index:-1,items:[]};if(JSON.stringify(x.items[x.index])!=JSON.stringify(l)){var E=x.index>w?x.index-w:0,rn=x.items.splice(E,x.index==0?1:x.index+1);x.items=rn.concat([l]),x.index<=w?x.index++:x.index=w+1,localStorage.setItem("history",JSON.stringify(x))}}function L(){var l=localStorage.getItem("history");if(!!l){var f=JSON.parse(l);if(!!f){if(f.index>=f.items.length-1){G.default.error("No next history!");return}return f.index++,localStorage.setItem("history",JSON.stringify(f)),f.items[f.index]}}}function d(){var l=localStorage.getItem("history");if(!!l){var f=JSON.parse(l);if(console.log("history",f),!f||!f.index||f.index<=1){G.default.error("No previous history!");return}return f.index--,localStorage.setItem("history",JSON.stringify(f)),f.items[f.index]}}},1690:function(J,Q,n){"use strict";n.r(Q),n.d(Q,{MOST_HISTORY_STEPS:function(){return Tn},default:function(){return Zn}});var X=n(11849),G=n(57663),w=n(71577),H=n(34792),D=n(48086),L=n(91220),d=n(2824),l=n(67294),f=n(48971),x=n(8088),E=n(61541),rn=n(44434),an=n(27992),e=n(5041),M=n(57436),i=n(14836),I=n(91861),P=n(8978),Z=n(65031),R=n(57406),o=n(85893);function v(t,u){if(!(!t||!u))return u.join(",")}function _(t){var u,r=t.annotation;if(!r||!r.result||r.result.length<2||!((u=r.label)!==null&&u!==void 0&&u.color))return(0,o.jsx)(o.Fragment,{});var m=r.result.split(",").map(Number),y=r.label.color,g=(0,R.oo)(y);if(!g)return(0,o.jsx)(o.Fragment,{});var U=.3,b=void 0,O=[];return m.forEach(function(s,S){if(!b){b=s;return}O.push((0,o.jsx)(Z.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(r)},draggable:t.currentTool=="editor",onDragMove:function(C){var V;C.cancelBubble=!0;var K=(V=t.stageRef)===null||V===void 0?void 0:V.current,W=K.findOne(".baseImage"),A=!1,sn=C.target.x();sn>W.width()/2&&(sn=W.width()/2,A=!0),sn<-W.width()/2&&(sn=-W.width()/2,A=!0);var $=C.target.y();$>W.height()/2&&($=W.height()/2,A=!0),$<-W.height()/2&&($=-W.height()/2,A=!0),A&&C.target.setPosition({x:sn,y:$}),m[S-1]=sn,m[S]=$;var B=(0,X.Z)((0,X.Z)({},r),{},{result:m.join(",")});t.onDrag(B)},onMouseOver:function(){var C;t.currentTool=="editor"&&(C=t.stageRef)!==null&&C!==void 0&&C.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var C;(C=t.stageRef)!==null&&C!==void 0&&C.current&&(t.stageRef.current.container().style.cursor="default")},x:b,y:s,radius:5/t.scale,fill:y})),b=void 0}),(0,o.jsxs)(Z.ZA,{children:[(0,o.jsx)(Z.x1,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(r)},stroke:y,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",points:m,tension:0,closed:!0,fill:"rgba(".concat(g.r,", ").concat(g.g,", ").concat(g.b,", ").concat(U,")")}),O]},r.frontendId)}function T(t){var u=0;if(!t)return u;var r=(0,L.Z)(t),m;try{for(r.s();!(m=r.n()).done;){var y=m.value;!y||!y.frontendId||y.frontendId>u&&(u=y.frontendId)}}catch(g){r.e(g)}finally{r.f()}return u}function q(t){var u=function(U,b){var O,s,S=v((O=t.currentLabel)===null||O===void 0?void 0:O.color,[U,b]);!S||(console.log(S),t.onAnnotationAdd({dataId:t.dataId,type:"polygon",frontendId:T(t.annotations)+1,label:t.currentLabel,labelId:(s=t.currentLabel)===null||s===void 0?void 0:s.labelId,result:S}))},r=function(U,b){var O;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((O=t.currentLabel)!==null&&O!==void 0&&O.color))){var s=t.currentAnnotation.result+",".concat(U,",").concat(b),S=(0,X.Z)((0,X.Z)({},t.currentAnnotation),{},{result:s});t.modifyAnnoByFrontendId(S)}},m=function(U){if(t.currentTool=="polygon"){var b=U.mouseX+U.offsetX,O=U.mouseY+U.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?r(b,O):u(b,O)}},y=function(){t.currentTool=="polygon"&&t.onMouseUp&&t.onMouseUp()};return{onMouseDown:m,onMouseMove:function(){},onMouseUp:y,drawAnnotation:_}}var tn=n(10137),F=n(94038),ln=n(20136),z=n(55241),nn=n(47673),en=n(24044),k=n(3182),dn=n(9715),p=n(93766),gn=n(94043),vn=n.n(gn),yn=n(37071),Sn=n(13237),Mn=n.n(Sn),xn=function(u){var r=(0,F.Gd)(l.useState),m=yn.Z.getQueryVariable("projectId"),y=(0,F.RZ)(l.useState),g=p.Z.useForm(),U=(0,d.Z)(g,1),b=U[0];(0,l.useEffect)(function(){function s(){return S.apply(this,arguments)}function S(){return S=(0,k.Z)(vn().mark(function j(){var C,V,K;return vn().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,F.bo)();case 2:if(A.sent){A.next=4;break}return A.abrupt("return");case 4:if(r.getAll(),m){A.next=8;break}return D.default.error("Machine Learning settings are specific to every project. Please choose a project first."),A.abrupt("return");case 8:return A.next=10,r.getCurr(m);case 10:K=A.sent,K!=null&&(C=K.otherSettings)!==null&&C!==void 0&&C.mlBackendUrl&&y.setMlBackendUrl(K==null||(V=K.otherSettings)===null||V===void 0?void 0:V.mlBackendUrl);case 12:case"end":return A.stop()}},j)})),S.apply(this,arguments)}s()},[]),(0,l.useEffect)(function(){if(!!r.curr){var s=r.curr.otherSettings?r.curr.otherSettings:{},S=s.models&&s.perviousModel?s.models[s.perviousModel]:{},j={mlBackendUrl:s.mlBackendUrl,modelName:s.perviousModel,trainBatchSize:S.trainBatchSize};b.setFieldsValue(j),s!=null&&s.mlBackendUrl&&y.setMlBackendUrl(s.mlBackendUrl)}},[r.curr]);function O(s){if(console.log("saveMlsettings",r.curr,s),!r.curr){D.default.error("Please select project first!");return}r.curr.otherSettings||(r.curr.otherSettings={}),r.curr.otherSettings.mlBackendUrl=b.getFieldValue("mlBackendUrl"),r.curr.otherSettings.mlModelAbsPath=b.getFieldValue("mlModelAbsPath"),r.curr.otherSettings.mlWeightAbsPath=b.getFieldValue("mlWeightAbsPath"),r.curr.otherSettings.perviousModel=s.modelName,r.update(r.curr.projectId,{otherSettings:r.curr.otherSettings}),D.default.info("Ml setting saved. Let's start trainig or inference!")}return(0,o.jsxs)(z.Z,{overlayClassName:"".concat(Mn().popover," ").concat(Mn().popoverLeft),placement:"left",content:(0,o.jsxs)(p.Z,{form:b,layout:"horizontal",size:"large",onFinish:function(S){console.log("form finish",S),O(S)},hidden:r.curr==null,children:[(0,o.jsx)(p.Z.Item,{name:"mlBackendUrl",label:"ML Backend URL",labelCol:{span:6},wrapperCol:{span:18},initialValue:"http://127.0.0.1:1234/model",style:{fontSize:"1.5rem"},children:(0,o.jsx)(en.Z,{placeholder:"http://127.0.0.1:1234/model"})}),(0,o.jsx)(p.Z.Item,{name:"mlModelAbsPath",label:"Model Path",labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"},children:(0,o.jsx)(en.Z,{placeholder:"Absolute path"})}),(0,o.jsx)(p.Z.Item,{name:"mlWeightAbsPath",label:"Weight Path",labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"},children:(0,o.jsx)(en.Z,{placeholder:"Absolute path"})}),(0,o.jsx)(p.Z.Item,{wrapperCol:{span:16,offset:6},children:(0,o.jsx)(w.Z,{htmlType:"submit",type:"primary",style:{height:"2.5rem",width:"48%"},block:!0,children:"Save"})})]}),trigger:"hover",children:[" ",(0,o.jsx)(E.Z,{imgSrc:u.imgSrc||"",onClick:u.onClick,active:u.active,children:u.children})]})},Bn=xn;function On(t){var u,r,m=t.canvasRef,y=t.annotation,g=y.result;if(!g)return(0,o.jsx)(o.Fragment,{});var U=(u=m.current)===null||u===void 0?void 0:u.getContext("2d");if(!U)return(0,o.jsx)(o.Fragment,{});for(var b=((r=m.current)===null||r===void 0?void 0:r.width)||0,O=t.threshold?t.threshold:.5,s=[],S=0,j=0,C=0;C<g.length;C++)if(g.at(C)==","){j++;var V=parseFloat(g.slice(S,C));V>=O&&s.push(Math.floor(j/b),j%b),S=C+1}else if(C==g.length-1){j++;var K=parseFloat(g.slice(S,C));K>=O&&s.push(Math.floor(j/b),j%b),jn(s,U,y)}return(0,o.jsx)(o.Fragment,{})}function jn(t,u,r){var m;if(t.length<4){console.log("found incorrect points:",t);return}Ln(u,t.slice(2),(m=r.label)===null||m===void 0?void 0:m.color)}function Ln(t,u,r){t.globalCompositeOperation=r?"source-over":"destination-out",r&&(t.fillStyle=r);for(var m=0;m<=u.length/2-1;m++){var y=u[2*m],g=u[2*m+1];t.fillRect(y,g,1,1)}}function Cn(t){if(!t||t.length==0)return 0;var u=0,r=(0,L.Z)(t),m;try{for(r.s();!(m=r.n()).done;){var y=m.value;y.frontendId>u&&(u=y.frontendId)}}catch(g){r.e(g)}finally{r.f()}return u}function En(t){var u=(0,l.useState)([]),r=(0,d.Z)(u,2),m=r[0],y=r[1],g=(0,F.RZ)(l.useState),U=function(){var s=(0,k.Z)(vn().mark(function S(j){var C,V,K,W,A,sn,$,B,mn;return vn().wrap(function(on){for(;;)switch(on.prev=on.next){case 0:if(!(t.currentTool!="interactor"||!((C=t.currentLabel)!==null&&C!==void 0&&C.color))){on.next=2;break}return on.abrupt("return");case 2:if(V=j.mouseX,K=j.mouseY,console.log("frontendId: ",t.frontendIdOps.frontendId,"maxId:",Cn(t.annotations)),W=t.frontendIdOps.frontendId>0?t.frontendIdOps.frontendId:Cn(t.annotations)+1,W!=t.frontendIdOps.frontendId&&t.frontendIdOps.setFrontendId(W),A=m,j.e.evt.button==2?A=A.concat([V,K,!1]):A=A.concat([V,K,!0]),y(A),console.log(A,t.currentLabel.color),!(!A.length||!j.stageRef.current||W==null)){on.next=13;break}return on.abrupt("return");case 13:return sn=j.stageRef.current,$=sn.findOne(".baseImage").toDataURL().slice(22),on.next=17,g.predict({format:"b64",img:$,other:{clicks:A}});case 17:B=on.sent,console.log(B),mn={dataId:t.dataId,label:t.currentLabel,labelId:t.currentLabel.labelId,frontendId:W,result:B,type:"brush"},t.onAnnotationAdd(mn);case 21:case"end":return on.stop()}},S)}));return function(j){return s.apply(this,arguments)}}(),b=function(){},O=function(){t.currentTool=="interactor"&&t.onMouseUp()};return{onMouseDown:U,onMouseMove:b,onMouseUp:O,drawAnnotation:On}}var Tn=40,Dn=function(){var u,r=(0,l.useState)(0),m=(0,d.Z)(r,2),y=m[0],g=m[1],U=(0,l.useState)(10),b=(0,d.Z)(U,2),O=b[0],s=b[1],S=(0,l.useState)(.5),j=(0,d.Z)(S,2),C=j[0],V=j[1],K=(0,l.useState)(60),W=(0,d.Z)(K,2),A=W[0],sn=W[1],$=(0,F.$L)(l.useState,l.useEffect,{effectTrigger:{postTaskChange:function(){return(0,I.Ad)()}},label:{oneHot:!0,postSelect:function(){h.setCurr(void 0),g(0)},preUnsetCurr:pn},tool:{defaultTool:"mover"},task:{push:!0}}),B=$.tool,mn=$.task,fn=$.data,on=$.project,hn=$.scale,cn=$.label,h=$.annotation;function pn(){h.setCurr(void 0),g(0),B.setCurr("mover")}var N=function(a){h.setCurr(a),a!=null&&a.frontendId?g(a.frontendId):g(0)};(0,l.useEffect)(function(){(0,I.Ad)()},[]),(0,l.useEffect)(function(){var c=setInterval(function(){var a;console.log("triggered!",fn),h.pushToBackend((a=fn.curr)===null||a===void 0?void 0:a.dataId)},2e4);return function(){clearInterval(c)}},[h,fn,fn.curr]);var Rn=function(a){!a||(h.all.pop(),h.all.push(a),N(a),h.setAll(h.all))},An=function(a){var un=[],In=(0,L.Z)(h.all),bn;try{for(In.s();!(bn=In.n()).done;){var _n=bn.value;_n.frontendId==a.frontendId?un.push(a):un.push(_n)}}catch(Fn){In.e(Fn)}finally{In.f()}N(a),h.setAll(un)},Pn={dataId:(u=fn.curr)===null||u===void 0?void 0:u.dataId,currentLabel:cn.curr,brushSize:O,scale:hn.curr,currentTool:B.curr,annotations:h.all,currentAnnotation:h.curr,onAnnotationAdd:function(a){var un=h.all.concat([a]);h.setAll(un),N(a)},onAnnotationModify:Rn,modifyAnnoByFrontendId:An,onMouseUp:function(){(0,I.k3)({annos:h.all,currAnno:h.curr})},frontendIdOps:{frontendId:y,setFrontendId:g}},Y=(0,f.YB)(),Un={polygon:q(Pn),brush:(0,P.Z)(Pn),interactor:En(Pn)};return(0,o.jsxs)(x.Z,{className:"segment",children:[(0,o.jsxs)(rn.Z,{children:[(0,o.jsx)(E.Z,{imgSrc:"./pics/buttons/polygon.png",active:B.curr=="polygon",onClick:function(){if(!cn.curr){D.default.error("Please select a label first");return}B.setCurr("polygon"),N(void 0)},children:Y.formatMessage({id:"pages.toolBar.polygon"})}),(0,o.jsx)(E.Z,{active:B.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){B.setCurr("editor"),N(void 0)},children:Y.formatMessage({id:"pages.toolBar.edit"})}),(0,o.jsx)(an.Z,{imgSrc:"./pics/buttons/brush.png",size:O,active:B.curr=="brush",onClick:function(){if(!cn.curr){D.default.error("Please select a label first");return}B.curr!="rubber"&&B.curr!="brush"&&N(void 0),B.setCurr("brush")},onChange:function(a){s(a)},children:Y.formatMessage({id:"pages.toolBar.brush"})}),(0,o.jsx)(an.Z,{size:O,active:B.curr=="rubber",onClick:function(){B.curr!="rubber"&&B.curr!="brush"&&N(void 0),B.setCurr("rubber")},onChange:function(a){s(a)},imgSrc:"./pics/buttons/rubber.png",children:Y.formatMessage({id:"pages.toolBar.rubber"})}),(0,o.jsx)(E.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){hn.change(.1)},children:Y.formatMessage({id:"pages.toolBar.zoomIn"})}),(0,o.jsx)(E.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){hn.change(-.1)},children:Y.formatMessage({id:"pages.toolBar.zoomOut"})}),(0,o.jsx)(E.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var a;h.pushToBackend((a=fn.curr)===null||a===void 0?void 0:a.dataId)},children:Y.formatMessage({id:"pages.toolBar.save"})}),(0,o.jsx)(E.Z,{active:B.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){B.setCurr("mover")},children:Y.formatMessage({id:"pages.toolBar.move"})}),(0,o.jsx)(E.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var a=(0,I.td)();a&&(h.setAll(a.annos),N(a.currAnno))},children:Y.formatMessage({id:"pages.toolBar.unDo"})}),(0,o.jsx)(E.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var a=(0,I.Vd)();a&&(h.setAll(a.annos),N(a.currAnno))},children:Y.formatMessage({id:"pages.toolBar.reDo"})}),(0,o.jsx)(E.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){h.setAll([]),h.setCurr(void 0)},children:Y.formatMessage({id:"pages.toolBar.clearMark"})})]}),(0,o.jsxs)("div",{id:"dr",className:"mainStage",children:[(0,o.jsx)("div",{className:"draw",children:(0,o.jsx)(M.Z,{scale:hn.curr,annotations:h.all,currentTool:B.curr,currentAnnotation:h.curr,setCurrentAnnotation:N,onAnnotationModify:An,onAnnotationModifyComplete:function(){(0,I.k3)({annos:h.all,currAnno:h.curr})},frontendIdOps:{frontendId:y,setFrontendId:g},imgSrc:fn.imgSrc,transparency:A,threshold:C,onAnnotationAdd:function(a){var un=h.all.concat([a]);h.setAll(un),h.curr||N(a)},drawTool:Un})}),(0,o.jsx)("div",{className:"pblock",children:(0,o.jsx)(tn.Z,{task:mn,project:on})}),(0,o.jsx)("div",{className:"prevTask",onClick:function(){!mn.prevTask()||N(void 0)}}),(0,o.jsx)("div",{className:"nextTask",onClick:function(){!mn.nextTask()||N(void 0)}})]}),(0,o.jsxs)(rn.Z,{disLoc:"right",children:[(0,o.jsx)(Bn,{imgSrc:"./pics/buttons/intelligent_interaction.png",active:B.curr=="interactor",onClick:function(){B.setCurr("interactor")},children:Y.formatMessage({id:"pages.toolBar.interactor"})}),(0,o.jsx)(an.Z,{imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:C,maxSize:1,minSize:.1,step:.1,onChange:function(a){V(a)},children:Y.formatMessage({id:"pages.toolBar.segmentThreshold"})}),(0,o.jsx)(an.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:A,maxSize:100,minSize:0,onChange:function(a){sn(a)},children:Y.formatMessage({id:"pages.toolBar.transparency"})}),(0,o.jsx)(an.Z,{imgSrc:"./pics/buttons/radius.png",disLoc:"left",children:Y.formatMessage({id:"pages.toolBar.visualRadius"})}),(0,o.jsx)(E.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){f.m8.push("/project_overview?projectId=".concat(on.curr.projectId))},children:"Project Overview"})]}),(0,o.jsxs)("div",{className:"rightSideBar",children:[(0,o.jsx)("div",{className:"determinOutline",children:(0,o.jsx)(w.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){N(void 0)},children:Y.formatMessage({id:"pages.toolBar.determineOutline"})})}),(0,o.jsx)(e.Z,{hideColorPicker:!1,labels:cn.all,activeIds:cn.activeIds,onLabelSelect:cn.onSelect,onLabelModify:function(){},onLabelDelete:cn.remove,onLabelAdd:function(a){cn.create((0,X.Z)((0,X.Z)({},a),{},{projectId:on.curr.projectId})).then(function(un){N(void 0),cn.setCurr(un)})}}),(0,o.jsx)(i.Z,{currAnnotation:h.curr,annotations:h.all,onAnnotationSelect:function(a){a!=null&&a.delete||N(a)},onAnnotationAdd:function(){N(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(a){h.setAll(h.all.filter(function(un){return un.frontendId!=a.frontendId})),N(void 0)}})]})]})},Zn=Dn}}]);
