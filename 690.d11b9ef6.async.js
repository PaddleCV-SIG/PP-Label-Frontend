(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[690],{13237:function(Y){Y.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},85024:function(Y){Y.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(Y){Y.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},26647:function(Y){Y.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___1FTWb",toolBarButtonContainer:"toolBarButtonContainer___1Vahn",toolBarButton:"toolBarButton___3mR2H",buttonText:"buttonText___Y0WDm",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3lRZ8",popover:"popover___3zzu2",slider:"slider___ALra-",popoverLeft:"popoverLeft___15lGe"}},8978:function(Y,V,n){"use strict";n.d(V,{Z:function(){return a0}});var N=n(11849),X=n(2824),J=n(91220),F=n(67294),D=n(85893);function y(e){if(!e||!e.width||!e.color||!e.points||e.points.length<2||e.frontendId==null)return"";var A=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(A,",").concat(e.points.join(","))}function f(e){var A,a=e.canvasRef,M=e.annotation,C=M.result;if(!C)return(0,D.jsx)(D.Fragment,{});var T=(A=a.current)===null||A===void 0?void 0:A.getContext("2d");if(!T)return(0,D.jsx)(D.Fragment,{});for(var Z=[],r=0,P=0;P<C.length;P++)C.at(P)==","?(Z.push(parseFloat(C.slice(r,P))),r=P+1):C.at(P)=="|"?(Z.push(parseFloat(C.slice(r,P))),u(Z,T,M),Z=[],r=P+1):P==C.length-1&&(Z.push(parseFloat(C.slice(r,C.length))),u(Z,T,M));return(0,D.jsx)(D.Fragment,{})}function u(e,A,a){var M;if(e.length<4){console.log("found incorrect points:",e);return}var C=e[0],T=e[1];if(C==0){var Z;x(A,e.slice(2),(Z=a.label)===null||Z===void 0?void 0:Z.color);return}if(T==0){v(A,C,e.slice(2),void 0);return}v(A,C,e.slice(2),(M=a.label)===null||M===void 0?void 0:M.color)}function v(e,A,a,M){e.beginPath(),e.moveTo(a[0],a[1]);for(var C=0;C<=a.length/2-1;C++){var T=a[2*C],Z=a[2*C+1];e.lineTo(T,Z)}e.lineCap="round",e.lineJoin="round",e.lineWidth=A,M&&(e.strokeStyle=M),e.globalCompositeOperation=M?"source-over":"destination-out",e.stroke()}function x(e,A,a){console.log("renderPixel: ",A,a,e),e.globalCompositeOperation=a?"source-over":"destination-out",a&&(e.fillStyle=a);for(var M=0;M<=A.length/2-1;M++){var C=A[2*M],T=A[2*M+1];e.fillRect(C,T,1,1)}}function B(e){if(!e||e.length==0)return 0;var A=0,a=(0,J.Z)(e),M;try{for(a.s();!(M=a.n()).done;){var C=M.value;C.frontendId>A&&(A=C.frontendId)}}catch(T){a.e(T)}finally{a.f()}return A}function o0(e,A){return e=="rubber"||A==2?"rubber":"brush"}function a0(e){var A=(0,F.useState)(),a=(0,X.Z)(A,2),M=a[0],C=a[1],T=function(S){var O,Q;if(!(e.currentTool!="brush"&&e.currentTool!="rubber"||!((O=e.currentLabel)!==null&&O!==void 0&&O.color)||!e.brushSize)){var e0=S.mouseX,k=S.mouseY,l0=o0(e.currentTool,S.e.evt.button);console.log("frontendId: ",e.frontendIdOps.frontendId,"maxId:",B(e.annotations));var R=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:B(e.annotations)+1;R!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(R);var G=y({width:e.brushSize||10,color:(Q=e.currentLabel)===null||Q===void 0?void 0:Q.color,points:[e0,k,e0,k],type:l0,frontendId:R});if(!!G){C(l0);var w={dataId:e.dataId,label:e.currentLabel,labelId:e.currentLabel.labelId,frontendId:R,result:G,type:"brush"};e.onAnnotationAdd(w)}}},Z=function(S){var O;if(!(!M||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((O=e.currentLabel)!==null&&O!==void 0&&O.color))){var Q=S.mouseX,e0=S.mouseY,k=e.currentAnnotation.result+",".concat(Q,",").concat(e0);e.onAnnotationModify((0,N.Z)((0,N.Z)({},e.currentAnnotation),{},{result:k}))}},r=function(){e.currentTool!="brush"&&e.currentTool!="rubber"||(C(void 0),e.onMouseUp())};return{onMouseDown:T,onMouseMove:Z,onMouseUp:r,drawAnnotation:f}}},57406:function(Y,V,n){"use strict";n.d(V,{pL:function(){return X},oo:function(){return J}});var N=n(91220);function X(y){var f=0;if(!y)return f;var u=(0,N.Z)(y),v;try{for(u.s();!(v=u.n()).done;){var x=v.value;!x||!x.frontendId||x.frontendId>f&&(f=x.frontendId)}}catch(B){u.e(B)}finally{u.f()}return f}function J(y){var f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(y);return f?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:null}function F(y){var f=y.toString(16);return f.length==1?"0"+f:f}function D(y,f,u){return"#"+F(y)+F(f)+F(u)}},14836:function(Y,V,n){"use strict";n.d(V,{Z:function(){return r}});var N=n(54421),X=n(38272),J=n(57663),F=n(71577),D=n(91220),y=n(67294),f=n(56159),u=n.n(f),v=n(49111),x=n(19650),B=n(2824),o0=n(11849),a0=n(85024),e=n.n(a0),A=n(63097),a=n(85893),M=function(S){var O=(0,o0.Z)({},S.annotation),Q=(0,y.useState)(O.invisible),e0=(0,B.Z)(Q,2),k=e0[0],l0=e0[1],R=(0,y.useState)(0),G=(0,B.Z)(R,2),w=G[0],K=G[1];(0,y.useEffect)(function(){l0(S.annotation.invisible)},[S.annotation.invisible]);var W=(0,a.jsxs)(X.ZP.Item,{className:"".concat(e().listItem," ").concat(S.active?e().listItemActive:""),unselectable:"on",onClick:function(){S.onClick(O)},children:[(0,a.jsxs)(x.Z,{align:"center",size:5,children:[(0,a.jsx)("a",{className:e().eye,style:{backgroundImage:k?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(v0){v0.stopPropagation(),l0(!k),S.onAnnotationModify(O)}})," ",(0,a.jsx)("span",{className:e().annotationId,children:O.frontendId}),(0,a.jsx)("span",{className:e().labelName,children:O.label.name}),(0,a.jsx)(A.Z,{color:O.label.color})]}),(0,a.jsx)("a",{className:e().delete,onClick:function(v0){v0.stopPropagation();var m0=new Date().getTime();m0-w<300||(K(m0),S.onAnnotationDelete(O))}})]});return W},C=M,T=n(48971),Z=function(S){var O=(0,T.YB)(),Q=O.formatMessage({id:"component.PPAnnotationList.annotationList"}),e0=O.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),k=new Set,l0=[],R=(0,D.Z)(S.annotations),G;try{for(R.s();!(G=R.n()).done;){var w=G.value;k.has(w.frontendId)||(l0.push(w),k.add(w.frontendId))}}catch(K){R.e(K)}finally{R.f()}return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(X.ZP,{className:u().labelList,size:"large",header:(0,a.jsx)("div",{className:u().listHeader,children:Q}),bordered:!0,dataSource:l0,renderItem:function(W){var p;return(0,a.jsx)(C,{onClick:S.onAnnotationSelect,annotation:W,active:W.frontendId==((p=S.currAnnotation)===null||p===void 0?void 0:p.frontendId),onAnnotationDelete:S.onAnnotationDelete,onAnnotationModify:S.onAnnotationModify})},footer:function(){return S.onAnnotationAdd?(0,a.jsx)("div",{children:(0,a.jsx)(F.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){S.onAnnotationAdd()},block:!0,children:e0})}):(0,a.jsx)("div",{})}})})},r=Z},27992:function(Y,V,n){"use strict";var N=n(20136),X=n(55241),J=n(13062),F=n(71230),D=n(77883),y=n(70507),f=n(89032),u=n(15746),v=n(66126),x=n(75454),B=n(2824),o0=n(67294),a0=n(61541),e=n(26647),A=n.n(e),a=n(85893),M=0,C=100,T=10,Z=function(P){var S=(0,o0.useState)(w(P.size)),O=(0,B.Z)(S,2),Q=O[0],e0=O[1];function k(K){e0(w(K))}var l0=P.step?P.step:10,R=P.minSize==null?M:P.minSize,G=P.maxSize==null?C:P.maxSize;function w(K){return K==null?T:K<=R?R:K>=G?G:K}return(0,o0.useEffect)(function(){k(P.size)},[P.size]),(0,a.jsxs)(X.Z,{overlayClassName:"".concat(A().popover," ").concat(P.disLoc=="left"?A().popoverLeft:""),placement:P.disLoc||"right",content:(0,a.jsxs)(F.Z,{children:[(0,a.jsx)(u.Z,{span:16,children:(0,a.jsx)(x.Z,{className:A().slider,value:Q,max:G,min:R,onChange:function(W){var p;(p=P.onChange)===null||p===void 0||p.call(0,W)},tooltipVisible:!1})}),(0,a.jsx)(u.Z,{span:8,children:(0,a.jsx)(y.Z,{min:R,max:G,value:Q,onChange:function(W){var p;(p=P.onChange)===null||p===void 0||p.call(0,W)},step:l0})})]}),trigger:"hover",children:[" ",(0,a.jsx)(a0.Z,{imgSrc:P.imgSrc||"",onClick:P.onClick,active:P.active,children:P.children})]})};V.Z=Z},10137:function(Y,V,n){"use strict";var N=n(34669),X=n(54458),J=n(67294),F=n(85893),D=function(f){var u,v;return(0,F.jsxs)("div",{className:"progress",children:[(0,F.jsx)(X.Z,{className:"progressBar",percent:Math.ceil(f.project.finished/((u=f.task.all)===null||u===void 0?void 0:u.length)*100),status:"active",showInfo:!1})," ",(0,F.jsxs)("span",{className:"progressDesc",children:["Current labeling ",f.task.currIdx==null?1:f.task.currIdx+1," of"," ",(v=f.task.all)===null||v===void 0?void 0:v.length,". Already labeled ",f.project.finished||0,"."]})]})};V.Z=D},91861:function(Y,V,n){"use strict";n.d(V,{Ad:function(){return F},k3:function(){return D},Vd:function(){return y},td:function(){return f}});var N=n(34792),X=n(48086),J=40;function F(){localStorage.removeItem("history"),D([])}function D(u){var v=localStorage.getItem("history"),x=v?JSON.parse(v):{index:-1,items:[]};if(JSON.stringify(x.items[x.index])!=JSON.stringify(u)){var B=x.index>J?x.index-J:0,o0=x.items.splice(B,x.index==0?1:x.index+1);x.items=o0.concat([u]),x.index<=J?x.index++:x.index=J+1,localStorage.setItem("history",JSON.stringify(x))}}function y(){var u=localStorage.getItem("history");if(!!u){var v=JSON.parse(u);if(!!v){if(v.index>=v.items.length-1){X.default.error("No next history!");return}return v.index++,localStorage.setItem("history",JSON.stringify(v)),v.items[v.index]}}}function f(){var u=localStorage.getItem("history");if(!!u){var v=JSON.parse(u);if(console.log("history",v),!v||!v.index||v.index<=1){X.default.error("No previous history!");return}return v.index--,localStorage.setItem("history",JSON.stringify(v)),v.items[v.index]}}},1690:function(Y,V,n){"use strict";n.r(V),n.d(V,{MOST_HISTORY_STEPS:function(){return F0},default:function(){return p0}});var N=n(11849),X=n(57663),J=n(71577),F=n(34792),D=n(48086),y=n(91220),f=n(2824),u=n(67294),v=n(48971),x=n(8088),B=n(61541),o0=n(44434),a0=n(27992),e=n(5041),A=n(57436),a=n(14836),M=n(91861),C=n(8978),T=n(65031),Z=n(57406),r=n(85893);function P(t,l){if(!(!t||!l))return l.join(",")}function S(t){var l,i=t.annotation;if(!i||!i.result||i.result.length<2||!((l=i.label)!==null&&l!==void 0&&l.color))return(0,r.jsx)(r.Fragment,{});var m=i.result.split(",").map(Number),I=i.label.color,d=(0,Z.oo)(I);if(!d)return(0,r.jsx)(r.Fragment,{});var s=.3,E=void 0,_=[];return m.forEach(function(b,j){if(!E){E=b;return}_.push((0,r.jsx)(T.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(i)},draggable:t.currentTool=="editor",onDragMove:function(c){var i0;c.cancelBubble=!0;var g0=(i0=t.stageRef)===null||i0===void 0?void 0:i0.current,q=g0.findOne(".baseImage"),t0=!1,s0=c.target.x();s0>q.width()/2&&(s0=q.width()/2,t0=!0),s0<-q.width()/2&&(s0=-q.width()/2,t0=!0);var r0=c.target.y();r0>q.height()/2&&(r0=q.height()/2,t0=!0),r0<-q.height()/2&&(r0=-q.height()/2,t0=!0),t0&&c.target.setPosition({x:s0,y:r0}),m[j-1]=s0,m[j]=r0;var f0=(0,N.Z)((0,N.Z)({},i),{},{result:m.join(",")});t.onDrag(f0)},onMouseOver:function(){var c;t.currentTool=="editor"&&(c=t.stageRef)!==null&&c!==void 0&&c.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var c;(c=t.stageRef)!==null&&c!==void 0&&c.current&&(t.stageRef.current.container().style.cursor="default")},x:E,y:b,radius:5/t.scale,fill:I})),E=void 0}),(0,r.jsxs)(T.ZA,{children:[(0,r.jsx)(T.x1,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(i)},stroke:I,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",points:m,tension:0,closed:!0,fill:"rgba(".concat(d.r,", ").concat(d.g,", ").concat(d.b,", ").concat(s,")")}),_]},i.frontendId)}function O(t){var l=0;if(!t)return l;var i=(0,y.Z)(t),m;try{for(i.s();!(m=i.n()).done;){var I=m.value;!I||!I.frontendId||I.frontendId>l&&(l=I.frontendId)}}catch(d){i.e(d)}finally{i.f()}return l}function Q(t){var l=function(s,E){var _,b,j=P((_=t.currentLabel)===null||_===void 0?void 0:_.color,[s,E]);!j||(console.log(j),t.onAnnotationAdd({dataId:t.dataId,type:"polygon",frontendId:O(t.annotations)+1,label:t.currentLabel,labelId:(b=t.currentLabel)===null||b===void 0?void 0:b.labelId,result:j}))},i=function(s,E){var _;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((_=t.currentLabel)!==null&&_!==void 0&&_.color))){var b=t.currentAnnotation.result+",".concat(s,",").concat(E),j=(0,N.Z)((0,N.Z)({},t.currentAnnotation),{},{result:b});t.modifyAnnoByFrontendId(j)}},m=function(s){if(t.currentTool=="polygon"){var E=s.mouseX+s.offsetX,_=s.mouseY+s.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?i(E,_):l(E,_)}},I=function(){t.currentTool=="polygon"&&t.onMouseUp&&t.onMouseUp()};return{onMouseDown:m,onMouseMove:function(){},onMouseUp:I,drawAnnotation:S}}var e0=n(10137),k=n(98731),l0=n(20136),R=n(55241),G=n(47673),w=n(24044),K=n(9715),W=n(93766),p=n(13237),v0=n.n(p),m0="http://127.0.0.1:1234/model",O0=function(l){var i=W.Z.useForm(),m=(0,f.Z)(i,1),I=m[0],d=l.model,s=l.project;(0,u.useEffect)(function(){var _,b,j,$;if(!!s.curr){var c=s.curr.otherSettings?s.curr.otherSettings:{},i0={mlBackendUrl:c.mlBackendUrl,mlModelAbsPath:(_=c.models)===null||_===void 0||(b=_.EISeg)===null||b===void 0?void 0:b.mlModelAbsPath,mlWeightAbsPath:(j=c.models)===null||j===void 0||($=j.EISeg)===null||$===void 0?void 0:$.mlWeightAbsPath};I.setFieldsValue(i0),c!=null&&c.mlBackendUrl?d.setMlBackendUrl(c.mlBackendUrl):d.setMlBackendUrl(m0),c.mlModelAbsPath&&c.mlWeightAbsPath&&d.load(c.mlModelAbsPath,c.mlWeightAbsPath)}},[s.curr]);function E(_){if(console.log("saveMlsettings",s.curr,_),!s.curr){D.default.error("Please select project first!");return}s.curr.otherSettings||(s.curr.otherSettings={}),s.curr.otherSettings.mlBackendUrl=I.getFieldValue("mlBackendUrl"),s.curr.otherSettings.models={},s.curr.otherSettings.models.EISeg={},s.curr.otherSettings.models.EISeg.mlModelAbsPath=I.getFieldValue("mlModelAbsPath"),s.curr.otherSettings.models.EISeg.mlWeightAbsPath=I.getFieldValue("mlWeightAbsPath"),s.curr.otherSettings.perviousModel=_.modelName,s.update(s.curr.projectId,{otherSettings:s.curr.otherSettings}),d.setMlBackendUrl(s.curr.otherSettings.mlBackendUrl),d.load(s.curr.otherSettings.models.EISeg.mlModelAbsPath,s.curr.otherSettings.models.EISeg.mlWeightAbsPath),D.default.info("Ml setting saved. Let's start trainig or inference!")}return(0,r.jsxs)(R.Z,{overlayClassName:"".concat(v0().popover," ").concat(v0().popoverLeft),placement:"left",content:(0,r.jsxs)(W.Z,{form:I,layout:"horizontal",size:"large",onFinish:function(b){console.log("form finish",b),E(b)},hidden:s.curr==null,children:[(0,r.jsx)(W.Z.Item,{name:"mlBackendUrl",label:"ML Backend URL",labelCol:{span:6},wrapperCol:{span:18},initialValue:m0,style:{fontSize:"1.5rem"},children:(0,r.jsx)(w.Z,{placeholder:m0})}),(0,r.jsx)(W.Z.Item,{name:"mlModelAbsPath",label:"Model Path",labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"},children:(0,r.jsx)(w.Z,{placeholder:"Absolute path"})}),(0,r.jsx)(W.Z.Item,{name:"mlWeightAbsPath",label:"Weight Path",labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"},children:(0,r.jsx)(w.Z,{placeholder:"Absolute path"})}),(0,r.jsx)(W.Z.Item,{wrapperCol:{span:16,offset:6},children:(0,r.jsx)(J.Z,{htmlType:"submit",type:"primary",style:{height:"2.5rem",width:"48%"},block:!0,children:"Save"})})]}),trigger:"hover",children:[" ",(0,r.jsx)(B.Z,{imgSrc:l.imgSrc||"",onClick:l.onClick,active:l.active,children:l.children})]})},E0=O0,j0=n(3182),L0=n(94043),_0=n.n(L0),H0={result:[[.3779466152191162,.38711845874786377,.36106088757514954,.35420000553131104,.35632404685020447,.36673659086227417,.3709605634212494,.33228039741516113,.3710925579071045,.3494248390197754,.34312722086906433,.3462066650390625,.3746175765991211,.3791941702365875,.4216013550758362,.44569116830825806,.40616583824157715,.4613204002380371,.49154922366142273,.4584124684333801,.4600294828414917,.4803354740142822,.46287786960601807,.43543994426727295,.43747758865356445,.4064893126487732,.3941977620124817,.39790475368499756,.39159834384918213,.3925873935222626,.3789200186729431,.36321160197257996],[.3818621039390564,.3770502805709839,.36075377464294434,.3548894226551056,.3503073453903198,.335567444562912,.3341645896434784,.33101293444633484,.3728009760379791,.364932656288147,.37297818064689636,.37586647272109985,.3893028497695923,.39986884593963623,.41131657361984253,.4522101581096649,.4333687722682953,.5002316832542419,.4971569776535034,.473648339509964,.4820094704627991,.46783292293548584,.4617140591144562,.44852927327156067,.44560548663139343,.44700291752815247,.4248964786529541,.44343101978302,.41931068897247314,.43451547622680664,.4378070831298828,.3568068742752075],[.3652324676513672,.35223522782325745,.35097530484199524,.360146701335907,.36671239137649536,.3395833373069763,.35282737016677856,.33361345529556274,.377223938703537,.38735657930374146,.39466923475265503,.3888944387435913,.3632313311100006,.3888370096683502,.4123692810535431,.41089701652526855,.4431883990764618,.5125359296798706,.5071693658828735,.47963064908981323,.46734818816185,.4608532786369324,.4394238293170929,.40698742866516113,.42963457107543945,.4184359908103943,.39965513348579407,.4161875247955322,.4067150950431824,.45255592465400696,.44494757056236267,.34891369938850403],[.364960253238678,.3754047155380249,.3721790313720703,.37246841192245483,.3652416467666626,.32984012365341187,.3496708571910858,.3422262966632843,.3380891978740692,.3428453207015991,.36001724004745483,.36075884103775024,.36690282821655273,.375881552696228,.3909446597099304,.3976140320301056,.43047186732292175,.5223039984703064,.5174918174743652,.5091606974601746,.4703259766101837,.46562325954437256,.4584425091743469,.4025508463382721,.4088236391544342,.41495299339294434,.41274765133857727,.394614577293396,.3999204635620117,.43086522817611694,.443092942237854,.3433324098587036],[.34178581833839417,.3906759023666382,.3692866563796997,.361131876707077,.3499326705932617,.3162209391593933,.31167617440223694,.3333600163459778,.3163505494594574,.338070273399353,.35670241713523865,.3636510670185089,.35625404119491577,.35763710737228394,.38493406772613525,.39124634861946106,.4325636029243469,.5645959973335266,.5685874223709106,.5350329279899597,.4992934465408325,.4620708227157593,.45242631435394287,.41027894616127014,.4038461744785309,.3944956958293915,.39921683073043823,.3937588334083557,.38950315117836,.3928646147251129,.4300973415374756,.33759239315986633],[.34255340695381165,.384326696395874,.35354241728782654,.32820284366607666,.34075650572776794,.310611367225647,.3198155462741852,.3376222848892212,.3267553746700287,.33798253536224365,.3261478543281555,.3417035639286041,.34279346466064453,.3464927673339844,.3819480240345001,.3768705129623413,.43024203181266785,.5799015164375305,.5669912099838257,.5345537066459656,.5366686582565308,.5029425621032715,.4881816804409027,.4266446828842163,.3896041512489319,.38750505447387695,.3878398835659027,.401533305644989,.38611483573913574,.4102136492729187,.43251603841781616,.3381301164627075],[.34610551595687866,.37768492102622986,.3577062487602234,.321483314037323,.3238357901573181,.31036683917045593,.32922878861427307,.33748194575309753,.34403321146965027,.3489550054073334,.32951661944389343,.35581493377685547,.3549908995628357,.34664082527160645,.37512969970703125,.37657931447029114,.4325118064880371,.6002883911132812,.5718269348144531,.5072413086891174,.5073626041412354,.5133922100067139,.48958104848861694,.45026227831840515,.41855117678642273,.38928452134132385,.3869919180870056,.3884861171245575,.38088345527648926,.4067824184894562,.42561301589012146,.3727574646472931],[.36236464977264404,.38462936878204346,.33172523975372314,.2767360210418701,.28566184639930725,.29154667258262634,.32516488432884216,.3253626823425293,.30838415026664734,.3315502405166626,.3262888789176941,.3520568013191223,.35253870487213135,.3447986841201782,.3818697929382324,.3651794195175171,.4231885075569153,.5827294588088989,.5951063632965088,.6352673768997192,.5757752656936646,.48387131094932556,.46553540229797363,.4512472450733185,.44570550322532654,.4316057562828064,.41964590549468994,.3941313624382019,.37175554037094116,.3886064291000366,.40585458278656006,.3790917694568634],[.35083019733428955,.3677082061767578,.33382877707481384,.3098861575126648,.3019915223121643,.3109188377857208,.3330777883529663,.331575870513916,.31939375400543213,.34113019704818726,.34969979524612427,.3529251217842102,.36156511306762695,.35511070489883423,.37965914607048035,.37223300337791443,.4537010192871094,.5680437088012695,.6448143720626831,.7226863503456116,.729232907295227,.6868923902511597,.5698102116584778,.4619525372982025,.46818724274635315,.43513986468315125,.42044782638549805,.3994002342224121,.39396214485168457,.3904518187046051,.40890100598335266,.3930703103542328],[.3359583914279938,.3705343008041382,.35527661442756653,.3399384319782257,.34458956122398376,.3259856700897217,.347974956035614,.3495017886161804,.3527892231941223,.35826316475868225,.35742005705833435,.335483193397522,.34679195284843445,.36213573813438416,.38948914408683777,.3846794366836548,.4752236008644104,.5317398905754089,.6341782212257385,.7260967493057251,.7400858402252197,.7263891696929932,.6071794629096985,.49351879954338074,.4718652367591858,.4380945563316345,.44395726919174194,.42750805616378784,.4137647747993469,.41625750064849854,.42252638936042786,.4066489040851593],[.3289949595928192,.37435805797576904,.3653024733066559,.34567791223526,.37014514207839966,.36809563636779785,.36826398968696594,.32743436098098755,.3298226594924927,.34234797954559326,.34268611669540405,.3254646956920624,.3090794086456299,.3477054834365845,.37110430002212524,.3621593713760376,.4475082755088806,.487918496131897,.601881742477417,.6983312964439392,.7557751536369324,.7451871633529663,.5793305039405823,.4939006268978119,.47265419363975525,.42300844192504883,.43300366401672363,.41770070791244507,.414137601852417,.42620089650154114,.41289666295051575,.4050122797489166],[.2583468556404114,.3622201085090637,.3609732985496521,.35103529691696167,.3431868553161621,.36043819785118103,.3594401776790619,.33510416746139526,.31773367524147034,.32706841826438904,.33306169509887695,.329282283782959,.3103845715522766,.3467973470687866,.36439552903175354,.35807719826698303,.40837693214416504,.46938514709472656,.6127392053604126,.7233112454414368,.7669434547424316,.7611733675003052,.5953957438468933,.5389460921287537,.4672558009624481,.42192357778549194,.42329633235931396,.42473718523979187,.40417638421058655,.408004492521286,.4068392515182495,.45992550253868103],[.26873499155044556,.3717286288738251,.3643631339073181,.3532456159591675,.3495698571205139,.3619597554206848,.3786068260669708,.3432343006134033,.3145405650138855,.32395321130752563,.33640119433403015,.33749133348464966,.31600821018218994,.3369048535823822,.3504919409751892,.34988847374916077,.3846014440059662,.4548245966434479,.6552940011024475,.7398929595947266,.7898313999176025,.7753756642341614,.6361410617828369,.550889790058136,.4542275369167328,.41850578784942627,.4201924800872803,.4233487844467163,.4089168310165405,.40734779834747314,.4125276207923889,.45579835772514343],[.2889721095561981,.3404158651828766,.34746238589286804,.3323819637298584,.36239108443260193,.36021608114242554,.3564058542251587,.34031766653060913,.3106665015220642,.32129210233688354,.32644376158714294,.3231737017631531,.30393165349960327,.34000542759895325,.3698198199272156,.3764057457447052,.37690526247024536,.44695284962654114,.6244124174118042,.7085537910461426,.7864880561828613,.7922757267951965,.6478504538536072,.5585101842880249,.46907946467399597,.43042469024658203,.4196140766143799,.4143720269203186,.41768819093704224,.4123932123184204,.40979909896850586,.40944749116897583],[.33511802554130554,.3354792892932892,.3483961820602417,.3393648862838745,.36110979318618774,.37371599674224854,.3693099021911621,.3380741477012634,.31597936153411865,.3110752999782562,.3071911334991455,.29553914070129395,.28971895575523376,.3283897936344147,.3738657832145691,.359753280878067,.37170153856277466,.45006322860717773,.622103214263916,.7240833044052124,.8724844455718994,.8468523025512695,.6292383670806885,.5481832027435303,.47547808289527893,.4294469654560089,.4108424484729767,.4051211476325989,.4253206253051758,.42601343989372253,.4097977876663208,.3356857895851135],[.3555319011211395,.3408556282520294,.35363197326660156,.3417183756828308,.3509896397590637,.38215622305870056,.41220414638519287,.3597573935985565,.3141809105873108,.299405962228775,.2974483370780945,.2919771671295166,.2913997769355774,.32095572352409363,.373879075050354,.3556964099407196,.3629939556121826,.47226566076278687,.6256035566329956,.7390267252922058,.8593417406082153,.8262102603912354,.6343622803688049,.5576579570770264,.4742991030216217,.41313984990119934,.3864082098007202,.3817637264728546,.4082636833190918,.41419312357902527,.4119032323360443,.2635403275489807],[.3506373465061188,.32203149795532227,.34963458776474,.32425546646118164,.33225691318511963,.35579705238342285,.38111579418182373,.3564165532588959,.3126765489578247,.3007081151008606,.30092623829841614,.30085325241088867,.2974894046783447,.326341450214386,.36822161078453064,.35820019245147705,.3826185166835785,.4894598424434662,.6533626317977905,.70644211769104,.7451343536376953,.7429384589195251,.6669357419013977,.5394930243492126,.45886534452438354,.41244491934776306,.39533960819244385,.370727002620697,.386724591255188,.3909628987312317,.40651923418045044,.24896344542503357],[.3370128571987152,.30008041858673096,.3007066547870636,.2964634597301483,.31920456886291504,.3513490855693817,.3618793785572052,.3482736349105835,.3220705986022949,.3098466992378235,.306601345539093,.30917924642562866,.32083860039711,.33934545516967773,.3853139877319336,.3959599435329437,.42794349789619446,.5098592042922974,.6510905027389526,.7034169435501099,.7345707416534424,.7295455932617188,.6945785880088806,.5392878651618958,.46230608224868774,.4132283627986908,.40620577335357666,.39428097009658813,.39259806275367737,.38836321234703064,.3802737891674042,.2869125008583069],[.3107353448867798,.28716710209846497,.2810332477092743,.28914326429367065,.3127279281616211,.349570631980896,.35278424620628357,.3424120545387268,.3312514126300812,.3183543384075165,.31009000539779663,.3195717930793762,.31631040573120117,.32442909479141235,.3819769620895386,.39367008209228516,.41426554322242737,.48430579900741577,.6400377750396729,.682829737663269,.7346150875091553,.7265263199806213,.6635222434997559,.5312811732292175,.4713155925273895,.40454715490341187,.41512030363082886,.4182337820529938,.39747387170791626,.3760755658149719,.3628138303756714,.3463020622730255],[.30060598254203796,.3060090243816376,.3139290511608124,.3145269751548767,.30912041664123535,.35013264417648315,.35046622157096863,.33206114172935486,.322023868560791,.3207645118236542,.3205072283744812,.32279807329177856,.3099812865257263,.3307061493396759,.3545922636985779,.3684121072292328,.39094099402427673,.43648841977119446,.6046525239944458,.6440432071685791,.6817156672477722,.6866225600242615,.6455923318862915,.5251345634460449,.4481634497642517,.4150755703449249,.4251801371574402,.404987633228302,.37328672409057617,.36327677965164185,.3602195680141449,.3206213116645813],[.30405154824256897,.3178442716598511,.33336877822875977,.3373711109161377,.32321715354919434,.3630528748035431,.3537922501564026,.3336135447025299,.30300673842430115,.31718388199806213,.3529442846775055,.34015488624572754,.3124402165412903,.3555675745010376,.35390767455101013,.37345024943351746,.4144602119922638,.44640690088272095,.573625922203064,.6119270324707031,.6456900835037231,.6455104351043701,.5934235453605652,.484555721282959,.4161651134490967,.3811432719230652,.3861028552055359,.3659202456474304,.34390294551849365,.3247116208076477,.3456142544746399,.32664284110069275],[.2826228737831116,.2938840985298157,.30609411001205444,.29632243514060974,.2861210107803345,.30216431617736816,.28895461559295654,.2819651961326599,.2588002383708954,.30655887722969055,.34061241149902344,.32973647117614746,.3005189895629883,.29779112339019775,.2948862910270691,.3190575838088989,.3858416974544525,.4116919934749603,.5491650104522705,.5732342004776001,.5938672423362732,.5976152420043945,.5155865550041199,.45706799626350403,.3356960117816925,.31694191694259644,.3380652368068695,.3176265358924866,.315368115901947,.3020714521408081,.3154049515724182,.32578057050704956]]};function T0(t){var l,i,m=t.canvasRef;if(!t.interactorData||!((l=t.label)!==null&&l!==void 0&&l.color))return(0,r.jsx)(r.Fragment,{});var I=t.interactorData,d=(i=m.current)===null||i===void 0?void 0:i.getContext("2d");return d?(Z0(b0(I,t.threshold),d,t.label.color),(0,r.jsx)(r.Fragment,{})):(0,r.jsx)(r.Fragment,{})}function b0(t,l){var i=l?l*.01:.5,m=[],I=0,d=(0,y.Z)(t),s;try{for(d.s();!(s=d.n()).done;){var E=s.value,_=0,b=(0,y.Z)(E),j;try{for(b.s();!(j=b.n()).done;){var $=j.value;$>=i&&m.push(_,I),_++}}catch(c){b.e(c)}finally{b.f()}I++}}catch(c){d.e(c)}finally{d.f()}return m}function D0(t,l,i,m,I){if(!m||!I||!t)return null;var d=b0(t,l),s=0,E=A0(i),_="".concat(s,",").concat(E,",")+d.join(","),b={dataId:m,label:I,labelId:I.labelId,frontendId:E,result:_,type:"brush"};return b}function Z0(t,l,i){if(t.length<4){console.log("found incorrect points:",t);return}U0(l,t.slice(2),i)}function U0(t,l,i){t.globalCompositeOperation=i?"source-over":"destination-out",i&&(t.fillStyle=i);for(var m=0;m<=l.length/2-1;m++){var I=l[2*m],d=l[2*m+1];t.fillRect(I,d,1,1)}}function A0(t){if(!t||t.length==0)return 0;var l=0,i=(0,y.Z)(t),m;try{for(i.s();!(m=i.n()).done;){var I=m.value;I.frontendId>l&&(l=I.frontendId)}}catch(d){i.e(d)}finally{i.f()}return l}function R0(t){var l=(0,u.useState)([]),i=(0,f.Z)(l,2),m=i[0],I=i[1],d=(0,v.tT)("InteractorData",function(j){return j.setInteractorData}),s=t.model,E=function(){var j=(0,j0.Z)(_0().mark(function $(c){var i0,g0,q,t0,s0,r0,f0;return _0().wrap(function(n0){for(;;)switch(n0.prev=n0.next){case 0:if(!(t.currentTool!="interactor"||!((i0=t.currentLabel)!==null&&i0!==void 0&&i0.color))){n0.next=2;break}return n0.abrupt("return");case 2:if(g0=Math.round(c.mouseX),q=Math.round(c.mouseY),console.log("frontendId: ",t.frontendIdOps.frontendId,"maxId:",A0(t.annotations)),t0=t.frontendIdOps.frontendId>0?t.frontendIdOps.frontendId:A0(t.annotations)+1,t0!=t.frontendIdOps.frontendId&&t.frontendIdOps.setFrontendId(t0),m.push(new Array(g0,q,c.e.evt.button!=2)),I(m),!(!m.length||!c.stageRef.current||t0==null)){n0.next=11;break}return n0.abrupt("return");case 11:return s0=c.stageRef.current,r0=s0.findOne(".baseImage").toDataURL().slice(22),n0.next=15,s.predict({format:"b64",img:r0,other:{clicks:m}});case 15:if(f0=n0.sent,f0){n0.next=18;break}return n0.abrupt("return");case 18:d(f0.result);case 19:case"end":return n0.stop()}},$)}));return function(c){return j.apply(this,arguments)}}(),_=function(){},b=function(){t.currentTool=="interactor"&&t.onMouseUp()};return{onMouseDown:E,onMouseMove:_,onMouseUp:b,drawAnnotation:T0}}var F0=40,W0=function(){var l,i=(0,u.useState)(0),m=(0,f.Z)(i,2),I=m[0],d=m[1],s=(0,u.useState)(10),E=(0,f.Z)(s,2),_=E[0],b=E[1],j=(0,u.useState)(50),$=(0,f.Z)(j,2),c=$[0],i0=$[1],g0=(0,u.useState)(60),q=(0,f.Z)(g0,2),t0=q[0],s0=q[1],r0=(0,v.tT)("InteractorData"),f0=r0.interactorData,S0=r0.setInteractorData,n0=(0,k.RZ)(u.useState),d0=(0,k.$L)(u.useState,u.useEffect,{effectTrigger:{postTaskChange:function(){return(0,M.Ad)()}},label:{oneHot:!0,postSelect:function(){g.setCurr(void 0),d(0)},preUnsetCurr:N0},tool:{defaultTool:"mover"},task:{push:!0}}),L=d0.tool,M0=d0.task,c0=d0.data,I0=d0.project,P0=d0.scale,u0=d0.label,g=d0.annotation,z0=d0.refreshVar;function N0(){g.setCurr(void 0),d(0),L.setCurr("mover")}var U=function(o){g.setCurr(o),o!=null&&o.frontendId?d(o.frontendId):d(0)};(0,u.useEffect)(function(){(0,M.Ad)()},[]),(0,u.useEffect)(function(){var h=setInterval(function(){var o;console.log("triggered!",c0),g.pushToBackend((o=c0.curr)===null||o===void 0?void 0:o.dataId)},2e4);return function(){clearInterval(h)}},[g,c0,c0.curr]);var k0=function(o){!o||(g.all.pop(),g.all.push(o),U(o),g.setAll(g.all))},y0=function(o){var H=[],h0=(0,y.Z)(g.all),x0;try{for(h0.s();!(x0=h0.n()).done;){var B0=x0.value;B0.frontendId==o.frontendId?H.push(o):H.push(B0)}}catch($0){h0.e($0)}finally{h0.f()}U(o),g.setAll(H)},C0={dataId:(l=c0.curr)===null||l===void 0?void 0:l.dataId,currentLabel:u0.curr,brushSize:_,scale:P0.curr,currentTool:L.curr,annotations:g.all,currentAnnotation:g.curr,onAnnotationAdd:function(o){var H=g.all.concat([o]);g.setAll(H),U(o)},onAnnotationModify:k0,modifyAnnoByFrontendId:y0,onMouseUp:function(){L.curr!="interactor"&&(0,M.k3)({annos:g.all,currAnno:g.curr})},frontendIdOps:{frontendId:I,setFrontendId:d},model:n0},z=(0,v.YB)(),K0={polygon:Q(C0),brush:(0,C.Z)(C0),interactor:R0(C0)};return(0,r.jsxs)(x.Z,{className:"segment",children:[(0,r.jsxs)(o0.Z,{children:[(0,r.jsx)(B.Z,{imgSrc:"./pics/buttons/polygon.png",active:L.curr=="polygon",onClick:function(){if(!u0.curr){D.default.error("Please select a label first");return}L.setCurr("polygon"),U(void 0)},children:z.formatMessage({id:"pages.toolBar.polygon"})}),(0,r.jsx)(B.Z,{active:L.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){L.setCurr("editor"),U(void 0)},children:z.formatMessage({id:"pages.toolBar.edit"})}),(0,r.jsx)(a0.Z,{imgSrc:"./pics/buttons/brush.png",size:_,active:L.curr=="brush",onClick:function(){if(!u0.curr){D.default.error("Please select a label first");return}L.curr!="rubber"&&L.curr!="brush"&&U(void 0),L.setCurr("brush")},onChange:function(o){b(o)},children:z.formatMessage({id:"pages.toolBar.brush"})}),(0,r.jsx)(a0.Z,{size:_,active:L.curr=="rubber",onClick:function(){L.curr!="rubber"&&L.curr!="brush"&&U(void 0),L.setCurr("rubber")},onChange:function(o){b(o)},imgSrc:"./pics/buttons/rubber.png",children:z.formatMessage({id:"pages.toolBar.rubber"})}),(0,r.jsx)(B.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){P0.change(.1)},children:z.formatMessage({id:"pages.toolBar.zoomIn"})}),(0,r.jsx)(B.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){P0.change(-.1)},children:z.formatMessage({id:"pages.toolBar.zoomOut"})}),(0,r.jsx)(B.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var o;g.pushToBackend((o=c0.curr)===null||o===void 0?void 0:o.dataId)},children:z.formatMessage({id:"pages.toolBar.save"})}),(0,r.jsx)(B.Z,{active:L.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){L.setCurr("mover")},children:z.formatMessage({id:"pages.toolBar.move"})}),(0,r.jsx)(B.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=(0,M.td)();o&&(g.setAll(o.annos),U(o.currAnno))},children:z.formatMessage({id:"pages.toolBar.unDo"})}),(0,r.jsx)(B.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=(0,M.Vd)();o&&(g.setAll(o.annos),U(o.currAnno))},children:z.formatMessage({id:"pages.toolBar.reDo"})}),(0,r.jsx)(B.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){g.setAll([]),g.setCurr(void 0)},children:z.formatMessage({id:"pages.toolBar.clearMark"})})]}),(0,r.jsxs)("div",{id:"dr",className:"mainStage",children:[(0,r.jsx)("div",{className:"draw",children:(0,r.jsx)(A.Z,{scale:P0.curr,annotations:g.all,currentTool:L.curr,currentAnnotation:g.curr,currentLabel:u0.curr,setCurrentAnnotation:U,onAnnotationModify:y0,onAnnotationModifyComplete:function(){L.curr!="interactor"&&(0,M.k3)({annos:g.all,currAnno:g.curr})},frontendIdOps:{frontendId:I,setFrontendId:d},imgSrc:c0.imgSrc,transparency:t0,threshold:c,onAnnotationAdd:function(o){var H=g.all.concat([o]);g.setAll(H),g.curr||U(o)},drawTool:K0,refresh:z0})}),(0,r.jsx)("div",{className:"pblock",children:(0,r.jsx)(e0.Z,{task:M0,project:I0})}),(0,r.jsx)("div",{className:"prevTask",onClick:function(){!M0.prevTask()||U(void 0)}}),(0,r.jsx)("div",{className:"nextTask",onClick:function(){!M0.nextTask()||U(void 0)}})]}),(0,r.jsxs)(o0.Z,{disLoc:"right",children:[(0,r.jsx)(E0,{imgSrc:"./pics/buttons/intelligent_interaction.png",active:L.curr=="interactor",onClick:function(){L.setCurr("interactor")},model:n0,project:I0,children:z.formatMessage({id:"pages.toolBar.interactor"})}),(0,r.jsx)(a0.Z,{imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:c,maxSize:100,minSize:10,step:10,onChange:function(o){i0(o)},children:z.formatMessage({id:"pages.toolBar.segmentThreshold"})}),(0,r.jsx)(a0.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:t0,maxSize:100,minSize:0,onChange:function(o){s0(o)},children:z.formatMessage({id:"pages.toolBar.transparency"})}),(0,r.jsx)(a0.Z,{imgSrc:"./pics/buttons/radius.png",disLoc:"left",children:z.formatMessage({id:"pages.toolBar.visualRadius"})}),(0,r.jsx)(B.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){v.m8.push("/project_overview?projectId=".concat(I0.curr.projectId))},children:"Project Overview"})]}),(0,r.jsxs)("div",{className:"rightSideBar",children:[(0,r.jsx)("div",{className:"determinOutline",children:(0,r.jsx)(J.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){if(L.curr=="interactor"){var o;console.log(L.curr);var H=D0(f0,c,g.all,(o=c0.curr)===null||o===void 0?void 0:o.dataId,u0.curr);if(H){var h0=g.all.concat([H]);g.setAll(h0),U(H)}}S0([]),U(void 0)},children:z.formatMessage({id:"pages.toolBar.determineOutline"})})}),(0,r.jsx)(e.Z,{hideColorPicker:!1,labels:u0.all,activeIds:u0.activeIds,onLabelSelect:u0.onSelect,onLabelModify:function(){},onLabelDelete:u0.remove,onLabelAdd:function(o){u0.create((0,N.Z)((0,N.Z)({},o),{},{projectId:I0.curr.projectId})).then(function(H){U(void 0),u0.setCurr(H)})}}),(0,r.jsx)(a.Z,{currAnnotation:g.curr,annotations:g.all,onAnnotationSelect:function(o){o!=null&&o.delete||U(o)},onAnnotationAdd:function(){U(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(o){g.setAll(g.all.filter(function(H){return H.frontendId!=o.frontendId})),U(void 0)}})]})]})},p0=W0}}]);
