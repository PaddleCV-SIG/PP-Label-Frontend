(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(se,Q,S){"use strict";S.d(Q,{gu:function(){return x},Gd:function(){return z},$L:function(){return ue}});var H=S(86582),F=S(91220),A=S(3182),ie=S(34792),y=S(48086),O=S(2824),X=S(94043),i=S.n(X),N=S(48971),L=S(37071),R=S(81139),W=localStorage.getItem("basePath"),K=new R.VK(W?{basePath:W}:void 0),j=new R.U(K),Y=new R.sD(K),q=new R.W6(K),G=new R.Cl(K),J=new R.vb(K),x=function(o){return JSON.parse(JSON.stringify(o))};function fe(M){return M&&(M.toLowerCase().replace(/([-_][a-z])/g,function(o){return o.toUpperCase().replace("-","").replace("_","")}),M)}var V=function(o,h,g){if(!!g){for(var s=typeof o=="number"?o:o[g],m=0;m<h.length;m++)if(s==h[m][g])return m}},ee=function(o){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],g=o(1),s=(0,O.Z)(g,2),m=s[0],U=s[1],E=function(p){var _=m;_+=p,_<h[0]&&(_=h[0],y.default.error("Smallest scale is "+h[0])),_>h[1]&&(_=h[1],y.default.error("Largest scale is "+h[1])),U(_)};return{curr:m,change:E}},z=function(o){var h=o([]),g=(0,O.Z)(h,2),s=g[0],m=g[1],U=o(),E=(0,O.Z)(U,2),f=E[0],p=E[1],_=function(){var c=(0,A.Z)(i().mark(function a(){var u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getAll();case 3:return u=e.sent,m(u),e.abrupt("return",u);case 8:return e.prev=8,e.t0=e.catch(0),console.log("project getAll err",e.t0),L.Z.parseError(e.t0,y.default),e.abrupt("return");case 13:case"end":return e.stop()}},a,null,[[0,8]])}));return function(){return c.apply(this,arguments)}}(),D=function(){var c=(0,A.Z)(i().mark(function a(u){var n;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(u!=null){r.next=2;break}return r.abrupt("return",void 0);case 2:if(!(s.length>1)){r.next=5;break}return y.default.error("Currently have multiple projects stored, use turnTo instead"),r.abrupt("return");case 5:return r.next=7,j.get(u);case 7:return n=r.sent,m([n]),p(0),r.abrupt("return",n);case 11:case"end":return r.stop()}},a)}));return function(u){return c.apply(this,arguments)}}(),Z=function(){var c=(0,A.Z)(i().mark(function a(u){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove project",u),typeof u!="number"){e.next=6;break}return e.next=4,j.remove(u);case 4:e.next=8;break;case 6:return e.next=8,j.remove(u.projectId);case 8:_();case 9:case"end":return e.stop()}},a)}));return function(u){return c.apply(this,arguments)}}(),C=function(){var c=(0,A.Z)(i().mark(function a(u){var n;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,j.create(u);case 3:return n=r.sent,console.log(n),r.abrupt("return",n);case 8:return r.prev=8,r.t0=r.catch(0),console.log("project create err",r.t0),r.abrupt("return",L.Z.parseError(r.t0,y.default));case 12:case"end":return r.stop()}},a,null,[[0,8]])}));return function(u){return c.apply(this,arguments)}}(),v=function(){var c=(0,A.Z)(i().mark(function a(u,n){return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:j.update(u,n).then(function(b){console.log("project update res",b)}).catch(function(b){console.log("project update err ",b),L.Z.parseError(b,y.default)});case 1:case"end":return r.stop()}},a)}));return function(u,n){return c.apply(this,arguments)}}();return{all:s,getAll:_,getCurr:D,remove:Z,create:C,update:v,get curr(){if(f!=null)return s[f]}}},re=function(o,h){var g=h.oneHot,s=g===void 0?!0:g,m=h.postSetCurr,U=o(),E=(0,O.Z)(U,2),f=E[0],p=E[1],_=o(),D=(0,O.Z)(_,2),Z=D[0],C=D[1],v=o(s),c=(0,O.Z)(v,2),a=c[0],u=c[1],n=function(){var w=(0,A.Z)(i().mark(function t(k){var T,d,P,B;return i().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.prev=0,$.next=3,j.getLabels(k);case 3:T=$.sent,d=(0,F.Z)(T);try{for(d.s();!(P=d.n()).done;)B=P.value,B.active=!1}catch(le){d.e(le)}finally{d.f()}return p(T),$.abrupt("return",T);case 10:return $.prev=10,$.t0=$.catch(0),console.log("label getall err ",$.t0),$.abrupt("return",L.Z.parseError($.t0,y.default));case 14:case"end":return $.stop()}},t,null,[[0,10]])}));return function(k){return w.apply(this,arguments)}}(),e=function(t){var k=V(t,f,"labelId");if(k==null)throw Error("undefined label idx");if(C(k),a){var T=(0,F.Z)(f),d;try{for(T.s();!(d=T.n()).done;){var P=d.value;P.active=!1}}catch(B){T.e(B)}finally{T.f()}f[k].active=!0,console.log("all",f)}else f[k].active=!f[k].active;m&&m(f[k]),p((0,H.Z)(f))},r=function(){var w=(0,A.Z)(i().mark(function t(k){var T;return i().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,J.create(k);case 3:return T=P.sent,T.active=!1,p([].concat((0,H.Z)(f),[T])),P.abrupt("return",T);case 9:return P.prev=9,P.t0=P.catch(0),console.log("label create err",P.t0),P.abrupt("return",L.Z.parseError(P.t0,y.default));case 13:case"end":return P.stop()}},t,null,[[0,9]])}));return function(k){return w.apply(this,arguments)}}(),b=function(){var w=(0,A.Z)(i().mark(function t(k){return i().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return console.log("remove label",k),d.prev=1,d.next=4,J.remove(k.labelId);case 4:p(f.filter(function(P){return P.labelId!=k.labelId})),d.next=11;break;case 7:d.prev=7,d.t0=d.catch(1),console.log("label remove err",d.t0),L.Z.parseError(d.t0,y.default);case 11:case"end":return d.stop()}},t,null,[[1,7]])}));return function(k){return w.apply(this,arguments)}}(),l=function(){},I=function(){u(!a)};return{all:f,getAll:n,setAll:p,setCurr:e,create:r,remove:b,onModify:l,toggleOneHot:I,get curr(){if(Z!=null)return f[Z]}}},ae=function(o){var h=o(),g=(0,O.Z)(h,2),s=g[0],m=g[1],U=o(),E=(0,O.Z)(U,2),f=E[0],p=E[1],_=o(),D=(0,O.Z)(_,2),Z=D[0],C=D[1],v=function(r){if(r<0){y.default.error("This is the first image. No previous image.");return}if(r==s.length){y.default.error("This is the final image. No next image.");return}console.log("turning to",r),p(r)},c=function(){var e=(0,A.Z)(i().mark(function r(b,l){var I;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.getTasks(b);case 3:if(I=t.sent,m(I),l==null){t.next=9;break}return console.log("getall turnto"),v(l),t.abrupt("return",[I,I[l]]);case 9:return t.abrupt("return",I);case 12:return t.prev=12,t.t0=t.catch(0),console.log("task getall err ",t.t0),t.abrupt("return",L.Z.parseError(t.t0,y.default));case 16:case"end":return t.stop()}},r,null,[[0,12]])}));return function(b,l){return e.apply(this,arguments)}}(),a=function(){var e=(0,A.Z)(i().mark(function r(b){var l,I;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.getProgress(b);case 3:if(l=t.sent,!(!l||l.finished==null||l.total==null)){t.next=6;break}throw Error("empty progress");case 6:return I=Math.ceil(l.finished/l.total*100),C(I),t.abrupt("return",I);case 11:return t.prev=11,t.t0=t.catch(0),console.log("get progress err",t.t0),L.Z.parseError(t.t0,y.default),t.abrupt("return",0);case 16:case"end":return t.stop()}},r,null,[[0,11]])}));return function(b){return e.apply(this,arguments)}}(),u=function(){var e=(0,A.Z)(i().mark(function r(){return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:v(f+1),console.log("all tasks",s);case 2:case"end":return l.stop()}},r)}));return function(){return e.apply(this,arguments)}}(),n=function(){var e=(0,A.Z)(i().mark(function r(){return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:v(f-1);case 1:case"end":return l.stop()}},r)}));return function(){return e.apply(this,arguments)}}();return{currIdx:f,all:s,turnTo:v,getAll:c,getProgress:a,progress:Z,nextTask:u,prevTask:n,get curr(){if(!(f==null||s==null))return console.log("task.curr",s[f]),s[f]},get finished(){return Math.floor((s==null?void 0:s.length)*Z/100)}}},ne=function(o){var h=o(),g=(0,O.Z)(h,2),s=g[0],m=g[1],U=o(),E=(0,O.Z)(U,2),f=E[0],p=E[1],_=function(){var v=(0,A.Z)(i().mark(function c(a){var u,n,e,r;return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,q.getAnnotations(a);case 3:u=l.sent,n=(0,F.Z)(u);try{for(n.s();!(e=n.n()).done;)r=e.value,r.active=!1}catch(I){n.e(I)}finally{n.f()}return m(u),l.abrupt("return",u);case 10:return l.prev=10,l.t0=l.catch(0),console.log("ann getAll err",l.t0),l.abrupt("return",L.Z.parseError(l.t0,y.default));case 14:case"end":return l.stop()}},c,null,[[0,10]])}));return function(a){return v.apply(this,arguments)}}(),D=function(){var v=(0,A.Z)(i().mark(function c(a){var u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create",a),e.prev=1,e.next=4,G.create(a);case 4:return u=e.sent,a.dataId&&_(a.dataId),e.abrupt("return",u);case 9:return e.prev=9,e.t0=e.catch(1),console.log("annotation create err",e.t0),e.abrupt("return",L.Z.parseError(e.t0,y.default));case 13:case"end":return e.stop()}},c,null,[[1,9]])}));return function(a){return v.apply(this,arguments)}}(),Z=function(){var v=(0,A.Z)(i().mark(function c(a){var u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("typeof",typeof a),u=typeof a!="number"?a.annotationId:a,e.prev=2,!u){e.next=6;break}return e.next=6,G.remove(u);case 6:m(s.filter(function(r){return r.annotationId!=u})),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(2),console.log("annotation remove err",e.t0),e.abrupt("return",L.Z.parseError(e.t0,y.default));case 13:case"end":return e.stop()}},c,null,[[2,9]])}));return function(a){return v.apply(this,arguments)}}(),C=function(){var v=(0,A.Z)(i().mark(function c(a,u){var n,e,r,b,l;return i().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(a!=null){w.next=3;break}return p(void 0),w.abrupt("return");case 3:n=(0,F.Z)(s);try{for(n.s();!(e=n.n()).done;)r=e.value,r.active=!1}catch(t){n.e(t)}finally{n.f()}b=s.filter(function(t){return t.annotationId==a.annotationId})[0],b.active=!a.active,l=V(b,s,"annotationId"),p(l),m((0,H.Z)(s)),console.log("ann on select label",u),u.setCurr(a.labelId);case 12:case"end":return w.stop()}},c)}));return function(a,u){return v.apply(this,arguments)}}();return{all:s,getAll:_,create:D,remove:Z,setCurr:C,get curr(){if(!(!s||!f))return s[f]}}},te=function(o){var h=o(),g=(0,O.Z)(h,2),s=g[0],m=g[1],U=o([]),E=(0,O.Z)(U,2),f=E[0],p=E[1],_=function(){var Z=(0,A.Z)(i().mark(function C(v){return i().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:m(v);case 1:case"end":return a.stop()}},C)}));return function(v){return Z.apply(this,arguments)}}(),D=function(){var Z=(0,A.Z)(i().mark(function C(v,c){var a;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Y.getDatas(v);case 3:if(a=n.sent,p(a),c==null){n.next=8;break}return _(c),n.abrupt("return",[a,a[c]]);case 8:return n.abrupt("return",a);case 11:return n.prev=11,n.t0=n.catch(0),console.log("data getall err ",n.t0),n.abrupt("return",L.Z.parseError(n.t0,y.default));case 15:case"end":return n.stop()}},C,null,[[0,11]])}));return function(v,c){return Z.apply(this,arguments)}}();return{all:f,getAll:D,turnTo:_,get curr(){if(!(s==null||f==null))return f[s]},get imgSrc(){return f&&f[s]?(console.log("imgsrc","".concat(W,"/datas/").concat(f[s].dataId,"/image?sault=").concat(f[s].sault)),"".concat(W,"/datas/").concat(f[s].dataId,"/image?sault=").concat(f[s].sault)):""}}},ue=function(o,h,g){g.effectTrigger||(g.effectTrigger={});var s=o(!1),m=(0,O.Z)(s,2),U=m[0],E=m[1],f=ee(o),p=ae(o),_=te(o),D=z(o),Z=re(o,g.label),C=ne(o);return h(function(){var v=L.Z.getQueryVariable("projectId");if(v==null){N.m8.push("/");return}var c=parseInt(v);D.getCurr(v).catch(function(a){L.Z.parseError(a,y.default),N.m8.push("/")}),Z.getAll(c),p.getAll(c),p.getProgress(c)},[]),h(function(){p.all&&p.all.length!=0&&p.turnTo(0)},[p.all]),h(function(){if(p.currIdx!=null){var v=function(){var c=(0,A.Z)(i().mark(function a(){var u,n,e,r,b,l,I,w,t,k;return i().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(console.log("onTaskChange",p.curr,Z.all,p.progress),(u=p.curr)!==null&&u!==void 0&&u.projectId&&p.getProgress(p.curr.projectId),!((n=p.curr)!==null&&n!==void 0&&n.taskId)){d.next=15;break}return d.next=5,_.getAll(p.curr.taskId,0);case 5:return e=d.sent,r=(0,O.Z)(e,2),b=r[0],l=r[1],console.log(b),d.next=12,C.getAll(l.dataId);case 12:if(I=d.sent,Z.all){w=(0,F.Z)(Z.all);try{for(w.s();!(t=w.n()).done;)k=t.value,k.active=!1}catch(P){w.e(P)}finally{w.f()}}g.effectTrigger.postTaskChange&&g.effectTrigger.postTaskChange(Z.all,I);case 15:E(!1);case 16:case"end":return d.stop()}},a)}));return function(){return c.apply(this,arguments)}}();v()}},[p.currIdx]),[U,E,f,C,p,_,D,Z]}}}]);
