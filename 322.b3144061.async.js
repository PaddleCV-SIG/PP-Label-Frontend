(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(be,ae,K){"use strict";K.d(ae,{gu:function(){return le},os:function(){return se},Gd:function(){return re},$L:function(){return me}});var X=K(11849),Y=K(91220),E=K(3182),_e=K(34792),T=K(48086),U=K(2824),ne=K(94043),a=K.n(ne),q=K(48971),O=K(37071),N=K(9992),V=localStorage.getItem("basePath"),G=new N.VK(V?{basePath:V}:void 0),B=new N.U(G),te=new N.sD(G),ue=new N.W6(G),z=new N.Cl(G),x=new N.vb(G),le=function(n){return JSON.parse(JSON.stringify(n))};function se(A){return A&&(A.toLowerCase().replace(/([-_][a-z])/g,function(n){return n.toUpperCase().replace("-","").replace("_","")}),A)}var ee=function(n,p,v){if(!!v){for(var t=typeof n=="number"?n:n[v],b=0;b<p.length;b++)if(t==p[b][v])return b}},ie=function(n){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],v=n(1),t=(0,U.Z)(v,2),b=t[0],M=t[1];function w(S){var P=S;P<p[0]&&(P=p[0],T.default.error("Smallest scale is "+p[0])),P>p[1]&&(P=p[1],T.default.error("Largest scale is "+p[1])),M(P)}function c(S){w(b+S)}return{curr:b,change:c,setScale:w}};function fe(A,n){var p=n.defaultTool,v=A(p),t=(0,U.Z)(v,2),b=t[0],M=t[1];return{curr:b,setCurr:M}}function ce(A){var n=A(!1),p=(0,U.Z)(n,2),v=p[0],t=p[1];return{curr:v,setCurr:t}}var re=function(n){var p=n(),v=(0,U.Z)(p,2),t=v[0],b=v[1],M=n(),w=(0,U.Z)(M,2),c=w[0],S=w[1],P=n(),R=(0,U.Z)(P,2),j=R[0],D=R[1];function C(){return k.apply(this,arguments)}function k(){return k=(0,E.Z)(a().mark(function s(){var e;return a().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,B.getAll();case 3:return e=h.sent,b(e),h.abrupt("return",e);case 8:return h.prev=8,h.t0=h.catch(0),console.log("project getAll err",h.t0),O.Z.parseError(h.t0,T.default),h.abrupt("return");case 13:case"end":return h.stop()}},s,null,[[0,8]])})),k.apply(this,arguments)}function u(s){return $.apply(this,arguments)}function $(){return $=(0,E.Z)(a().mark(function s(e){var y;return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e!=null){r.next=2;break}return r.abrupt("return",void 0);case 2:if(!(t&&t.length>1)){r.next=5;break}return T.default.error("Currently have multiple projects stored, use turnTo instead"),r.abrupt("return");case 5:return r.next=7,B.get(e);case 7:return y=r.sent,b([y]),S(0),r.abrupt("return",y);case 11:case"end":return r.stop()}},s)})),$.apply(this,arguments)}function i(s){return L.apply(this,arguments)}function L(){return L=(0,E.Z)(a().mark(function s(e){return a().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return S(e),h.abrupt("return",t[e]);case 2:case"end":return h.stop()}},s)})),L.apply(this,arguments)}function W(s){return I.apply(this,arguments)}function I(){return I=(0,E.Z)(a().mark(function s(e){var y;return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("remove project",e),y=typeof e=="number"?e:e.projectId,r.next=4,B.remove(y);case 4:C();case 5:case"end":return r.stop()}},s)})),I.apply(this,arguments)}function H(s){return F.apply(this,arguments)}function F(){return F=(0,E.Z)(a().mark(function s(e){var y;return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,B.create(e);case 3:return y=r.sent,r.abrupt("return",y);case 7:return r.prev=7,r.t0=r.catch(0),console.log("project create err",r.t0),r.abrupt("return",O.Z.parseError(r.t0,T.default));case 11:case"end":return r.stop()}},s,null,[[0,7]])})),F.apply(this,arguments)}function Z(s,e){return f.apply(this,arguments)}function f(){return f=(0,E.Z)(a().mark(function s(e,y){return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:B.update(e,y).then(function(g){console.log("project update res",g)}).catch(function(g){console.log("project update err ",g),O.Z.parseError(g,T.default)});case 1:case"end":return r.stop()}},s)})),f.apply(this,arguments)}function _(){return o.apply(this,arguments)}function o(){return o=(0,E.Z)(a().mark(function s(){var e,y,h,r,g=arguments;return a().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return e=g.length>0&&g[0]!==void 0?g[0]:void 0,d.prev=1,y=e==null?t[c].projectId:e,d.next=5,B.getProgress(y);case 5:if(h=d.sent,!(!h||h.finished==null||h.total==null)){d.next=8;break}throw Error("empty progress");case 8:return r=Math.ceil(h.finished/h.total*100),D(r),d.abrupt("return",r);case 13:return d.prev=13,d.t0=d.catch(1),console.log("get progress err",d.t0),O.Z.parseError(d.t0,T.default),d.abrupt("return",0);case 18:case"end":return d.stop()}},s,null,[[1,13]])})),o.apply(this,arguments)}return{all:t,getAll:C,getCurr:u,turnTo:i,remove:W,create:H,update:Z,progress:j,getProgress:_,get curr(){if(!!t)return t[c]}}},pe=function(n,p){var v=p.oneHot,t=v===void 0?!0:v,b=p.postSetCurr,M=n(),w=(0,U.Z)(M,2),c=w[0],S=w[1],P=n(),R=(0,U.Z)(P,2),j=R[0],D=R[1],C=n(new Set),k=(0,U.Z)(C,2),u=k[0],$=k[1],i=n(t),L=(0,U.Z)(i,2),W=L[0],I=L[1];function H(g){return F.apply(this,arguments)}function F(){return F=(0,E.Z)(a().mark(function g(m){var d;return a().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(m!=null){l.next=2;break}return l.abrupt("return");case 2:return l.prev=2,l.next=5,B.getLabels(m);case 5:return d=l.sent,console.log("label getall:",d),S(d),l.abrupt("return",d);case 11:return l.prev=11,l.t0=l.catch(2),console.log("label getall err ",l.t0),l.abrupt("return",O.Z.parseError(l.t0,T.default));case 15:case"end":return l.stop()}},g,null,[[2,11]])})),F.apply(this,arguments)}function Z(g){var m=ee(g,c,"labelId");if(m==null)throw Error("label.onSelect label not found");D(m);var d=c[m].labelId;W?u.has(d)?u.clear():(u.clear(),u.add(d)):u.has(d)?u.delete(d):u.add(d),$(new Set(u)),b&&b(c[m])}function f(g){if(console.log("LabelUtils setCurr",g),!t)throw Error("multi select task doesn't have current label");if(!!g){var m=typeof g=="number"?g:g.labelId;m=ee(m,c,"labelId"),m!=null&&(console.log("LabelUtils setCurr index:",m),D(m),$(new Set([g])))}}function _(g){u.clear();var m=(0,Y.Z)(g),d;try{for(m.s();!(d=m.n()).done;){var J=d.value;u.add(J.labelId)}}catch(l){m.e(l)}finally{m.f()}}function o(g){return s.apply(this,arguments)}function s(){return s=(0,E.Z)(a().mark(function g(m){var d;return a().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return console.log("create label",m),l.prev=1,l.next=4,x.create(m);case 4:return d=l.sent,H(m.projectId),l.abrupt("return",d);case 9:return l.prev=9,l.t0=l.catch(1),console.log("label create err",l.t0),l.abrupt("return",O.Z.parseError(l.t0,T.default));case 13:case"end":return l.stop()}},g,null,[[1,9]])})),s.apply(this,arguments)}function e(g){return y.apply(this,arguments)}function y(){return y=(0,E.Z)(a().mark(function g(m){var d;return a().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return d=typeof m=="number"?m:m.labelId,l.prev=1,l.next=4,x.remove(d);case 4:c&&c.length&&H(c[0].projectId),l.next=11;break;case 7:l.prev=7,l.t0=l.catch(1),console.log("label remove err",l.t0),O.Z.parseError(l.t0,T.default);case 11:case"end":return l.stop()}},g,null,[[1,7]])})),y.apply(this,arguments)}function h(g){var m=typeof g=="number"?g:g.labelId;return u.has(m)}var r=function(m){m!=null?I(m):I(!W)};return{all:c,getAll:H,activeIds:u,initActive:_,onSelect:Z,setCurr:f,isActive:h,create:o,remove:e,toggleOneHot:r,get curr(){if(c!=null)return c[j]}}},de=function(n){var p=n(),v=(0,U.Z)(p,2),t=v[0],b=v[1],M=n(),w=(0,U.Z)(M,2),c=w[0],S=w[1],P=function(u){if(!!t){if(u<0){T.default.error("This is the first image. No previous image.");return}if(u==t.length){T.default.error("This is the final image. No next image.");return}S(u)}},R=function(){var k=(0,E.Z)(a().mark(function u($,i){var L;return a().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,I.next=3,B.getTasks($);case 3:if(L=I.sent,b(L),i==null){I.next=9;break}return console.log("getall turnto"),P(i),I.abrupt("return",[L,L[i]]);case 9:return I.abrupt("return",L);case 12:return I.prev=12,I.t0=I.catch(0),console.log("task getall err ",I.t0),I.abrupt("return",O.Z.parseError(I.t0,T.default));case 16:case"end":return I.stop()}},u,null,[[0,12]])}));return function($,i){return k.apply(this,arguments)}}();function j(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return k==null||!t?0:Math.round(t.length*k/100)}var D=function(){var k=(0,E.Z)(a().mark(function u(){return a().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:P(c+1),console.log("all tasks",t);case 2:case"end":return i.stop()}},u)}));return function(){return k.apply(this,arguments)}}(),C=function(){var k=(0,E.Z)(a().mark(function u(){return a().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:P(c-1);case 1:case"end":return i.stop()}},u)}));return function(){return k.apply(this,arguments)}}();return{currIdx:c,all:t,turnTo:P,getAll:R,nextTask:D,prevTask:C,finished:j,get curr(){if(!(c==null||t==null))return t[c]}}};function oe(A,n){var p=n.label,v=p===void 0?void 0:p,t=n.project,b=t===void 0?void 0:t,M=A(),w=(0,U.Z)(M,2),c=w[0],S=w[1],P=A(),R=(0,U.Z)(P,2),j=R[0],D=R[1],C=function(){var Z=(0,E.Z)(a().mark(function f(_){var o;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("AnnotationUtils getAll, dataId:",_),_!=null){e.next=3;break}return e.abrupt("return",[]);case 3:return e.prev=3,e.next=6,ue.getAnnotations(_);case 6:return o=e.sent,console.log("AnnotationUtils getAll, annRes:",o),S(o),e.abrupt("return",o);case 12:return e.prev=12,e.t0=e.catch(3),console.log("AnnotationUtils ann getAll err",e.t0),O.Z.parseError(e.t0,T.default),e.abrupt("return",[]);case 17:case"end":return e.stop()}},f,null,[[3,12]])}));return function(_){return Z.apply(this,arguments)}}(),k=function(){var Z=(0,E.Z)(a().mark(function f(_){var o,s,e,y=arguments;return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=y.length>1&&y[1]!==void 0?y[1]:!1,console.log("create label",_.label),r.prev=2,_.label&&(_.labelId=_.label.labelId),_.label=void 0,r.next=7,z.create(_);case 7:if(s=r.sent,i(s),e=[],!_.dataId){r.next=14;break}return r.next=13,C(_.dataId);case 13:e=r.sent;case 14:b&&e.length==1&&b.getProgress(),r.next=21;break;case 17:return r.prev=17,r.t0=r.catch(2),console.log("annotation create err",r.t0),r.abrupt("return",O.Z.parseError(r.t0,T.default));case 21:case"end":return r.stop()}},f,null,[[2,17]])}));return function(_){return Z.apply(this,arguments)}}();function u(Z){return $.apply(this,arguments)}function $(){return $=(0,E.Z)(a().mark(function Z(f){var _,o;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove",f),_=typeof f=="number"?f:f.annotationId,_!=null){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,z.remove(_);case 7:if(!(c&&c.length&&c[0].dataId)){e.next=12;break}return e.next=10,C(c[0].dataId);case 10:o=e.sent,o.length==0&&b.getProgress();case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(4),console.log("annotation remove err",e.t0),e.abrupt("return",O.Z.parseError(e.t0,T.default));case 18:case"end":return e.stop()}},Z,null,[[4,14]])})),$.apply(this,arguments)}function i(Z){return L.apply(this,arguments)}function L(){return L=(0,E.Z)(a().mark(function Z(f){return a().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(console.log("annotation setcurr",f,"all",c),f!=null){o.next=4;break}return D(void 0),o.abrupt("return");case 4:D(f),v.setCurr(f.labelId);case 6:case"end":return o.stop()}},Z)})),L.apply(this,arguments)}function W(Z){return I.apply(this,arguments)}function I(){return I=(0,E.Z)(a().mark(function Z(f){var _;return a().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(f.annotationId){s.next=2;break}return s.abrupt("return",[]);case 2:f.taskId=void 0,f.label&&(f.labelId=(_=f.label)===null||_===void 0?void 0:_.labelId),f.label=void 0,z.update(f.annotationId,f).then(function(e){return console.log("annotation update res",e),i(f),C(f.dataId)}).catch(function(e){return console.log("annotation update err ",e),O.Z.parseError(e,T.default),[]});case 6:case"end":return s.stop()}},Z)})),I.apply(this,arguments)}function H(Z){return F.apply(this,arguments)}function F(){return F=(0,E.Z)(a().mark(function Z(f){return a().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(f){o.next=2;break}return o.abrupt("return",void 0);case 2:if(f.annotationId!=null){o.next=7;break}return o.next=5,k(f);case 5:o.next=9;break;case 7:return o.next=9,W(f);case 9:case"end":return o.stop()}},Z)})),F.apply(this,arguments)}return{all:c,getAll:C,create:k,remove:u,setCurr:i,update:W,modify:H,curr:j}}var ge=function(n){var p=n(),v=(0,U.Z)(p,2),t=v[0],b=v[1],M=n([]),w=(0,U.Z)(M,2),c=w[0],S=w[1],P=function(){var j=(0,E.Z)(a().mark(function D(C){return a().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:b(C);case 1:case"end":return u.stop()}},D)}));return function(C){return j.apply(this,arguments)}}(),R=function(){var j=(0,E.Z)(a().mark(function D(C,k){var u;return a().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,te.getDatas(C);case 3:if(u=i.sent,S(u),k==null){i.next=8;break}return P(k),i.abrupt("return",[u,u[k]]);case 8:return i.abrupt("return",u);case 11:return i.prev=11,i.t0=i.catch(0),console.log("data getall err ",i.t0),i.abrupt("return",O.Z.parseError(i.t0,T.default));case 15:case"end":return i.stop()}},D,null,[[0,11]])}));return function(C,k){return j.apply(this,arguments)}}();return{all:c,getAll:R,turnTo:P,get curr(){if(!(t==null||c==null))return c[t]},get imgSrc(){return c&&c[t]?"".concat(V,"/datas/").concat(c[t].dataId,"/image?sault=").concat(c[t].sault):""}}};function ve(A,n){B.exportDataset(A,{exportDir:n}).then(function(p){console.log(p)}).catch(function(p){console.log("export error",p),O.Z.parseError(p,T.default)})}function he(A,n){return Q.apply(this,arguments)}function Q(){return Q=(0,E.Z)(a().mark(function A(n,p){return a().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:console.log("split param",p),B.splitDataset(n,p).then(function(b){console.log(b)}).catch(function(b){console.log("split error",b),O.Z.parseError(b,T.default)});case 2:case"end":return t.stop()}},A)})),Q.apply(this,arguments)}var me=function(n,p,v){var t=fe(n,v.tool?v.tool:{}),b=ce(n),M=ie(n),w=de(n),c=ge(n),S=re(n),P=pe(n,v.label?v.label:{}),R=oe(n,(0,X.Z)((0,X.Z)({},v.annotation),{},{label:P,project:S}));return p(function(){var j=O.Z.getQueryVariable("projectId");if(j==null){q.m8.push("/");return}var D=parseInt(j);S.getCurr(j).catch(function(C){O.Z.parseError(C,T.default),q.m8.push("/")}),P.getAll(D),w.getAll(D),S.getProgress(D)},[]),p(function(){w.all&&w.all.length!=0&&w.turnTo(0)},[w.all]),p(function(){if(w.currIdx!=null){var j=function(){var D=(0,E.Z)(a().mark(function C(){var k,u,$,i,L,W,I,H,F,Z,f,_;return a().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if((k=w.curr)!==null&&k!==void 0&&k.projectId&&S.getProgress(w.curr.projectId),!((u=w.curr)!==null&&u!==void 0&&u.taskId)){s.next=13;break}return s.next=4,c.getAll(w.curr.taskId,0);case 4:return L=s.sent,W=(0,U.Z)(L,2),I=W[0],H=W[1],s.next=10,R.getAll(H.dataId);case 10:if(F=s.sent,P.all){Z=(0,Y.Z)(P.all);try{for(Z.s();!(f=Z.n()).done;)_=f.value,_.active=!1}catch(e){Z.e(e)}finally{Z.f()}}($=v.effectTrigger)!==null&&$!==void 0&&$.postTaskChange&&((i=v.effectTrigger)===null||i===void 0||i.postTaskChange(P.all,F));case 13:b.setCurr(!1);case 14:case"end":return s.stop()}},C)}));return function(){return D.apply(this,arguments)}}();j()}},[w.currIdx]),[t,b,M,R,w,c,S,P,he,ve]}}}]);
