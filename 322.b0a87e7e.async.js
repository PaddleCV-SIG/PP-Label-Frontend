(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(pe,q,j){"use strict";j.d(q,{gu:function(){return ne},os:function(){return te},Gd:function(){return Y},$L:function(){return ce}});var x=j(86582),N=j(91220),Z=j(3182),oe=j(34792),E=j(48086),O=j(2824),ee=j(94043),t=j.n(ee),V=j(48971),S=j(37071),W=j(81139),G=localStorage.getItem("basePath"),H=new W.VK(G?{basePath:G}:void 0),R=new W.U(H),re=new W.sD(H),ae=new W.W6(H),z=new W.Cl(H),Q=new W.vb(H),ne=function(f){return JSON.parse(JSON.stringify(f))};function te(U){return U&&(U.toLowerCase().replace(/([-_][a-z])/g,function(f){return f.toUpperCase().replace("-","").replace("_","")}),U)}var X=function(f,b,_){if(!!_){for(var u=typeof f=="number"?f:f[_],w=0;w<b.length;w++)if(u==b[w][_])return w}},ue=function(f){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],_=f(1),u=(0,O.Z)(_,2),w=u[0],M=u[1];function I(o){var P=o;P<b[0]&&(P=b[0],E.default.error("Smallest scale is "+b[0])),P>b[1]&&(P=b[1],E.default.error("Largest scale is "+b[1])),M(P)}function d(o){I(w+o)}return{curr:w,change:d,setScale:I}},Y=function(f){var b=f(),_=(0,O.Z)(b,2),u=_[0],w=_[1],M=f(),I=(0,O.Z)(M,2),d=I[0],o=I[1];function P(){return L.apply(this,arguments)}function L(){return L=(0,Z.Z)(t().mark(function r(){var s;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.getAll();case 3:return s=e.sent,w(s),e.abrupt("return",s);case 8:return e.prev=8,e.t0=e.catch(0),console.log("project getAll err",e.t0),S.Z.parseError(e.t0,E.default),e.abrupt("return");case 13:case"end":return e.stop()}},r,null,[[0,8]])})),L.apply(this,arguments)}function C(r){return T.apply(this,arguments)}function T(){return T=(0,Z.Z)(t().mark(function r(s){var g;return t().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(s!=null){i.next=2;break}return i.abrupt("return",void 0);case 2:if(!(u&&u.length>1)){i.next=5;break}return E.default.error("Currently have multiple projects stored, use turnTo instead"),i.abrupt("return");case 5:return i.next=7,R.get(s);case 7:return g=i.sent,w([g]),o(0),i.abrupt("return",g);case 11:case"end":return i.stop()}},r)})),T.apply(this,arguments)}function h(r){return c.apply(this,arguments)}function c(){return c=(0,Z.Z)(t().mark(function r(s){return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o(s),e.abrupt("return",u[s]);case 2:case"end":return e.stop()}},r)})),c.apply(this,arguments)}function n(r){return v.apply(this,arguments)}function v(){return v=(0,Z.Z)(t().mark(function r(s){var g;return t().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return console.log("remove project",s),g=typeof s=="number"?s:s.projectId,i.next=4,R.remove(g);case 4:P();case 5:case"end":return i.stop()}},r)})),v.apply(this,arguments)}function l(r){return a.apply(this,arguments)}function a(){return a=(0,Z.Z)(t().mark(function r(s){var g;return t().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,R.create(s);case 3:return g=i.sent,i.abrupt("return",g);case 7:return i.prev=7,i.t0=i.catch(0),console.log("project create err",i.t0),i.abrupt("return",S.Z.parseError(i.t0,E.default));case 11:case"end":return i.stop()}},r,null,[[0,7]])})),a.apply(this,arguments)}function p(r,s){return A.apply(this,arguments)}function A(){return A=(0,Z.Z)(t().mark(function r(s,g){return t().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:R.update(s,g).then(function(K){console.log("project update res",K)}).catch(function(K){console.log("project update err ",K),S.Z.parseError(K,E.default)});case 1:case"end":return i.stop()}},r)})),A.apply(this,arguments)}return{all:u,getAll:P,getCurr:C,turnTo:h,remove:n,create:l,update:p,get curr(){if(!!u)return u[d]}}},le=function(f,b){var _=b.oneHot,u=_===void 0?!0:_,w=b.postSetCurr,M=f(),I=(0,O.Z)(M,2),d=I[0],o=I[1],P=f(),L=(0,O.Z)(P,2),C=L[0],T=L[1],h=f(new Set),c=(0,O.Z)(h,2),n=c[0],v=c[1],l=f(u),a=(0,O.Z)(l,2),p=a[0],A=a[1];function r($){return s.apply(this,arguments)}function s(){return s=(0,Z.Z)(t().mark(function $(k){var y;return t().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.prev=0,m.next=3,R.getLabels(k);case 3:return y=m.sent,o(y),m.abrupt("return",y);case 8:return m.prev=8,m.t0=m.catch(0),console.log("label getall err ",m.t0),m.abrupt("return",S.Z.parseError(m.t0,E.default));case 12:case"end":return m.stop()}},$,null,[[0,8]])})),s.apply(this,arguments)}function g($){console.log("label setcurr",$);var k=X($,d,"labelId");if(k==null)throw Error("label.setCurr label not found");T(k);var y=d[k].labelId;p?(n.clear(),n.add([y])):n.has(y)?n.delete(y):n.add(y),v(new Set(n)),w&&w(d[k])}function e($){n.clear();var k=(0,N.Z)($),y;try{for(k.s();!(y=k.n()).done;){var B=y.value;n.add(B.labelId)}}catch(m){k.e(m)}finally{k.f()}}var i=function(){var $=(0,Z.Z)(t().mark(function k(y){var B;return t().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.prev=0,D.next=3,Q.create(y);case 3:return B=D.sent,r(y.projectId),D.abrupt("return",B);case 8:return D.prev=8,D.t0=D.catch(0),console.log("label create err",D.t0),D.abrupt("return",S.Z.parseError(D.t0,E.default));case 12:case"end":return D.stop()}},k,null,[[0,8]])}));return function(y){return $.apply(this,arguments)}}(),K=function(){var $=(0,Z.Z)(t().mark(function k(y){return t().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return console.log("remove label",y),m.prev=1,m.next=4,Q.remove(y.labelId);case 4:o(d.filter(function(D){return D.labelId!=y.labelId})),m.next=11;break;case 7:m.prev=7,m.t0=m.catch(1),console.log("label remove err",m.t0),S.Z.parseError(m.t0,E.default);case 11:case"end":return m.stop()}},k,null,[[1,7]])}));return function(y){return $.apply(this,arguments)}}();function F($){return n.has($.labelId)}var J=function(k){k!=null?A(k):A(!p)};return{all:d,getAll:r,activeIds:n,initActive:e,setCurr:g,isActive:F,create:i,remove:K,toggleOneHot:J,get curr(){if(d!=null)return d[C]}}},se=function(f){var b=f(),_=(0,O.Z)(b,2),u=_[0],w=_[1],M=f(),I=(0,O.Z)(M,2),d=I[0],o=I[1],P=f(),L=(0,O.Z)(P,2),C=L[0],T=L[1],h=function(p){if(p<0){E.default.error("This is the first image. No previous image.");return}if(p==u.length){E.default.error("This is the final image. No next image.");return}o(p)},c=function(){var a=(0,Z.Z)(t().mark(function p(A,r){var s;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.getTasks(A);case 3:if(s=e.sent,w(s),r==null){e.next=9;break}return console.log("getall turnto"),h(r),e.abrupt("return",[s,s[r]]);case 9:return e.abrupt("return",s);case 12:return e.prev=12,e.t0=e.catch(0),console.log("task getall err ",e.t0),e.abrupt("return",S.Z.parseError(e.t0,E.default));case 16:case"end":return e.stop()}},p,null,[[0,12]])}));return function(A,r){return a.apply(this,arguments)}}(),n=function(){var a=(0,Z.Z)(t().mark(function p(A){var r,s;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.getProgress(A);case 3:if(r=e.sent,!(!r||r.finished==null||r.total==null)){e.next=6;break}throw Error("empty progress");case 6:return s=Math.ceil(r.finished/r.total*100),T(s),e.abrupt("return",s);case 11:return e.prev=11,e.t0=e.catch(0),console.log("get progress err",e.t0),S.Z.parseError(e.t0,E.default),e.abrupt("return",0);case 16:case"end":return e.stop()}},p,null,[[0,11]])}));return function(A){return a.apply(this,arguments)}}(),v=function(){var a=(0,Z.Z)(t().mark(function p(){return t().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:h(d+1),console.log("all tasks",u);case 2:case"end":return r.stop()}},p)}));return function(){return a.apply(this,arguments)}}(),l=function(){var a=(0,Z.Z)(t().mark(function p(){return t().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:h(d-1);case 1:case"end":return r.stop()}},p)}));return function(){return a.apply(this,arguments)}}();return{currIdx:d,all:u,turnTo:h,getAll:c,getProgress:n,progress:C,nextTask:v,prevTask:l,get curr(){if(!(d==null||u==null))return u[d]},get finished(){return Math.floor((u==null?void 0:u.length)*C/100)}}},ie=function(f){var b=f(),_=(0,O.Z)(b,2),u=_[0],w=_[1],M=f(),I=(0,O.Z)(M,2),d=I[0],o=I[1],P=function(){var h=(0,Z.Z)(t().mark(function c(n){var v,l,a,p;return t().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,ae.getAnnotations(n);case 3:v=r.sent,l=(0,N.Z)(v);try{for(l.s();!(a=l.n()).done;)p=a.value,p.active=!1}catch(s){l.e(s)}finally{l.f()}return w(v),r.abrupt("return",v);case 10:return r.prev=10,r.t0=r.catch(0),console.log("ann getAll err",r.t0),r.abrupt("return",S.Z.parseError(r.t0,E.default));case 14:case"end":return r.stop()}},c,null,[[0,10]])}));return function(n){return h.apply(this,arguments)}}(),L=function(){var h=(0,Z.Z)(t().mark(function c(n){var v;return t().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("create",n),a.prev=1,a.next=4,z.create(n);case 4:return v=a.sent,n.dataId&&P(n.dataId),a.abrupt("return",v);case 9:return a.prev=9,a.t0=a.catch(1),console.log("annotation create err",a.t0),a.abrupt("return",S.Z.parseError(a.t0,E.default));case 13:case"end":return a.stop()}},c,null,[[1,9]])}));return function(n){return h.apply(this,arguments)}}(),C=function(){var h=(0,Z.Z)(t().mark(function c(n){var v;return t().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(console.log("typeof",typeof n),v=typeof n!="number"?n.annotationId:n,a.prev=2,!v){a.next=6;break}return a.next=6,z.remove(v);case 6:w(u.filter(function(p){return p.annotationId!=v})),a.next=13;break;case 9:return a.prev=9,a.t0=a.catch(2),console.log("annotation remove err",a.t0),a.abrupt("return",S.Z.parseError(a.t0,E.default));case 13:case"end":return a.stop()}},c,null,[[2,9]])}));return function(n){return h.apply(this,arguments)}}(),T=function(){var h=(0,Z.Z)(t().mark(function c(n,v){var l,a,p,A,r;return t().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(n!=null){g.next=3;break}return o(void 0),g.abrupt("return");case 3:l=(0,N.Z)(u);try{for(l.s();!(a=l.n()).done;)p=a.value,p.active=!1}catch(e){l.e(e)}finally{l.f()}A=u.filter(function(e){return e.annotationId==n.annotationId})[0],A.active=!n.active,r=X(A,u,"annotationId"),o(r),w((0,x.Z)(u)),console.log("ann on select label",v),v.setCurr(n.labelId);case 12:case"end":return g.stop()}},c)}));return function(n,v){return h.apply(this,arguments)}}();return{all:u,getAll:P,create:L,remove:C,setCurr:T,get curr(){if(!(!u||!d))return u[d]}}},fe=function(f){var b=f(),_=(0,O.Z)(b,2),u=_[0],w=_[1],M=f([]),I=(0,O.Z)(M,2),d=I[0],o=I[1],P=function(){var C=(0,Z.Z)(t().mark(function T(h){return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:w(h);case 1:case"end":return n.stop()}},T)}));return function(h){return C.apply(this,arguments)}}(),L=function(){var C=(0,Z.Z)(t().mark(function T(h,c){var n;return t().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,re.getDatas(h);case 3:if(n=l.sent,o(n),c==null){l.next=8;break}return P(c),l.abrupt("return",[n,n[c]]);case 8:return l.abrupt("return",n);case 11:return l.prev=11,l.t0=l.catch(0),console.log("data getall err ",l.t0),l.abrupt("return",S.Z.parseError(l.t0,E.default));case 15:case"end":return l.stop()}},T,null,[[0,11]])}));return function(h,c){return C.apply(this,arguments)}}();return{all:d,getAll:L,turnTo:P,get curr(){if(!(u==null||d==null))return d[u]},get imgSrc(){return d&&d[u]?"".concat(G,"/datas/").concat(d[u].dataId,"/image?sault=").concat(d[u].sault):""}}},ce=function(f,b,_){_.effectTrigger||(_.effectTrigger={});var u=f(!1),w=(0,O.Z)(u,2),M=w[0],I=w[1],d=ue(f),o=se(f),P=fe(f),L=Y(f),C=le(f,_.label),T=ie(f);return b(function(){var h=S.Z.getQueryVariable("projectId");if(h==null){V.m8.push("/");return}var c=parseInt(h);L.getCurr(h).catch(function(n){S.Z.parseError(n,E.default),V.m8.push("/")}),C.getAll(c),o.getAll(c),o.getProgress(c)},[]),b(function(){o.all&&o.all.length!=0&&o.turnTo(0)},[o.all]),b(function(){if(o.currIdx!=null){var h=function(){var c=(0,Z.Z)(t().mark(function n(){var v,l,a,p,A,r,s,g,e,i;return t().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if((v=o.curr)!==null&&v!==void 0&&v.projectId&&o.getProgress(o.curr.projectId),!((l=o.curr)!==null&&l!==void 0&&l.taskId)){F.next=13;break}return F.next=4,P.getAll(o.curr.taskId,0);case 4:return a=F.sent,p=(0,O.Z)(a,2),A=p[0],r=p[1],F.next=10,T.getAll(r.dataId);case 10:if(s=F.sent,C.all){g=(0,N.Z)(C.all);try{for(g.s();!(e=g.n()).done;)i=e.value,i.active=!1}catch(J){g.e(J)}finally{g.f()}}_.effectTrigger.postTaskChange&&_.effectTrigger.postTaskChange(C.all,s);case 13:I(!1);case 14:case"end":return F.stop()}},n)}));return function(){return c.apply(this,arguments)}}();h()}},[o.currIdx]),[M,I,d,T,o,P,L,C]}}}]);
