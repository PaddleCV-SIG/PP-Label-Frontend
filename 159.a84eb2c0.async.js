(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[159],{13237:function(V){V.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},85024:function(V){V.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(V){V.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},26647:function(V){V.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___1FTWb",toolBarButtonContainer:"toolBarButtonContainer___1Vahn",toolBarButton:"toolBarButton___3mR2H",buttonText:"buttonText___Y0WDm",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3lRZ8",popover:"popover___3zzu2",slider:"slider___ALra-",popoverLeft:"popoverLeft___15lGe"}},8978:function(V,J,n){"use strict";n.d(J,{Z:function(){return sn}});var _=n(11849),en=n(2824),X=n(91220),K=n(67294),x=n(85893);function C(e){if(!e||!e.width||!e.color||!e.points||e.points.length<2||e.frontendId==null)return"";var h=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(h,",").concat(e.points.join(","))}function r(e){var h,l=e.canvasRef,v=e.annotation,m=v.result;if(!m)return(0,x.jsx)(x.Fragment,{});var L=(h=l.current)===null||h===void 0?void 0:h.getContext("2d");if(!L)return(0,x.jsx)(x.Fragment,{});for(var T=[],t=0,g=0;g<m.length;g++)m.at(g)==","?(T.push(parseFloat(m.slice(t,g))),t=g+1):m.at(g)=="|"?(T.push(parseFloat(m.slice(t,g))),a(T,L,v),T=[],t=g+1):g==m.length-1&&(T.push(parseFloat(m.slice(t,m.length))),a(T,L,v));return(0,x.jsx)(x.Fragment,{})}function a(e,h,l){var v;if(e.length<4){console.log("found incorrect points:",e);return}var m=e[0],L=e[1];if(m==0){var T;Q(h,e.slice(2),(T=l.label)===null||T===void 0?void 0:T.color);return}if(L==0){k(h,m,e.slice(2),void 0);return}k(h,m,e.slice(2),(v=l.label)===null||v===void 0?void 0:v.color)}function k(e,h,l,v){e.beginPath(),e.moveTo(l[0],l[1]);for(var m=0;m<=l.length/2-1;m++){var L=l[2*m],T=l[2*m+1];e.lineTo(L,T)}e.lineCap="round",e.lineJoin="round",e.lineWidth=h,v&&(e.strokeStyle=v),e.globalCompositeOperation=v?"source-over":"destination-out",e.stroke()}function Q(e,h,l){e.globalCompositeOperation=l?"source-over":"destination-out",l&&(e.fillStyle=l);for(var v=0;v<=h.length/2-1;v++){var m=h[2*v],L=h[2*v+1];e.fillRect(m,L,1,1)}}function p(e){if(!e||e.length==0)return 0;var h=0,l=(0,X.Z)(e),v;try{for(l.s();!(v=l.n()).done;){var m=v.value;m.frontendId>h&&(h=m.frontendId)}}catch(L){l.e(L)}finally{l.f()}return h}function dn(e,h){return e=="rubber"||h==2?"rubber":"brush"}function sn(e){var h=(0,K.useState)(),l=(0,en.Z)(h,2),v=l[0],m=l[1],L=function(S){var B,G;if(!(e.currentTool!="brush"&&e.currentTool!="rubber"||!((B=e.currentLabel)!==null&&B!==void 0&&B.color)||!e.brushSize)){var tn=S.mouseX,D=S.mouseY,w=dn(e.currentTool,S.e.evt.button);console.log("frontendId: ",e.frontendIdOps.frontendId,"maxId:",p(e.annotations));var z=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:p(e.annotations)+1;z!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(z);var on=C({width:e.brushSize||10,color:(G=e.currentLabel)===null||G===void 0?void 0:G.color,points:[tn,D,tn,D],type:w,frontendId:z});if(!!on){m(w);var U={dataId:e.dataId,label:e.currentLabel,labelId:e.currentLabel.labelId,frontendId:z,result:on,type:"brush"};e.onAnnotationAdd(U)}}},T=function(S){var B;if(!(!v||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((B=e.currentLabel)!==null&&B!==void 0&&B.color))){var G=S.mouseX,tn=S.mouseY,D=e.currentAnnotation.result+",".concat(G,",").concat(tn);e.onAnnotationModify((0,_.Z)((0,_.Z)({},e.currentAnnotation),{},{result:D}))}},t=function(){e.currentTool!="brush"&&e.currentTool!="rubber"||(m(void 0),e.onMouseUp())};return{onMouseDown:L,onMouseMove:T,onMouseUp:t,drawAnnotation:r}}},57406:function(V,J,n){"use strict";n.d(J,{pL:function(){return en},oo:function(){return X}});var _=n(91220);function en(C){var r=0;if(!C)return r;var a=(0,_.Z)(C),k;try{for(a.s();!(k=a.n()).done;){var Q=k.value;!Q||!Q.frontendId||Q.frontendId>r&&(r=Q.frontendId)}}catch(p){a.e(p)}finally{a.f()}return r}function X(C){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(C);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null}function K(C){var r=C.toString(16);return r.length==1?"0"+r:r}function x(C,r,a){return"#"+K(C)+K(r)+K(a)}},14836:function(V,J,n){"use strict";n.d(J,{Z:function(){return t}});var _=n(54421),en=n(38272),X=n(57663),K=n(71577),x=n(91220),C=n(67294),r=n(56159),a=n.n(r),k=n(49111),Q=n(19650),p=n(2824),dn=n(11849),sn=n(85024),e=n.n(sn),h=n(63097),l=n(85893),v=function(S){var B=(0,dn.Z)({},S.annotation),G=(0,C.useState)(B.invisible),tn=(0,p.Z)(G,2),D=tn[0],w=tn[1],z=(0,C.useState)(0),on=(0,p.Z)(z,2),U=on[0],an=on[1];(0,C.useEffect)(function(){w(S.annotation.invisible)},[S.annotation.invisible]);var rn=(0,l.jsxs)(en.ZP.Item,{className:"".concat(e().listItem," ").concat(S.active?e().listItemActive:""),unselectable:"on",onClick:function(){S.onClick(B)},children:[(0,l.jsxs)(Q.Z,{align:"center",size:5,children:[(0,l.jsx)("a",{className:e().eye,style:{backgroundImage:D?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(mn){mn.stopPropagation(),w(!D),S.onAnnotationModify(B)}})," ",(0,l.jsx)("span",{className:e().annotationId,children:B.frontendId}),(0,l.jsx)("span",{className:e().labelName,children:B.label.name}),(0,l.jsx)(h.Z,{color:B.label.color})]}),(0,l.jsx)("a",{className:e().delete,onClick:function(mn){mn.stopPropagation();var fn=new Date().getTime();fn-U<300||(an(fn),S.onAnnotationDelete(B))}})]});return rn},m=v,L=n(48971),T=function(S){var B=(0,L.YB)(),G=B.formatMessage({id:"component.PPAnnotationList.annotationList"}),tn=B.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),D=new Set,w=[],z=(0,x.Z)(S.annotations),on;try{for(z.s();!(on=z.n()).done;){var U=on.value;D.has(U.frontendId)||(w.push(U),D.add(U.frontendId))}}catch(an){z.e(an)}finally{z.f()}return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(en.ZP,{className:a().labelList,size:"large",header:(0,l.jsx)("div",{className:a().listHeader,children:G}),bordered:!0,dataSource:w,renderItem:function(rn){var q;return(0,l.jsx)(m,{onClick:S.onAnnotationSelect,annotation:rn,active:rn.frontendId==((q=S.currAnnotation)===null||q===void 0?void 0:q.frontendId),onAnnotationDelete:S.onAnnotationDelete,onAnnotationModify:S.onAnnotationModify})},footer:(0,l.jsx)("div",{children:(0,l.jsx)(K.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){S.onAnnotationAdd()},block:!0,children:tn})})})})},t=T},27992:function(V,J,n){"use strict";var _=n(20136),en=n(55241),X=n(13062),K=n(71230),x=n(77883),C=n(70507),r=n(89032),a=n(15746),k=n(66126),Q=n(75454),p=n(2824),dn=n(67294),sn=n(61541),e=n(26647),h=n.n(e),l=n(85893),v=0,m=100,L=10,T=function(g){var S=(0,dn.useState)(on(g.size)),B=(0,p.Z)(S,2),G=B[0],tn=B[1];function D(U){tn(on(U))}var w=g.minSize==null?v:g.minSize,z=g.maxSize==null?m:g.maxSize;function on(U){return U==null?L:U<=w?w:U>=z?z:U}return(0,dn.useEffect)(function(){D(g.size)},[g.size]),(0,l.jsxs)(en.Z,{overlayClassName:"".concat(h().popover," ").concat(g.disLoc=="left"?h().popoverLeft:""),placement:g.disLoc||"right",content:(0,l.jsxs)(K.Z,{children:[(0,l.jsx)(a.Z,{span:16,children:(0,l.jsx)(Q.Z,{className:h().slider,value:G,max:z,min:w,onChange:function(an){var rn;(rn=g.onChange)===null||rn===void 0||rn.call(0,an)},tooltipVisible:!1})}),(0,l.jsx)(a.Z,{span:8,children:(0,l.jsx)(C.Z,{min:w,max:z,value:G,onChange:function(an){var rn;(rn=g.onChange)===null||rn===void 0||rn.call(0,an)},step:10})})]}),trigger:"hover",children:[" ",(0,l.jsx)(sn.Z,{imgSrc:g.imgSrc||"",onClick:g.onClick,active:g.active,children:g.children})]})};J.Z=T},10137:function(V,J,n){"use strict";var _=n(34669),en=n(54458),X=n(67294),K=n(85893),x=function(r){var a,k;return(0,K.jsxs)("div",{className:"progress",children:[(0,K.jsx)(en.Z,{className:"progressBar",percent:Math.ceil(r.project.finished/((a=r.task.all)===null||a===void 0?void 0:a.length)*100),status:"active",showInfo:!1})," ",(0,K.jsxs)("span",{className:"progressDesc",children:["Current labeling ",r.task.currIdx==null?1:r.task.currIdx+1," of"," ",(k=r.task.all)===null||k===void 0?void 0:k.length,". Already labeled ",r.project.finished||0,"."]})]})};J.Z=x},91861:function(V,J,n){"use strict";n.d(J,{Ad:function(){return en},k3:function(){return X},Vd:function(){return K},td:function(){return x}});var _=40;function en(){localStorage.removeItem("history"),X([])}function X(C){var r=localStorage.getItem("history"),a=r?JSON.parse(r):{index:-1,items:[]};if(JSON.stringify(a.items[a.index])!=JSON.stringify(C)){var k=a.index>_?a.index-_:0,Q=a.items.splice(k,a.index==0?1:a.index+1);a.items=Q.concat([C]),a.index<=_?a.index++:a.index=_+1,localStorage.setItem("history",JSON.stringify(a))}}function K(){var C=localStorage.getItem("history");if(!!C){var r=JSON.parse(C);if(!!r&&!(r.index>=r.items.length-1))return r.index++,localStorage.setItem("history",JSON.stringify(r)),r.items[r.index]}}function x(){var C=localStorage.getItem("history");if(!!C){var r=JSON.parse(C);if(!(!r||!r.index)&&!(r.index<=0))return r.index--,localStorage.setItem("history",JSON.stringify(r)),r.items[r.index]}}},91159:function(V,J,n){"use strict";n.r(J),n.d(J,{MOST_HISTORY_STEPS:function(){return Tn},default:function(){return Un}});var _=n(11849),en=n(57663),X=n(71577),K=n(34792),x=n(48086),C=n(91220),r=n(2824),a=n(67294),k=n(48971),Q=n(8088),p=n(61541),dn=n(44434),sn=n(27992),e=n(5041),h=n(57436),l=n(14836),v=n(91861),m=n(8978),L=n(65031),T=n(57406),t=n(85893);function g(i,I){if(!(!i||!I))return I.join(",")}function S(i){var I,P=i.annotation;if(!P||!P.result||P.result.length<2||!((I=P.label)!==null&&I!==void 0&&I.color))return(0,t.jsx)(t.Fragment,{});var b=P.result.split(",").map(Number),s=P.label.color,M=(0,T.oo)(s);if(!M)return(0,t.jsx)(t.Fragment,{});var F=.3,N=void 0,Z=[];return b.forEach(function(W,c){if(!N){N=W;return}Z.push((0,t.jsx)(L.Cd,{onMouseDown:function(){i.currentTool=="editor"&&i.onSelect(P)},draggable:i.currentTool=="editor",onDragMove:function(E){var d;E.cancelBubble=!0;var y=(d=i.stageRef)===null||d===void 0?void 0:d.current,j=y.findOne(".baseImage"),ln=!1,A=E.target.x();A>j.width()/2&&(A=j.width()/2,ln=!0),A<-j.width()/2&&(A=-j.width()/2,ln=!0);var O=E.target.y();O>j.height()/2&&(O=j.height()/2,ln=!0),O<-j.height()/2&&(O=-j.height()/2,ln=!0),ln&&E.target.setPosition({x:A,y:O}),b[c-1]=A,b[c]=O;var R=(0,_.Z)((0,_.Z)({},P),{},{result:b.join(",")});i.onDrag(R)},onMouseOver:function(){var E;i.currentTool=="editor"&&(E=i.stageRef)!==null&&E!==void 0&&E.current&&(i.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var E;(E=i.stageRef)!==null&&E!==void 0&&E.current&&(i.stageRef.current.container().style.cursor="default")},x:N,y:W,radius:5/i.scale,fill:s})),N=void 0}),(0,t.jsxs)(L.ZA,{children:[(0,t.jsx)(L.x1,{onMouseOver:function(){i.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){i.currentTool=="editor"&&i.onSelect(P)},stroke:s,strokeWidth:2/i.scale,globalCompositeOperation:"source-over",lineCap:"round",points:b,tension:0,closed:!0,fill:"rgba(".concat(M.r,", ").concat(M.g,", ").concat(M.b,", ").concat(F,")")}),Z]},P.frontendId)}function B(i){var I=0;if(!i)return I;var P=(0,C.Z)(i),b;try{for(P.s();!(b=P.n()).done;){var s=b.value;!s||!s.frontendId||s.frontendId>I&&(I=s.frontendId)}}catch(M){P.e(M)}finally{P.f()}return I}function G(i){var I=function(F,N){var Z,W,c=g((Z=i.currentLabel)===null||Z===void 0?void 0:Z.color,[F,N]);!c||(console.log(c),i.onAnnotationAdd({dataId:i.dataId,type:"polygon",frontendId:B(i.annotations)+1,label:i.currentLabel,labelId:(W=i.currentLabel)===null||W===void 0?void 0:W.labelId,result:c}))},P=function(F,N){var Z;if(!(!i.currentAnnotation||!i.currentAnnotation.result||!((Z=i.currentLabel)!==null&&Z!==void 0&&Z.color))){var W=i.currentAnnotation.result+",".concat(F,",").concat(N),c=(0,_.Z)((0,_.Z)({},i.currentAnnotation),{},{result:W});i.modifyAnnoByFrontendId(c)}},b=function(F){if(i.currentTool=="polygon"){var N=F.mouseX+F.offsetX,Z=F.mouseY+F.offsetY;console.log("currentAnnotation:",i.currentAnnotation),i.currentAnnotation?P(N,Z):I(N,Z)}},s=function(){i.currentTool=="polygon"&&i.onMouseUp()};return{onMouseDown:b,onMouseMove:function(){},onMouseUp:s,drawAnnotation:S}}var tn=n(10137),D=n(45194),w=n(71194),z=n(50146),on=n(47673),U=n(24044),an=n(3182),rn=n(9715),q=n(93766),mn=n(43358),fn=n(34041),bn=n(94043),gn=n.n(bn),In=n(37071),jn=function(I){var P,b=(0,k.YB)(),s=(0,D.Gd)(a.useState),M=In.Z.getQueryVariable("projectId"),F=(0,D.RZ)(a.useState),N=fn.Z.Option,Z=q.Z.useForm(),W=(0,r.Z)(Z,1),c=W[0];(0,a.useEffect)(function(){function d(){return y.apply(this,arguments)}function y(){return y=(0,an.Z)(gn().mark(function j(){var ln,A,O;return gn().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,(0,D.bo)();case 2:if(Y.sent){Y.next=4;break}return Y.abrupt("return");case 4:if(s.getAll(),M){Y.next=8;break}return x.default.error("Machine Learning settings are specific to every project. Please choose a project first."),Y.abrupt("return");case 8:return Y.next=10,s.getCurr(M);case 10:O=Y.sent,O!=null&&(ln=O.otherSettings)!==null&&ln!==void 0&&ln.mlBackendUrl&&F.setMlBackendUrl(O==null||(A=O.otherSettings)===null||A===void 0?void 0:A.mlBackendUrl);case 12:case"end":return Y.stop()}},j)})),y.apply(this,arguments)}d()},[]),(0,a.useEffect)(function(){if(!!s.curr){var d=s.curr.otherSettings?s.curr.otherSettings:{},y=d.models&&d.perviousModel?d.models[d.perviousModel]:{},j={mlBackendUrl:d.mlBackendUrl,modelName:d.perviousModel,trainBatchSize:y.trainBatchSize};c.setFieldsValue(j),d!=null&&d.mlBackendUrl&&F.setMlBackendUrl(d.mlBackendUrl)}},[s.curr]);function nn(){if(!s.curr){x.default.error("Please choose a project first!");return}var d=c.getFieldValue("mlBackendUrl");F.setMlBackendUrl(d);var y=(0,_.Z)((0,_.Z)({},s.curr.otherSettings),{},{mlBackendUrl:d});s.update(s.curr.projectId,{otherSettings:y})}function E(d){if(console.log("saveMlsettings",s.curr,d),!s.curr){x.default.error("Please select model first!");return}s.curr.otherSettings||(s.curr.otherSettings={});var y=s.curr.otherSettings.models?s.curr.otherSettings.models:{};y[d.modelName]=d,s.curr.otherSettings.mlBackendUrl=c.getFieldValue("mlBackendUrl"),s.curr.otherSettings.perviousModel=d.modelName,s.curr.otherSettings.models=y,s.update(s.curr.projectId,{otherSettings:s.curr.otherSettings}),x.default.info("Ml setting saved. Let's start trainig or inference!")}return(0,t.jsx)(z.Z,{title:b.formatMessage({id:"pages.toolBar.interactor"}),visible:I.visible,onCancel:I.onCancel,footer:null,children:(0,t.jsxs)(q.Z,{form:c,layout:"horizontal",size:"large",onFinish:function(y){console.log("form finish",y),E(y)},hidden:s.curr==null,children:[(0,t.jsxs)(U.Z.Group,{compact:!0,children:[(0,t.jsx)(q.Z.Item,{name:"mlBackendUrl",rules:[{required:!0,message:"Please input ml backend url"}],style:{fontSize:"1.5rem"},children:(0,t.jsx)(U.Z,{allowClear:!0,addonBefore:"ML Backend URL ",style:{textAlign:"left"}})}),(0,t.jsx)(X.Z,{type:"primary",onClick:nn,children:"Set"})]}),(0,t.jsx)(q.Z.Item,{name:"modelName",label:"Model",labelCol:{span:6},wrapperCol:{span:16},rules:[{required:!0,message:"Please select a model"}],style:{fontSize:"1.5rem"},children:(0,t.jsx)(fn.Z,{placeholder:"Select a model",children:(P=F.all)===null||P===void 0?void 0:P.map(function(d){return(0,t.jsx)(N,{value:d.name,children:d.name},d.name)})})}),(0,t.jsx)(q.Z.Item,{name:"trainBatchSize",label:"Training Batch Size",labelCol:{span:6},wrapperCol:{span:16},style:{fontSize:"1.5rem"},children:(0,t.jsx)(U.Z,{placeholder:"Training batch size"})}),(0,t.jsxs)(q.Z.Item,{wrapperCol:{span:16,offset:6},children:[(0,t.jsx)(X.Z,{onClick:function(){var y;(y=I.onCancel)===null||y===void 0||y.call(0),c.resetFields()},children:b.formatMessage({id:"component.PPCreater.cancel"})}),(0,t.jsx)(X.Z,{htmlType:"submit",type:"primary",style:{height:"2.5rem",width:"48%"},block:!0,children:"Save"})]})]})})},xn=jn,$n=n(20136),pn=n(55241),Kn=n(13062),On=n(71230),Hn=n(89032),_n=n(15746),Ln=n(13237),Sn=n.n(Ln),Zn=function(I){var P,b=(0,D.Gd)(a.useState),s=In.Z.getQueryVariable("projectId"),M=(0,D.RZ)(a.useState),F=fn.Z.Option,N=q.Z.useForm(),Z=(0,r.Z)(N,1),W=Z[0];return(0,a.useEffect)(function(){function c(){return nn.apply(this,arguments)}function nn(){return nn=(0,an.Z)(gn().mark(function E(){var d,y,j;return gn().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,D.bo)();case 2:if(A.sent){A.next=4;break}return A.abrupt("return");case 4:if(b.getAll(),s){A.next=8;break}return x.default.error("Machine Learning settings are specific to every project. Please choose a project first."),A.abrupt("return");case 8:return A.next=10,b.getCurr(s);case 10:j=A.sent,j!=null&&(d=j.otherSettings)!==null&&d!==void 0&&d.mlBackendUrl&&M.setMlBackendUrl(j==null||(y=j.otherSettings)===null||y===void 0?void 0:y.mlBackendUrl);case 12:case"end":return A.stop()}},E)})),nn.apply(this,arguments)}c()},[]),(0,a.useEffect)(function(){if(!!b.curr){var c=b.curr.otherSettings?b.curr.otherSettings:{},nn=c.models&&c.perviousModel?c.models[c.perviousModel]:{},E={mlBackendUrl:c.mlBackendUrl,modelName:c.perviousModel,trainBatchSize:nn.trainBatchSize};W.setFieldsValue(E),c!=null&&c.mlBackendUrl&&M.setMlBackendUrl(c.mlBackendUrl)}},[b.curr]),(0,t.jsxs)(pn.Z,{overlayClassName:"".concat(Sn().popover," ").concat(Sn().popoverLeft),placement:"left",content:(0,t.jsx)(On.Z,{children:(0,t.jsx)(_n.Z,{span:24,children:(0,t.jsx)(fn.Z,{placeholder:"Select a model",style:{padding:"0 4px",width:"100%"},children:(P=M.all)===null||P===void 0?void 0:P.map(function(c){return(0,t.jsx)(F,{value:c.name,children:c.name},c.name)})})})}),trigger:"hover",children:[" ",(0,t.jsx)(p.Z,{imgSrc:I.imgSrc||"",onClick:I.onClick,active:I.active,children:I.children})]})},En=Zn,Tn=40,Dn=function(){var I,P=(0,a.useState)(0),b=(0,r.Z)(P,2),s=b[0],M=b[1],F=(0,a.useState)(10),N=(0,r.Z)(F,2),Z=N[0],W=N[1],c=(0,a.useState)(60),nn=(0,r.Z)(c,2),E=nn[0],d=nn[1],y=(0,a.useState)(!1),j=(0,r.Z)(y,2),ln=j[0],A=j[1],O=(0,D.$L)(a.useState,a.useEffect,{effectTrigger:{postTaskChange:function(){return(0,v.Ad)()}},label:{oneHot:!0,postSelect:function(){f.setCurr(void 0),M(0)},preUnsetCurr:Rn},tool:{defaultTool:"mover"}}),R=O.tool,Y=O.task,vn=O.data,hn=O.project,Cn=O.scale,cn=O.label,f=O.annotation;function Rn(){f.setCurr(void 0),M(0),R.setCurr("mover")}var $=function(o){f.setCurr(o),o!=null&&o.frontendId?M(o.frontendId):M(0)};(0,a.useEffect)(function(){(0,v.Ad)()},[]),(0,a.useEffect)(function(){var u=setInterval(function(){var o;console.log("triggered!",vn),f.pushToBackend((o=vn.curr)===null||o===void 0?void 0:o.dataId)},2e4);return function(){clearInterval(u)}},[f,vn,vn.curr]);var Fn=function(o){!o||(f.all.pop(),f.all.push(o),$(o),f.setAll(f.all))},Mn=function(o){var un=[],Pn=(0,C.Z)(f.all),An;try{for(Pn.s();!(An=Pn.n()).done;){var Bn=An.value;Bn.frontendId==o.frontendId?un.push(o):un.push(Bn)}}catch(Wn){Pn.e(Wn)}finally{Pn.f()}$(o),f.setAll(un)},yn={dataId:(I=vn.curr)===null||I===void 0?void 0:I.dataId,currentLabel:cn.curr,brushSize:Z,scale:Cn.curr,currentTool:R.curr,annotations:f.all,currentAnnotation:f.curr,onAnnotationAdd:function(o){var un=f.all.concat([o]);f.setAll(un),$(o)},onAnnotationModify:Fn,modifyAnnoByFrontendId:Mn,onMouseUp:function(){(0,v.k3)({annos:f.all,currAnno:f.curr})},frontendIdOps:{frontendId:s,setFrontendId:M}},H=(0,k.YB)(),kn=(0,m.Z)(yn),zn=G(yn),Nn={polygon:zn,brush:kn};return(0,t.jsxs)(Q.Z,{className:"segment",children:[(0,t.jsxs)(dn.Z,{children:[(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/polygon.png",active:R.curr=="polygon",onClick:function(){if(!cn.curr){x.default.error("Please select a label first");return}R.setCurr("polygon"),$(void 0)},children:H.formatMessage({id:"pages.toolBar.polygon"})}),(0,t.jsx)(p.Z,{active:R.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){R.setCurr("editor"),$(void 0)},children:H.formatMessage({id:"pages.toolBar.edit"})}),(0,t.jsx)(sn.Z,{imgSrc:"./pics/buttons/brush.png",size:Z,active:R.curr=="brush",onClick:function(){if(!cn.curr){x.default.error("Please select a label first");return}R.curr!="rubber"&&R.curr!="brush"&&$(void 0),R.setCurr("brush")},onChange:function(o){W(o)},children:H.formatMessage({id:"pages.toolBar.brush"})}),(0,t.jsx)(sn.Z,{size:Z,active:R.curr=="rubber",onClick:function(){R.curr!="rubber"&&R.curr!="brush"&&$(void 0),R.setCurr("rubber")},onChange:function(o){W(o)},imgSrc:"./pics/buttons/rubber.png",children:H.formatMessage({id:"pages.toolBar.rubber"})}),(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){Cn.change(.1)},children:H.formatMessage({id:"pages.toolBar.zoomIn"})}),(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){Cn.change(-.1)},children:H.formatMessage({id:"pages.toolBar.zoomOut"})}),(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var o;f.pushToBackend((o=vn.curr)===null||o===void 0?void 0:o.dataId)},children:H.formatMessage({id:"pages.toolBar.save"})}),(0,t.jsx)(p.Z,{active:R.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){R.setCurr("mover")},children:H.formatMessage({id:"pages.toolBar.move"})}),(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=(0,v.td)();o&&(f.setAll(o.annos),$(o.currAnno))},children:H.formatMessage({id:"pages.toolBar.unDo"})}),(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=(0,v.Vd)();o&&(f.setAll(o.annos),$(o.currAnno))},children:H.formatMessage({id:"pages.toolBar.reDo"})}),(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){f.setAll([]),f.setCurr(void 0)},children:H.formatMessage({id:"pages.toolBar.clearMark"})})]}),(0,t.jsxs)("div",{id:"dr",className:"mainStage",children:[(0,t.jsx)("div",{className:"draw",children:(0,t.jsx)(h.Z,{scale:Cn.curr,annotations:f.all,currentTool:R.curr,currentAnnotation:f.curr,setCurrentAnnotation:$,onAnnotationModify:Mn,onAnnotationModifyComplete:function(){(0,v.k3)({annos:f.all,currAnno:f.curr})},frontendIdOps:{frontendId:s,setFrontendId:M},imgSrc:vn.imgSrc,transparency:E,onAnnotationAdd:function(o){var un=f.all.concat([o]);f.setAll(un),f.curr||$(o)},drawTool:Nn})}),(0,t.jsx)("div",{className:"pblock",children:(0,t.jsx)(tn.Z,{task:Y,project:hn})}),(0,t.jsx)("div",{className:"prevTask",onClick:function(){!Y.prevTask()||$(void 0)}}),(0,t.jsx)("div",{className:"nextTask",onClick:function(){!Y.nextTask()||$(void 0)}})]}),(0,t.jsxs)(dn.Z,{disLoc:"right",children:[(0,t.jsx)(En,{imgSrc:"./pics/buttons/intelligent_interaction.png",onClick:function(){return A(!0)},children:H.formatMessage({id:"pages.toolBar.interactor"})}),(0,t.jsx)(sn.Z,{imgSrc:"./pics/buttons/threshold.png",disLoc:"left",children:H.formatMessage({id:"pages.toolBar.segmentThreshold"})}),(0,t.jsx)(sn.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:E,maxSize:100,minSize:0,onChange:function(o){d(o)},children:H.formatMessage({id:"pages.toolBar.transparency"})}),(0,t.jsx)(sn.Z,{imgSrc:"./pics/buttons/radius.png",disLoc:"left",children:H.formatMessage({id:"pages.toolBar.visualRadius"})}),(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){k.m8.push("/project_overview?projectId=".concat(hn.curr.projectId))},children:"Project Overview"}),(0,t.jsx)(p.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){k.m8.push("/ml?projectId=".concat(hn.curr.projectId))},children:"ML Settings"})]}),(0,t.jsxs)("div",{className:"rightSideBar",children:[(0,t.jsx)("div",{className:"determinOutline",children:(0,t.jsx)(X.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){$(void 0)},children:H.formatMessage({id:"pages.toolBar.determineOutline"})})}),(0,t.jsx)(e.Z,{hideColorPicker:!1,labels:cn.all,activeIds:cn.activeIds,onLabelSelect:cn.onSelect,onLabelModify:function(){},onLabelDelete:cn.remove,onLabelAdd:function(o){cn.create((0,_.Z)((0,_.Z)({},o),{},{projectId:hn.curr.projectId})).then(function(un){$(void 0),cn.setCurr(un)})}}),(0,t.jsx)(l.Z,{currAnnotation:f.curr,annotations:f.all,onAnnotationSelect:function(o){o!=null&&o.delete||$(o)},onAnnotationAdd:function(){$(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(o){f.setAll(f.all.filter(function(un){return un.frontendId!=o.frontendId})),$(void 0)}})]}),(0,t.jsx)(xn,{visible:ln,onCancel:function(){return A(!1)}})]})},Un=Dn}}]);
