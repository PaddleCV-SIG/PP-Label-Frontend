(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[690],{13237:function(V){V.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},85024:function(V){V.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(V){V.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},26647:function(V){V.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___1FTWb",toolBarButtonContainer:"toolBarButtonContainer___1Vahn",toolBarButton:"toolBarButton___3mR2H",buttonText:"buttonText___Y0WDm",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3lRZ8",popover:"popover___3zzu2",slider:"slider___ALra-",popoverLeft:"popoverLeft___15lGe"}},8978:function(V,J,n){"use strict";n.d(J,{Z:function(){return rn}});var X=n(11849),Q=n(2824),G=n(91220),$=n(67294),T=n(85893);function B(e){if(!e||!e.width||!e.color||!e.points||e.points.length<2||e.frontendId==null)return"";var M=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(M,",").concat(e.points.join(","))}function d(e){var M,i=e.canvasRef,I=e.annotation,P=I.result;if(!P)return(0,T.jsx)(T.Fragment,{});var D=(M=i.current)===null||M===void 0?void 0:M.getContext("2d");if(!D)return(0,T.jsx)(T.Fragment,{});for(var p=[],o=0,v=0;v<P.length;v++)P.at(v)==","?(p.push(parseFloat(P.slice(o,v))),o=v+1):P.at(v)=="|"?(p.push(parseFloat(P.slice(o,v))),l(p,D,I),p=[],o=v+1):v==P.length-1&&(p.push(parseFloat(P.slice(o,P.length))),l(p,D,I));return(0,T.jsx)(T.Fragment,{})}function l(e,M,i){var I;if(e.length<4){console.log("found incorrect points:",e);return}var P=e[0],D=e[1];if(P==0){var p;S(M,e.slice(2),(p=i.label)===null||p===void 0?void 0:p.color);return}if(D==0){f(M,P,e.slice(2),void 0);return}f(M,P,e.slice(2),(I=i.label)===null||I===void 0?void 0:I.color)}function f(e,M,i,I){e.beginPath(),e.moveTo(i[0],i[1]);for(var P=0;P<=i.length/2-1;P++){var D=i[2*P],p=i[2*P+1];e.lineTo(D,p)}e.lineCap="round",e.lineJoin="round",e.lineWidth=M,I&&(e.strokeStyle=I),e.globalCompositeOperation=I?"source-over":"destination-out",e.stroke()}function S(e,M,i){e.globalCompositeOperation=i?"source-over":"destination-out",i&&(e.fillStyle=i);for(var I=0;I<=M.length/2-1;I++){var P=M[2*I],D=M[2*I+1];e.fillRect(P,D,1,1)}}function O(e){if(!e||e.length==0)return 0;var M=0,i=(0,G.Z)(e),I;try{for(i.s();!(I=i.n()).done;){var P=I.value;P.frontendId>M&&(M=P.frontendId)}}catch(D){i.e(D)}finally{i.f()}return M}function on(e,M){return e=="rubber"||M==2?"rubber":"brush"}function rn(e){var M=(0,$.useState)(),i=(0,Q.Z)(M,2),I=i[0],P=i[1],D=function(b){var j,w;if(!(e.currentTool!="brush"&&e.currentTool!="rubber"||!((j=e.currentLabel)!==null&&j!==void 0&&j.color)||!e.brushSize)){var tn=b.mouseX,z=b.mouseY,an=on(e.currentTool,b.e.evt.button);console.log("frontendId: ",e.frontendIdOps.frontendId,"maxId:",O(e.annotations));var W=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:O(e.annotations)+1;W!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(W);var q=B({width:e.brushSize||10,color:(w=e.currentLabel)===null||w===void 0?void 0:w.color,points:[tn,z,tn,z],type:an,frontendId:W});if(!!q){P(an);var nn={dataId:e.dataId,label:e.currentLabel,labelId:e.currentLabel.labelId,frontendId:W,result:q,type:"brush"};e.onAnnotationAdd(nn)}}},p=function(b){var j;if(!(!I||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((j=e.currentLabel)!==null&&j!==void 0&&j.color))){var w=b.mouseX,tn=b.mouseY,z=e.currentAnnotation.result+",".concat(w,",").concat(tn);e.onAnnotationModify((0,X.Z)((0,X.Z)({},e.currentAnnotation),{},{result:z}))}},o=function(){e.currentTool!="brush"&&e.currentTool!="rubber"||(P(void 0),e.onMouseUp())};return{onMouseDown:D,onMouseMove:p,onMouseUp:o,drawAnnotation:d}}},57406:function(V,J,n){"use strict";n.d(J,{pL:function(){return Q},oo:function(){return G}});var X=n(91220);function Q(B){var d=0;if(!B)return d;var l=(0,X.Z)(B),f;try{for(l.s();!(f=l.n()).done;){var S=f.value;!S||!S.frontendId||S.frontendId>d&&(d=S.frontendId)}}catch(O){l.e(O)}finally{l.f()}return d}function G(B){var d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(B);return d?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)}:null}function $(B){var d=B.toString(16);return d.length==1?"0"+d:d}function T(B,d,l){return"#"+$(B)+$(d)+$(l)}},14836:function(V,J,n){"use strict";n.d(J,{Z:function(){return o}});var X=n(54421),Q=n(38272),G=n(57663),$=n(71577),T=n(91220),B=n(67294),d=n(56159),l=n.n(d),f=n(49111),S=n(19650),O=n(2824),on=n(11849),rn=n(85024),e=n.n(rn),M=n(63097),i=n(85893),I=function(b){var j=(0,on.Z)({},b.annotation),w=(0,B.useState)(j.invisible),tn=(0,O.Z)(w,2),z=tn[0],an=tn[1],W=(0,B.useState)(0),q=(0,O.Z)(W,2),nn=q[0],H=q[1];(0,B.useEffect)(function(){an(b.annotation.invisible)},[b.annotation.invisible]);var sn=(0,i.jsxs)(Q.ZP.Item,{className:"".concat(e().listItem," ").concat(b.active?e().listItemActive:""),unselectable:"on",onClick:function(){b.onClick(j)},children:[(0,i.jsxs)(S.Z,{align:"center",size:5,children:[(0,i.jsx)("a",{className:e().eye,style:{backgroundImage:z?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(fn){fn.stopPropagation(),an(!z),b.onAnnotationModify(j)}})," ",(0,i.jsx)("span",{className:e().annotationId,children:j.frontendId}),(0,i.jsx)("span",{className:e().labelName,children:j.label.name}),(0,i.jsx)(M.Z,{color:j.label.color})]}),(0,i.jsx)("a",{className:e().delete,onClick:function(fn){fn.stopPropagation();var vn=new Date().getTime();vn-nn<300||(H(vn),b.onAnnotationDelete(j))}})]});return sn},P=I,D=n(48971),p=function(b){var j=(0,D.YB)(),w=j.formatMessage({id:"component.PPAnnotationList.annotationList"}),tn=j.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),z=new Set,an=[],W=(0,T.Z)(b.annotations),q;try{for(W.s();!(q=W.n()).done;){var nn=q.value;z.has(nn.frontendId)||(an.push(nn),z.add(nn.frontendId))}}catch(H){W.e(H)}finally{W.f()}return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(Q.ZP,{className:l().labelList,size:"large",header:(0,i.jsx)("div",{className:l().listHeader,children:w}),bordered:!0,dataSource:an,renderItem:function(sn){var Z;return(0,i.jsx)(P,{onClick:b.onAnnotationSelect,annotation:sn,active:sn.frontendId==((Z=b.currAnnotation)===null||Z===void 0?void 0:Z.frontendId),onAnnotationDelete:b.onAnnotationDelete,onAnnotationModify:b.onAnnotationModify})},footer:function(){return b.onAnnotationAdd?(0,i.jsx)("div",{children:(0,i.jsx)($.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){b.onAnnotationAdd()},block:!0,children:tn})}):(0,i.jsx)("div",{})}})})},o=p},27992:function(V,J,n){"use strict";var X=n(20136),Q=n(55241),G=n(13062),$=n(71230),T=n(77883),B=n(70507),d=n(89032),l=n(15746),f=n(66126),S=n(75454),O=n(2824),on=n(67294),rn=n(61541),e=n(26647),M=n.n(e),i=n(85893),I=0,P=100,D=10,p=function(v){var b=(0,on.useState)(nn(v.size)),j=(0,O.Z)(b,2),w=j[0],tn=j[1];function z(H){tn(nn(H))}var an=v.step?v.step:10,W=v.minSize==null?I:v.minSize,q=v.maxSize==null?P:v.maxSize;function nn(H){return H==null?D:H<=W?W:H>=q?q:H}return(0,on.useEffect)(function(){z(v.size)},[v.size]),(0,i.jsxs)(Q.Z,{overlayClassName:"".concat(M().popover," ").concat(v.disLoc=="left"?M().popoverLeft:""),placement:v.disLoc||"right",content:(0,i.jsxs)($.Z,{children:[(0,i.jsx)(l.Z,{span:16,children:(0,i.jsx)(S.Z,{className:M().slider,value:w,max:q,min:W,onChange:function(sn){var Z;(Z=v.onChange)===null||Z===void 0||Z.call(0,sn)},tooltipVisible:!1})}),(0,i.jsx)(l.Z,{span:8,children:(0,i.jsx)(B.Z,{min:W,max:q,value:w,onChange:function(sn){var Z;(Z=v.onChange)===null||Z===void 0||Z.call(0,sn)},step:an})})]}),trigger:"hover",children:[" ",(0,i.jsx)(rn.Z,{imgSrc:v.imgSrc||"",onClick:v.onClick,active:v.active,children:v.children})]})};J.Z=p},10137:function(V,J,n){"use strict";var X=n(34669),Q=n(54458),G=n(67294),$=n(85893),T=function(d){var l,f;return(0,$.jsxs)("div",{className:"progress",children:[(0,$.jsx)(Q.Z,{className:"progressBar",percent:Math.ceil(d.project.finished/((l=d.task.all)===null||l===void 0?void 0:l.length)*100),status:"active",showInfo:!1})," ",(0,$.jsxs)("span",{className:"progressDesc",children:["Current labeling ",d.task.currIdx==null?1:d.task.currIdx+1," of"," ",(f=d.task.all)===null||f===void 0?void 0:f.length,". Already labeled ",d.project.finished||0,"."]})]})};J.Z=T},91861:function(V,J,n){"use strict";n.d(J,{Ad:function(){return $},k3:function(){return T},Vd:function(){return B},td:function(){return d}});var X=n(34792),Q=n(48086),G=40;function $(){localStorage.removeItem("history"),T([])}function T(l){var f=localStorage.getItem("history"),S=f?JSON.parse(f):{index:-1,items:[]};if(JSON.stringify(S.items[S.index])!=JSON.stringify(l)){var O=S.index>G?S.index-G:0,on=S.items.splice(O,S.index==0?1:S.index+1);S.items=on.concat([l]),S.index<=G?S.index++:S.index=G+1,localStorage.setItem("history",JSON.stringify(S))}}function B(){var l=localStorage.getItem("history");if(!!l){var f=JSON.parse(l);if(!!f){if(f.index>=f.items.length-1){Q.default.error("No next history!");return}return f.index++,localStorage.setItem("history",JSON.stringify(f)),f.items[f.index]}}}function d(){var l=localStorage.getItem("history");if(!!l){var f=JSON.parse(l);if(console.log("history",f),!f||!f.index||f.index<=1){Q.default.error("No previous history!");return}return f.index--,localStorage.setItem("history",JSON.stringify(f)),f.items[f.index]}}},1690:function(V,J,n){"use strict";n.r(J),n.d(J,{MOST_HISTORY_STEPS:function(){return Tn},default:function(){return Zn}});var X=n(11849),Q=n(57663),G=n(71577),$=n(34792),T=n(48086),B=n(91220),d=n(2824),l=n(67294),f=n(48971),S=n(8088),O=n(61541),on=n(44434),rn=n(27992),e=n(5041),M=n(57436),i=n(14836),I=n(91861),P=n(8978),D=n(65031),p=n(57406),o=n(85893);function v(t,s){if(!(!t||!s))return s.join(",")}function b(t){var s,r=t.annotation;if(!r||!r.result||r.result.length<2||!((s=r.label)!==null&&s!==void 0&&s.color))return(0,o.jsx)(o.Fragment,{});var m=r.result.split(",").map(Number),y=r.label.color,g=(0,p.oo)(y);if(!g)return(0,o.jsx)(o.Fragment,{});var F=.3,_=void 0,x=[];return m.forEach(function(u,A){if(!_){_=u;return}x.push((0,o.jsx)(D.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(r)},draggable:t.currentTool=="editor",onDragMove:function(C){var en;C.cancelBubble=!0;var N=(en=t.stageRef)===null||en===void 0?void 0:en.current,U=N.findOne(".baseImage"),E=!1,un=C.target.x();un>U.width()/2&&(un=U.width()/2,E=!0),un<-U.width()/2&&(un=-U.width()/2,E=!0);var K=C.target.y();K>U.height()/2&&(K=U.height()/2,E=!0),K<-U.height()/2&&(K=-U.height()/2,E=!0),E&&C.target.setPosition({x:un,y:K}),m[A-1]=un,m[A]=K;var L=(0,X.Z)((0,X.Z)({},r),{},{result:m.join(",")});t.onDrag(L)},onMouseOver:function(){var C;t.currentTool=="editor"&&(C=t.stageRef)!==null&&C!==void 0&&C.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var C;(C=t.stageRef)!==null&&C!==void 0&&C.current&&(t.stageRef.current.container().style.cursor="default")},x:_,y:u,radius:5/t.scale,fill:y})),_=void 0}),(0,o.jsxs)(D.ZA,{children:[(0,o.jsx)(D.x1,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(r)},stroke:y,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",points:m,tension:0,closed:!0,fill:"rgba(".concat(g.r,", ").concat(g.g,", ").concat(g.b,", ").concat(F,")")}),x]},r.frontendId)}function j(t){var s=0;if(!t)return s;var r=(0,B.Z)(t),m;try{for(r.s();!(m=r.n()).done;){var y=m.value;!y||!y.frontendId||y.frontendId>s&&(s=y.frontendId)}}catch(g){r.e(g)}finally{r.f()}return s}function w(t){var s=function(F,_){var x,u,A=v((x=t.currentLabel)===null||x===void 0?void 0:x.color,[F,_]);!A||(console.log(A),t.onAnnotationAdd({dataId:t.dataId,type:"polygon",frontendId:j(t.annotations)+1,label:t.currentLabel,labelId:(u=t.currentLabel)===null||u===void 0?void 0:u.labelId,result:A}))},r=function(F,_){var x;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((x=t.currentLabel)!==null&&x!==void 0&&x.color))){var u=t.currentAnnotation.result+",".concat(F,",").concat(_),A=(0,X.Z)((0,X.Z)({},t.currentAnnotation),{},{result:u});t.modifyAnnoByFrontendId(A)}},m=function(F){if(t.currentTool=="polygon"){var _=F.mouseX+F.offsetX,x=F.mouseY+F.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?r(_,x):s(_,x)}},y=function(){t.currentTool=="polygon"&&t.onMouseUp&&t.onMouseUp()};return{onMouseDown:m,onMouseMove:function(){},onMouseUp:y,drawAnnotation:b}}var tn=n(10137),z=n(45194),an=n(20136),W=n(55241),q=n(47673),nn=n(24044),H=n(3182),sn=n(9715),Z=n(93766),fn=n(94043),vn=n.n(fn),yn=n(37071),Sn=n(13237),Mn=n.n(Sn),xn=function(s){var r=(0,z.Gd)(l.useState),m=yn.Z.getQueryVariable("projectId"),y=(0,z.RZ)(l.useState),g=Z.Z.useForm(),F=(0,d.Z)(g,1),_=F[0];(0,l.useEffect)(function(){function u(){return A.apply(this,arguments)}function A(){return A=(0,H.Z)(vn().mark(function R(){var C,en,N;return vn().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,(0,z.bo)();case 2:if(E.sent){E.next=4;break}return E.abrupt("return");case 4:if(r.getAll(),m){E.next=8;break}return T.default.error("Machine Learning settings are specific to every project. Please choose a project first."),E.abrupt("return");case 8:return E.next=10,r.getCurr(m);case 10:N=E.sent,N!=null&&(C=N.otherSettings)!==null&&C!==void 0&&C.mlBackendUrl&&y.setMlBackendUrl(N==null||(en=N.otherSettings)===null||en===void 0?void 0:en.mlBackendUrl);case 12:case"end":return E.stop()}},R)})),A.apply(this,arguments)}u()},[]),(0,l.useEffect)(function(){if(!!r.curr){var u=r.curr.otherSettings?r.curr.otherSettings:{},A=u.models&&u.perviousModel?u.models[u.perviousModel]:{},R={mlBackendUrl:u.mlBackendUrl,modelName:u.perviousModel,trainBatchSize:A.trainBatchSize};_.setFieldsValue(R),u!=null&&u.mlBackendUrl&&y.setMlBackendUrl(u.mlBackendUrl)}},[r.curr]);function x(u){if(console.log("saveMlsettings",r.curr,u),!r.curr){T.default.error("Please select project first!");return}r.curr.otherSettings||(r.curr.otherSettings={}),r.curr.otherSettings.mlBackendUrl=_.getFieldValue("mlBackendUrl"),r.curr.otherSettings.mlModelAbsPath=_.getFieldValue("mlModelAbsPath"),r.curr.otherSettings.mlWeightAbsPath=_.getFieldValue("mlWeightAbsPath"),r.curr.otherSettings.perviousModel=u.modelName,r.update(r.curr.projectId,{otherSettings:r.curr.otherSettings}),T.default.info("Ml setting saved. Let's start trainig or inference!")}return(0,o.jsxs)(W.Z,{overlayClassName:"".concat(Mn().popover," ").concat(Mn().popoverLeft),placement:"left",content:(0,o.jsxs)(Z.Z,{form:_,layout:"horizontal",size:"large",onFinish:function(A){console.log("form finish",A),x(A)},hidden:r.curr==null,children:[(0,o.jsx)(Z.Z.Item,{name:"mlBackendUrl",label:"ML Backend URL",labelCol:{span:6},wrapperCol:{span:18},initialValue:"http://127.0.0.1:1234/model",style:{fontSize:"1.5rem"},children:(0,o.jsx)(nn.Z,{placeholder:"http://127.0.0.1:1234/model"})}),(0,o.jsx)(Z.Z.Item,{name:"mlModelAbsPath",label:"Model Path",labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"},children:(0,o.jsx)(nn.Z,{placeholder:"Absolute path"})}),(0,o.jsx)(Z.Z.Item,{name:"mlWeightAbsPath",label:"Weight Path",labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"},children:(0,o.jsx)(nn.Z,{placeholder:"Absolute path"})}),(0,o.jsx)(Z.Z.Item,{wrapperCol:{span:16,offset:6},children:(0,o.jsx)(G.Z,{htmlType:"submit",type:"primary",style:{height:"2.5rem",width:"48%"},block:!0,children:"Save"})})]}),trigger:"hover",children:[" ",(0,o.jsx)(O.Z,{imgSrc:s.imgSrc||"",onClick:s.onClick,active:s.active,children:s.children})]})},Bn=xn;function On(t){var s,r,m=t.canvasRef,y=t.annotation,g=y.result;if(!g)return(0,o.jsx)(o.Fragment,{});var F=(s=m.current)===null||s===void 0?void 0:s.getContext("2d");if(!F)return(0,o.jsx)(o.Fragment,{});for(var _=((r=m.current)===null||r===void 0?void 0:r.width)||0,x=t.threshold?t.threshold:.5,u=[],A=0,R=0,C=0;C<g.length;C++)if(g.at(C)==","){R++;var en=parseFloat(g.slice(A,C));en>=x&&u.push(Math.floor(R/_),R%_),A=C+1}else if(C==g.length-1){R++;var N=parseFloat(g.slice(A,C));N>=x&&u.push(Math.floor(R/_),R%_),jn(u,F,y)}return(0,o.jsx)(o.Fragment,{})}function jn(t,s,r){var m;if(t.length<4){console.log("found incorrect points:",t);return}Ln(s,t.slice(2),(m=r.label)===null||m===void 0?void 0:m.color)}function Ln(t,s,r){t.globalCompositeOperation=r?"source-over":"destination-out",r&&(t.fillStyle=r);for(var m=0;m<=s.length/2-1;m++){var y=s[2*m],g=s[2*m+1];t.fillRect(y,g,1,1)}}function Cn(t){if(!t||t.length==0)return 0;var s=0,r=(0,B.Z)(t),m;try{for(r.s();!(m=r.n()).done;){var y=m.value;y.frontendId>s&&(s=y.frontendId)}}catch(g){r.e(g)}finally{r.f()}return s}function En(t){var s=(0,l.useState)([]),r=(0,d.Z)(s,2),m=r[0],y=r[1],g=(0,z.RZ)(l.useState),F=function(A){var R;if(!(t.currentTool!="interactor"||!((R=t.currentLabel)!==null&&R!==void 0&&R.color))){var C=A.mouseX,en=A.mouseY;console.log("frontendId: ",t.frontendIdOps.frontendId,"maxId:",Cn(t.annotations));var N=t.frontendIdOps.frontendId>0?t.frontendIdOps.frontendId:Cn(t.annotations)+1;N!=t.frontendIdOps.frontendId&&t.frontendIdOps.setFrontendId(N);var U=m;if(A.e.evt.button==2?U=U.concat([C,en,!1]):U=U.concat([C,en,!0]),y(U),console.log(U,t.currentLabel.color),!(!U.length||!A.stageRef.current||N==null)){var E=A.stageRef.current,un=E.findOne(".baseImage").toDataURL().slice(22);g.predict({format:"b64",img:un,other:{clicks:U}}).then(function(K){console.log(K);var L={dataId:t.dataId,label:t.currentLabel,labelId:t.currentLabel.labelId,frontendId:N,result:K,type:"brush"};t.onAnnotationAdd(L)})}}},_=function(){},x=function(){t.currentTool=="interactor"&&t.onMouseUp()};return{onMouseDown:F,onMouseMove:_,onMouseUp:x,drawAnnotation:On}}var Tn=40,Dn=function(){var s,r=(0,l.useState)(0),m=(0,d.Z)(r,2),y=m[0],g=m[1],F=(0,l.useState)(10),_=(0,d.Z)(F,2),x=_[0],u=_[1],A=(0,l.useState)(.5),R=(0,d.Z)(A,2),C=R[0],en=R[1],N=(0,l.useState)(60),U=(0,d.Z)(N,2),E=U[0],un=U[1],K=(0,z.$L)(l.useState,l.useEffect,{effectTrigger:{postTaskChange:function(){return(0,I.Ad)()}},label:{oneHot:!0,postSelect:function(){h.setCurr(void 0),g(0)},preUnsetCurr:Rn},tool:{defaultTool:"mover"},task:{push:!0}}),L=K.tool,hn=K.task,cn=K.data,In=K.project,mn=K.scale,dn=K.label,h=K.annotation;function Rn(){h.setCurr(void 0),g(0),L.setCurr("mover")}var k=function(a){h.setCurr(a),a!=null&&a.frontendId?g(a.frontendId):g(0)};(0,l.useEffect)(function(){(0,I.Ad)()},[]),(0,l.useEffect)(function(){var c=setInterval(function(){var a;console.log("triggered!",cn),h.pushToBackend((a=cn.curr)===null||a===void 0?void 0:a.dataId)},2e4);return function(){clearInterval(c)}},[h,cn,cn.curr]);var Un=function(a){!a||(h.all.pop(),h.all.push(a),k(a),h.setAll(h.all))},An=function(a){var ln=[],gn=(0,B.Z)(h.all),_n;try{for(gn.s();!(_n=gn.n()).done;){var bn=_n.value;bn.frontendId==a.frontendId?ln.push(a):ln.push(bn)}}catch(Fn){gn.e(Fn)}finally{gn.f()}k(a),h.setAll(ln)},Pn={dataId:(s=cn.curr)===null||s===void 0?void 0:s.dataId,currentLabel:dn.curr,brushSize:x,scale:mn.curr,currentTool:L.curr,annotations:h.all,currentAnnotation:h.curr,onAnnotationAdd:function(a){var ln=h.all.concat([a]);h.setAll(ln),k(a)},onAnnotationModify:Un,modifyAnnoByFrontendId:An,onMouseUp:function(){(0,I.k3)({annos:h.all,currAnno:h.curr})},frontendIdOps:{frontendId:y,setFrontendId:g}},Y=(0,f.YB)(),pn={polygon:w(Pn),brush:(0,P.Z)(Pn),interactor:En(Pn)};return(0,o.jsxs)(S.Z,{className:"segment",children:[(0,o.jsxs)(on.Z,{children:[(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/polygon.png",active:L.curr=="polygon",onClick:function(){if(!dn.curr){T.default.error("Please select a label first");return}L.setCurr("polygon"),k(void 0)},children:Y.formatMessage({id:"pages.toolBar.polygon"})}),(0,o.jsx)(O.Z,{active:L.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){L.setCurr("editor"),k(void 0)},children:Y.formatMessage({id:"pages.toolBar.edit"})}),(0,o.jsx)(rn.Z,{imgSrc:"./pics/buttons/brush.png",size:x,active:L.curr=="brush",onClick:function(){if(!dn.curr){T.default.error("Please select a label first");return}L.curr!="rubber"&&L.curr!="brush"&&k(void 0),L.setCurr("brush")},onChange:function(a){u(a)},children:Y.formatMessage({id:"pages.toolBar.brush"})}),(0,o.jsx)(rn.Z,{size:x,active:L.curr=="rubber",onClick:function(){L.curr!="rubber"&&L.curr!="brush"&&k(void 0),L.setCurr("rubber")},onChange:function(a){u(a)},imgSrc:"./pics/buttons/rubber.png",children:Y.formatMessage({id:"pages.toolBar.rubber"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){mn.change(.1)},children:Y.formatMessage({id:"pages.toolBar.zoomIn"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){mn.change(-.1)},children:Y.formatMessage({id:"pages.toolBar.zoomOut"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var a;h.pushToBackend((a=cn.curr)===null||a===void 0?void 0:a.dataId)},children:Y.formatMessage({id:"pages.toolBar.save"})}),(0,o.jsx)(O.Z,{active:L.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){L.setCurr("mover")},children:Y.formatMessage({id:"pages.toolBar.move"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var a=(0,I.td)();a&&(h.setAll(a.annos),k(a.currAnno))},children:Y.formatMessage({id:"pages.toolBar.unDo"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var a=(0,I.Vd)();a&&(h.setAll(a.annos),k(a.currAnno))},children:Y.formatMessage({id:"pages.toolBar.reDo"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){h.setAll([]),h.setCurr(void 0)},children:Y.formatMessage({id:"pages.toolBar.clearMark"})})]}),(0,o.jsxs)("div",{id:"dr",className:"mainStage",children:[(0,o.jsx)("div",{className:"draw",children:(0,o.jsx)(M.Z,{scale:mn.curr,annotations:h.all,currentTool:L.curr,currentAnnotation:h.curr,setCurrentAnnotation:k,onAnnotationModify:An,onAnnotationModifyComplete:function(){(0,I.k3)({annos:h.all,currAnno:h.curr})},frontendIdOps:{frontendId:y,setFrontendId:g},imgSrc:cn.imgSrc,transparency:E,threshold:C,onAnnotationAdd:function(a){var ln=h.all.concat([a]);h.setAll(ln),h.curr||k(a)},drawTool:pn})}),(0,o.jsx)("div",{className:"pblock",children:(0,o.jsx)(tn.Z,{task:hn,project:In})}),(0,o.jsx)("div",{className:"prevTask",onClick:function(){!hn.prevTask()||k(void 0)}}),(0,o.jsx)("div",{className:"nextTask",onClick:function(){!hn.nextTask()||k(void 0)}})]}),(0,o.jsxs)(on.Z,{disLoc:"right",children:[(0,o.jsx)(Bn,{imgSrc:"./pics/buttons/intelligent_interaction.png",active:L.curr=="interactor",onClick:function(){L.setCurr("interactor")},children:Y.formatMessage({id:"pages.toolBar.interactor"})}),(0,o.jsx)(rn.Z,{imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:C,maxSize:1,minSize:.1,step:.1,onChange:function(a){en(a)},children:Y.formatMessage({id:"pages.toolBar.segmentThreshold"})}),(0,o.jsx)(rn.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:E,maxSize:100,minSize:0,onChange:function(a){un(a)},children:Y.formatMessage({id:"pages.toolBar.transparency"})}),(0,o.jsx)(rn.Z,{imgSrc:"./pics/buttons/radius.png",disLoc:"left",children:Y.formatMessage({id:"pages.toolBar.visualRadius"})}),(0,o.jsx)(O.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){f.m8.push("/project_overview?projectId=".concat(In.curr.projectId))},children:"Project Overview"})]}),(0,o.jsxs)("div",{className:"rightSideBar",children:[(0,o.jsx)("div",{className:"determinOutline",children:(0,o.jsx)(G.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){k(void 0)},children:Y.formatMessage({id:"pages.toolBar.determineOutline"})})}),(0,o.jsx)(e.Z,{hideColorPicker:!1,labels:dn.all,activeIds:dn.activeIds,onLabelSelect:dn.onSelect,onLabelModify:function(){},onLabelDelete:dn.remove,onLabelAdd:function(a){dn.create((0,X.Z)((0,X.Z)({},a),{},{projectId:In.curr.projectId})).then(function(ln){k(void 0),dn.setCurr(ln)})}}),(0,o.jsx)(i.Z,{currAnnotation:h.curr,annotations:h.all,onAnnotationSelect:function(a){a!=null&&a.delete||k(a)},onAnnotationAdd:function(){k(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(a){h.setAll(h.all.filter(function(ln){return ln.frontendId!=a.frontendId})),k(void 0)}})]})]})},Zn=Dn}}]);
