(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(ve,re,B){"use strict";B.d(re,{gu:function(){return ue},os:function(){return le},Gd:function(){return ee},$L:function(){return oe}});var Q=B(11849),X=B(91220),Z=B(3182),ge=B(34792),O=B(48086),M=B(2824),ae=B(94043),t=B.n(ae),Y=B(48971),K=B(37071),G=B(81139),z=localStorage.getItem("basePath"),J=new G.VK(z?{basePath:z}:void 0),N=new G.U(J),ne=new G.sD(J),te=new G.W6(J),q=new G.Cl(J),x=new G.vb(J),ue=function(l){return JSON.parse(JSON.stringify(l))};function le(j){return j&&(j.toLowerCase().replace(/([-_][a-z])/g,function(l){return l.toUpperCase().replace("-","").replace("_","")}),j)}var V=function(l,o,v){if(!!v){for(var s=typeof l=="number"?l:l[v],b=0;b<o.length;b++)if(s==o[b][v])return b}},se=function(l){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],v=l(1),s=(0,M.Z)(v,2),b=s[0],_=s[1];function E(A){var I=A;I<o[0]&&(I=o[0],O.default.error("Smallest scale is "+o[0])),I>o[1]&&(I=o[1],O.default.error("Largest scale is "+o[1])),_(I)}function a(A){E(b+A)}return{curr:b,change:a,setScale:E}};function ie(j){var l=j(!1),o=(0,M.Z)(l,2),v=o[0],s=o[1];return{curr:v,setCurr:s}}var ee=function(l){var o=l(),v=(0,M.Z)(o,2),s=v[0],b=v[1],_=l(),E=(0,M.Z)(_,2),a=E[0],A=E[1],I=l(),L=(0,M.Z)(I,2),D=L[0],y=L[1];function $(){return p.apply(this,arguments)}function p(){return p=(0,Z.Z)(t().mark(function r(){var h;return t().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,N.getAll();case 3:return h=f.sent,b(h),f.abrupt("return",h);case 8:return f.prev=8,f.t0=f.catch(0),console.log("project getAll err",f.t0),K.Z.parseError(f.t0,O.default),f.abrupt("return");case 13:case"end":return f.stop()}},r,null,[[0,8]])})),p.apply(this,arguments)}function n(r){return S.apply(this,arguments)}function S(){return S=(0,Z.Z)(t().mark(function r(h){var U;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h!=null){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(s&&s.length>1)){e.next=5;break}return O.default.error("Currently have multiple projects stored, use turnTo instead"),e.abrupt("return");case 5:return e.next=7,N.get(h);case 7:return U=e.sent,b([U]),A(0),e.abrupt("return",U);case 11:case"end":return e.stop()}},r)})),S.apply(this,arguments)}function u(r){return R.apply(this,arguments)}function R(){return R=(0,Z.Z)(t().mark(function r(h){return t().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return A(h),f.abrupt("return",s[h]);case 2:case"end":return f.stop()}},r)})),R.apply(this,arguments)}function H(r){return d.apply(this,arguments)}function d(){return d=(0,Z.Z)(t().mark(function r(h){var U;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("remove project",h),U=typeof h=="number"?h:h.projectId,e.next=4,N.remove(U);case 4:$();case 5:case"end":return e.stop()}},r)})),d.apply(this,arguments)}function F(r){return P.apply(this,arguments)}function P(){return P=(0,Z.Z)(t().mark(function r(h){var U;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.create(h);case 3:return U=e.sent,e.abrupt("return",U);case 7:return e.prev=7,e.t0=e.catch(0),console.log("project create err",e.t0),e.abrupt("return",K.Z.parseError(e.t0,O.default));case 11:case"end":return e.stop()}},r,null,[[0,7]])})),P.apply(this,arguments)}function g(r,h){return m.apply(this,arguments)}function m(){return m=(0,Z.Z)(t().mark(function r(h,U){return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:N.update(h,U).then(function(i){console.log("project update res",i)}).catch(function(i){console.log("project update err ",i),K.Z.parseError(i,O.default)});case 1:case"end":return e.stop()}},r)})),m.apply(this,arguments)}function T(){return w.apply(this,arguments)}function w(){return w=(0,Z.Z)(t().mark(function r(){var h,U,f,e,i=arguments;return t().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return h=i.length>0&&i[0]!==void 0?i[0]:void 0,k.prev=1,U=h==null?s[a].projectId:h,k.next=5,N.getProgress(U);case 5:if(f=k.sent,!(!f||f.finished==null||f.total==null)){k.next=8;break}throw Error("empty progress");case 8:return e=Math.ceil(f.finished/f.total*100),y(e),k.abrupt("return",e);case 13:return k.prev=13,k.t0=k.catch(1),console.log("get progress err",k.t0),K.Z.parseError(k.t0,O.default),k.abrupt("return",0);case 18:case"end":return k.stop()}},r,null,[[1,13]])})),w.apply(this,arguments)}return{all:s,getAll:$,getCurr:n,turnTo:u,remove:H,create:F,update:g,progress:D,getProgress:T,get curr(){if(!!s)return s[a]}}},fe=function(l,o){var v=o.oneHot,s=v===void 0?!0:v,b=o.postSetCurr,_=l(),E=(0,M.Z)(_,2),a=E[0],A=E[1],I=l(),L=(0,M.Z)(I,2),D=L[0],y=L[1],$=l(new Set),p=(0,M.Z)($,2),n=p[0],S=p[1],u=l(s),R=(0,M.Z)(u,2),H=R[0],d=R[1];function F(e){return P.apply(this,arguments)}function P(){return P=(0,Z.Z)(t().mark(function e(i){var C;return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(i!=null){c.next=2;break}return c.abrupt("return");case 2:return c.prev=2,c.next=5,N.getLabels(i);case 5:return C=c.sent,A(C),c.abrupt("return",C);case 10:return c.prev=10,c.t0=c.catch(2),console.log("label getall err ",c.t0),c.abrupt("return",K.Z.parseError(c.t0,O.default));case 14:case"end":return c.stop()}},e,null,[[2,10]])})),P.apply(this,arguments)}function g(e){var i=V(e,a,"labelId");if(i==null)throw Error("label.onSelect label not found");y(i);var C=a[i].labelId;H?n.has(C)?n.clear():(n.clear(),n.add([C])):n.has(C)?n.delete(C):n.add(C),S(new Set(n)),b&&b(a[i])}function m(e){if(!s)throw Error("multi select task doesn't have current label");var i=typeof e=="number"?e:e.labelId;y(V(i,a,"labelId")),S(new Set([i]))}function T(e){n.clear();var i=(0,X.Z)(e),C;try{for(i.s();!(C=i.n()).done;){var k=C.value;n.add(k.labelId)}}catch(c){i.e(c)}finally{i.f()}}var w=function(){var e=(0,Z.Z)(t().mark(function i(C){var k;return t().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.prev=0,W.next=3,x.create(C);case 3:return k=W.sent,F(C.projectId),W.abrupt("return",k);case 8:return W.prev=8,W.t0=W.catch(0),console.log("label create err",W.t0),W.abrupt("return",K.Z.parseError(W.t0,O.default));case 12:case"end":return W.stop()}},i,null,[[0,8]])}));return function(C){return e.apply(this,arguments)}}();function r(e){return h.apply(this,arguments)}function h(){return h=(0,Z.Z)(t().mark(function e(i){var C;return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return C=typeof i=="number"?i:i.labelId,c.prev=1,c.next=4,x.remove(C);case 4:a&&a.length&&F(a[0].projectId),c.next=11;break;case 7:c.prev=7,c.t0=c.catch(1),console.log("label remove err",c.t0),K.Z.parseError(c.t0,O.default);case 11:case"end":return c.stop()}},e,null,[[1,7]])})),h.apply(this,arguments)}function U(e){var i=typeof e=="number"?e:e.labelId;return n.has(i)}var f=function(i){i!=null?d(i):d(!H)};return{all:a,getAll:F,activeIds:n,initActive:T,onSelect:g,setCurr:m,isActive:U,create:w,remove:r,toggleOneHot:f,get curr(){if(a!=null)return a[D]}}},de=function(l){var o=l(),v=(0,M.Z)(o,2),s=v[0],b=v[1],_=l(),E=(0,M.Z)(_,2),a=E[0],A=E[1],I=function(n){if(n<0){O.default.error("This is the first image. No previous image.");return}if(n==s.length){O.default.error("This is the final image. No next image.");return}A(n)},L=function(){var p=(0,Z.Z)(t().mark(function n(S,u){var R;return t().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.next=3,N.getTasks(S);case 3:if(R=d.sent,b(R),u==null){d.next=9;break}return console.log("getall turnto"),I(u),d.abrupt("return",[R,R[u]]);case 9:return d.abrupt("return",R);case 12:return d.prev=12,d.t0=d.catch(0),console.log("task getall err ",d.t0),d.abrupt("return",K.Z.parseError(d.t0,O.default));case 16:case"end":return d.stop()}},n,null,[[0,12]])}));return function(S,u){return p.apply(this,arguments)}}();function D(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return p==null||!s?0:Math.round(s.length*p/100)}var y=function(){var p=(0,Z.Z)(t().mark(function n(){return t().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:I(a+1),console.log("all tasks",s);case 2:case"end":return u.stop()}},n)}));return function(){return p.apply(this,arguments)}}(),$=function(){var p=(0,Z.Z)(t().mark(function n(){return t().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:I(a-1);case 1:case"end":return u.stop()}},n)}));return function(){return p.apply(this,arguments)}}();return{currIdx:a,all:s,turnTo:I,getAll:L,nextTask:y,prevTask:$,finished:D,get curr(){if(!(a==null||s==null))return s[a]}}};function ce(j){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=l.label,v=o===void 0?void 0:o,s=l.project,b=s===void 0?void 0:s,_=j(),E=(0,M.Z)(_,2),a=E[0],A=E[1],I=j(),L=(0,M.Z)(I,2),D=L[0],y=L[1],$=j(new Set),p=(0,M.Z)($,2),n=p[0],S=p[1],u=function(){var F=(0,Z.Z)(t().mark(function P(g){var m;return t().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(g!=null){w.next=2;break}return w.abrupt("return");case 2:return w.prev=2,w.next=5,te.getAnnotations(g);case 5:return m=w.sent,A(m),w.abrupt("return",m);case 10:return w.prev=10,w.t0=w.catch(2),console.log("ann getAll err",w.t0),w.abrupt("return",K.Z.parseError(w.t0,O.default));case 14:case"end":return w.stop()}},P,null,[[2,10]])}));return function(g){return F.apply(this,arguments)}}(),R=function(){var F=(0,Z.Z)(t().mark(function P(g){var m,T;return t().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,q.create(g);case 3:if(m=r.sent,T=[],!g.dataId){r.next=9;break}return r.next=8,u(g.dataId);case 8:T=r.sent;case 9:return b&&T.length==1&&b.getProgress(),r.abrupt("return",m);case 13:return r.prev=13,r.t0=r.catch(0),console.log("annotation create err",r.t0),r.abrupt("return",K.Z.parseError(r.t0,O.default));case 17:case"end":return r.stop()}},P,null,[[0,13]])}));return function(g){return F.apply(this,arguments)}}(),H=function(){var F=(0,Z.Z)(t().mark(function P(g){var m,T;return t().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(m=typeof g=="number"?g:g.annotationId,m!=null){r.next=3;break}return r.abrupt("return");case 3:return r.prev=3,r.next=6,q.remove(m);case 6:if(!(a&&a.length)){r.next=11;break}return r.next=9,u(a[0].dataId);case 9:T=r.sent,T.length==0&&b.getProgress();case 11:r.next=17;break;case 13:return r.prev=13,r.t0=r.catch(3),console.log("annotation remove err",r.t0),r.abrupt("return",K.Z.parseError(r.t0,O.default));case 17:case"end":return r.stop()}},P,null,[[3,13]])}));return function(g){return F.apply(this,arguments)}}(),d=function(){var F=(0,Z.Z)(t().mark(function P(g){return t().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(g!=null){T.next=4;break}return y(void 0),S(new Set),T.abrupt("return");case 4:y(V(g,a,"annotationId")),S(new Set([g.annotationId])),v.setCurr(g.labelId),console.log(V(g,a,"annotationId"),new Set([g.annotationId]),g.labelId);case 8:case"end":return T.stop()}},P)}));return function(g){return F.apply(this,arguments)}}();return{all:a,getAll:u,create:R,remove:H,setCurr:d,activeIds:n,get curr(){if(!(!a||!D))return a[D]}}}var pe=function(l){var o=l(),v=(0,M.Z)(o,2),s=v[0],b=v[1],_=l([]),E=(0,M.Z)(_,2),a=E[0],A=E[1],I=function(){var D=(0,Z.Z)(t().mark(function y($){return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:b($);case 1:case"end":return n.stop()}},y)}));return function($){return D.apply(this,arguments)}}(),L=function(){var D=(0,Z.Z)(t().mark(function y($,p){var n;return t().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,ne.getDatas($);case 3:if(n=u.sent,A(n),p==null){u.next=8;break}return I(p),u.abrupt("return",[n,n[p]]);case 8:return u.abrupt("return",n);case 11:return u.prev=11,u.t0=u.catch(0),console.log("data getall err ",u.t0),u.abrupt("return",K.Z.parseError(u.t0,O.default));case 15:case"end":return u.stop()}},y,null,[[0,11]])}));return function($,p){return D.apply(this,arguments)}}();return{all:a,getAll:L,turnTo:I,get curr(){if(!(s==null||a==null))return a[s]},get imgSrc(){return a&&a[s]?"".concat(z,"/datas/").concat(a[s].dataId,"/image?sault=").concat(a[s].sault):""}}},oe=function(l,o,v){v.effectTrigger||(v.effectTrigger={});var s=ie(l),b=se(l),_=de(l),E=pe(l),a=ee(l),A=fe(l,v.label),I=ce(l,(0,Q.Z)((0,Q.Z)({},v.annotation),{},{label:A,project:a}));return o(function(){var L=K.Z.getQueryVariable("projectId");if(L==null){Y.m8.push("/");return}var D=parseInt(L);a.getCurr(L).catch(function(y){K.Z.parseError(y,O.default),Y.m8.push("/")}),A.getAll(D),_.getAll(D),a.getProgress(D)},[]),o(function(){_.all&&_.all.length!=0&&_.turnTo(0)},[_.all]),o(function(){if(_.currIdx!=null){var L=function(){var D=(0,Z.Z)(t().mark(function y(){var $,p,n,S,u,R,H,d,F,P;return t().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(($=_.curr)!==null&&$!==void 0&&$.projectId&&a.getProgress(_.curr.projectId),!((p=_.curr)!==null&&p!==void 0&&p.taskId)){m.next=13;break}return m.next=4,E.getAll(_.curr.taskId,0);case 4:return n=m.sent,S=(0,M.Z)(n,2),u=S[0],R=S[1],m.next=10,I.getAll(R.dataId);case 10:if(H=m.sent,A.all){d=(0,X.Z)(A.all);try{for(d.s();!(F=d.n()).done;)P=F.value,P.active=!1}catch(T){d.e(T)}finally{d.f()}}v.effectTrigger.postTaskChange&&v.effectTrigger.postTaskChange(A.all,H);case 13:s.setCurr(!1);case 14:case"end":return m.stop()}},y)}));return function(){return D.apply(this,arguments)}}();L()}},[_.currIdx]),[s,b,I,_,E,a,A]}}}]);
