(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(E,L,n){"use strict";n.d(L,{Z:function(){return x}});var T=n(94663),Z=n(80112);function D(l){return Function.toString.call(l).indexOf("[native code]")!==-1}var C=n(18597);function O(l,a,s){return(0,C.Z)()?O=Reflect.construct:O=function(p,J,S){var z=[null];z.push.apply(z,J);var V=Function.bind.apply(p,z),R=new V;return S&&(0,Z.Z)(R,S.prototype),R},O.apply(null,arguments)}function x(l){var a=typeof Map=="function"?new Map:void 0;return x=function(i){if(i===null||!D(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(i))return a.get(i);a.set(i,p)}function p(){return O(i,arguments,(0,T.Z)(this).constructor)}return p.prototype=Object.create(i.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),(0,Z.Z)(p,i)},x(l)}},85024:function(E){E.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(E){E.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(E){E.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(E,L,n){"use strict";n.d(L,{pL:function(){return Z},oo:function(){return D}});var T=n(91220);function Z(x){var l=0;if(!x)return l;var a=(0,T.Z)(x),s;try{for(a.s();!(s=a.n()).done;){var i=s.value;!i||!i.frontendId||i.frontendId>l&&(l=i.frontendId)}}catch(p){a.e(p)}finally{a.f()}return l}function D(x){var l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(x);return l?{r:parseInt(l[1],16),g:parseInt(l[2],16),b:parseInt(l[3],16)}:null}function C(x){var l=x.toString(16);return l.length==1?"0"+l:l}function O(x,l,a){return"#"+C(x)+C(l)+C(a)}},14836:function(E,L,n){"use strict";n.d(L,{Z:function(){return tn}});var T=n(20228),Z=n(11382),D=n(54421),C=n(38272),O=n(57663),x=n(71577),l=n(91220),a=n(67294),s=n(56159),i=n.n(s),p=n(49111),J=n(19650),S=n(2824),z=n(11849),V=n(85024),R=n.n(V),nn=n(63097),y=n(85893),F=function(m){var B=(0,z.Z)({},m.annotation),Q=(0,a.useState)(B.invisible),X=(0,S.Z)(Q,2),t=X[0],j=X[1],v=(0,a.useState)(0),I=(0,S.Z)(v,2),c=I[0],g=I[1];(0,a.useEffect)(function(){j(m.annotation.invisible)},[m.annotation.invisible]);var d=(0,y.jsxs)(C.ZP.Item,{className:"".concat(R().listItem," ").concat(m.active?R().listItemActive:""),unselectable:"on",onClick:function(){m.onClick(B)},children:[(0,y.jsxs)(J.Z,{align:"center",size:5,children:[(0,y.jsx)("a",{className:R().eye,style:{backgroundImage:t?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(A){A.stopPropagation(),j(!t),m.onAnnotationModify(B)}})," ",(0,y.jsx)("span",{className:R().annotationId,children:B.frontendId}),(0,y.jsx)("span",{className:R().labelName,children:B.label.name}),(0,y.jsx)(nn.Z,{color:B.label.color})]}),(0,y.jsx)("a",{className:R().delete,onClick:function(A){A.stopPropagation();var M=new Date().getTime();M-c<300||(g(M),m.onAnnotationDelete(B))}})]});return d},G=F,_=n(48971),r=function(m){var B=(0,_.YB)(),Q=B.formatMessage({id:"component.PPAnnotationList.annotationList"}),X=B.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),t=new Set,j=[],v=(0,l.Z)(m.annotations),I;try{for(v.s();!(I=v.n()).done;){var c=I.value;t.has(c.frontendId)||(j.push(c),t.add(c.frontendId))}}catch(g){v.e(g)}finally{v.f()}return(0,y.jsx)(Z.Z,{spinning:m.disabled,indicator:(0,y.jsx)(y.Fragment,{}),children:(0,y.jsx)(C.ZP,{className:i().labelList,size:"large",header:(0,y.jsx)("div",{className:i().listHeader,children:Q}),bordered:!0,dataSource:j,renderItem:function(d){var f;return(0,y.jsx)(G,{onClick:m.disabled?function(){}:m.onAnnotationSelect,annotation:d,active:m.disabled?!1:d.frontendId==((f=m.currAnnotation)===null||f===void 0?void 0:f.frontendId),onAnnotationDelete:m.onAnnotationDelete,onAnnotationModify:m.onAnnotationModify})},footer:function(){return m.onAnnotationAdd?(0,y.jsx)("div",{children:(0,y.jsx)(x.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){m.onAnnotationAdd()},block:!0,children:X})}):(0,y.jsx)("div",{})}})})},tn=r},10137:function(E,L,n){"use strict";var T=n(34669),Z=n(54458),D=n(67294),C=n(85893),O=function(l){var a,s;return(0,C.jsxs)("div",{className:"progress",children:[(0,C.jsx)(Z.Z,{className:"progressBar",percent:Math.ceil(l.project.finished/((a=l.task.all)===null||a===void 0?void 0:a.length)*100),status:"active",showInfo:!1})," ",(0,C.jsxs)("span",{className:"progressDesc",children:["Current labeling ",l.task.currIdx==null?1:l.task.currIdx+1," of"," ",(s=l.task.all)===null||s===void 0?void 0:s.length,". Already labeled ",l.project.finished||0,"."]})]})};L.Z=O},91861:function(E,L,n){"use strict";n.d(L,{Ad:function(){return C},k3:function(){return O},Vd:function(){return x},td:function(){return l}});var T=n(34792),Z=n(48086),D=40;function C(){localStorage.removeItem("history"),O([])}function O(a){var s=localStorage.getItem("history"),i=s?JSON.parse(s):{index:-1,items:[]};if(JSON.stringify(i.items[i.index])!=JSON.stringify(a)){var p=i.index>D?i.index-D:0,J=i.items.splice(p,i.index==0?1:i.index+1);i.items=J.concat([a]),i.index<=D?i.index++:i.index=D+1,localStorage.setItem("history",JSON.stringify(i))}}function x(){var a=localStorage.getItem("history");if(!!a){var s=JSON.parse(a);if(!!s){if(s.index>=s.items.length-1){Z.default.error("No next history!");return}return s.index++,localStorage.setItem("history",JSON.stringify(s)),s.items[s.index]}}}function l(){var a=localStorage.getItem("history");if(!!a){var s=JSON.parse(a);if(console.log("history",s),!s||!s.index||s.index<=1){Z.default.error("No previous history!");return}return s.index--,localStorage.setItem("history",JSON.stringify(s)),s.items[s.index]}}},58857:function(E,L,n){"use strict";n.r(L),n.d(L,{default:function(){return X}});var T=n(11849),Z=n(20228),D=n(11382),C=n(34792),O=n(48086),x=n(91220),l=n(2824),a=n(67294),s=n(48971),i=n(72285),p=n.n(i),J=n(8088),S=n(61541),z=n(44434),V=n(5041),R=n(57436),nn=n(14836),y=n(98731),F=n(91861),G=n(65031),_=n(57406),r=n(85893);function tn(t){if(!(!t||t.length<2))return t.join(",")}function en(t){var j,v=t.annotation;if(!v||!v.result||!v.label||!v.label.color)return(0,r.jsx)(r.Fragment,{});var I=v.result.split(","),c={xmin:parseInt(I[0]),ymin:parseInt(I[1]),xmax:I.length>=3?parseInt(I[2]):void 0,ymax:I.length>=4?parseInt(I[3]):void 0},g=v.label.color,d=(0,_.oo)(g);if(!d)return(0,r.jsx)(r.Fragment,{});var f=((j=t.currentAnnotation)===null||j===void 0?void 0:j.frontendId)==v.frontendId,A=f?.5:.1,M=c.xmax!=null&&c.ymax!=null?(0,r.jsx)(G.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(v)},stroke:g,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:c.xmin,y:c.ymin,width:c.xmax-c.xmin,height:c.ymax-c.ymin,closed:!0,fill:"rgba(".concat(d.r,", ").concat(d.g,", ").concat(d.b,", ").concat(A,")")}):(0,r.jsx)(r.Fragment,{});function e(k){if(!k&&(c.xmax==null||c.ymax==null))return(0,r.jsx)(r.Fragment,{});var K=function(h){var w;if(t.currentTool=="editor"){var b=(w=t.stageRef)===null||w===void 0?void 0:w.current,N=b.findOne(".baseImage"),Y=!1,U=h.target.x();U>N.width()/2&&(U=N.width()/2,Y=!0),U<-N.width()/2&&(U=-N.width()/2,Y=!0);var H=h.target.y();H>N.height()/2&&(H=N.height()/2,Y=!0),H<-N.height()/2&&(H=-N.height()/2,Y=!0),Y&&h.target.setPosition({x:U,y:H}),k?(c.xmin=U,c.ymin=H):(c.xmax=U,c.ymax=H);var on=(0,T.Z)((0,T.Z)({},v),{},{result:"".concat(c.xmin,",").concat(c.ymin,",").concat(c.xmax,",").concat(c.ymax)});t.onDrag(on)}};return(0,r.jsx)(G.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(v)},draggable:t.currentTool=="editor",onDragMove:K,onDragEnd:K,onMouseOver:function(){var h;t.currentTool=="editor"&&(h=t.stageRef)!==null&&h!==void 0&&h.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var h;(h=t.stageRef)!==null&&h!==void 0&&h.current&&(t.stageRef.current.container().style.cursor="default")},x:k?c.xmin:c.xmax,y:k?c.ymin:c.ymax,radius:5/t.scale,fill:g})}return(0,r.jsxs)(G.ZA,{children:[M,e(!0),e(!1)]},v.annotationId)}function m(t){var j=function(d,f){var A,M=tn([d,f]);!M||!t.dataId||(console.log(M),t.onAnnotationAdd({dataId:t.dataId,type:"rectangle",frontendId:(0,_.pL)(t.annotations)+1,label:t.currentLabel,labelId:(A=t.currentLabel)===null||A===void 0?void 0:A.labelId,result:M}))},v=function(d,f){var A;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((A=t.currentLabel)!==null&&A!==void 0&&A.color))){var M=t.currentAnnotation.result+",".concat(d,",").concat(f),e=(0,T.Z)((0,T.Z)({},t.currentAnnotation),{},{result:M});t.modifyAnnoByFrontendId(e)}},I=function(d){if(t.currentTool=="rectangle"){var f=d.mouseX+d.offsetX,A=d.mouseY+d.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?v(f,A):j(f,A)}},c=function(){t.currentTool!="rectangle"&&t.currentTool!="editor"||t.onMouseUp&&t.onMouseUp()};return{onMouseDown:I,onMouseMove:function(){},onMouseUp:c,drawAnnotation:en}}var B=n(10137),Q=function(){var j,v=(0,a.useState)(0),I=(0,l.Z)(v,2),c=I[0],g=I[1],d=(0,y.$L)(a.useState,a.useEffect,{effectTrigger:{postTaskChange:function(o,P){(0,F.Ad)(),(0,F.k3)({annos:P})}},label:{oneHot:!0,postSelect:function(){e.setCurr(void 0),g(0)},preUnsetCurr:w},tool:{defaultTool:"mover"}}),f=d.tool,A=d.loading,M=d.scale,e=d.annotation,k=d.task,K=d.data,W=d.project,h=d.label;function w(){e.setCurr(void 0),g(0),console.log("preCurrLabelUnset"),f.setCurr("mover")}var b=function(o){console.log("setCurrentAnnotation"),e.setCurr(o),o!=null&&o.frontendId?g(o.frontendId):g(0)},N=function(o){var P=[],q=(0,x.Z)(e.all),rn;try{for(q.s();!(rn=q.n()).done;){var an=rn.value;an.frontendId==o.frontendId?P.push(o):P.push(an)}}catch(hn){q.e(hn)}finally{q.f()}b(o),e.setAll(P)};(0,a.useEffect)(function(){(0,F.Ad)()},[]);function Y(){var u;(0,F.k3)({annos:e.all,currAnno:e.curr}),console.log("finish before",e.curr),!!e.curr&&(!e.curr.result||e.curr.result.split(",").length!=4||((e==null||(u=e.curr)===null||u===void 0?void 0:u.annotationId)==null?(console.log("finish",K.curr,e.curr),e.create(e==null?void 0:e.curr)):e.update(e==null?void 0:e.curr),console.log("finish after",e.curr),O.default.success("Save Success!"),console.log("tool",f.curr),f.curr=="rectangle"&&b(void 0)))}var U={dataId:(j=K.curr)===null||j===void 0?void 0:j.dataId,currentLabel:h.curr,scale:M.curr,currentTool:f.curr,annotations:e.all,currentAnnotation:e.curr,onAnnotationAdd:function(o){var P=e.all.concat([o]);e.setAll(P),b(o)},onAnnotationModify:N,modifyAnnoByFrontendId:N,onMouseUp:Y,frontendIdOps:{frontendId:c,setFrontendId:g}},H=m(U),on={polygon:H,brush:void 0},$=(0,s.YB)(),ln=$.formatMessage({id:"pages.toolBar.rectangle"}),sn=$.formatMessage({id:"pages.toolBar.zoomIn"}),cn=$.formatMessage({id:"pages.toolBar.zoomOut"}),dn=$.formatMessage({id:"pages.toolBar.move"}),un=$.formatMessage({id:"pages.toolBar.unDo"}),fn=$.formatMessage({id:"pages.toolBar.reDo"}),vn=$.formatMessage({id:"pages.toolBar.save"}),gn=$.formatMessage({id:"pages.toolBar.edit"}),mn=$.formatMessage({id:"pages.toolBar.clearMark"});return(0,r.jsxs)(J.Z,{className:p().det,children:[(0,r.jsxs)(z.Z,{children:[(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/rectangle.png",active:f.curr=="rectangle",onClick:function(){if(!h.curr){O.default.error("Please choose a label category first!");return}f.setCurr("rectangle"),b(void 0)},children:ln}),(0,r.jsx)(S.Z,{active:f.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){f.setCurr("editor")},children:gn}),(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){M.change(.1)},children:sn}),(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){M.change(-.1)},children:cn}),(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var o;e.pushToBackend((o=K.curr)===null||o===void 0?void 0:o.dataId)},children:vn}),(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/move.png",active:f.curr=="mover",onClick:function(){f.setCurr("mover")},children:dn}),(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=(0,F.td)();if(o){var P;e.setAll(o.annos),b(o.currAnno),e.pushToBackend((P=K.curr)===null||P===void 0?void 0:P.dataId,o.annos)}},children:un}),(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=(0,F.Vd)();o&&(e.setAll(o.annos),b(o.currAnno))},children:fn}),(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){e.clear(),(0,F.k3)({annos:[]})},children:mn})]}),(0,r.jsx)("div",{id:"dr",className:"mainStage",children:(0,r.jsxs)(D.Z,{tip:"loading",spinning:!!A.curr,children:[(0,r.jsx)("div",{className:"draw",children:(0,r.jsx)(R.Z,{scale:M.curr,annotations:e.all,currentTool:f.curr,currentAnnotation:e.curr,setCurrentAnnotation:b,onAnnotationModify:N,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:c,setFrontendId:g},imgSrc:K.imgSrc,transparency:100,onAnnotationAdd:function(o){var P=e.all.concat([o]);e.setAll(P)},drawTool:on,threshold:0})}),(0,r.jsx)("div",{className:"pblock",children:(0,r.jsx)(B.Z,{task:k,project:W})}),(0,r.jsx)("div",{className:"prevTask",onClick:function(){!k.prevTask()||b(void 0)}}),(0,r.jsx)("div",{className:"nextTask",onClick:function(){!k.nextTask()||b(void 0)}})]})}),(0,r.jsx)(z.Z,{disLoc:"right",children:(0,r.jsx)(S.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){s.m8.push("/project_overview?projectId=".concat(W.curr.projectId))},children:"Project Overview"})}),(0,r.jsxs)("div",{className:"rightSideBar",children:[(0,r.jsx)(V.Z,{labels:h.all,activeIds:h.activeIds,onLabelSelect:h.onSelect,onLabelModify:function(){},onLabelDelete:h.remove,onLabelAdd:function(o){h.create((0,T.Z)((0,T.Z)({},o),{},{projectId:W.curr.projectId})).then(function(P){b(void 0),h.setCurr(P)})}}),(0,r.jsx)(nn.Z,{disabled:!1,currAnnotation:e.curr,annotations:e.all,onAnnotationSelect:function(o){o!=null&&o.delete||b(o),console.log(o)},onAnnotationAdd:function(){console.log("onAnnotationAdd"),b(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(o){e.setAll(e.all.filter(function(P){return P.frontendId!=o.frontendId})),b(void 0),e.remove(o)}})]})]})},X=Q}}]);
