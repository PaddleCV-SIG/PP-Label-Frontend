(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(ge,re,R){"use strict";R.d(re,{gu:function(){return ue},os:function(){return le},Gd:function(){return ee},$L:function(){return ve}});var X=R(11849),Y=R(91220),P=R(3182),he=R(34792),E=R(48086),$=R(2824),ae=R(94043),u=R.n(ae),q=R(48971),O=R(37071),N=R(81139),z=localStorage.getItem("basePath"),G=new N.VK(z?{basePath:z}:void 0),H=new N.U(G),ne=new N.sD(G),te=new N.W6(G),Q=new N.Cl(G),x=new N.vb(G),ue=function(d){return JSON.parse(JSON.stringify(d))};function le(A){return A&&(A.toLowerCase().replace(/([-_][a-z])/g,function(d){return d.toUpperCase().replace("-","").replace("_","")}),A)}var J=function(d,h,g){if(!!g){for(var c=typeof d=="number"?d:d[g],w=0;w<h.length;w++)if(c==h[w][g])return w}},se=function(d){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],g=d(1),c=(0,$.Z)(g,2),w=c[0],L=c[1];function m(y){var I=y;I<h[0]&&(I=h[0],E.default.error("Smallest scale is "+h[0])),I>h[1]&&(I=h[1],E.default.error("Largest scale is "+h[1])),L(I)}function l(y){m(w+y)}return{curr:w,change:l,setScale:m}};function ie(A,d){var h=d.defaultTool,g=A(h),c=(0,$.Z)(g,2),w=c[0],L=c[1];return{curr:w,setCurr:L}}function fe(A){var d=A(!1),h=(0,$.Z)(d,2),g=h[0],c=h[1];return{curr:g,setCurr:c}}var ee=function(d){var h=d(),g=(0,$.Z)(h,2),c=g[0],w=g[1],L=d(),m=(0,$.Z)(L,2),l=m[0],y=m[1],I=d(),D=(0,$.Z)(I,2),C=D[0],Z=D[1];function S(){return _.apply(this,arguments)}function _(){return _=(0,P.Z)(u().mark(function a(){var r;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,H.getAll();case 3:return r=t.sent,w(r),t.abrupt("return",r);case 8:return t.prev=8,t.t0=t.catch(0),console.log("project getAll err",t.t0),O.Z.parseError(t.t0,E.default),t.abrupt("return");case 13:case"end":return t.stop()}},a,null,[[0,8]])})),_.apply(this,arguments)}function s(a){return j.apply(this,arguments)}function j(){return j=(0,P.Z)(u().mark(function a(r){var p;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r!=null){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(c&&c.length>1)){e.next=5;break}return E.default.error("Currently have multiple projects stored, use turnTo instead"),e.abrupt("return");case 5:return e.next=7,H.get(r);case 7:return p=e.sent,w([p]),y(0),e.abrupt("return",p);case 11:case"end":return e.stop()}},a)})),j.apply(this,arguments)}function f(a){return T.apply(this,arguments)}function T(){return T=(0,P.Z)(u().mark(function a(r){return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return y(r),t.abrupt("return",c[r]);case 2:case"end":return t.stop()}},a)})),T.apply(this,arguments)}function F(a){return b.apply(this,arguments)}function b(){return b=(0,P.Z)(u().mark(function a(r){var p;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("remove project",r),p=typeof r=="number"?r:r.projectId,e.next=4,H.remove(p);case 4:S();case 5:case"end":return e.stop()}},a)})),b.apply(this,arguments)}function K(a){return U.apply(this,arguments)}function U(){return U=(0,P.Z)(u().mark(function a(r){var p;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H.create(r);case 3:return p=e.sent,e.abrupt("return",p);case 7:return e.prev=7,e.t0=e.catch(0),console.log("project create err",e.t0),e.abrupt("return",O.Z.parseError(e.t0,E.default));case 11:case"end":return e.stop()}},a,null,[[0,7]])})),U.apply(this,arguments)}function M(a,r){return W.apply(this,arguments)}function W(){return W=(0,P.Z)(u().mark(function a(r,p){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:H.update(r,p).then(function(n){console.log("project update res",n)}).catch(function(n){console.log("project update err ",n),O.Z.parseError(n,E.default)});case 1:case"end":return e.stop()}},a)})),W.apply(this,arguments)}function B(){return k.apply(this,arguments)}function k(){return k=(0,P.Z)(u().mark(function a(){var r,p,t,e,n=arguments;return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return r=n.length>0&&n[0]!==void 0?n[0]:void 0,v.prev=1,p=r==null?c[l].projectId:r,v.next=5,H.getProgress(p);case 5:if(t=v.sent,!(!t||t.finished==null||t.total==null)){v.next=8;break}throw Error("empty progress");case 8:return e=Math.ceil(t.finished/t.total*100),Z(e),v.abrupt("return",e);case 13:return v.prev=13,v.t0=v.catch(1),console.log("get progress err",v.t0),O.Z.parseError(v.t0,E.default),v.abrupt("return",0);case 18:case"end":return v.stop()}},a,null,[[1,13]])})),k.apply(this,arguments)}return{all:c,getAll:S,getCurr:s,turnTo:f,remove:F,create:K,update:M,progress:C,getProgress:B,get curr(){if(!!c)return c[l]}}},de=function(d,h){var g=h.oneHot,c=g===void 0?!0:g,w=h.postSetCurr,L=d(),m=(0,$.Z)(L,2),l=m[0],y=m[1],I=d(),D=(0,$.Z)(I,2),C=D[0],Z=D[1],S=d(new Set),_=(0,$.Z)(S,2),s=_[0],j=_[1],f=d(c),T=(0,$.Z)(f,2),F=T[0],b=T[1];function K(n){return U.apply(this,arguments)}function U(){return U=(0,P.Z)(u().mark(function n(o){var v;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(console.log("label getall"),o!=null){i.next=3;break}return i.abrupt("return");case 3:return i.prev=3,i.next=6,H.getLabels(o);case 6:return v=i.sent,y(v),i.abrupt("return",v);case 11:return i.prev=11,i.t0=i.catch(3),console.log("label getall err ",i.t0),i.abrupt("return",O.Z.parseError(i.t0,E.default));case 15:case"end":return i.stop()}},n,null,[[3,11]])})),U.apply(this,arguments)}function M(n){var o=J(n,l,"labelId");if(o==null)throw Error("label.onSelect label not found");Z(o);var v=l[o].labelId;F?s.has(v)?s.clear():(s.clear(),s.add(v)):s.has(v)?s.delete(v):s.add(v),j(new Set(s)),w&&w(l[o])}function W(n){if(console.log("setCurr",n),!c)throw Error("multi select task doesn't have current label");if(!!n){var o=typeof n=="number"?n:n.labelId;o=J(o,l,"labelId"),o&&(console.log("setCurr index:",o),Z(o),j(new Set([o])))}}function B(n){s.clear();var o=(0,Y.Z)(n),v;try{for(o.s();!(v=o.n()).done;){var V=v.value;s.add(V.labelId)}}catch(i){o.e(i)}finally{o.f()}}function k(n){return a.apply(this,arguments)}function a(){return a=(0,P.Z)(u().mark(function n(o){var v;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return console.log("create label",o),i.prev=1,i.next=4,x.create(o);case 4:return v=i.sent,K(o.projectId),i.abrupt("return",v);case 9:return i.prev=9,i.t0=i.catch(1),console.log("label create err",i.t0),i.abrupt("return",O.Z.parseError(i.t0,E.default));case 13:case"end":return i.stop()}},n,null,[[1,9]])})),a.apply(this,arguments)}function r(n){return p.apply(this,arguments)}function p(){return p=(0,P.Z)(u().mark(function n(o){var v;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return v=typeof o=="number"?o:o.labelId,i.prev=1,i.next=4,x.remove(v);case 4:l&&l.length&&K(l[0].projectId),i.next=11;break;case 7:i.prev=7,i.t0=i.catch(1),console.log("label remove err",i.t0),O.Z.parseError(i.t0,E.default);case 11:case"end":return i.stop()}},n,null,[[1,7]])})),p.apply(this,arguments)}function t(n){var o=typeof n=="number"?n:n.labelId;return s.has(o)}var e=function(o){o!=null?b(o):b(!F)};return{all:l,getAll:K,activeIds:s,initActive:B,onSelect:M,setCurr:W,isActive:t,create:k,remove:r,toggleOneHot:e,get curr(){if(l!=null)return l[C]}}},ce=function(d){var h=d(),g=(0,$.Z)(h,2),c=g[0],w=g[1],L=d(),m=(0,$.Z)(L,2),l=m[0],y=m[1],I=function(s){if(!!c){if(s<0){E.default.error("This is the first image. No previous image.");return}if(s==c.length){E.default.error("This is the final image. No next image.");return}y(s)}},D=function(){var _=(0,P.Z)(u().mark(function s(j,f){var T;return u().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,b.next=3,H.getTasks(j);case 3:if(T=b.sent,w(T),f==null){b.next=9;break}return console.log("getall turnto"),I(f),b.abrupt("return",[T,T[f]]);case 9:return b.abrupt("return",T);case 12:return b.prev=12,b.t0=b.catch(0),console.log("task getall err ",b.t0),b.abrupt("return",O.Z.parseError(b.t0,E.default));case 16:case"end":return b.stop()}},s,null,[[0,12]])}));return function(j,f){return _.apply(this,arguments)}}();function C(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return _==null||!c?0:Math.round(c.length*_/100)}var Z=function(){var _=(0,P.Z)(u().mark(function s(){return u().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:I(l+1),console.log("all tasks",c);case 2:case"end":return f.stop()}},s)}));return function(){return _.apply(this,arguments)}}(),S=function(){var _=(0,P.Z)(u().mark(function s(){return u().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:I(l-1);case 1:case"end":return f.stop()}},s)}));return function(){return _.apply(this,arguments)}}();return{currIdx:l,all:c,turnTo:I,getAll:D,nextTask:Z,prevTask:S,finished:C,get curr(){if(!(l==null||c==null))return c[l]}}};function pe(A,d){var h=d.label,g=h===void 0?void 0:h,c=d.project,w=c===void 0?void 0:c,L=A(),m=(0,$.Z)(L,2),l=m[0],y=m[1],I=A(),D=(0,$.Z)(I,2),C=D[0],Z=D[1],S=A(new Set),_=(0,$.Z)(S,2),s=_[0],j=_[1],f=function(){var k=(0,P.Z)(u().mark(function a(r){var p;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r!=null){e.next=2;break}return e.abrupt("return",[]);case 2:return e.prev=2,e.next=5,te.getAnnotations(r);case 5:return p=e.sent,y(p),e.abrupt("return",p);case 10:return e.prev=10,e.t0=e.catch(2),console.log("ann getAll err",e.t0),O.Z.parseError(e.t0,E.default),e.abrupt("return",[]);case 15:case"end":return e.stop()}},a,null,[[2,10]])}));return function(r){return k.apply(this,arguments)}}(),T=function(){var k=(0,P.Z)(u().mark(function a(r){var p,t;return u().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r.label&&(r.labelId=r.label.id),n.next=4,Q.create(r);case 4:if(p=n.sent,t=[],!r.dataId){n.next=10;break}return n.next=9,f(r.dataId);case 9:t=n.sent;case 10:return w&&t.length==1&&w.getProgress(),n.abrupt("return",p);case 14:return n.prev=14,n.t0=n.catch(0),console.log("annotation create err",n.t0),n.abrupt("return",O.Z.parseError(n.t0,E.default));case 18:case"end":return n.stop()}},a,null,[[0,14]])}));return function(r){return k.apply(this,arguments)}}();function F(k){return b.apply(this,arguments)}function b(){return b=(0,P.Z)(u().mark(function k(a){var r,p;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove",a),r=typeof a=="number"?a:a.annotationId,r!=null){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Q.remove(r);case 7:if(!(l&&l.length&&l[0].dataId)){e.next=12;break}return e.next=10,f(l[0].dataId);case 10:p=e.sent,p.length==0&&w.getProgress();case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(4),console.log("annotation remove err",e.t0),e.abrupt("return",O.Z.parseError(e.t0,E.default));case 18:case"end":return e.stop()}},k,null,[[4,14]])})),b.apply(this,arguments)}var K=function(){var k=(0,P.Z)(u().mark(function a(r){var p;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("annotation setcurr",r),r!=null){e.next=4;break}return Z(void 0),e.abrupt("return");case 4:if(p=J(r,l,"annotationId"),p){e.next=8;break}return e.next=8,T(r);case 8:Z(J(r,l,"annotationId")),j(new Set([r.annotationId])),g.setCurr(r.labelId),console.log(J(r,l,"annotationId"),new Set([r.annotationId]),r.labelId);case 12:case"end":return e.stop()}},a)}));return function(r){return k.apply(this,arguments)}}();function U(k){return M.apply(this,arguments)}function M(){return M=(0,P.Z)(u().mark(function k(a){return u().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:Q.update(a.annotationId,a).then(function(t){console.log("annotation update res",t),f(a.projectId)}).catch(function(t){console.log("annotation update err ",t),O.Z.parseError(t,E.default)});case 1:case"end":return p.stop()}},k)})),M.apply(this,arguments)}function W(k){return B.apply(this,arguments)}function B(){return B=(0,P.Z)(u().mark(function k(a){var r;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=a==null?l[C]:a,r.annotationId==null?T(r):U(r);case 2:case"end":return t.stop()}},k)})),B.apply(this,arguments)}return{all:l,getAll:f,create:T,remove:F,setCurr:K,update:U,modify:W,activeIds:s,get curr(){if(!(!l||!C))return l[C]}}}var oe=function(d){var h=d(),g=(0,$.Z)(h,2),c=g[0],w=g[1],L=d([]),m=(0,$.Z)(L,2),l=m[0],y=m[1],I=function(){var C=(0,P.Z)(u().mark(function Z(S){return u().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:w(S);case 1:case"end":return s.stop()}},Z)}));return function(S){return C.apply(this,arguments)}}(),D=function(){var C=(0,P.Z)(u().mark(function Z(S,_){var s;return u().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,ne.getDatas(S);case 3:if(s=f.sent,y(s),_==null){f.next=8;break}return I(_),f.abrupt("return",[s,s[_]]);case 8:return f.abrupt("return",s);case 11:return f.prev=11,f.t0=f.catch(0),console.log("data getall err ",f.t0),f.abrupt("return",O.Z.parseError(f.t0,E.default));case 15:case"end":return f.stop()}},Z,null,[[0,11]])}));return function(S,_){return C.apply(this,arguments)}}();return{all:l,getAll:D,turnTo:I,get curr(){if(!(c==null||l==null))return l[c]},get imgSrc(){return l&&l[c]?"".concat(z,"/datas/").concat(l[c].dataId,"/image?sault=").concat(l[c].sault):""}}},ve=function(d,h,g){var c=ie(d,g.tool?g.tool:{}),w=fe(d),L=se(d),m=ce(d),l=oe(d),y=ee(d),I=de(d,g.label?g.label:{}),D=pe(d,(0,X.Z)((0,X.Z)({},g.annotation),{},{label:I,project:y}));return h(function(){var C=O.Z.getQueryVariable("projectId");if(C==null){q.m8.push("/");return}var Z=parseInt(C);y.getCurr(C).catch(function(S){O.Z.parseError(S,E.default),q.m8.push("/")}),I.getAll(Z),m.getAll(Z),y.getProgress(Z)},[]),h(function(){m.all&&m.all.length!=0&&m.turnTo(0)},[m.all]),h(function(){if(m.currIdx!=null){var C=function(){var Z=(0,P.Z)(u().mark(function S(){var _,s,j,f,T,F,b,K,U,M,W,B;return u().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if((_=m.curr)!==null&&_!==void 0&&_.projectId&&y.getProgress(m.curr.projectId),!((s=m.curr)!==null&&s!==void 0&&s.taskId)){a.next=13;break}return a.next=4,l.getAll(m.curr.taskId,0);case 4:return T=a.sent,F=(0,$.Z)(T,2),b=F[0],K=F[1],a.next=10,D.getAll(K.dataId);case 10:if(U=a.sent,I.all){M=(0,Y.Z)(I.all);try{for(M.s();!(W=M.n()).done;)B=W.value,B.active=!1}catch(r){M.e(r)}finally{M.f()}}(j=g.effectTrigger)!==null&&j!==void 0&&j.postTaskChange&&((f=g.effectTrigger)===null||f===void 0||f.postTaskChange(I.all,U));case 13:w.setCurr(!1);case 14:case"end":return a.stop()}},S)}));return function(){return Z.apply(this,arguments)}}();C()}},[m.currIdx]),[c,w,L,D,m,l,y,I]}}}]);
