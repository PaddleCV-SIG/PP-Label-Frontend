(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(ue,z,$){"use strict";$.d(z,{gu:function(){return q},Gd:function(){return V},$L:function(){return te}});var H=$(86582),F=$(91220),w=$(3182),se=$(34792),k=$(48086),O=$(2824),Q=$(94043),i=$.n(Q),L=$(37071),R=$(81139),W=localStorage.getItem("basePath"),K=new R.VK(W?{basePath:W}:void 0),j=new R.U(K),X=new R.sD(K),Y=new R.W6(K),N=new R.Cl(K),G=new R.vb(K),q=function(p){return JSON.parse(JSON.stringify(p))};function ie(D){return D&&(D.toLowerCase().replace(/([-_][a-z])/g,function(p){return p.toUpperCase().replace("-","").replace("_","")}),D)}var J=function(p,g,d){if(!!d){for(var s=0;s<g.length;s++)if(p[d]==g[s][d])return s}},x=function(p){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,3],d=p(1),s=(0,O.Z)(d,2),y=s[0],U=s[1],P=function(E){var c=y;c+=E,c<g[0]&&(c=g[0],k.default.error("Smallest scale is "+g[0])),c>g[1]&&(c=g[1],k.default.error("Largest scale is "+g[1])),U(c)};return{curr:y,change:P}},V=function(p){var g=p([]),d=(0,O.Z)(g,2),s=d[0],y=d[1],U=p(),P=(0,O.Z)(U,2),o=P[0],E=P[1],c=function(){var f=(0,w.Z)(i().mark(function a(){var t;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,j.getAll();case 3:return t=r.sent,y(t),r.abrupt("return",t);case 8:r.prev=8,r.t0=r.catch(0),console.log("project getAll err",r.t0),L.Z.parseError(r.t0,k.default);case 12:case"end":return r.stop()}},a,null,[[0,8]])}));return function(){return f.apply(this,arguments)}}(),S=function(){var f=(0,w.Z)(i().mark(function a(t){var n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t!=null){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(s.length>1)){e.next=5;break}return k.default.error("Currently have multiple projects stored, use turnTo instead"),e.abrupt("return");case 5:return e.prev=5,e.next=8,j.get(t);case 8:return n=e.sent,y([n]),E(0),e.abrupt("return",n);case 14:e.prev=14,e.t0=e.catch(5),console.log("prject getcurr err",e.t0),L.Z.parseError(e.t0,k.default);case 18:case"end":return e.stop()}},a,null,[[5,14]])}));return function(t){return f.apply(this,arguments)}}(),C=function(){var f=(0,w.Z)(i().mark(function a(t){return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("remove project",t),typeof t!="number"){r.next=6;break}return r.next=4,j.remove(t);case 4:r.next=8;break;case 6:return r.next=8,j.remove(t.projectId);case 8:c();case 9:case"end":return r.stop()}},a)}));return function(t){return f.apply(this,arguments)}}(),Z=function(){var f=(0,w.Z)(i().mark(function a(t){var n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.create(t);case 3:return n=e.sent,console.log(n),e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(0),console.log("project create err",e.t0),L.Z.parseError(e.t0,k.default);case 12:case"end":return e.stop()}},a,null,[[0,8]])}));return function(t){return f.apply(this,arguments)}}(),v=function(){var f=(0,w.Z)(i().mark(function a(t,n){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:j.update(t,n).then(function(h){console.log("project update res",h)}).catch(function(h){console.log("project update err ",h),L.Z.parseError(h,k.default)});case 1:case"end":return e.stop()}},a)}));return function(t,n){return f.apply(this,arguments)}}();return{all:s,getAll:c,getCurr:S,remove:C,create:Z,update:v,get curr(){if(o!=null)return s[o]}}},ee=function(p,g){var d=g.oneHot,s=d===void 0?!0:d,y=g.postOnSelect,U=p(),P=(0,O.Z)(U,2),o=P[0],E=P[1],c=p(),S=(0,O.Z)(c,2),C=S[0],Z=S[1],v=p(s),f=(0,O.Z)(v,2),a=f[0],t=f[1],n=function(){var I=(0,w.Z)(i().mark(function u(_){var T,b,A,B;return i().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.prev=0,M.next=3,j.getLabels(_);case 3:T=M.sent,b=(0,F.Z)(T);try{for(b.s();!(A=b.n()).done;)B=A.value,B.active=!1}catch(le){b.e(le)}finally{b.f()}return E(T),M.abrupt("return",T);case 10:M.prev=10,M.t0=M.catch(0),console.log("label getall err ",M.t0),L.Z.parseError(M.t0,k.default);case 14:case"end":return M.stop()}},u,null,[[0,10]])}));return function(_){return I.apply(this,arguments)}}(),r=function(u){var _=J(u,o,"labelId");if(Z(_),console.log("onehot",a),a){var T=(0,F.Z)(o),b;try{for(T.s();!(b=T.n()).done;){var A=b.value;A.active=!1}}catch(B){T.e(B)}finally{T.f()}o[_].active=!0,console.log("all",o)}else o[_].active=!o[_].active;y&&y(o[_]),E((0,H.Z)(o))},e=function(){var I=(0,w.Z)(i().mark(function u(_){var T;return i().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.prev=0,A.next=3,G.create(_);case 3:return T=A.sent,T.active=!1,E([].concat((0,H.Z)(o),[T])),A.abrupt("return",T);case 9:A.prev=9,A.t0=A.catch(0),console.log("label create err",A.t0),L.Z.parseError(A.t0,k.default);case 13:case"end":return A.stop()}},u,null,[[0,9]])}));return function(_){return I.apply(this,arguments)}}(),h=function(){var I=(0,w.Z)(i().mark(function u(_){return i().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return console.log("remove label",_),b.prev=1,b.next=4,G.remove(_.labelId);case 4:E(o.filter(function(A){return A.labelId!=_.labelId})),b.next=11;break;case 7:b.prev=7,b.t0=b.catch(1),console.log("label remove err",b.t0),L.Z.parseError(b.t0,k.default);case 11:case"end":return b.stop()}},u,null,[[1,7]])}));return function(_){return I.apply(this,arguments)}}(),l=function(){},m=function(){t(!a)};return{all:o,getAll:n,setAll:E,onSelect:r,create:e,remove:h,onModify:l,toggleOneHot:m,get curr(){if(C!=null)return o[C]}}},re=function(p){var g=p(),d=(0,O.Z)(g,2),s=d[0],y=d[1],U=p(),P=(0,O.Z)(U,2),o=P[0],E=P[1],c=p(),S=(0,O.Z)(c,2),C=S[0],Z=S[1],v=function(e){if(e<0){k.default.error("This is the first image. No previous image.");return}if(e==s.length){k.default.error("This is the final image. No next image.");return}console.log("turning to",e),E(e)},f=function(){var r=(0,w.Z)(i().mark(function e(h,l){var m;return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,j.getTasks(h);case 3:if(m=u.sent,y(m),l==null){u.next=9;break}return console.log("getall turnto"),v(l),u.abrupt("return",[m,m[l]]);case 9:return u.abrupt("return",m);case 12:u.prev=12,u.t0=u.catch(0),console.log("task getall err ",u.t0),L.Z.parseError(u.t0,k.default);case 16:case"end":return u.stop()}},e,null,[[0,12]])}));return function(h,l){return r.apply(this,arguments)}}(),a=function(){var r=(0,w.Z)(i().mark(function e(h){var l,m;return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,j.getProgress(h);case 3:return l=u.sent,m=Math.ceil(l.finished/l.total*100),console.log("progress",l,m),Z(m),u.abrupt("return",m);case 10:return u.prev=10,u.t0=u.catch(0),console.log("get progress err",u.t0),L.Z.parseError(u.t0,k.default),u.abrupt("return",0);case 15:case"end":return u.stop()}},e,null,[[0,10]])}));return function(h){return r.apply(this,arguments)}}(),t=function(){var r=(0,w.Z)(i().mark(function e(){return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:v(o+1),console.log("all tasks",s);case 2:case"end":return l.stop()}},e)}));return function(){return r.apply(this,arguments)}}(),n=function(){var r=(0,w.Z)(i().mark(function e(){return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:v(o-1);case 1:case"end":return l.stop()}},e)}));return function(){return r.apply(this,arguments)}}();return{currIdx:o,all:s,turnTo:v,getAll:f,getProgress:a,progress:C,nextTask:t,prevTask:n,get curr(){if(!(o==null||s==null))return console.log("task.curr",s[o]),s[o]},get finished(){return Math.floor((s==null?void 0:s.length)*C/100)}}},ae=function(p){var g=p(),d=(0,O.Z)(g,2),s=d[0],y=d[1],U=p(),P=(0,O.Z)(U,2),o=P[0],E=P[1],c=function(){var v=(0,w.Z)(i().mark(function f(a){var t,n,r,e;return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,Y.getAnnotations(a);case 3:t=l.sent,n=(0,F.Z)(t);try{for(n.s();!(r=n.n()).done;)e=r.value,e.active=!1}catch(m){n.e(m)}finally{n.f()}return l.next=8,y(t);case 8:return l.abrupt("return",t);case 11:l.prev=11,l.t0=l.catch(0),console.log("ann getAll err",l.t0),L.Z.parseError(l.t0,k.default);case 15:case"end":return l.stop()}},f,null,[[0,11]])}));return function(a){return v.apply(this,arguments)}}(),S=function(){var v=(0,w.Z)(i().mark(function f(a){var t;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("create",a),r.prev=1,r.next=4,N.create(a);case 4:return t=r.sent,c(a.dataId),r.abrupt("return",t);case 9:r.prev=9,r.t0=r.catch(1),console.log("annotation create err",r.t0),L.Z.parseError(r.t0,k.default);case 13:case"end":return r.stop()}},f,null,[[1,9]])}));return function(a){return v.apply(this,arguments)}}(),C=function(){var v=(0,w.Z)(i().mark(function f(a){var t;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=a,typeof a=="Annotation"&&(t=a.annotationId);try{N.remove(t)}catch(e){console.log("annotation remove err",e),L.Z.parseError(e,k.default)}case 3:case"end":return r.stop()}},f)}));return function(a){return v.apply(this,arguments)}}(),Z=function(){var v=(0,w.Z)(i().mark(function f(a){var t,n,r,e,h;return i().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:console.log("annotation onselect",a),t=(0,F.Z)(s);try{for(t.s();!(n=t.n()).done;)r=n.value,r.active=!1}catch(I){t.e(I)}finally{t.f()}e=s.filter(function(I){return I.annotationId==a.annotationId})[0],e.active=!a.active,h=J(e,s,"annotationId"),E(h),y((0,H.Z)(s));case 8:case"end":return m.stop()}},f)}));return function(a){return v.apply(this,arguments)}}();return{all:s,getAll:c,create:S,remove:C,onSelect:Z,get curr(){if(!!s)return s[o]}}},ne=function(p){var g=p(),d=(0,O.Z)(g,2),s=d[0],y=d[1],U=p([]),P=(0,O.Z)(U,2),o=P[0],E=P[1],c=function(){var C=(0,w.Z)(i().mark(function Z(v){return i().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:y(v);case 1:case"end":return a.stop()}},Z)}));return function(v){return C.apply(this,arguments)}}(),S=function(){var C=(0,w.Z)(i().mark(function Z(v,f){var a;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,X.getDatas(v);case 3:if(a=n.sent,E(a),f==null){n.next=8;break}return c(f),n.abrupt("return",[a,a[f]]);case 8:return n.abrupt("return",a);case 11:n.prev=11,n.t0=n.catch(0),console.log("data getall err ",n.t0),L.Z.parseError(n.t0,k.default);case 15:case"end":return n.stop()}},Z,null,[[0,11]])}));return function(v,f){return C.apply(this,arguments)}}();return{all:o,getAll:S,turnTo:c,get curr(){if(!(s==null||o==null))return o[s]},get imgSrc(){if(o&&o[s])return console.log("imgsrc","".concat(W,"/datas/").concat(o[s].dataId,"/image")),"".concat(W,"/datas/").concat(o[s].dataId,"/image")}}},te=function(p,g){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};d.effectTrigger||(d.effectTrigger={});var s=p(!1),y=(0,O.Z)(s,2),U=y[0],P=y[1],o=x(p),E=ae(p),c=re(p),S=ne(p),C=V(p),Z=ee(p,d.label);return g(function(){var v=L.Z.getQueryVariable("projectId");C.getCurr(v),Z.getAll(v),c.getAll(v),c.getProgress(v)},[]),g(function(){c.all&&c.all.length!=0&&c.turnTo(0)},[c.all]),g(function(){if(c.currIdx!=null){var v=function(){var f=(0,w.Z)(i().mark(function a(){var t,n,r,e,h,l,m,I;return i().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return console.log("onTaskChange",c.curr,Z.all,c.progress),c.getProgress(c.curr.projectId),_.next=4,S.getAll(c.curr.taskId,0);case 4:return t=_.sent,n=(0,O.Z)(t,2),r=n[0],e=n[1],console.log(r),_.next=11,E.getAll(e.dataId);case 11:h=_.sent,l=(0,F.Z)(Z.all);try{for(l.s();!(m=l.n()).done;)I=m.value,I.active=!1}catch(T){l.e(T)}finally{l.f()}d.effectTrigger.postTaskChange&&d.effectTrigger.postTaskChange(Z.all,h),P(!1);case 16:case"end":return _.stop()}},a)}));return function(){return f.apply(this,arguments)}}();v()}},[c.currIdx]),[U,P,o,E,c,S,C,Z]}}}]);
