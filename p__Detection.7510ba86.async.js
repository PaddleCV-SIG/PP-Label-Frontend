(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(O,L,n){"use strict";n.d(L,{Z:function(){return s}});var j=n(94663),N=n(80112);function R(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var T=n(18597);function b(e,a,D){return(0,T.Z)()?b=Reflect.construct:b=function(h,Q,W){var C=[null];C.push.apply(C,Q);var y=Function.bind.apply(h,C),u=new y;return W&&(0,N.Z)(u,W.prototype),u},b.apply(null,arguments)}function s(e){var a=typeof Map=="function"?new Map:void 0;return s=function(l){if(l===null||!R(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(l))return a.get(l);a.set(l,h)}function h(){return b(l,arguments,(0,j.Z)(this).constructor)}return h.prototype=Object.create(l.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),(0,N.Z)(h,l)},s(e)}},85024:function(O){O.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(O){O.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(O){O.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(O,L,n){"use strict";n.d(L,{pL:function(){return N},oo:function(){return R}});var j=n(91220);function N(s){var e=0;if(!s)return e;var a=(0,j.Z)(s),D;try{for(a.s();!(D=a.n()).done;){var l=D.value;!l||!l.frontendId||l.frontendId>e&&(e=l.frontendId)}}catch(h){a.e(h)}finally{a.f()}return e}function R(s){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function T(s){var e=s.toString(16);return e.length==1?"0"+e:e}function b(s,e,a){return"#"+T(s)+T(e)+T(a)}},14836:function(O,L,n){"use strict";n.d(L,{Z:function(){return an}});var j=n(54421),N=n(38272),R=n(57663),T=n(71577),b=n(91220),s=n(67294),e=n(56159),a=n.n(e),D=n(49111),l=n(19650),h=n(2824),Q=n(11849),W=n(85024),C=n.n(W),y=n(63097),u=n(85893),en=function(m){var g=(0,Q.Z)({},m.annotation),U=(0,s.useState)(g.invisible),w=(0,h.Z)(U,2),Y=w[0],$=w[1],z=(0,s.useState)(0),X=(0,h.Z)(z,2),K=X[0],t=X[1];(0,s.useEffect)(function(){$(m.annotation.invisible)},[m.annotation.invisible]);var f=(0,u.jsxs)(N.ZP.Item,{className:"".concat(C().listItem," ").concat(m.active?C().listItemActive:""),unselectable:"on",onClick:function(){m.onClick(g)},children:[(0,u.jsxs)(l.Z,{align:"center",size:5,children:[(0,u.jsx)("a",{className:C().eye,style:{backgroundImage:Y?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(r){r.stopPropagation(),$(!Y),m.onAnnotationModify(g)}})," ",(0,u.jsx)("span",{className:C().annotationId,children:g.frontendId}),(0,u.jsx)("span",{className:C().labelName,children:g.label.name}),(0,u.jsx)(y.Z,{color:g.label.color})]}),(0,u.jsx)("a",{className:C().delete,onClick:function(r){r.stopPropagation();var B=new Date().getTime();B-K<300||(t(B),m.onAnnotationDelete(g))}})]});return f},on=en,rn=n(48971),o=function(m){var g=(0,rn.YB)(),U=g.formatMessage({id:"component.PPAnnotationList.annotationList"}),w=g.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),Y=new Set,$=[],z=(0,b.Z)(m.annotations),X;try{for(z.s();!(X=z.n()).done;){var K=X.value;Y.has(K.frontendId)||($.push(K),Y.add(K.frontendId))}}catch(t){z.e(t)}finally{z.f()}return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(N.ZP,{className:a().labelList,size:"large",header:(0,u.jsx)("div",{className:a().listHeader,children:U}),bordered:!0,dataSource:$,renderItem:function(f){var c;return(0,u.jsx)(on,{onClick:m.onAnnotationSelect,annotation:f,active:f.frontendId==((c=m.currAnnotation)===null||c===void 0?void 0:c.frontendId),onAnnotationDelete:m.onAnnotationDelete,onAnnotationModify:m.onAnnotationModify})},footer:(0,u.jsx)("div",{children:(0,u.jsx)(T.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){m.onAnnotationAdd()},block:!0,children:w})})})})},an=o},91861:function(O,L,n){"use strict";n.d(L,{Ad:function(){return N},k3:function(){return R},Vd:function(){return T},td:function(){return b}});var j=40;function N(){localStorage.removeItem("history"),R([])}function R(s){var e=localStorage.getItem("history"),a=e?JSON.parse(e):{index:-1,items:[]};if(JSON.stringify(a.items[a.index])!=JSON.stringify(s)){var D=a.index>j?a.index-j:0,l=a.items.splice(D,a.index==0?1:a.index+1);a.items=l.concat([s]),a.index<=j?a.index++:a.index=j+1,localStorage.setItem("history",JSON.stringify(a))}}function T(){var s=localStorage.getItem("history");if(!!s){var e=JSON.parse(s);if(!!e&&!(e.index>=e.items.length-1))return e.index++,localStorage.setItem("history",JSON.stringify(e)),e.items[e.index]}}function b(){var s=localStorage.getItem("history");if(!!s){var e=JSON.parse(s);if(!(!e||!e.index)&&!(e.index<=0))return e.index--,localStorage.setItem("history",JSON.stringify(e)),e.items[e.index]}}},29396:function(O,L,n){"use strict";n.r(L),n.d(L,{default:function(){return K}});var j=n(11849),N=n(20228),R=n(11382),T=n(34669),b=n(54458),s=n(34792),e=n(48086),a=n(91220),D=n(2824),l=n(67294),h=n(48971),Q=n(72285),W=n.n(Q),C=n(8088),y=n(61541),u=n(44434),en=n(5041),on=n(57436),rn=n(14836),o=n(85893),an=function(f){return(0,o.jsx)(y.Z,{active:f.active,imgSrc:f.imgSrc||"./pics/buttons/rectangle.png",onClick:f.onClick,children:f.children})},sn=an,m=n(32871),g=n(91861),U=n(65031),w=n(57406);function Y(t){if(!(!t||t.length<2))return t.join(",")}function $(t){var f;if(!t.annotation||!t.annotation.result||!t.annotation.label||!t.annotation.label.color)return[(0,o.jsx)(o.Fragment,{})];var c=t.annotation.result.split(","),r={xmin:parseInt(c[0]),ymin:parseInt(c[1]),xmax:c.length>=3?parseInt(c[2]):void 0,ymax:c.length>=4?parseInt(c[3]):void 0},B=t.annotation.label.color,P=(0,w.oo)(B);if(!P)return[(0,o.jsx)(o.Fragment,{})];var p=((f=t.currentAnnotation)===null||f===void 0?void 0:f.frontendId)==t.annotation.frontendId,A=p?.5:.1,M=r.xmax!=null&&r.ymax!=null?(0,o.jsx)(U.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(t.annotation)},stroke:B,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:r.xmin,y:r.ymin,width:r.xmax-r.xmin,height:r.ymax-r.ymin,closed:!0,fill:"rgba(".concat(P.r,", ").concat(P.g,", ").concat(P.b,", ").concat(A,")")}):(0,o.jsx)(o.Fragment,{});function k(v){if(!v&&(r.xmax==null||r.ymax==null))return(0,o.jsx)(o.Fragment,{});var nn=function(E){var x;if(t.currentTool=="editor"){var ln=(x=t.stageRef)===null||x===void 0?void 0:x.current,Z=ln.findOne(".baseImage"),I=!1,S=E.target.x();S>Z.width()/2&&(S=Z.width()/2,I=!0),S<-Z.width()/2&&(S=-Z.width()/2,I=!0);var F=E.target.y();F>Z.height()/2&&(F=Z.height()/2,I=!0),F<-Z.height()/2&&(F=-Z.height()/2,I=!0),I&&E.target.setPosition({x:S,y:F}),v?(r.xmin=S,r.ymin=F):(r.xmax=S,r.ymax=F);var tn=(0,j.Z)((0,j.Z)({},t.annotation),{},{result:"".concat(r.xmin,",").concat(r.ymin,",").concat(r.xmax,",").concat(r.ymax)});t.onDrag(tn)}};return(0,o.jsx)(U.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(t.annotation)},draggable:t.currentTool=="editor",onDragMove:nn,onDragEnd:nn,onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:v?r.xmin:r.xmax,y:v?r.ymin:r.ymax,radius:5/t.scale,fill:B})}return[(0,o.jsxs)(U.ZA,{children:[M,k(!0),k(!1)]},t.annotation.annotationId)]}function z(t){var f=function(p,A){var M=Y([p,A]);!M||(console.log(M),t.onAnnotationAdd({dataId:t.dataId,type:"rectangle",frontendId:(0,w.pL)(t.annotations)+1,label:t.currentLabel,result:M}))},c=function(p,A){var M;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((M=t.currentLabel)!==null&&M!==void 0&&M.color))){var k=t.currentAnnotation.result+",".concat(p,",").concat(A),v={dataId:t.dataId,type:"rectangle",frontendId:t.currentAnnotation.frontendId,label:t.currentAnnotation.label,result:k};t.modifyAnnoByFrontendId(v)}},r=function(p){if(t.currentTool=="rectangle"){var A=p.mouseX+p.offsetX,M=p.mouseY+p.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?c(A,M):f(A,M)}},B=function(){t.currentTool=="rectangle"&&t.onMouseUp()};return{onMouseDown:r,onMouseMove:function(){},onMouseUp:B,createElementsFunc:$}}var X=function(){var f,c=(0,m.$L)(l.useState,l.useEffect,{label:{oneHot:!0},tool:{defaultTool:"mover"},effectTrigger:{postTaskChange:g.Ad}}),r=c.tool,B=c.loading,P=c.scale,p=c.annotation,A=c.task,M=c.data,k=c.project,v=c.label,nn=(0,l.useState)(),G=(0,D.Z)(nn,2),E=G[0],x=G[1],ln=(0,l.useState)([]),Z=(0,D.Z)(ln,2),I=Z[0],S=Z[1],F=function(i){if(!i.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(i));I.push(i),S(I),x(i)},tn=function(i){if(!i.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(i));var V=[],J=(0,a.Z)(I),q;try{for(J.s();!(q=J.n()).done;){var _=q.value;_.frontendId==i.frontendId?V.push(i):V.push(_)}}catch(dn){J.e(dn)}finally{J.f()}console.log("modifyAnnotation, newAnnos:",V,"anno:",i),S(V),x(i)},fn=function(i){if(!i.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(i));var V=[],J=(0,a.Z)(I),q;try{for(J.s();!(q=J.n()).done;){var _=q.value;_.frontendId!=i.frontendId&&V.push(_)}}catch(dn){J.e(dn)}finally{J.f()}S(V),x(void 0)},un=z({currentLabel:v.curr,currentTool:r.curr,annotations:I,currentAnnotation:E,onAnnotationAdd:F,onAnnotationModify:tn,onMouseUp:function(){(0,g.k3)({annos:I,currAnno:E})}}),cn=un,H=(0,h.YB)(),vn=H.formatMessage({id:"pages.toolBar.rectangle"}),mn=H.formatMessage({id:"pages.toolBar.zoomIn"}),gn=H.formatMessage({id:"pages.toolBar.zoomOut"}),xn=H.formatMessage({id:"pages.toolBar.move"}),hn=H.formatMessage({id:"pages.toolBar.unDo"}),yn=H.formatMessage({id:"pages.toolBar.reDo"}),An=H.formatMessage({id:"pages.toolBar.save"}),In=H.formatMessage({id:"pages.toolBar.edit"}),Sn=H.formatMessage({id:"pages.toolBar.clearMark"});return(0,o.jsxs)(C.Z,{className:W().det,children:[(0,o.jsxs)(u.Z,{children:[(0,o.jsx)(sn,{active:r.curr=="rectangle",onClick:function(){if(!v.curr){e.default.error("Please choose a label category first!");return}r.setCurr("rectangle"),x(void 0)},children:vn}),(0,o.jsx)(y.Z,{active:r.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){r.setCurr("editor")},children:In}),(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){P.change(.1)},children:mn}),(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){P.change(-.1)},children:gn}),(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){e.default.info("Annotations are saved automatically in this type of project. No need to click save.")},children:An}),(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/move.png",active:r.curr=="mover",onClick:function(){r.setCurr("mover")},children:xn}),(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var i=(0,g.td)();!i||(x(i.currAnno),S(i.annos))},children:hn}),(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var i=(0,g.Vd)();!i||(x(i.currAnno),S(i.annos))},children:yn}),(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:Sn})]}),(0,o.jsx)("div",{id:"dr",className:"mainStage",children:(0,o.jsxs)(R.Z,{tip:"loading",spinning:!!B.curr,children:[(0,o.jsx)("div",{className:"draw",children:(0,o.jsx)(on.Z,{scale:P.curr,annotations:I,currentTool:r.curr,currentAnnotation:E,setCurrentAnnotation:x,onAnnotationModify:tn,onAnnotationModifyComplete:function(){(0,g.k3)({annos:I,currAnno:E})},onMouseDown:cn.onMouseDown,onMouseMove:cn.onMouseMove,onMouseUp:cn.onMouseUp,createRectangleFunc:un.createElementsFunc,imgSrc:M.imgSrc})}),(0,o.jsx)("div",{className:"pblock",children:(0,o.jsxs)("div",{className:"progress",children:[(0,o.jsx)(b.Z,{className:"progressBar",percent:k.progress,status:"active",showInfo:!1})," ",(0,o.jsxs)("span",{className:"progressDesc",children:["Current labeling ",A.currIdx==null?1:A.currIdx+1," of"," ",(f=A.all)===null||f===void 0?void 0:f.length,". Already labeled ",A.finished(k.progress)||0,"."]})]})}),(0,o.jsx)("div",{className:"prevTask",onClick:function(){!A.prevTask()||(x(void 0),S([]))}}),(0,o.jsx)("div",{className:"nextTask",onClick:function(){!A.nextTask()||(x(void 0),S([]))}})]})}),(0,o.jsxs)(u.Z,{disLoc:"right",children:[(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){h.m8.push("/project_overview?projectId=".concat(k.curr.projectId))},children:"Project Overview"}),(0,o.jsx)(y.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){h.m8.push("/ml?projectId=".concat(k.curr.projectId))},children:"ML Settings"})]}),(0,o.jsxs)("div",{className:"rightSideBar",children:[(0,o.jsx)(en.Z,{labels:v.all,activeIds:v.activeIds,onLabelSelect:function(i){v.onSelect(i),x(void 0)},onLabelModify:function(){},onLabelDelete:v.remove,onLabelAdd:function(i){return v.create((0,j.Z)((0,j.Z)({},i),{},{projectId:k.curr.projectId}))}}),(0,o.jsx)(rn.Z,{annotations:I,currAnnotation:E,onAnnotationSelect:x,onAnnotationAdd:function(){x(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(i){fn(i)}})]})]})},K=X}}]);
