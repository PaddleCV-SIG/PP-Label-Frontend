(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(D,O,n){"use strict";n.d(O,{Z:function(){return s}});var A=n(94663),T=n(80112);function N(t){return Function.toString.call(t).indexOf("[native code]")!==-1}var j=n(18597);function P(t,i,M){return(0,j.Z)()?P=Reflect.construct:P=function(C,I,U){var p=[null];p.push.apply(p,I);var X=Function.bind.apply(C,p),v=new X;return U&&(0,T.Z)(v,U.prototype),v},P.apply(null,arguments)}function s(t){var i=typeof Map=="function"?new Map:void 0;return s=function(u){if(u===null||!N(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(u))return i.get(u);i.set(u,C)}function C(){return P(u,arguments,(0,A.Z)(this).constructor)}return C.prototype=Object.create(u.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),(0,T.Z)(C,u)},s(t)}},85024:function(D){D.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(D){D.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(D){D.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(D,O,n){"use strict";n.d(O,{pL:function(){return T},oo:function(){return N}});var A=n(91220);function T(s){var t=0;if(!s)return t;var i=(0,A.Z)(s),M;try{for(i.s();!(M=i.n()).done;){var u=M.value;!u||!u.frontendId||u.frontendId>t&&(t=u.frontendId)}}catch(C){i.e(C)}finally{i.f()}return t}function N(s){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function j(s){var t=s.toString(16);return t.length==1?"0"+t:t}function P(s,t,i){return"#"+j(s)+j(t)+j(i)}},14836:function(D,O,n){"use strict";n.d(O,{Z:function(){return a}});var A=n(54421),T=n(38272),N=n(57663),j=n(71577),P=n(91220),s=n(67294),t=n(56159),i=n.n(t),M=n(49111),u=n(19650),C=n(2824),I=n(11849),U=n(85024),p=n.n(U),X=n(63097),v=n(85893),_=function(x){var Z=(0,I.Z)({},x.annotation),V=(0,s.useState)(Z.invisible),K=(0,C.Z)(V,2),z=K[0],e=K[1],h=(0,s.useState)(0),d=(0,C.Z)(h,2),r=d[0],b=d[1];(0,s.useEffect)(function(){e(x.annotation.invisible)},[x.annotation.invisible]);var m=(0,v.jsxs)(T.ZP.Item,{className:"".concat(p().listItem," ").concat(x.active?p().listItemActive:""),unselectable:"on",onClick:function(){x.onClick(Z)},children:[(0,v.jsxs)(u.Z,{align:"center",size:5,children:[(0,v.jsx)("a",{className:p().eye,style:{backgroundImage:z?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(y){y.stopPropagation(),e(!z),x.onAnnotationModify(Z)}})," ",(0,v.jsx)("span",{className:p().annotationId,children:Z.frontendId}),(0,v.jsx)("span",{className:p().labelName,children:Z.label.name}),(0,v.jsx)(X.Z,{color:Z.label.color})]}),(0,v.jsx)("a",{className:p().delete,onClick:function(y){y.stopPropagation();var f=new Date().getTime();f-r<300||(b(f),x.onAnnotationDelete(Z))}})]});return m},F=_,w=n(48971),G=function(x){var Z=(0,w.YB)(),V=Z.formatMessage({id:"component.PPAnnotationList.annotationList"}),K=Z.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),z=new Set,e=[],h=(0,P.Z)(x.annotations),d;try{for(h.s();!(d=h.n()).done;){var r=d.value;z.has(r.frontendId)||(e.push(r),z.add(r.frontendId))}}catch(b){h.e(b)}finally{h.f()}return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(T.ZP,{className:i().labelList,size:"large",header:(0,v.jsx)("div",{className:i().listHeader,children:V}),bordered:!0,dataSource:e,renderItem:function(m){var o;return(0,v.jsx)(F,{onClick:x.onAnnotationSelect,annotation:m,active:m.frontendId==((o=x.currAnnotation)===null||o===void 0?void 0:o.frontendId),onAnnotationDelete:x.onAnnotationDelete,onAnnotationModify:x.onAnnotationModify})},footer:(0,v.jsx)("div",{children:(0,v.jsx)(j.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){x.onAnnotationAdd()},block:!0,children:K})})})})},a=G},10137:function(D,O,n){"use strict";var A=n(34669),T=n(54458),N=n(67294),j=n(85893),P=function(t){var i,M;return(0,j.jsxs)("div",{className:"progress",children:[(0,j.jsx)(T.Z,{className:"progressBar",percent:Math.ceil(t.project.finished/((i=t.task.all)===null||i===void 0?void 0:i.length)*100),status:"active",showInfo:!1})," ",(0,j.jsxs)("span",{className:"progressDesc",children:["Current labeling ",t.task.currIdx==null?1:t.task.currIdx+1," of"," ",(M=t.task.all)===null||M===void 0?void 0:M.length,". Already labeled ",t.project.finished||0,"."]})]})};O.Z=P},91861:function(D,O,n){"use strict";n.d(O,{Ad:function(){return T},k3:function(){return N},Vd:function(){return j},td:function(){return P}});var A=40;function T(){localStorage.removeItem("history"),N([])}function N(s){var t=localStorage.getItem("history"),i=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(i.items[i.index])!=JSON.stringify(s)){var M=i.index>A?i.index-A:0,u=i.items.splice(M,i.index==0?1:i.index+1);i.items=u.concat([s]),i.index<=A?i.index++:i.index=A+1,localStorage.setItem("history",JSON.stringify(i))}}function j(){var s=localStorage.getItem("history");if(!!s){var t=JSON.parse(s);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function P(){var s=localStorage.getItem("history");if(!!s){var t=JSON.parse(s);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}},58857:function(D,O,n){"use strict";n.r(O),n.d(O,{default:function(){return z}});var A=n(11849),T=n(20228),N=n(11382),j=n(34792),P=n(48086),s=n(2824),t=n(67294),i=n(48971),M=n(72285),u=n.n(M),C=n(8088),I=n(61541),U=n(44434),p=n(5041),X=n(57436),v=n(14836),_=n(32871),F=n(91861),w=n(65031),G=n(57406),a=n(85893);function q(e){if(!(!e||e.length<2))return e.join(",")}function x(e){var h;if(!e.annotation||!e.annotation.result||!e.annotation.label||!e.annotation.label.color)return(0,a.jsx)(a.Fragment,{});var d=e.annotation.result.split(","),r={xmin:parseInt(d[0]),ymin:parseInt(d[1]),xmax:d.length>=3?parseInt(d[2]):void 0,ymax:d.length>=4?parseInt(d[3]):void 0},b=e.annotation.label.color,m=(0,G.oo)(b);if(!m)return(0,a.jsx)(a.Fragment,{});var o=((h=e.currentAnnotation)===null||h===void 0?void 0:h.frontendId)==e.annotation.frontendId,y=o?.5:.1,f=r.xmax!=null&&r.ymax!=null?(0,a.jsx)(w.UL,{onMouseOver:function(){e.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){e.currentTool=="editor"&&e.onSelect(e.annotation)},stroke:b,strokeWidth:2/e.scale,globalCompositeOperation:"source-over",lineCap:"round",x:r.xmin,y:r.ymin,width:r.xmax-r.xmin,height:r.ymax-r.ymin,closed:!0,fill:"rgba(".concat(m.r,", ").concat(m.g,", ").concat(m.b,", ").concat(y,")")}):(0,a.jsx)(a.Fragment,{});function k(g){if(!g&&(r.xmax==null||r.ymax==null))return(0,a.jsx)(a.Fragment,{});var Q=function(W){var H;if(e.currentTool=="editor"){var S=(H=e.stageRef)===null||H===void 0?void 0:H.current,L=S.findOne(".baseImage"),$=!1,E=W.target.x();E>L.width()/2&&(E=L.width()/2,$=!0),E<-L.width()/2&&(E=-L.width()/2,$=!0);var R=W.target.y();R>L.height()/2&&(R=L.height()/2,$=!0),R<-L.height()/2&&(R=-L.height()/2,$=!0),$&&W.target.setPosition({x:E,y:R}),g?(r.xmin=E,r.ymin=R):(r.xmax=E,r.ymax=R);var B=(0,A.Z)((0,A.Z)({},e.annotation),{},{result:"".concat(r.xmin,",").concat(r.ymin,",").concat(r.xmax,",").concat(r.ymax)});e.onDrag(B)}};return(0,a.jsx)(w.Cd,{onMouseDown:function(){e.currentTool=="editor"&&e.onSelect(e.annotation)},draggable:e.currentTool=="editor",onDragMove:Q,onDragEnd:Q,onMouseOver:function(){e.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:g?r.xmin:r.xmax,y:g?r.ymin:r.ymax,radius:5/e.scale,fill:b})}return(0,a.jsxs)(w.ZA,{children:[f,k(!0),k(!1)]},e.annotation.annotationId)}function Z(e){var h=function(o,y){var f=q([o,y]);!f||(console.log(f),e.onAnnotationAdd({dataId:e.dataId,type:"rectangle",frontendId:(0,G.pL)(e.annotations)+1,label:e.currentLabel,result:f}))},d=function(o,y){var f;if(!(!e.currentAnnotation||!e.currentAnnotation.result||!((f=e.currentLabel)!==null&&f!==void 0&&f.color))){var k=e.currentAnnotation.result+",".concat(o,",").concat(y),g={dataId:e.dataId,type:"rectangle",frontendId:e.currentAnnotation.frontendId,label:e.currentAnnotation.label,result:k};e.modifyAnnoByFrontendId(g)}},r=function(o){if(e.currentTool=="rectangle"){var y=o.mouseX+o.offsetX,f=o.mouseY+o.offsetY;console.log("currentAnnotation:",e.currentAnnotation),e.currentAnnotation?d(y,f):h(y,f)}},b=function(){e.currentTool=="rectangle"&&e.onMouseUp()};return{onMouseDown:r,onMouseMove:function(){},onMouseUp:b,drawAnnotation:x}}var V=n(10137),K=function(){var h,d=(0,_.$L)(t.useState,t.useEffect,{label:{oneHot:!0},tool:{defaultTool:"mover"},effectTrigger:{postTaskChange:F.Ad}}),r=d.tool,b=d.loading,m=d.scale,o=d.annotation,y=d.task,f=d.data,k=d.project,g=d.label,Q=(0,t.useState)(0),Y=(0,s.Z)(Q,2),W=Y[0],H=Y[1],S=function(l){o.setCurr(l),l!=null&&l.frontendId?H(l.frontendId):H(0)},L=function(l){!l||(o.all.pop(),o.all.push(l),S(l),o.setAll(o.all))};(0,t.useEffect)(function(){(0,F.Ad)()},[]),(0,t.useEffect)(function(){var c=setInterval(function(){var l;console.log("triggered!",f),o.pushToBackend((l=f.curr)===null||l===void 0?void 0:l.dataId)},2e4);return function(){clearInterval(c)}},[o,f,f.curr]);var $={dataId:(h=f.curr)===null||h===void 0?void 0:h.dataId,currentLabel:g.curr,scale:m.curr,currentTool:r.curr,annotations:o.all,currentAnnotation:o.curr,onAnnotationAdd:function(l){var J=o.all.concat([l]);o.setAll(J),S(l)},onAnnotationModify:L,modifyAnnoByFrontendId:L,onMouseUp:function(){(0,F.k3)({annos:o.all,currAnno:o.curr})},frontendIdOps:{frontendId:W,setFrontendId:H}},E=Z($),R={polygon:E,brush:void 0},B=(0,i.YB)(),nn=B.formatMessage({id:"pages.toolBar.rectangle"}),tn=B.formatMessage({id:"pages.toolBar.zoomIn"}),en=B.formatMessage({id:"pages.toolBar.zoomOut"}),on=B.formatMessage({id:"pages.toolBar.move"}),rn=B.formatMessage({id:"pages.toolBar.unDo"}),an=B.formatMessage({id:"pages.toolBar.reDo"}),ln=B.formatMessage({id:"pages.toolBar.save"}),sn=B.formatMessage({id:"pages.toolBar.edit"}),cn=B.formatMessage({id:"pages.toolBar.clearMark"});return(0,a.jsxs)(C.Z,{className:u().det,children:[(0,a.jsxs)(U.Z,{children:[(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/rectangle.png",active:r.curr=="rectangle",onClick:function(){if(!g.curr){P.default.error("Please choose a label category first!");return}r.setCurr("rectangle"),S(void 0)},children:nn}),(0,a.jsx)(I.Z,{active:r.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){r.setCurr("editor")},children:sn}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){m.change(.1)},children:tn}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){m.change(-.1)},children:en}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){P.default.info("Annotations are saved automatically in this type of project. No need to click save.")},children:ln}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/move.png",active:r.curr=="mover",onClick:function(){r.setCurr("mover")},children:on}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var l=(0,F.td)();l&&(o.setAll(l.annos),S(l.currAnno))},children:rn}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var l=(0,F.Vd)();l&&(o.setAll(l.annos),S(l.currAnno))},children:an}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:cn})]}),(0,a.jsx)("div",{id:"dr",className:"mainStage",children:(0,a.jsxs)(N.Z,{tip:"loading",spinning:!!b.curr,children:[(0,a.jsx)("div",{className:"draw",children:(0,a.jsx)(X.Z,{scale:m.curr,annotations:o.all,currentTool:r.curr,currentAnnotation:o.curr,setCurrentAnnotation:S,onAnnotationModify:L,onAnnotationModifyComplete:function(){(0,F.k3)({annos:o.all,currAnno:o.curr})},frontendIdOps:{frontendId:W,setFrontendId:H},imgSrc:f.imgSrc,transparency:1,onAnnotationAdd:function(l){var J=o.all.concat([l]);o.setAll(J),o.curr||S(l)},drawTool:R})}),(0,a.jsx)("div",{className:"pblock",children:(0,a.jsx)(V.Z,{task:y,project:k})}),(0,a.jsx)("div",{className:"prevTask",onClick:function(){!y.prevTask()||S(void 0)}}),(0,a.jsx)("div",{className:"nextTask",onClick:function(){!y.nextTask()||S(void 0)}})]})}),(0,a.jsxs)(U.Z,{disLoc:"right",children:[(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){i.m8.push("/project_overview?projectId=".concat(k.curr.projectId))},children:"Project Overview"}),(0,a.jsx)(I.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){i.m8.push("/ml?projectId=".concat(k.curr.projectId))},children:"ML Settings"})]}),(0,a.jsxs)("div",{className:"rightSideBar",children:[(0,a.jsx)(p.Z,{labels:g.all,activeIds:g.activeIds,onLabelSelect:g.onSelect,onLabelModify:function(){},onLabelDelete:g.remove,onLabelAdd:function(l){g.create((0,A.Z)((0,A.Z)({},l),{},{projectId:k.curr.projectId})).then(function(J){S(void 0),g.setCurr(J)})}}),(0,a.jsx)(v.Z,{currAnnotation:o.curr,annotations:o.all,onAnnotationSelect:function(l){l!=null&&l.delete||S(l)},onAnnotationAdd:function(){S(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(l){o.setAll(o.all.filter(function(J){return J.frontendId!=l.frontendId})),S(void 0)}})]})]})},z=K}}]);
