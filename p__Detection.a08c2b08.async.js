(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(k,Z,n){"use strict";n.d(Z,{Z:function(){return v}});var b=n(94663),O=n(80112);function D(a){return Function.toString.call(a).indexOf("[native code]")!==-1}var j=n(18597);function M(a,i,l){return(0,j.Z)()?M=Reflect.construct:M=function(P,K,A){var T=[null];T.push.apply(T,K);var w=Function.bind.apply(P,T),h=new w;return A&&(0,O.Z)(h,A.prototype),h},M.apply(null,arguments)}function v(a){var i=typeof Map=="function"?new Map:void 0;return v=function(s){if(s===null||!D(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(s))return i.get(s);i.set(s,P)}function P(){return M(s,arguments,(0,b.Z)(this).constructor)}return P.prototype=Object.create(s.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),(0,O.Z)(P,s)},v(a)}},85024:function(k){k.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(k){k.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(k){k.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(k,Z,n){"use strict";n.d(Z,{pL:function(){return O},oo:function(){return D}});var b=n(91220);function O(v){var a=0;if(!v)return a;var i=(0,b.Z)(v),l;try{for(i.s();!(l=i.n()).done;){var s=l.value;!s||!s.frontendId||s.frontendId>a&&(a=s.frontendId)}}catch(P){i.e(P)}finally{i.f()}return a}function D(v){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(v);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function j(v){var a=v.toString(16);return a.length==1?"0"+a:a}function M(v,a,i){return"#"+j(v)+j(a)+j(i)}},14836:function(k,Z,n){"use strict";n.d(Z,{Z:function(){return q}});var b=n(54421),O=n(38272),D=n(57663),j=n(71577),M=n(91220),v=n(67294),a=n(56159),i=n.n(a),l=n(49111),s=n(19650),P=n(2824),K=n(11849),A=n(85024),T=n.n(A),w=n(63097),h=n(85893),tn=function(I){var B=(0,K.Z)({},I.annotation),Q=(0,v.useState)(B.invisible),V=(0,P.Z)(Q,2),J=V[0],W=V[1],t=(0,v.useState)(0),S=(0,P.Z)(t,2),m=S[0],y=S[1];(0,v.useEffect)(function(){W(I.annotation.invisible)},[I.annotation.invisible]);var c=(0,h.jsxs)(O.ZP.Item,{className:"".concat(T().listItem," ").concat(I.active?T().listItemActive:""),unselectable:"on",onClick:function(){I.onClick(B)},children:[(0,h.jsxs)(s.Z,{align:"center",size:5,children:[(0,h.jsx)("a",{className:T().eye,style:{backgroundImage:J?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(u){u.stopPropagation(),W(!J),I.onAnnotationModify(B)}})," ",(0,h.jsx)("span",{className:T().annotationId,children:B.frontendId}),(0,h.jsx)("span",{className:T().labelName,children:B.label.name}),(0,h.jsx)(w.Z,{color:B.label.color})]}),(0,h.jsx)("a",{className:T().delete,onClick:function(u){u.stopPropagation();var g=new Date().getTime();g-m<300||(y(g),I.onAnnotationDelete(B))}})]});return c},en=tn,H=n(48971),G=function(I){var B=(0,H.YB)(),Q=B.formatMessage({id:"component.PPAnnotationList.annotationList"}),V=B.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),J=new Set,W=[],t=(0,M.Z)(I.annotations),S;try{for(t.s();!(S=t.n()).done;){var m=S.value;J.has(m.frontendId)||(W.push(m),J.add(m.frontendId))}}catch(y){t.e(y)}finally{t.f()}return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(O.ZP,{className:i().labelList,size:"large",header:(0,h.jsx)("div",{className:i().listHeader,children:Q}),bordered:!0,dataSource:W,renderItem:function(c){var f;return(0,h.jsx)(en,{onClick:I.onAnnotationSelect,annotation:c,active:c.frontendId==((f=I.currAnnotation)===null||f===void 0?void 0:f.frontendId),onAnnotationDelete:I.onAnnotationDelete,onAnnotationModify:I.onAnnotationModify})},footer:(0,h.jsx)("div",{children:(0,h.jsx)(j.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){I.onAnnotationAdd()},block:!0,children:V})})})})},q=G},10137:function(k,Z,n){"use strict";var b=n(34669),O=n(54458),D=n(67294),j=n(85893),M=function(a){var i,l;return(0,j.jsxs)("div",{className:"progress",children:[(0,j.jsx)(O.Z,{className:"progressBar",percent:Math.ceil(a.project.finished/((i=a.task.all)===null||i===void 0?void 0:i.length)*100),status:"active",showInfo:!1})," ",(0,j.jsxs)("span",{className:"progressDesc",children:["Current labeling ",a.task.currIdx==null?1:a.task.currIdx+1," of"," ",(l=a.task.all)===null||l===void 0?void 0:l.length,". Already labeled ",a.project.finished||0,"."]})]})};Z.Z=M},91861:function(k,Z,n){"use strict";n.d(Z,{Ad:function(){return j},k3:function(){return M},Vd:function(){return v},td:function(){return a}});var b=n(34792),O=n(48086),D=40;function j(){localStorage.removeItem("history"),M([])}function M(i){var l=localStorage.getItem("history"),s=l?JSON.parse(l):{index:-1,items:[]};if(JSON.stringify(s.items[s.index])!=JSON.stringify(i)){var P=s.index>D?s.index-D:0,K=s.items.splice(P,s.index==0?1:s.index+1);s.items=K.concat([i]),s.index<=D?s.index++:s.index=D+1,localStorage.setItem("history",JSON.stringify(s))}}function v(){var i=localStorage.getItem("history");if(!!i){var l=JSON.parse(i);if(!!l){if(l.index>=l.items.length-1){O.default.error("No next history!");return}return l.index++,localStorage.setItem("history",JSON.stringify(l)),l.items[l.index]}}}function a(){var i=localStorage.getItem("history");if(!!i){var l=JSON.parse(i);if(console.log("history",l),!l||!l.index||l.index<=1){O.default.error("No previous history!");return}return l.index--,localStorage.setItem("history",JSON.stringify(l)),l.items[l.index]}}},58857:function(k,Z,n){"use strict";n.r(Z),n.d(Z,{default:function(){return W}});var b=n(11849),O=n(20228),D=n(11382),j=n(34792),M=n(48086),v=n(91220),a=n(2824),i=n(67294),l=n(48971),s=n(72285),P=n.n(s),K=n(8088),A=n(61541),T=n(44434),w=n(5041),h=n(57436),tn=n(14836),en=n(45194),H=n(91861),G=n(65031),q=n(57406),o=n(85893);function I(t){if(!(!t||t.length<2))return t.join(",")}function B(t){var S,m=t.annotation;if(!m||!m.result||!m.label||!m.label.color)return(0,o.jsx)(o.Fragment,{});var y=m.result.split(","),c={xmin:parseInt(y[0]),ymin:parseInt(y[1]),xmax:y.length>=3?parseInt(y[2]):void 0,ymax:y.length>=4?parseInt(y[3]):void 0},f=m.label.color,u=(0,q.oo)(f);if(!u)return(0,o.jsx)(o.Fragment,{});var g=((S=t.currentAnnotation)===null||S===void 0?void 0:S.frontendId)==m.frontendId,p=g?.5:.1,N=c.xmax!=null&&c.ymax!=null?(0,o.jsx)(G.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(m)},stroke:f,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:c.xmin,y:c.ymin,width:c.xmax-c.xmin,height:c.ymax-c.ymin,closed:!0,fill:"rgba(".concat(u.r,", ").concat(u.g,", ").concat(u.b,", ").concat(p,")")}):(0,o.jsx)(o.Fragment,{});function e(R){if(!R&&(c.xmax==null||c.ymax==null))return(0,o.jsx)(o.Fragment,{});var Y=function(x){var _;if(t.currentTool=="editor"){var C=(_=t.stageRef)===null||_===void 0?void 0:_.current,E=C.findOne(".baseImage"),X=!1,F=x.target.x();F>E.width()/2&&(F=E.width()/2,X=!0),F<-E.width()/2&&(F=-E.width()/2,X=!0);var U=x.target.y();U>E.height()/2&&(U=E.height()/2,X=!0),U<-E.height()/2&&(U=-E.height()/2,X=!0),X&&x.target.setPosition({x:F,y:U}),R?(c.xmin=F,c.ymin=U):(c.xmax=F,c.ymax=U);var on=(0,b.Z)((0,b.Z)({},m),{},{result:"".concat(c.xmin,",").concat(c.ymin,",").concat(c.xmax,",").concat(c.ymax)});t.onDrag(on)}};return(0,o.jsx)(G.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(m)},draggable:t.currentTool=="editor",onDragMove:Y,onDragEnd:Y,onMouseOver:function(){var x;t.currentTool=="editor"&&(x=t.stageRef)!==null&&x!==void 0&&x.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var x;(x=t.stageRef)!==null&&x!==void 0&&x.current&&(t.stageRef.current.container().style.cursor="default")},x:R?c.xmin:c.xmax,y:R?c.ymin:c.ymax,radius:5/t.scale,fill:f})}return(0,o.jsxs)(G.ZA,{children:[N,e(!0),e(!1)]},m.annotationId)}function Q(t){var S=function(u,g){var p,N=I([u,g]);!N||!t.dataId||(console.log(N),t.onAnnotationAdd({dataId:t.dataId,type:"rectangle",frontendId:(0,q.pL)(t.annotations)+1,label:t.currentLabel,labelId:(p=t.currentLabel)===null||p===void 0?void 0:p.labelId,result:N}))},m=function(u,g){var p;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((p=t.currentLabel)!==null&&p!==void 0&&p.color))){var N=t.currentAnnotation.result+",".concat(u,",").concat(g),e=(0,b.Z)((0,b.Z)({},t.currentAnnotation),{},{result:N});t.modifyAnnoByFrontendId(e)}},y=function(u){if(t.currentTool=="rectangle"){var g=u.mouseX+u.offsetX,p=u.mouseY+u.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?m(g,p):S(g,p)}},c=function(){t.currentTool!="rectangle"&&t.currentTool!="editor"||t.onMouseUp&&t.onMouseUp()};return{onMouseDown:y,onMouseMove:function(){},onMouseUp:c,drawAnnotation:B}}var V=n(10137),J=function(){var S,m=(0,i.useState)(0),y=(0,a.Z)(m,2),c=y[0],f=y[1],u=(0,en.$L)(i.useState,i.useEffect,{effectTrigger:{postTaskChange:function(r,L){(0,H.Ad)(),(0,H.k3)({annos:L})}},label:{oneHot:!0,postSelect:function(){e.setCurr(void 0),f(0)},preUnsetCurr:_},tool:{defaultTool:"mover"}}),g=u.tool,p=u.loading,N=u.scale,e=u.annotation,R=u.task,Y=u.data,z=u.project,x=u.label;function _(){e.setCurr(void 0),f(0),g.setCurr("mover")}var C=function(r){e.setCurr(r),r!=null&&r.frontendId?f(r.frontendId):f(0)},E=function(r){var L=[],nn=(0,v.Z)(e.all),rn;try{for(nn.s();!(rn=nn.n()).done;){var an=rn.value;an.frontendId==r.frontendId?L.push(r):L.push(an)}}catch(xn){nn.e(xn)}finally{nn.f()}C(r),e.setAll(L)};(0,i.useEffect)(function(){(0,H.Ad)()},[]);function X(){var d;(0,H.k3)({annos:e.all,currAnno:e.curr}),console.log("finish before",e.curr),(e==null||(d=e.curr)===null||d===void 0?void 0:d.annotationId)==null?(console.log("finish",Y.curr,e.curr),e.create(e==null?void 0:e.curr)):e.update(e==null?void 0:e.curr),console.log("finish after",e.curr)}var F={dataId:(S=Y.curr)===null||S===void 0?void 0:S.dataId,currentLabel:x.curr,scale:N.curr,currentTool:g.curr,annotations:e.all,currentAnnotation:e.curr,onAnnotationAdd:function(r){var L=e.all.concat([r]);e.setAll(L),C(r)},onAnnotationModify:E,modifyAnnoByFrontendId:E,onMouseUp:X,frontendIdOps:{frontendId:c,setFrontendId:f}},U=Q(F),on={polygon:U,brush:void 0},$=(0,l.YB)(),ln=$.formatMessage({id:"pages.toolBar.rectangle"}),sn=$.formatMessage({id:"pages.toolBar.zoomIn"}),cn=$.formatMessage({id:"pages.toolBar.zoomOut"}),dn=$.formatMessage({id:"pages.toolBar.move"}),un=$.formatMessage({id:"pages.toolBar.unDo"}),fn=$.formatMessage({id:"pages.toolBar.reDo"}),vn=$.formatMessage({id:"pages.toolBar.save"}),mn=$.formatMessage({id:"pages.toolBar.edit"}),gn=$.formatMessage({id:"pages.toolBar.clearMark"});return(0,o.jsxs)(K.Z,{className:P().det,children:[(0,o.jsxs)(T.Z,{children:[(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/rectangle.png",active:g.curr=="rectangle",onClick:function(){if(!x.curr){M.default.error("Please choose a label category first!");return}g.setCurr("rectangle"),C(void 0)},children:ln}),(0,o.jsx)(A.Z,{active:g.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){g.setCurr("editor")},children:mn}),(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){N.change(.1)},children:sn}),(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){N.change(-.1)},children:cn}),(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var r;e.pushToBackend((r=Y.curr)===null||r===void 0?void 0:r.dataId)},children:vn}),(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/move.png",active:g.curr=="mover",onClick:function(){g.setCurr("mover")},children:dn}),(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var r=(0,H.td)();r&&(e.setAll(r.annos),C(r.currAnno))},children:un}),(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var r=(0,H.Vd)();r&&(e.setAll(r.annos),C(r.currAnno))},children:fn}),(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:gn})]}),(0,o.jsx)("div",{id:"dr",className:"mainStage",children:(0,o.jsxs)(D.Z,{tip:"loading",spinning:!!p.curr,children:[(0,o.jsx)("div",{className:"draw",children:(0,o.jsx)(h.Z,{scale:N.curr,annotations:e.all,currentTool:g.curr,currentAnnotation:e.curr,setCurrentAnnotation:C,onAnnotationModify:E,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:c,setFrontendId:f},imgSrc:Y.imgSrc,transparency:100,onAnnotationAdd:function(r){var L=e.all.concat([r]);e.setAll(L),e.curr||C(r)},drawTool:on})}),(0,o.jsx)("div",{className:"pblock",children:(0,o.jsx)(V.Z,{task:R,project:z})}),(0,o.jsx)("div",{className:"prevTask",onClick:function(){!R.prevTask()||C(void 0)}}),(0,o.jsx)("div",{className:"nextTask",onClick:function(){!R.nextTask()||C(void 0)}})]})}),(0,o.jsxs)(T.Z,{disLoc:"right",children:[(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){l.m8.push("/project_overview?projectId=".concat(z.curr.projectId))},children:"Project Overview"}),(0,o.jsx)(A.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){l.m8.push("/ml?projectId=".concat(z.curr.projectId))},children:"ML Settings"})]}),(0,o.jsxs)("div",{className:"rightSideBar",children:[(0,o.jsx)(w.Z,{labels:x.all,activeIds:x.activeIds,onLabelSelect:x.onSelect,onLabelModify:function(){},onLabelDelete:x.remove,onLabelAdd:function(r){x.create((0,b.Z)((0,b.Z)({},r),{},{projectId:z.curr.projectId})).then(function(L){C(void 0),x.setCurr(L)})}}),(0,o.jsx)(tn.Z,{currAnnotation:e.curr,annotations:e.all,onAnnotationSelect:function(r){r!=null&&r.delete||C(r)},onAnnotationAdd:function(){C(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(r){e.setAll(e.all.filter(function(L){return L.frontendId!=r.frontendId})),C(void 0)}})]})]})},W=J}}]);
