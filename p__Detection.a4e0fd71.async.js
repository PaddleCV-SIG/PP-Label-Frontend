(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(H,T,o){"use strict";o.d(T,{Z:function(){return E}});var Z=o(94663),Y=o(80112);function $(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var q=o(18597);function O(I,P,X){return(0,q.Z)()?O=Reflect.construct:O=function(h,z,U){var D=[null];D.push.apply(D,z);var p=Function.bind.apply(h,D),R=new p;return U&&(0,Y.Z)(R,U.prototype),R},O.apply(null,arguments)}function E(I){var P=typeof Map=="function"?new Map:void 0;return E=function(f){if(f===null||!$(f))return f;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(f))return P.get(f);P.set(f,h)}function h(){return O(f,arguments,(0,Z.Z)(this).constructor)}return h.prototype=Object.create(f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),(0,Y.Z)(h,f)},E(I)}},72285:function(H){H.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(H,T,o){"use strict";o.r(T),o.d(T,{default:function(){return xn}});var Z=o(11849),Y=o(57663),$=o(71577),q=o(20228),O=o(11382),E=o(34669),I=o(54458),P=o(34792),X=o(48086),f=o(2824),h=o(67294),z=o(72285),U=o.n(z),D=o(8088),p=o(61541),R=o(44434),en=o(5041),on=o(57436),rn=o(14836),e=o(85893),an=function(t){return(0,e.jsx)(p.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},sn=an,cn=o(91220),G=o(65031);function ln(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function _(n,t){if(!(!n||!t))return{tool:"rectangle",color:n,points:t}}function un(n,t,a,l,u,S,d,s){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var r=n.lines[0].points,v=n.lines[0].color,m=ln(v);if(!m)return[(0,e.jsx)(e.Fragment,{})];var g=(d==null?void 0:d.annotationId)==n.annotationId,C=g?.5:.1,x=void 0,M=[];return r.forEach(function(y,b){if(!x){x=y;return}M.push((0,e.jsx)(G.Cd,{onMouseDown:function(){(u=="editor"||u=="mover")&&S(n)},draggable:u=="editor",onDragMove:function(A){if(u=="editor"){var W=(A.evt.offsetX+((s==null?void 0:s.x)||0))/l,V=(A.evt.offsetY+((s==null?void 0:s.y)||0))/l;r[b-1]=W,r[b]=V;var J=(0,Z.Z)((0,Z.Z)({},n),{},{lines:[{tool:"rectangle",color:v,points:r}]});t(J)}},onMouseOver:function(){console.log("Circle onMouseOver"),u=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x,y,radius:5,fill:v})),r.length>4&&r.splice(b+1,2),x=void 0}),[(0,e.jsxs)(G.ZA,{children:[(0,e.jsx)(G.UL,{onMouseOver:function(){u=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){u=="mover"&&S(n)},stroke:v,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r[0],y:r[1],width:r[2]-r[0],height:r[3]-r[1],closed:!0,fill:"rgba(".concat(m.r,", ").concat(m.g,", ").concat(m.b,", ").concat(C,")")}),M]},n.annotationId)]}function dn(n){var t=0,a=(0,cn.Z)(n),l;try{for(a.s();!(l=a.n()).done;){var u=l.value;!u||u.annotationId>t&&(t=u.annotationId)}}catch(S){a.e(S)}finally{a.f()}return t}function fn(n){var t=function(d,s,r,v){var m;console.log(v);var g=(d.evt.offsetX+s)/v,C=(d.evt.offsetY+r)/v,x=_((m=n.currentLabel)===null||m===void 0?void 0:m.color,[g,C]);!x||n.onAnnotationAdd({tool:"rectangle",annotationId:dn(n.annotations)+1,label:n.currentLabel,lines:[x]})},a=function(d,s,r,v){var m,g;if(!!n.currentAnnotation){var C=(d.evt.offsetX+s)/v,x=(d.evt.offsetY+r)/v,M=n.currentAnnotation.lines||[],y=_((m=n.currentLabel)===null||m===void 0?void 0:m.color,(g=M[0])===null||g===void 0?void 0:g.points.concat([C,x]));if(!!y){var b={tool:"rectangle",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[y]};n.onAnnotationModify(b)}}},l=function(d,s,r,v){console.log(d.evt),n.currentTool=="rectangle"&&(n.currentAnnotation?a(d,s,r,v):t(d,s,r,v))},u=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:l,onMouseMove:function(){},onMouseUp:u,createElementsFunc:un}}var vn=o(64322),F=40;function gn(){localStorage.removeItem("history"),K([])}function K(n){var t=localStorage.getItem("history"),a=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(a.items[a.index])!=JSON.stringify(n)){var l=a.index>F?a.index-F:0,u=a.items.splice(l,a.index==0?1:a.index+1);a.items=u.concat([n]),a.index<=F?a.index++:a.index=F+1,localStorage.setItem("history",JSON.stringify(a))}}function mn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function hn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var pn=function(){var t,a=(0,vn.$L)(h.useState,h.useEffect,{label:{oneHot:!0},effectTrigger:{}}),l=(0,f.Z)(a,8),u=l[0],S=l[1],d=l[2],s=l[3],r=l[4],v=l[5],m=l[6],g=l[7],C=(0,h.useState)(void 0),x=(0,f.Z)(C,2),M=x[0],y=x[1],b=(0,h.useState)(),N=(0,f.Z)(b,2),A=N[0],W=N[1],V=(0,h.useState)([]),J=(0,f.Z)(V,2),j=J[0],w=J[1],L=function(i){W(i),i!=null&&i.label&&g.setCurr(i.label)};(0,h.useEffect)(function(){gn()},[]);var nn=function(i){for(var k=[],B=0;B<j.length;B++)j[B].annotationId==i.annotationId?k.push(i):k.push(j[B]);L(i),w(k)},tn=fn({currentLabel:g.curr,currentTool:M,annotations:j,currentAnnotation:A,onAnnotationAdd:function(i){var k=j.concat([i]);w(k),A||L(i)},onAnnotationModify:nn,onMouseUp:function(){K({annos:j,currAnno:A})}}),Q=tn;return(0,e.jsxs)(D.Z,{className:U().det,children:[(0,e.jsxs)(R.Z,{children:[(0,e.jsx)(sn,{active:M=="rectangle",onClick:function(){y("rectangle"),L(void 0)},children:"Rectangle"}),(0,e.jsx)(p.Z,{active:M=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){y("editor")},children:"Edit"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){d.change(.1)},children:"Zoom in"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){d.change(-.1)},children:"Zoom out"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){X.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){y("mover")},children:"Move"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var i=hn();w(i.annos),L(i.currAnno)},children:"Undo"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var i=mn();w(i.annos),L(i.currAnno)},children:"Redo"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(O.Z,{tip:"loading",spinning:!!u,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(on.Z,{scale:d.curr,annotations:j,currentTool:M,currentAnnotation:A,setCurrentAnnotation:L,onAnnotationModify:nn,onAnnotationModifyComplete:function(){K({annotations:j,currentAnnotation:A})},onMouseDown:Q.onMouseDown,onMouseMove:Q.onMouseMove,onMouseUp:Q.onMouseUp,createRectangleFunc:tn.createElementsFunc,imgSrc:v.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(I.Z,{className:"progressBar",percent:r.progress,status:"active",showInfo:!1})," ",(0,e.jsxs)("span",{className:"progressDesc",children:["Current labeling ",r.currIdx?r.currIdx+1:1," of ",(t=r.all)===null||t===void 0?void 0:t.length,". Already labeled ",r.finished||0,"."]})]})}),(0,e.jsx)("div",{className:"prevTask",onClick:r.prevTask}),(0,e.jsx)("div",{className:"nextTask",onClick:r.nextTask})]})}),(0,e.jsxs)(R.Z,{disLoc:"right",children:[(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)("div",{className:"determinOutline",children:(0,e.jsx)($.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){s.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(en.Z,{labels:g.all,onLabelSelect:function(i){g.setCurr(i),s.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:g.remove,onLabelAdd:function(i){return g.create((0,Z.Z)((0,Z.Z)({},i),{},{projectId:m.curr.projectId}))}}),(0,e.jsx)(rn.Z,{annotations:s.all,onAnnotationSelect:function(i){return s.setCurr(i,g)},onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:s.remove})]})]})},xn=pn}}]);
