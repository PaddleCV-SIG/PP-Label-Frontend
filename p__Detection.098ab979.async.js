(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{70830:function(w,O,o){"use strict";o.d(O,{Z:function(){return b}});function b(D){throw new TypeError('"'+D+'" is read-only')}},41435:function(w,O,o){"use strict";o.d(O,{Z:function(){return U}});var b=o(94663),D=o(80112);function Y(P){return Function.toString.call(P).indexOf("[native code]")!==-1}var Q=o(18597);function I(P,N,$){return(0,Q.Z)()?I=Reflect.construct:I=function(m,X,F){var R=[null];R.push.apply(R,X);var p=Function.bind.apply(m,R),T=new p;return F&&(0,D.Z)(T,F.prototype),T},I.apply(null,arguments)}function U(P){var N=typeof Map=="function"?new Map:void 0;return U=function(u){if(u===null||!Y(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof N!="undefined"){if(N.has(u))return N.get(u);N.set(u,m)}function m(){return I(u,arguments,(0,b.Z)(this).constructor)}return m.prototype=Object.create(u.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),(0,D.Z)(m,u)},U(P)}},72285:function(w){w.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(w,O,o){"use strict";o.r(O),o.d(O,{default:function(){return yn}});var b=o(11849),D=o(57663),Y=o(71577),Q=o(20228),I=o(11382),U=o(34669),P=o(54458),N=o(34792),$=o(48086),u=o(2824),m=o(67294),X=o(72285),F=o.n(X),R=o(8088),p=o(61541),T=o(44434),en=o(5041),on=o(57436),rn=o(14836),e=o(85893),an=function(t){return(0,e.jsx)(p.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},sn=an,cn=o(91220),z=o(65031);function ln(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function q(n,t){if(!(!n||!t))return{tool:"rectangle",color:n,points:t}}function un(n,t,a,d,v,x,l){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var r=n.lines[0].points,s=n.lines[0].color,f=ln(s);if(!f)return[(0,e.jsx)(e.Fragment,{})];var h=(l==null?void 0:l.annotationId)==n.annotationId,g=h?.5:.1,S=void 0,M=[];return r.forEach(function(y,A){if(!S){S=y;return}M.push((0,e.jsx)(z.Cd,{onMouseDown:function(){v=="mover"&&x(n)},draggable:v=="mover",onDragMove:function(k){console.log("Circle onDrageMove");var Z=k.evt.offsetX,K=k.evt.offsetY;r[A-1]=Z,r[A]=K;var W=(0,b.Z)((0,b.Z)({},n),{},{lines:[{tool:"rectangle",color:s,points:r}]});t(W)},onMouseOver:function(){console.log("Circle onMouseOver"),v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x:S,y,radius:5,fill:s})),r.length>4&&r.splice(A+1,2),S=void 0}),[(0,e.jsxs)(z.ZA,{children:[(0,e.jsx)(z.UL,{onMouseOver:function(){v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){v=="mover"&&x(n)},stroke:s,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r[0],y:r[1],width:r[2]-r[0],height:r[3]-r[1],closed:!0,fill:"rgba(".concat(f.r,", ").concat(f.g,", ").concat(f.b,", ").concat(g,")")}),M]},n.annotationId)]}function dn(n){var t=0,a=(0,cn.Z)(n),d;try{for(a.s();!(d=a.n()).done;){var v=d.value;!v||v.annotationId>t&&(t=v.annotationId)}}catch(x){a.e(x)}finally{a.f()}return t}function fn(n){var t=function(l,r,s,f){var h;console.log(f);var g=(l.evt.offsetX+r)/f,S=(l.evt.offsetY+s)/f,M=q((h=n.currentLabel)===null||h===void 0?void 0:h.color,[g,S]);!M||n.onAnnotationAdd({tool:"rectangle",annotationId:dn(n.annotations)+1,label:n.currentLabel,lines:[M]})},a=function(l,r,s,f){var h,g;if(!!n.currentAnnotation){var S=(l.evt.offsetX+r)/f,M=(l.evt.offsetY+s)/f,y=n.currentAnnotation.lines||[],A=q((h=n.currentLabel)===null||h===void 0?void 0:h.color,(g=y[0])===null||g===void 0?void 0:g.points.concat([S,M]));if(!!A){var C={tool:"rectangle",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[A]};n.onAnnotationModify(C)}}},d=function(l,r,s,f){console.log(l.evt),n.currentTool=="rectangle"&&(n.currentAnnotation?a(l,r,s,f):t(l,r,s,f))},v=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:d,onMouseMove:function(){},onMouseUp:v,createElementsFunc:un}}var vn=o(64322),J=40;function gn(){localStorage.removeItem("history"),G([])}function G(n){var t=localStorage.getItem("history"),a=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(a.items[a.index])!=JSON.stringify(n)){var d=a.index>J?a.index-J:0,v=a.items.splice(d,a.index==0?1:a.index+1);a.items=v.concat([n]),a.index<=J?a.index++:a.index=J+1,localStorage.setItem("history",JSON.stringify(a))}}function mn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function pn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var hn=function(){var t,a=(0,vn.$L)(m.useState,m.useEffect,{label:{oneHot:!0},effectTrigger:{}}),d=(0,u.Z)(a,8),v=d[0],x=d[1],l=d[2],r=d[3],s=d[4],f=d[5],h=d[6],g=d[7],S=(0,m.useState)(void 0),M=(0,u.Z)(S,2),y=M[0],A=M[1],C=(0,m.useState)(),k=(0,u.Z)(C,2),Z=k[0],K=k[1],W=(0,m.useState)([]),_=(0,u.Z)(W,2),j=_[0],B=_[1],L=function(i){K(i),i!=null&&i.label&&g.setCurr(i.label)};(0,m.useEffect)(function(){gn()},[]);var nn=function(i){for(var E=[],H=0;H<j.length;H++)j[H].annotationId==i.annotationId?E.push(i):E.push(j[H]);L(i),B(E)},tn=fn({currentLabel:g.curr,currentTool:y,annotations:j,currentAnnotation:Z,onAnnotationAdd:function(i){var E=j.concat([i]);B(E),Z||L(i)},onAnnotationModify:nn,onMouseUp:function(){G({annos:j,currAnno:Z})}}),V=tn;return(0,e.jsxs)(R.Z,{className:F().det,children:[(0,e.jsxs)(T.Z,{children:[(0,e.jsx)(sn,{active:y=="rectangle",onClick:function(){A("rectangle"),L(void 0)},children:"Rectangle"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/edit.png",children:"Edit"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){l.change(.1)},children:"Zoom in"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){l.change(-.1)},children:"Zoom out"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){$.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){A("mover")},children:"Move"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var i=pn();B(i.annos),L(i.currAnno)},children:"Undo"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var i=mn();B(i.annos),L(i.currAnno)},children:"Redo"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(I.Z,{tip:"loading",spinning:!!v,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(on.Z,{scale:l.curr,annotations:j,currentTool:y,currentAnnotation:Z,setCurrentAnnotation:L,onAnnotationModify:nn,onAnnotationModifyComplete:function(){G({annotations:j,currentAnnotation:Z})},onMouseDown:V.onMouseDown,onMouseMove:V.onMouseMove,onMouseUp:V.onMouseUp,createRectangleFunc:tn.createElementsFunc,imgSrc:f.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(P.Z,{className:"progressBar",percent:s.progress,status:"active",showInfo:!1})," ",(0,e.jsxs)("span",{className:"progressDesc",children:["Current labeling ",s.currIdx?s.currIdx+1:1," of ",(t=s.all)===null||t===void 0?void 0:t.length,". Already labeled ",s.finished||0,"."]})]})}),(0,e.jsx)("div",{className:"prevTask",onClick:s.prevTask}),(0,e.jsx)("div",{className:"nextTask",onClick:s.nextTask})]})}),(0,e.jsxs)(T.Z,{disLoc:"right",children:[(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(p.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)("div",{className:"determinOutline",children:(0,e.jsx)(Y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){r.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(en.Z,{labels:g.all,onLabelSelect:function(i){g.setCurr(i),r.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:g.remove,onLabelAdd:function(i){return g.create((0,b.Z)((0,b.Z)({},i),{},{projectId:h.curr.projectId}))}}),(0,e.jsx)(rn.Z,{annotations:r.all,onAnnotationSelect:function(i){return r.setCurr(i,g)},onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:r.remove})]})]})},yn=hn}}]);
