(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(ve,re,B){"use strict";B.d(re,{gu:function(){return te},os:function(){return le},Gd:function(){return ee},$L:function(){return oe}});var Q=B(11849),X=B(91220),Z=B(3182),ge=B(34792),S=B(48086),M=B(2824),ae=B(94043),u=B.n(ae),Y=B(48971),F=B(37071),G=B(81139),z=localStorage.getItem("basePath"),J=new G.VK(z?{basePath:z}:void 0),N=new G.U(J),ne=new G.sD(J),ue=new G.W6(J),q=new G.Cl(J),x=new G.vb(J),te=function(s){return JSON.parse(JSON.stringify(s))};function le(T){return T&&(T.toLowerCase().replace(/([-_][a-z])/g,function(s){return s.toUpperCase().replace("-","").replace("_","")}),T)}var V=function(s,g,h){if(!!h){for(var i=typeof s=="number"?s:s[h],w=0;w<g.length;w++)if(i==g[w][h])return w}},se=function(s){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,20],h=s(1),i=(0,M.Z)(h,2),w=i[0],_=i[1];function E(k){var I=k;I<g[0]&&(I=g[0],S.default.error("Smallest scale is "+g[0])),I>g[1]&&(I=g[1],S.default.error("Largest scale is "+g[1])),_(I)}function a(k){E(w+k)}return{curr:w,change:a,setScale:E}};function ie(T){var s=T(!1),g=(0,M.Z)(s,2),h=g[0],i=g[1];return{curr:h,setCurr:i}}var ee=function(s){var g=s(),h=(0,M.Z)(g,2),i=h[0],w=h[1],_=s(),E=(0,M.Z)(_,2),a=E[0],k=E[1],I=s(),O=(0,M.Z)(I,2),j=O[0],y=O[1];function L(){return v.apply(this,arguments)}function v(){return v=(0,Z.Z)(u().mark(function r(){var b;return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,N.getAll();case 3:return b=c.sent,w(b),c.abrupt("return",b);case 8:return c.prev=8,c.t0=c.catch(0),console.log("project getAll err",c.t0),F.Z.parseError(c.t0,S.default),c.abrupt("return");case 13:case"end":return c.stop()}},r,null,[[0,8]])})),v.apply(this,arguments)}function n(r){return D.apply(this,arguments)}function D(){return D=(0,Z.Z)(u().mark(function r(b){var U;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(b!=null){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(i&&i.length>1)){e.next=5;break}return S.default.error("Currently have multiple projects stored, use turnTo instead"),e.abrupt("return");case 5:return e.next=7,N.get(b);case 7:return U=e.sent,w([U]),k(0),e.abrupt("return",U);case 11:case"end":return e.stop()}},r)})),D.apply(this,arguments)}function l(r){return $.apply(this,arguments)}function $(){return $=(0,Z.Z)(u().mark(function r(b){return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return k(b),c.abrupt("return",i[b]);case 2:case"end":return c.stop()}},r)})),$.apply(this,arguments)}function H(r){return p.apply(this,arguments)}function p(){return p=(0,Z.Z)(u().mark(function r(b){var U;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("remove project",b),U=typeof b=="number"?b:b.projectId,e.next=4,N.remove(U);case 4:L();case 5:case"end":return e.stop()}},r)})),p.apply(this,arguments)}function R(r){return P.apply(this,arguments)}function P(){return P=(0,Z.Z)(u().mark(function r(b){var U;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.create(b);case 3:return U=e.sent,e.abrupt("return",U);case 7:return e.prev=7,e.t0=e.catch(0),console.log("project create err",e.t0),e.abrupt("return",F.Z.parseError(e.t0,S.default));case 11:case"end":return e.stop()}},r,null,[[0,7]])})),P.apply(this,arguments)}function f(r,b){return m.apply(this,arguments)}function m(){return m=(0,Z.Z)(u().mark(function r(b,U){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:N.update(b,U).then(function(t){console.log("project update res",t)}).catch(function(t){console.log("project update err ",t),F.Z.parseError(t,S.default)});case 1:case"end":return e.stop()}},r)})),m.apply(this,arguments)}function K(){return d.apply(this,arguments)}function d(){return d=(0,Z.Z)(u().mark(function r(){var b,U,c,e,t=arguments;return u().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return b=t.length>0&&t[0]!==void 0?t[0]:void 0,A.prev=1,U=b==null?i[a].projectId:b,A.next=5,N.getProgress(U);case 5:if(c=A.sent,!(!c||c.finished==null||c.total==null)){A.next=8;break}throw Error("empty progress");case 8:return e=Math.ceil(c.finished/c.total*100),y(e),A.abrupt("return",e);case 13:return A.prev=13,A.t0=A.catch(1),console.log("get progress err",A.t0),F.Z.parseError(A.t0,S.default),A.abrupt("return",0);case 18:case"end":return A.stop()}},r,null,[[1,13]])})),d.apply(this,arguments)}return{all:i,getAll:L,getCurr:n,turnTo:l,remove:H,create:R,update:f,progress:j,getProgress:K,get curr(){if(!!i)return i[a]}}},fe=function(s,g){var h=g.oneHot,i=h===void 0?!0:h,w=g.postSetCurr,_=s(),E=(0,M.Z)(_,2),a=E[0],k=E[1],I=s(),O=(0,M.Z)(I,2),j=O[0],y=O[1],L=s(new Set),v=(0,M.Z)(L,2),n=v[0],D=v[1],l=s(i),$=(0,M.Z)(l,2),H=$[0],p=$[1];function R(e){return P.apply(this,arguments)}function P(){return P=(0,Z.Z)(u().mark(function e(t){var C;return u().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t!=null){o.next=2;break}return o.abrupt("return");case 2:return o.prev=2,o.next=5,N.getLabels(t);case 5:return C=o.sent,k(C),o.abrupt("return",C);case 10:return o.prev=10,o.t0=o.catch(2),console.log("label getall err ",o.t0),o.abrupt("return",F.Z.parseError(o.t0,S.default));case 14:case"end":return o.stop()}},e,null,[[2,10]])})),P.apply(this,arguments)}function f(e){var t=V(e,a,"labelId");if(t==null)throw Error("label.onSelect label not found");y(t);var C=a[t].labelId;H?n.has(C)?n.clear():(n.clear(),n.add(C)):n.has(C)?n.delete(C):n.add(C),console.log("activeIds",n),D(new Set(n)),w&&w(a[t])}function m(e){if(console.log("setCurr",e),!i)throw Error("multi select task doesn't have current label");if(!!e){var t=typeof e=="number"?e:e.labelId;t=V(t,a,"labelId"),t&&(console.log("setCurr index:",t),y(t),D(new Set([t])))}}function K(e){n.clear();var t=(0,X.Z)(e),C;try{for(t.s();!(C=t.n()).done;){var A=C.value;n.add(A.labelId)}}catch(o){t.e(o)}finally{t.f()}}var d=function(){var e=(0,Z.Z)(u().mark(function t(C){var A;return u().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.prev=0,W.next=3,x.create(C);case 3:return A=W.sent,R(C.projectId),W.abrupt("return",A);case 8:return W.prev=8,W.t0=W.catch(0),console.log("label create err",W.t0),W.abrupt("return",F.Z.parseError(W.t0,S.default));case 12:case"end":return W.stop()}},t,null,[[0,8]])}));return function(C){return e.apply(this,arguments)}}();function r(e){return b.apply(this,arguments)}function b(){return b=(0,Z.Z)(u().mark(function e(t){var C;return u().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return C=typeof t=="number"?t:t.labelId,o.prev=1,o.next=4,x.remove(C);case 4:a&&a.length&&R(a[0].projectId),o.next=11;break;case 7:o.prev=7,o.t0=o.catch(1),console.log("label remove err",o.t0),F.Z.parseError(o.t0,S.default);case 11:case"end":return o.stop()}},e,null,[[1,7]])})),b.apply(this,arguments)}function U(e){var t=typeof e=="number"?e:e.labelId;return n.has(t)}var c=function(t){t!=null?p(t):p(!H)};return{all:a,getAll:R,activeIds:n,initActive:K,onSelect:f,setCurr:m,isActive:U,create:d,remove:r,toggleOneHot:c,get curr(){if(a!=null)return a[j]}}},de=function(s){var g=s(),h=(0,M.Z)(g,2),i=h[0],w=h[1],_=s(),E=(0,M.Z)(_,2),a=E[0],k=E[1],I=function(n){if(n<0){S.default.error("This is the first image. No previous image.");return}if(n==i.length){S.default.error("This is the final image. No next image.");return}k(n)},O=function(){var v=(0,Z.Z)(u().mark(function n(D,l){var $;return u().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,N.getTasks(D);case 3:if($=p.sent,w($),l==null){p.next=9;break}return console.log("getall turnto"),I(l),p.abrupt("return",[$,$[l]]);case 9:return p.abrupt("return",$);case 12:return p.prev=12,p.t0=p.catch(0),console.log("task getall err ",p.t0),p.abrupt("return",F.Z.parseError(p.t0,S.default));case 16:case"end":return p.stop()}},n,null,[[0,12]])}));return function(D,l){return v.apply(this,arguments)}}();function j(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return v==null||!i?0:Math.round(i.length*v/100)}var y=function(){var v=(0,Z.Z)(u().mark(function n(){return u().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:I(a+1),console.log("all tasks",i);case 2:case"end":return l.stop()}},n)}));return function(){return v.apply(this,arguments)}}(),L=function(){var v=(0,Z.Z)(u().mark(function n(){return u().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:I(a-1);case 1:case"end":return l.stop()}},n)}));return function(){return v.apply(this,arguments)}}();return{currIdx:a,all:i,turnTo:I,getAll:O,nextTask:y,prevTask:L,finished:j,get curr(){if(!(a==null||i==null))return i[a]}}};function ce(T,s){var g=s.label,h=g===void 0?void 0:g,i=s.project,w=i===void 0?void 0:i,_=T(),E=(0,M.Z)(_,2),a=E[0],k=E[1],I=T(),O=(0,M.Z)(I,2),j=O[0],y=O[1],L=T(new Set),v=(0,M.Z)(L,2),n=v[0],D=v[1],l=function(){var R=(0,Z.Z)(u().mark(function P(f){var m;return u().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(f!=null){d.next=2;break}return d.abrupt("return",[]);case 2:return d.prev=2,d.next=5,ue.getAnnotations(f);case 5:return m=d.sent,k(m),d.abrupt("return",m);case 10:return d.prev=10,d.t0=d.catch(2),console.log("ann getAll err",d.t0),F.Z.parseError(d.t0,S.default),d.abrupt("return",[]);case 15:case"end":return d.stop()}},P,null,[[2,10]])}));return function(f){return R.apply(this,arguments)}}(),$=function(){var R=(0,Z.Z)(u().mark(function P(f){var m,K;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,f.label&&(f.labelId=f.label.id),r.next=4,q.create(f);case 4:if(m=r.sent,K=[],!f.dataId){r.next=10;break}return r.next=9,l(f.dataId);case 9:K=r.sent;case 10:return w&&K.length==1&&w.getProgress(),r.abrupt("return",m);case 14:return r.prev=14,r.t0=r.catch(0),console.log("annotation create err",r.t0),r.abrupt("return",F.Z.parseError(r.t0,S.default));case 18:case"end":return r.stop()}},P,null,[[0,14]])}));return function(f){return R.apply(this,arguments)}}(),H=function(){var R=(0,Z.Z)(u().mark(function P(f){var m,K;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(m=typeof f=="number"?f:f.annotationId,m!=null){r.next=3;break}return r.abrupt("return");case 3:return r.prev=3,r.next=6,q.remove(m);case 6:if(!(a&&a.length&&a[0].dataId)){r.next=11;break}return r.next=9,l(a[0].dataId);case 9:K=r.sent,K.length==0&&w.getProgress();case 11:r.next=17;break;case 13:return r.prev=13,r.t0=r.catch(3),console.log("annotation remove err",r.t0),r.abrupt("return",F.Z.parseError(r.t0,S.default));case 17:case"end":return r.stop()}},P,null,[[3,13]])}));return function(f){return R.apply(this,arguments)}}(),p=function(){var R=(0,Z.Z)(u().mark(function P(f){var m;return u().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(console.log("setCurr",f),f!=null){d.next=4;break}return y(void 0),d.abrupt("return");case 4:if(m=V(f,a,"annotationId"),m){d.next=8;break}return d.next=8,$(f);case 8:y(V(f,a,"annotationId")),D(new Set([f.annotationId])),h.setCurr(f.labelId),console.log(V(f,a,"annotationId"),new Set([f.annotationId]),f.labelId);case 12:case"end":return d.stop()}},P)}));return function(f){return R.apply(this,arguments)}}();return{all:a,getAll:l,create:$,remove:H,setCurr:p,activeIds:n,get curr(){if(!(!a||!j))return a[j]}}}var pe=function(s){var g=s(),h=(0,M.Z)(g,2),i=h[0],w=h[1],_=s([]),E=(0,M.Z)(_,2),a=E[0],k=E[1],I=function(){var j=(0,Z.Z)(u().mark(function y(L){return u().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:w(L);case 1:case"end":return n.stop()}},y)}));return function(L){return j.apply(this,arguments)}}(),O=function(){var j=(0,Z.Z)(u().mark(function y(L,v){var n;return u().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,ne.getDatas(L);case 3:if(n=l.sent,k(n),v==null){l.next=8;break}return I(v),l.abrupt("return",[n,n[v]]);case 8:return l.abrupt("return",n);case 11:return l.prev=11,l.t0=l.catch(0),console.log("data getall err ",l.t0),l.abrupt("return",F.Z.parseError(l.t0,S.default));case 15:case"end":return l.stop()}},y,null,[[0,11]])}));return function(L,v){return j.apply(this,arguments)}}();return{all:a,getAll:O,turnTo:I,get curr(){if(!(i==null||a==null))return a[i]},get imgSrc(){return a&&a[i]?"".concat(z,"/datas/").concat(a[i].dataId,"/image?sault=").concat(a[i].sault):""}}},oe=function(s,g,h){h.effectTrigger||(h.effectTrigger={});var i=ie(s),w=se(s),_=de(s),E=pe(s),a=ee(s),k=fe(s,h.label),I=ce(s,(0,Q.Z)((0,Q.Z)({},h.annotation),{},{label:k,project:a}));return g(function(){var O=F.Z.getQueryVariable("projectId");if(O==null){Y.m8.push("/");return}var j=parseInt(O);a.getCurr(O).catch(function(y){F.Z.parseError(y,S.default),Y.m8.push("/")}),k.getAll(j),_.getAll(j),a.getProgress(j)},[]),g(function(){_.all&&_.all.length!=0&&_.turnTo(0)},[_.all]),g(function(){if(_.currIdx!=null){var O=function(){var j=(0,Z.Z)(u().mark(function y(){var L,v,n,D,l,$,H,p,R,P;return u().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if((L=_.curr)!==null&&L!==void 0&&L.projectId&&a.getProgress(_.curr.projectId),!((v=_.curr)!==null&&v!==void 0&&v.taskId)){m.next=13;break}return m.next=4,E.getAll(_.curr.taskId,0);case 4:return n=m.sent,D=(0,M.Z)(n,2),l=D[0],$=D[1],m.next=10,I.getAll($.dataId);case 10:if(H=m.sent,k.all){p=(0,X.Z)(k.all);try{for(p.s();!(R=p.n()).done;)P=R.value,P.active=!1}catch(K){p.e(K)}finally{p.f()}}h.effectTrigger.postTaskChange&&h.effectTrigger.postTaskChange(k.all,H);case 13:i.setCurr(!1);case 14:case"end":return m.stop()}},y)}));return function(){return j.apply(this,arguments)}}();O()}},[_.currIdx]),[i,w,I,_,E,a,k]}}}]);
