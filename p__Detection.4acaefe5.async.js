(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(Y,E,e){"use strict";e.d(E,{Z:function(){return w}});var O=e(94663),$=e(80112);function X(P){return Function.toString.call(P).indexOf("[native code]")!==-1}var _=e(18597);function I(P,L,z){return(0,_.Z)()?I=Reflect.construct:I=function(g,W,S){var R=[null];R.push.apply(R,W);var v=Function.bind.apply(g,R),T=new v;return S&&(0,$.Z)(T,S.prototype),T},I.apply(null,arguments)}function w(P){var L=typeof Map=="function"?new Map:void 0;return w=function(u){if(u===null||!X(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof L!="undefined"){if(L.has(u))return L.get(u);L.set(u,g)}function g(){return I(u,arguments,(0,O.Z)(this).constructor)}return g.prototype=Object.create(u.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),(0,$.Z)(g,u)},w(P)}},72285:function(Y){Y.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},80212:function(Y,E,e){"use strict";e.r(E),e.d(E,{default:function(){return Sn}});var O=e(11849),$=e(57663),X=e(71577),_=e(20228),I=e(11382),w=e(34669),P=e(54458),L=e(34792),z=e(48086),u=e(2824),g=e(67294),W=e(72285),S=e.n(W),R=e(8088),v=e(61541),T=e(44434),sn=e(5041),cn=e(57436),ln=e(14836),n=e(85893),un=function(i){return(0,n.jsx)(v.Z,{active:i.active,imgSrc:i.imgSrc||"./pics/buttons/rectangle.png",onClick:i.onClick,children:i.children})},dn=un,fn=e(91220),G=e(65031);function vn(t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}function nn(t,i){if(!(!t||!i))return{color:t,points:i}}function gn(t,i,p,M,l,y,m){if(!t||!t.lines||!t.lines[0])return[(0,n.jsx)(n.Fragment,{})];var o=t.lines[0].points,f=t.lines[0].color,d=vn(f);if(!d)return[(0,n.jsx)(n.Fragment,{})];var Z=(m==null?void 0:m.annotationId)==t.annotationId,A=Z?.5:.1,h=void 0,C=[];return o.forEach(function(x,b){if(!h){h=x;return}C.push((0,n.jsx)(G.Cd,{onMouseDown:function(){l=="mover"&&y(t)},draggable:l=="mover",onDragMove:function(F){console.log("Circle onDrageMove");var J=F.evt.offsetX/M,K=F.evt.offsetY/M;o[b-1]=J,o[b]=K;var B=(0,O.Z)((0,O.Z)({},t),{},{lines:[{color:f,points:o}]});i(B)},onMouseOver:function(){console.log("Circle onMouseOver"),l=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x:h,y:x,radius:5,fill:f})),console.log(b,o),o.length>4&&o.splice(b+1,2),h=void 0}),[(0,n.jsxs)(G.ZA,{children:[(0,n.jsx)(G.UL,{onMouseOver:function(){l=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){l=="mover"&&y(t)},stroke:f,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:o[0],y:o[1],width:o[2]-o[0],height:o[3]-o[1],closed:!0,fill:"rgba(".concat(d.r,", ").concat(d.g,", ").concat(d.b,", ").concat(A,")")}),C]},t.annotationId)]}function mn(t){var i=0,p=(0,fn.Z)(t),M;try{for(p.s();!(M=p.n()).done;){var l=M.value;!l||l.annotationId>i&&(i=l.annotationId)}}catch(y){p.e(y)}finally{p.f()}return i}function pn(t){var i=function(m,o){var f,d=m.evt.offsetX/o,Z=m.evt.offsetY/o,A=nn((f=t.currentLabel)===null||f===void 0?void 0:f.color,[d,Z]);!A||t.onAnnotationAdd({tool:"polygon",annotationId:mn(t.annotations)+1,label:t.currentLabel,lines:[A]})},p=function(m,o){var f,d;if(!!t.currentAnnotation){var Z=m.evt.offsetX/o,A=m.evt.offsetY/o,h=t.currentAnnotation.lines||[],C=nn((f=t.currentLabel)===null||f===void 0?void 0:f.color,(d=h[0])===null||d===void 0?void 0:d.points.concat([Z,A]));if(!!C){var x={tool:"polygon",annotationId:t.currentAnnotation.annotationId,label:t.currentAnnotation.label,lines:[C]};t.onAnnotationModify(x)}}},M=function(m,o){t.currentTool=="polygon"&&(t.currentAnnotation?p(m,o):i(m,o))},l=function(){t.currentTool=="polygon"&&t.onMouseUp()};return{onMouseDown:M,onMouseMove:function(){},onMouseUp:l,createElementsFunc:gn}}var yn=e(64322),U=40,hn=function(){var i,p,M=(0,yn.$L)(g.useState,g.useEffect,{label:{oneHot:!0},effectTrigger:{}}),l=(0,u.Z)(M,8),y=l[0],m=l[1],o=l[2],f=l[3],d=l[4],Z=l[5],A=l[6],h=l[7],C=(0,g.useState)(void 0),x=(0,u.Z)(C,2),b=x[0],N=x[1],F=(0,g.useState)({color:"",name:""}),J=(0,u.Z)(F,2),K=J[0],B=J[1],xn=(0,g.useState)(),tn=(0,u.Z)(xn,2),k=tn[0],V=tn[1],Mn=(0,g.useState)([]),en=(0,u.Z)(Mn,2),j=en[0],H=en[1],D=function(r){V(r),r!=null&&r.label&&B(r.label)};(0,g.useEffect)(function(){localStorage.removeItem("history"),Q([])},[]);function Q(c,r){var a=localStorage.getItem("history"),s=a?JSON.parse(a):{index:-1,items:[]},an={currentAnnotation:r,annotations:c};if(JSON.stringify(s.items[s.index])!=JSON.stringify(an)){var jn=s.index>U?s.index-U:0,Zn=s.items.splice(jn,s.index==0?1:s.index+1);s.items=Zn.concat([an]),s.index<=U?s.index++:s.index=U+1,localStorage.setItem("history",JSON.stringify(s))}}var An=function(){var r=localStorage.getItem("history");if(!!r){var a=JSON.parse(r);if(!!a&&!(a.index>=a.items.length-1)){a.index++,localStorage.setItem("history",JSON.stringify(a));var s=a.items[a.index];V(s.currentAnnotation),H(s.annotations)}}},bn=function(){var r=localStorage.getItem("history");if(!!r){var a=JSON.parse(r);if(!(!a||!a.index)&&!(a.index<=0)){a.index--,localStorage.setItem("history",JSON.stringify(a));var s=a.items[a.index];V(s.currentAnnotation),H(s.annotations)}}},on=function(r){for(var a=[],s=0;s<j.length;s++)j[s].annotationId==r.annotationId?a.push(r):a.push(j[s]);D(r),H(a)},rn=pn({currentLabel:K,currentTool:b,annotations:j,currentAnnotation:k,onAnnotationAdd:function(r){var a=j.concat([r]);H(a),k||D(r)},onAnnotationModify:on,onMouseUp:function(){Q(j,k)}}),q=rn;return(0,n.jsxs)(R.Z,{className:S().det,children:[(0,n.jsxs)(T.Z,{children:[(0,n.jsx)(dn,{active:b=="polygon",onClick:function(){N("polygon"),D(void 0)},children:"Rectangle"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/edit.png",children:"Edit"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){o.change(.1)},children:"Zoom in"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){o.change(-.1)},children:"Zoom out"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){z.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){N("mover")},children:"Move"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){bn()},children:"Undo"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){An()},children:"Redo"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,n.jsx)("div",{id:"dr",className:S().mainStage,children:(0,n.jsxs)(I.Z,{tip:"loading",spinning:y,children:[(0,n.jsx)("div",{className:S().draw,children:(0,n.jsx)(cn.Z,{width:(i=document.getElementById("dr"))===null||i===void 0?void 0:i.clientWidth,scale:o.curr,annotations:j,currentTool:b,currentAnnotation:k,setCurrentAnnotation:D,onAnnotationModify:on,onAnnotationModifyComplete:function(){Q(j,k)},onMouseDown:q.onMouseDown,onMouseMove:q.onMouseMove,onMouseUp:q.onMouseUp,createPolygonFunc:rn.createElementsFunc,imgSrc:Z.imgSrc})}),(0,n.jsx)("div",{className:S().pblock,children:(0,n.jsxs)("div",{className:S().progress,children:[(0,n.jsx)(P.Z,{percent:d.progress,status:"active"}),d.currIdx," ",(p=d.all)===null||p===void 0?void 0:p.length," ",d.finished]})})]})}),(0,n.jsxs)(T.Z,{disLoc:"right",children:[(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/next.png",onClick:d.nextTask,children:"Next"}),(0,n.jsx)(v.Z,{imgSrc:"./pics/buttons/prev.png",onClick:d.prevTask,children:"Prev"})]}),(0,n.jsxs)("div",{className:S().rightSideBar,children:[(0,n.jsx)("div",{className:S().determinOutline,children:(0,n.jsx)(X.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){D(void 0)},children:"Determine Outline"})}),(0,n.jsx)(sn.Z,{labels:h.all,onLabelSelect:function(r){h.onSelect(r),B(r),D(void 0)},onLabelModify:function(){},onLabelDelete:h.remove,onLabelAdd:function(r){return h.create((0,O.Z)((0,O.Z)({},r),{},{projectId:A.curr.projectId}))}}),(0,n.jsx)(ln.Z,{annotations:f.all,onAnnotationSelect:f.onSelect,onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:f.remove})]})]})},Sn=hn}}]);
