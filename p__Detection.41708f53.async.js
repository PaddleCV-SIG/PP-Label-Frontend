(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(Z,I,n){"use strict";n.d(I,{Z:function(){return H}});var h=n(94663),J=n(80112);function K(b){return Function.toString.call(b).indexOf("[native code]")!==-1}var cn=n(18597);function F(b,P,A){return(0,cn.Z)()?F=Reflect.construct:F=function(E,q,$){var x=[null];x.push.apply(x,q);var w=Function.bind.apply(E,x),X=new w;return $&&(0,J.Z)(X,$.prototype),X},F.apply(null,arguments)}function H(b){var P=typeof Map=="function"?new Map:void 0;return H=function(c){if(c===null||!K(c))return c;if(typeof c!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(c))return P.get(c);P.set(c,E)}function E(){return F(c,arguments,(0,h.Z)(this).constructor)}return E.prototype=Object.create(c.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),(0,J.Z)(E,c)},H(b)}},6277:function(Z){Z.exports={modal:"modal___26yNn"}},72285:function(Z){Z.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},74576:function(Z,I,n){"use strict";n.r(I),n.d(I,{default:function(){return Ln}});var h=n(11849),J=n(20228),K=n(11382),cn=n(34669),F=n(54458),H=n(34792),b=n(48086),P=n(91220),A=n(2824),c=n(67294),E=n(72285),q=n.n(E),$=n(8088),x=n(61541),w=n(44434),X=n(5041),mn=n(57436),gn=n(14836),t=n(85893),xn=function(o){return(0,t.jsx)(x.Z,{active:o.active,imgSrc:o.imgSrc||"./pics/buttons/rectangle.png",onClick:o.onClick,children:o.children})},pn=xn,nn=n(65031);function yn(e){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}function hn(e){if(!(!e||e.length<2))return{xmin:e[0],ymin:e[1],xmax:e[2]||void 0,ymax:e[3]||void 0}}function Mn(e,o,l,u,i,M,v){if(!e||!e.points||!e.label||!e.label.color)return[(0,t.jsx)(t.Fragment,{})];var r=e.points,d=e.label.color,m=yn(d);if(!m)return[(0,t.jsx)(t.Fragment,{})];var S=(v==null?void 0:v.annotationId)==e.annotationId,p=S?.5:.1,y=r.xmax!=null&&r.ymax!=null?(0,t.jsx)(nn.UL,{onMouseOver:function(){i=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){i=="mover"&&M(e)},stroke:d,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r.xmin,y:r.ymin,width:r.xmax-r.xmin,height:r.ymax-r.ymin,closed:!0,fill:"rgba(".concat(m.r,", ").concat(m.g,", ").concat(m.b,", ").concat(p,")")}):(0,t.jsx)(t.Fragment,{});function N(j){if(!j&&(r.xmax==null||r.ymax==null))return(0,t.jsx)(t.Fragment,{});var T=function(g){if(i=="editor"){var U=g.target.x(),L=g.target.y();j?(r.xmin=U,r.ymin=L):(r.xmax=U,r.ymax=L);var D=(0,h.Z)((0,h.Z)({},e),{},{points:r});o(D)}};return(0,t.jsx)(nn.Cd,{onMouseDown:function(){(i=="editor"||i=="mover")&&M(e)},draggable:i=="editor",onDragMove:T,onDragEnd:T,onMouseOver:function(){i=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:j?r.xmin:r.xmax,y:j?r.ymin:r.ymax,radius:5,fill:d})}return[(0,t.jsxs)(nn.ZA,{children:[y,N(!0),N(!1)]},e.annotationId)]}function Sn(e){var o=1;if(!e||e.length==0)return o;var l=(0,P.Z)(e),u;try{for(l.s();!(u=l.n()).done;){var i=u.value;i.frontendId&&o<=i.frontendId&&(o=i.frontendId+1)}}catch(M){l.e(M)}finally{l.f()}return o}function Dn(e){var o=function(v,r,d,m){var S=(v.evt.offsetX+r)/m,p=(v.evt.offsetY+d)/m,y=hn([S,p]);!y||e.onAnnotationAdd({frontendId:Sn(e.annotations),type:"rectangle",label:e.currentLabel,points:y})},l=function(v,r,d,m){if(!(!e.currentAnnotation||!e.currentAnnotation.points)){var S=(v.evt.offsetX+r)/m,p=(v.evt.offsetY+d)/m,y=e.currentAnnotation.points;if(!!y){y.xmax=S,y.ymax=p;var N={type:"rectangle",frontendId:e.currentAnnotation.frontendId,label:e.currentAnnotation.label,points:y};e.onAnnotationModify(N)}}},u=function(v,r,d,m){e.currentTool=="rectangle"&&(e.currentAnnotation?l(v,r,d,m):o(v,r,d,m))},i=function(){e.currentTool=="rectangle"&&e.onMouseUp()};return{onMouseDown:u,onMouseMove:function(){},onMouseUp:i,createElementsFunc:Mn}}var An=n(64322),G=40;function jn(){localStorage.removeItem("history"),tn([])}function tn(e){var o=localStorage.getItem("history"),l=o?JSON.parse(o):{index:-1,items:[]};if(JSON.stringify(l.items[l.index])!=JSON.stringify(e)){var u=l.index>G?l.index-G:0,i=l.items.splice(u,l.index==0?1:l.index+1);l.items=i.concat([e]),l.index<=G?l.index++:l.index=G+1,localStorage.setItem("history",JSON.stringify(l))}}function Cn(){var e=localStorage.getItem("history");if(!!e){var o=JSON.parse(e);if(!!o&&!(o.index>=o.items.length-1))return o.index++,localStorage.setItem("history",JSON.stringify(o)),o.items[o.index]}}function In(){var e=localStorage.getItem("history");if(!!e){var o=JSON.parse(e);if(!(!o||!o.index)&&!(o.index<=0))return o.index--,localStorage.setItem("history",JSON.stringify(o)),o.items[o.index]}}var f=n(48971),wn=n(71194),Zn=n(50146),Xn=n(49111),Pn=n(19650),Gn=n(57663),un=n(71577),Qn=n(13062),On=n(71230),_n=n(89032),en=n(15746),qn=n(77883),on=n(70507),nt=n(9715),k=n(93766),Bn=n(6277),bn=n.n(Bn),En=function(o){var l=(0,c.useState)(60),u=(0,A.Z)(l,2),i=u[0],M=u[1],v=(0,c.useState)(20),r=(0,A.Z)(v,2),d=r[0],m=r[1],S=(0,c.useState)(20),p=(0,A.Z)(S,2),y=p[0],N=p[1],j=(0,c.useState)(!1),T=(0,A.Z)(j,2),C=T[0],g=T[1],U=(0,f.YB)().formatMessage({id:"pages.toolBar.divideData"}),L=(0,f.YB)().formatMessage({id:"component.PPDivideDataModal.train"}),D=(0,f.YB)().formatMessage({id:"component.PPDivideDataModal.validation"}),R=(0,f.YB)().formatMessage({id:"component.PPDivideDataModal.test"}),an=(0,f.YB)().formatMessage({id:"component.PPCreater.cancel"}),Q=(0,f.YB)().formatMessage({id:"component.PPSegMode.ok"}),rn=k.Z.useForm(),W=(0,A.Z)(rn,1),_=W[0];return(0,t.jsx)(Zn.Z,{className:bn().modal,title:U,visible:o.visible,onCancel:o.onCancel,footer:null,children:(0,t.jsxs)(k.Z,{form:_,name:"basic",labelCol:{span:8},wrapperCol:{span:16},initialValues:{remember:!1},onFinish:function(){if(g(!0),i+d+y!=100){b.default.error("Train + Validation + Test should equal 100!");return}console.log("trainData: ".concat(i,", validationData: ").concat(d,", testData: ").concat(y,", props.project.curr.projectId: ").concat(o.project.curr.projectId)),o.splitDataset(o.project.curr.projectId,{train:i*.01,validation:d*.01,test:y*.01}).then(function(){var O;(O=o.onFinish)===null||O===void 0||O.call(0)}).finally(function(){g(!1)})},autoComplete:"off",layout:"vertical",children:[(0,t.jsxs)(On.Z,{children:[(0,t.jsx)(en.Z,{span:8,children:(0,t.jsx)(k.Z.Item,{label:L,name:"train",children:(0,t.jsx)(on.Z,{addonAfter:"%",defaultValue:60,precision:0,min:0,max:100,value:i,onChange:M})})}),(0,t.jsx)(en.Z,{span:8,children:(0,t.jsx)(k.Z.Item,{label:D,name:"validation",children:(0,t.jsx)(on.Z,{addonAfter:"%",defaultValue:20,precision:0,min:0,max:100,value:d,onChange:m})})}),(0,t.jsx)(en.Z,{span:8,children:(0,t.jsx)(k.Z.Item,{label:R,name:"test",children:(0,t.jsx)(on.Z,{addonAfter:"%",defaultValue:20,precision:0,min:0,max:100,value:y,onChange:N})})})]}),(0,t.jsx)(k.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,t.jsxs)(Pn.Z,{children:[(0,t.jsx)(un.Z,{onClick:function(){var O;(O=o.onCancel)===null||O===void 0||O.call(0),_.resetFields()},children:an}),(0,t.jsx)(un.Z,{type:"primary",htmlType:"submit",loading:C,children:Q})]})})]})})},Nn=En,Tn=function(){var o,l=(0,An.$L)(c.useState,c.useEffect,{label:{oneHot:!0},effectTrigger:{postTaskChange:jn}}),u=(0,A.Z)(l,10),i=u[0],M=u[1],v=u[2],r=u[3],d=u[4],m=u[5],S=u[6],p=u[7],y=u[8],N=u[9],j=(0,c.useState)(),T=(0,A.Z)(j,2),C=T[0],g=T[1],U=(0,c.useState)([]),L=(0,A.Z)(U,2),D=L[0],R=L[1],an=(0,c.useState)(!1),Q=(0,A.Z)(an,2),rn=Q[0],W=Q[1],_=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));D.push(a),R(D),g(a)},sn=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));var Y=[],B=(0,P.Z)(D),V;try{for(B.s();!(V=B.n()).done;){var z=V.value;z.frontendId==a.frontendId?Y.push(a):Y.push(z)}}catch(dn){B.e(dn)}finally{B.f()}console.log("modifyAnnotation, newAnnos:",Y,"anno:",a),R(Y),g(a)},O=function(a){if(!a.frontendId)throw new Error("addAnnotation, Annotation frontendId not generated: "+JSON.stringify(a));var Y=[],B=(0,P.Z)(D),V;try{for(B.s();!(V=B.n()).done;){var z=V.value;z.frontendId!=a.frontendId&&Y.push(z)}}catch(dn){B.e(dn)}finally{B.f()}R(Y),g(void 0)},tt=function(a){!a||(console.log("modifyAnnotation",a,"anno.label:",a==null?void 0:a.label),a.taskId=d.curr.taskId,a.dataId=m.curr.dataId,r.modify(a))},fn=function(a){console.log("onAnnotationModify"),sn(a)},vn=Dn({currentLabel:p.curr,currentTool:i.curr,annotations:D,currentAnnotation:C,onAnnotationAdd:_,onAnnotationModify:fn,onMouseUp:function(){tn({annos:D,currAnno:C})}}),ln=vn,Rn=(0,f.YB)().formatMessage({id:"pages.toolBar.rectangle"}),Yn=(0,f.YB)().formatMessage({id:"pages.toolBar.zoomIn"}),Fn=(0,f.YB)().formatMessage({id:"pages.toolBar.zoomOut"}),kn=(0,f.YB)().formatMessage({id:"pages.toolBar.move"}),Un=(0,f.YB)().formatMessage({id:"pages.toolBar.unDo"}),Jn=(0,f.YB)().formatMessage({id:"pages.toolBar.reDo"}),Kn=(0,f.YB)().formatMessage({id:"pages.toolBar.save"}),Wn=(0,f.YB)().formatMessage({id:"pages.toolBar.edit"}),Vn=(0,f.YB)().formatMessage({id:"pages.toolBar.clearMark"}),zn=(0,f.YB)().formatMessage({id:"pages.toolBar.undef"}),Hn=(0,f.YB)().formatMessage({id:"pages.toolBar.divideData"}),$n=(0,f.YB)().formatMessage({id:"pages.toolBar.export"});return(0,t.jsxs)($.Z,{className:q().det,children:[(0,t.jsxs)(w.Z,{children:[(0,t.jsx)(pn,{active:i.curr=="rectangle",onClick:function(){if(!p.curr){b.default.error("Please choose a label category first!");return}i.setCurr("rectangle"),g(void 0)},children:Rn}),(0,t.jsx)(x.Z,{active:i.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){i.setCurr("editor")},children:Wn}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){v.change(.1)},children:Yn}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){v.change(-.1)},children:Fn}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){b.default.info("Annotations are saved automatically. You don't need to click save.")},children:Kn}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/move.png",active:i.curr=="mover",onClick:function(){i.setCurr("mover")},children:kn}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var a=In();!a||(g(a.currAnno),R(a.annos))},children:Un}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var a=Cn();!a||(g(a.currAnno),R(a.annos))},children:Jn}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:Vn})]}),(0,t.jsx)("div",{id:"dr",className:"mainStage",children:(0,t.jsxs)(K.Z,{tip:"loading",spinning:!!M.curr,children:[(0,t.jsx)("div",{className:"draw",children:(0,t.jsx)(mn.Z,{scale:v.curr,annotations:D,currentTool:i.curr,currentAnnotation:C,setCurrentAnnotation:g,onAnnotationModify:fn,onAnnotationModifyComplete:function(){tn({annos:D,currAnno:C})},onMouseDown:ln.onMouseDown,onMouseMove:ln.onMouseMove,onMouseUp:ln.onMouseUp,createRectangleFunc:vn.createElementsFunc,imgSrc:m.imgSrc})}),(0,t.jsx)("div",{className:"pblock",children:(0,t.jsxs)("div",{className:"progress",children:[(0,t.jsx)(F.Z,{className:"progressBar",percent:S.progress,status:"active",showInfo:!1})," ",(0,t.jsxs)("span",{className:"progressDesc",children:["Current labeling ",d.currIdx==null?1:d.currIdx+1," of"," ",(o=d.all)===null||o===void 0?void 0:o.length,". Already labeled ",d.finished(S.progress)||0,"."]})]})}),(0,t.jsx)("div",{className:"prevTask",onClick:d.prevTask}),(0,t.jsx)("div",{className:"nextTask",onClick:d.nextTask})]})}),(0,t.jsxs)(w.Z,{disLoc:"right",children:[(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){W(!0)},children:Hn}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/export.png",onClick:function(){N(S.curr.projectId,"/home/lin/Desktop/data/pplabel/export/")},children:$n}),(0,t.jsx)(x.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){g(void 0)},children:zn})]}),(0,t.jsxs)("div",{className:"rightSideBar",children:[(0,t.jsx)(X.Z,{labels:p.all,activeIds:p.activeIds,onLabelSelect:function(a){p.onSelect(a),g(void 0)},onLabelModify:function(){},onLabelDelete:p.remove,onLabelAdd:function(a){return p.create((0,h.Z)((0,h.Z)({},a),{},{projectId:S.curr.projectId}))}}),(0,t.jsx)(gn.Z,{annotations:D,currAnnotation:C,onAnnotationSelect:g,onAnnotationAdd:function(){g(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(a){O(a)}})]}),(0,t.jsx)(Nn,{visible:rn,splitDataset:y,project:S,onCancel:function(){W(!1)},onFinish:function(){W(!1)}})]})},Ln=Tn},15746:function(Z,I,n){"use strict";var h=n(21584);I.Z=h.Z},89032:function(Z,I,n){"use strict";var h=n(38663),J=n.n(h),K=n(6999)},71230:function(Z,I,n){"use strict";var h=n(92820);I.Z=h.Z},13062:function(Z,I,n){"use strict";var h=n(38663),J=n.n(h),K=n(6999)}}]);
