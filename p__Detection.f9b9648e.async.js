(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(B,k,o){"use strict";o.d(k,{Z:function(){return E}});var Z=o(94663),H=o(80112);function Y(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var Q=o(18597);function O(I,P,$){return(0,Q.Z)()?O=Reflect.construct:O=function(m,X,U){var L=[null];L.push.apply(L,X);var h=Function.bind.apply(m,L),D=new h;return U&&(0,H.Z)(D,U.prototype),D},O.apply(null,arguments)}function E(I){var P=typeof Map=="function"?new Map:void 0;return E=function(u){if(u===null||!Y(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(u))return P.get(u);P.set(u,m)}function m(){return O(u,arguments,(0,Z.Z)(this).constructor)}return m.prototype=Object.create(u.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),(0,H.Z)(m,u)},E(I)}},72285:function(B){B.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(B,k,o){"use strict";o.r(k),o.d(k,{default:function(){return xn}});var Z=o(11849),H=o(57663),Y=o(71577),Q=o(20228),O=o(11382),E=o(34669),I=o(54458),P=o(34792),$=o(48086),u=o(2824),m=o(67294),X=o(72285),U=o.n(X),L=o(8088),h=o(61541),D=o(44434),en=o(5041),on=o(57436),rn=o(14836),e=o(85893),an=function(t){return(0,e.jsx)(h.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},sn=an,cn=o(91220),z=o(65031);function ln(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function q(n,t){if(!(!n||!t))return{tool:"rectangle",color:n,points:t}}function un(n,t,a,d,v,y,l){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var r=n.lines[0].points,s=n.lines[0].color,f=ln(s);if(!f)return[(0,e.jsx)(e.Fragment,{})];var p=(l==null?void 0:l.annotationId)==n.annotationId,g=p?.5:.1,S=void 0,M=[];return r.forEach(function(x,A){if(!S){S=x;return}M.push((0,e.jsx)(z.Cd,{onMouseDown:function(){v=="mover"&&y(n)},draggable:v=="mover",onDragMove:function(R){console.log("Circle onDrageMove");var C=R.evt.offsetX,K=R.evt.offsetY;r[A-1]=C,r[A]=K;var W=(0,Z.Z)((0,Z.Z)({},n),{},{lines:[{tool:"rectangle",color:s,points:r}]});t(W)},onMouseOver:function(){console.log("Circle onMouseOver"),v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){console.log("Circle onMouseOut"),document.body.style.cursor="default"},x:S,y:x,radius:5,fill:s})),r.length>4&&r.splice(A+1,2),S=void 0}),[(0,e.jsxs)(z.ZA,{children:[(0,e.jsx)(z.UL,{onMouseOver:function(){v=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){v=="mover"&&y(n)},stroke:s,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:r[0],y:r[1],width:r[2]-r[0],height:r[3]-r[1],closed:!0,fill:"rgba(".concat(f.r,", ").concat(f.g,", ").concat(f.b,", ").concat(g,")")}),M]},n.annotationId)]}function dn(n){var t=0,a=(0,cn.Z)(n),d;try{for(a.s();!(d=a.n()).done;){var v=d.value;!v||v.annotationId>t&&(t=v.annotationId)}}catch(y){a.e(y)}finally{a.f()}return t}function fn(n){var t=function(l,r,s,f){var p;console.log(f);var g=(l.evt.offsetX+r)/f,S=(l.evt.offsetY+s)/f,M=q((p=n.currentLabel)===null||p===void 0?void 0:p.color,[g,S]);!M||n.onAnnotationAdd({tool:"rectangle",annotationId:dn(n.annotations)+1,label:n.currentLabel,lines:[M]})},a=function(l,r,s,f){var p,g;if(!!n.currentAnnotation){var S=(l.evt.offsetX+r)/f,M=(l.evt.offsetY+s)/f,x=n.currentAnnotation.lines||[],A=q((p=n.currentLabel)===null||p===void 0?void 0:p.color,(g=x[0])===null||g===void 0?void 0:g.points.concat([S,M]));if(!!A){var b={tool:"rectangle",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[A]};n.onAnnotationModify(b)}}},d=function(l,r,s,f){console.log(l.evt),n.currentTool=="rectangle"&&(n.currentAnnotation?a(l,r,s,f):t(l,r,s,f))},v=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:d,onMouseMove:function(){},onMouseUp:v,createElementsFunc:un}}var vn=o(64322),F=40;function gn(){localStorage.removeItem("history"),G([])}function G(n){var t=localStorage.getItem("history"),a=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(a.items[a.index])!=JSON.stringify(n)){var d=a.index>F?a.index-F:0,v=a.items.splice(d,a.index==0?1:a.index+1);a.items=v.concat([n]),a.index<=F?a.index++:a.index=F+1,localStorage.setItem("history",JSON.stringify(a))}}function mn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function hn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var pn=function(){var t,a=(0,vn.$L)(m.useState,m.useEffect,{label:{oneHot:!0},effectTrigger:{}}),d=(0,u.Z)(a,8),v=d[0],y=d[1],l=d[2],r=d[3],s=d[4],f=d[5],p=d[6],g=d[7],S=(0,m.useState)(void 0),M=(0,u.Z)(S,2),x=M[0],A=M[1],b=(0,m.useState)(),R=(0,u.Z)(b,2),C=R[0],K=R[1],W=(0,m.useState)([]),_=(0,u.Z)(W,2),j=_[0],J=_[1],N=function(i){K(i),i!=null&&i.label&&g.setCurr(i.label)};(0,m.useEffect)(function(){gn()},[]);var nn=function(i){for(var T=[],w=0;w<j.length;w++)j[w].annotationId==i.annotationId?T.push(i):T.push(j[w]);N(i),J(T)},tn=fn({currentLabel:g.curr,currentTool:x,annotations:j,currentAnnotation:C,onAnnotationAdd:function(i){var T=j.concat([i]);J(T),C||N(i)},onAnnotationModify:nn,onMouseUp:function(){G({annos:j,currAnno:C})}}),V=tn;return(0,e.jsxs)(L.Z,{className:U().det,children:[(0,e.jsxs)(D.Z,{children:[(0,e.jsx)(sn,{active:x=="rectangle",onClick:function(){A("rectangle"),N(void 0)},children:"Rectangle"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/edit.png",children:"Edit"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){l.change(.1)},children:"Zoom in"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){l.change(-.1)},children:"Zoom out"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){$.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/move.png",onClick:function(){A("mover")},children:"Move"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var i=hn();J(i.annos),N(i.currAnno)},children:"Undo"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var i=mn();J(i.annos),N(i.currAnno)},children:"Redo"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/clear_mark.png",children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(O.Z,{tip:"loading",spinning:!!v,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(on.Z,{scale:l.curr,annotations:j,currentTool:x,currentAnnotation:C,setCurrentAnnotation:N,onAnnotationModify:nn,onAnnotationModifyComplete:function(){G({annotations:j,currentAnnotation:C})},onMouseDown:V.onMouseDown,onMouseMove:V.onMouseMove,onMouseUp:V.onMouseUp,createRectangleFunc:tn.createElementsFunc,imgSrc:f.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(I.Z,{className:"progressBar",percent:s.progress,status:"active",showInfo:!1})," ",(0,e.jsxs)("span",{className:"progressDesc",children:["Current labeling ",s.currIdx?s.currIdx+1:1," of ",(t=s.all)===null||t===void 0?void 0:t.length,". Already labeled ",s.finished||0,"."]})]})}),(0,e.jsx)("div",{className:"prevTask",onClick:s.prevTask}),(0,e.jsx)("div",{className:"nextTask",onClick:s.nextTask})]})}),(0,e.jsxs)(D.Z,{disLoc:"right",children:[(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)("div",{className:"determinOutline",children:(0,e.jsx)(Y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){r.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(en.Z,{labels:g.all,onLabelSelect:function(i){g.setCurr(i),r.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:g.remove,onLabelAdd:function(i){return g.create((0,Z.Z)((0,Z.Z)({},i),{},{projectId:p.curr.projectId}))}}),(0,e.jsx)(rn.Z,{annotations:r.all,onAnnotationSelect:function(i){return r.setCurr(i,g)},onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:r.remove})]})]})},xn=pn}}]);
