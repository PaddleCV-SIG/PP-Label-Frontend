(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[322],{64322:function(se,Q,S){"use strict";S.d(Q,{gu:function(){return x},Gd:function(){return z},$L:function(){return ue}});var H=S(86582),F=S(91220),A=S(3182),ie=S(34792),E=S(48086),O=S(2824),X=S(94043),i=S.n(X),N=S(48971),L=S(37071),R=S(81139),W=localStorage.getItem("basePath"),K=new R.VK(W?{basePath:W}:void 0),j=new R.U(K),Y=new R.sD(K),q=new R.W6(K),G=new R.Cl(K),J=new R.vb(K),x=function(f){return JSON.parse(JSON.stringify(f))};function oe(M){return M&&(M.toLowerCase().replace(/([-_][a-z])/g,function(f){return f.toUpperCase().replace("-","").replace("_","")}),M)}var V=function(f,m,g){if(!!g){for(var s=0;s<m.length;s++)if(f[g]==m[s][g])return s}},ee=function(f){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.1,3],g=f(1),s=(0,O.Z)(g,2),k=s[0],U=s[1],y=function(p){var h=k;h+=p,h<m[0]&&(h=m[0],E.default.error("Smallest scale is "+m[0])),h>m[1]&&(h=m[1],E.default.error("Largest scale is "+m[1])),U(h)};return{curr:k,change:y}},z=function(f){var m=f([]),g=(0,O.Z)(m,2),s=g[0],k=g[1],U=f(),y=(0,O.Z)(U,2),o=y[0],p=y[1],h=function(){var c=(0,A.Z)(i().mark(function a(){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getAll();case 3:return t=e.sent,k(t),e.abrupt("return",t);case 8:return e.prev=8,e.t0=e.catch(0),console.log("project getAll err",e.t0),L.Z.parseError(e.t0,E.default),e.abrupt("return");case 13:case"end":return e.stop()}},a,null,[[0,8]])}));return function(){return c.apply(this,arguments)}}(),D=function(){var c=(0,A.Z)(i().mark(function a(t){var n;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t!=null){r.next=2;break}return r.abrupt("return",void 0);case 2:if(!(s.length>1)){r.next=5;break}return E.default.error("Currently have multiple projects stored, use turnTo instead"),r.abrupt("return");case 5:return r.next=7,j.get(t);case 7:return n=r.sent,k([n]),p(0),r.abrupt("return",n);case 11:case"end":return r.stop()}},a)}));return function(t){return c.apply(this,arguments)}}(),P=function(){var c=(0,A.Z)(i().mark(function a(t){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("remove project",t),typeof t!="number"){e.next=6;break}return e.next=4,j.remove(t);case 4:e.next=8;break;case 6:return e.next=8,j.remove(t.projectId);case 8:h();case 9:case"end":return e.stop()}},a)}));return function(t){return c.apply(this,arguments)}}(),T=function(){var c=(0,A.Z)(i().mark(function a(t){var n;return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,j.create(t);case 3:return n=r.sent,console.log(n),r.abrupt("return",n);case 8:return r.prev=8,r.t0=r.catch(0),console.log("project create err",r.t0),r.abrupt("return",L.Z.parseError(r.t0,E.default));case 12:case"end":return r.stop()}},a,null,[[0,8]])}));return function(t){return c.apply(this,arguments)}}(),d=function(){var c=(0,A.Z)(i().mark(function a(t,n){return i().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:j.update(t,n).then(function(_){console.log("project update res",_)}).catch(function(_){console.log("project update err ",_),L.Z.parseError(_,E.default)});case 1:case"end":return r.stop()}},a)}));return function(t,n){return c.apply(this,arguments)}}();return{all:s,getAll:h,getCurr:D,remove:P,create:T,update:d,get curr(){if(o!=null)return s[o]}}},re=function(f,m){var g=m.oneHot,s=g===void 0?!0:g,k=m.postSetCurr,U=f(),y=(0,O.Z)(U,2),o=y[0],p=y[1],h=f(),D=(0,O.Z)(h,2),P=D[0],T=D[1],d=f(s),c=(0,O.Z)(d,2),a=c[0],t=c[1],n=function(){var C=(0,A.Z)(i().mark(function l(v){var I,w,Z,B;return i().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.prev=0,$.next=3,j.getLabels(v);case 3:I=$.sent,w=(0,F.Z)(I);try{for(w.s();!(Z=w.n()).done;)B=Z.value,B.active=!1}catch(le){w.e(le)}finally{w.f()}return p(I),$.abrupt("return",I);case 10:return $.prev=10,$.t0=$.catch(0),console.log("label getall err ",$.t0),$.abrupt("return",L.Z.parseError($.t0,E.default));case 14:case"end":return $.stop()}},l,null,[[0,10]])}));return function(v){return C.apply(this,arguments)}}(),e=function(l){var v=typeof l=="number"?l:V(l,o,"labelId");if(v=v||0,T(v),console.log("onehot",a),a){var I=(0,F.Z)(o),w;try{for(I.s();!(w=I.n()).done;){var Z=w.value;Z.active=!1}}catch(B){I.e(B)}finally{I.f()}o[v].active=!0,console.log("all",o)}else o[v].active=!o[v].active;k&&k(o[v]),p((0,H.Z)(o))},r=function(){var C=(0,A.Z)(i().mark(function l(v){var I;return i().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.prev=0,Z.next=3,J.create(v);case 3:return I=Z.sent,I.active=!1,p([].concat((0,H.Z)(o),[I])),Z.abrupt("return",I);case 9:return Z.prev=9,Z.t0=Z.catch(0),console.log("label create err",Z.t0),Z.abrupt("return",L.Z.parseError(Z.t0,E.default));case 13:case"end":return Z.stop()}},l,null,[[0,9]])}));return function(v){return C.apply(this,arguments)}}(),_=function(){var C=(0,A.Z)(i().mark(function l(v){return i().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return console.log("remove label",v),w.prev=1,w.next=4,J.remove(v.labelId);case 4:p(o.filter(function(Z){return Z.labelId!=v.labelId})),w.next=11;break;case 7:w.prev=7,w.t0=w.catch(1),console.log("label remove err",w.t0),L.Z.parseError(w.t0,E.default);case 11:case"end":return w.stop()}},l,null,[[1,7]])}));return function(v){return C.apply(this,arguments)}}(),u=function(){},b=function(){t(!a)};return{all:o,getAll:n,setAll:p,setCurr:e,create:r,remove:_,onModify:u,toggleOneHot:b,get curr(){if(P!=null)return o[P]}}},ae=function(f){var m=f(),g=(0,O.Z)(m,2),s=g[0],k=g[1],U=f(),y=(0,O.Z)(U,2),o=y[0],p=y[1],h=f(),D=(0,O.Z)(h,2),P=D[0],T=D[1],d=function(r){if(r<0){E.default.error("This is the first image. No previous image.");return}if(r==s.length){E.default.error("This is the final image. No next image.");return}console.log("turning to",r),p(r)},c=function(){var e=(0,A.Z)(i().mark(function r(_,u){var b;return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,j.getTasks(_);case 3:if(b=l.sent,k(b),u==null){l.next=9;break}return console.log("getall turnto"),d(u),l.abrupt("return",[b,b[u]]);case 9:return l.abrupt("return",b);case 12:l.prev=12,l.t0=l.catch(0),console.log("task getall err ",l.t0),L.Z.parseError(l.t0,E.default);case 16:case"end":return l.stop()}},r,null,[[0,12]])}));return function(_,u){return e.apply(this,arguments)}}(),a=function(){var e=(0,A.Z)(i().mark(function r(_){var u,b;return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,j.getProgress(_);case 3:if(u=l.sent,!(!u||!u.finished||!u.total)){l.next=6;break}throw Error("empty progress");case 6:return b=Math.ceil(u.finished/u.total*100),console.log("progress",u,b),T(b),l.abrupt("return",b);case 12:return l.prev=12,l.t0=l.catch(0),console.log("get progress err",l.t0),L.Z.parseError(l.t0,E.default),l.abrupt("return",0);case 17:case"end":return l.stop()}},r,null,[[0,12]])}));return function(_){return e.apply(this,arguments)}}(),t=function(){var e=(0,A.Z)(i().mark(function r(){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:d(o+1),console.log("all tasks",s);case 2:case"end":return u.stop()}},r)}));return function(){return e.apply(this,arguments)}}(),n=function(){var e=(0,A.Z)(i().mark(function r(){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:d(o-1);case 1:case"end":return u.stop()}},r)}));return function(){return e.apply(this,arguments)}}();return{currIdx:o,all:s,turnTo:d,getAll:c,getProgress:a,progress:P,nextTask:t,prevTask:n,get curr(){if(!(o==null||s==null))return console.log("task.curr",s[o]),s[o]},get finished(){return Math.floor((s==null?void 0:s.length)*P/100)}}},ne=function(f){var m=f(),g=(0,O.Z)(m,2),s=g[0],k=g[1],U=f(),y=(0,O.Z)(U,2),o=y[0],p=y[1],h=function(){var d=(0,A.Z)(i().mark(function c(a){var t,n,e,r;return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,q.getAnnotations(a);case 3:t=u.sent,n=(0,F.Z)(t);try{for(n.s();!(e=n.n()).done;)r=e.value,r.active=!1}catch(b){n.e(b)}finally{n.f()}return k(t),u.abrupt("return",t);case 10:return u.prev=10,u.t0=u.catch(0),console.log("ann getAll err",u.t0),u.abrupt("return",L.Z.parseError(u.t0,E.default));case 14:case"end":return u.stop()}},c,null,[[0,10]])}));return function(a){return d.apply(this,arguments)}}(),D=function(){var d=(0,A.Z)(i().mark(function c(a){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create",a),e.prev=1,e.next=4,G.create(a);case 4:return t=e.sent,h(a.dataId),e.abrupt("return",t);case 9:e.prev=9,e.t0=e.catch(1),console.log("annotation create err",e.t0),L.Z.parseError(e.t0,E.default);case 13:case"end":return e.stop()}},c,null,[[1,9]])}));return function(a){return d.apply(this,arguments)}}(),P=function(){var d=(0,A.Z)(i().mark(function c(a){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a,console.log("typeof",typeof a),typeof a!="number"&&(t=a.annotationId),e.prev=3,e.next=6,G.remove(t);case 6:k(s.filter(function(r){return r.annotationId!=a.annotationId})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),console.log("annotation remove err",e.t0),L.Z.parseError(e.t0,E.default);case 13:case"end":return e.stop()}},c,null,[[3,9]])}));return function(a){return d.apply(this,arguments)}}(),T=function(){var d=(0,A.Z)(i().mark(function c(a){var t,n,e,r,_;return i().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:console.log("annotation onselect",a),a==null&&p(void 0),t=(0,F.Z)(s);try{for(t.s();!(n=t.n()).done;)e=n.value,e.active=!1}catch(C){t.e(C)}finally{t.f()}r=s.filter(function(C){return C.annotationId==a.annotationId})[0],r.active=!a.active,_=V(r,s,"annotationId"),p(_),label.setCurr(a.labelId),k((0,H.Z)(s));case 10:case"end":return b.stop()}},c)}));return function(a){return d.apply(this,arguments)}}();return{all:s,getAll:h,create:D,remove:P,setCurr:T,get curr(){if(!!s)return s[o]}}},te=function(f){var m=f(),g=(0,O.Z)(m,2),s=g[0],k=g[1],U=f([]),y=(0,O.Z)(U,2),o=y[0],p=y[1],h=function(){var P=(0,A.Z)(i().mark(function T(d){return i().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:k(d);case 1:case"end":return a.stop()}},T)}));return function(d){return P.apply(this,arguments)}}(),D=function(){var P=(0,A.Z)(i().mark(function T(d,c){var a;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Y.getDatas(d);case 3:if(a=n.sent,p(a),c==null){n.next=8;break}return h(c),n.abrupt("return",[a,a[c]]);case 8:return n.abrupt("return",a);case 11:n.prev=11,n.t0=n.catch(0),console.log("data getall err ",n.t0),L.Z.parseError(n.t0,E.default);case 15:case"end":return n.stop()}},T,null,[[0,11]])}));return function(d,c){return P.apply(this,arguments)}}();return{all:o,getAll:D,turnTo:h,get curr(){if(!(s==null||o==null))return o[s]},get imgSrc(){if(o&&o[s])return console.log("imgsrc","".concat(W,"/datas/").concat(o[s].dataId,"/image?sault=").concat(o[s].sault)),"".concat(W,"/datas/").concat(o[s].dataId,"/image?sault=").concat(o[s].sault)}}},ue=function(f,m){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};g.effectTrigger||(g.effectTrigger={});var s=f(!1),k=(0,O.Z)(s,2),U=k[0],y=k[1],o=ee(f),p=ae(f),h=te(f),D=z(f),P=re(f,g.label),T=ne(f);return m(function(){var d=L.Z.getQueryVariable("projectId");if(d==null){N.m8.push("/");return}D.getCurr(d).catch(function(c){L.Z.parseError(c,E.default),N.m8.push("/")}),P.getAll(d),p.getAll(d),p.getProgress(d)},[]),m(function(){p.all&&p.all.length!=0&&p.turnTo(0)},[p.all]),m(function(){if(p.currIdx!=null){var d=function(){var c=(0,A.Z)(i().mark(function a(){var t,n,e,r,_,u,b,C;return i().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return console.log("onTaskChange",p.curr,P.all,p.progress),p.getProgress(p.curr.projectId),v.next=4,h.getAll(p.curr.taskId,0);case 4:return t=v.sent,n=(0,O.Z)(t,2),e=n[0],r=n[1],console.log(e),v.next=11,T.getAll(r.dataId);case 11:if(_=v.sent,P.all){u=(0,F.Z)(P.all);try{for(u.s();!(b=u.n()).done;)C=b.value,C.active=!1}catch(I){u.e(I)}finally{u.f()}}g.effectTrigger.postTaskChange&&g.effectTrigger.postTaskChange(P.all,_),y(!1);case 15:case"end":return v.stop()}},a)}));return function(){return c.apply(this,arguments)}}();d()}},[p.currIdx]),[U,y,o,T,p,h,D,P]}}}]);
