(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(B,R,r){"use strict";r.d(R,{Z:function(){return T}});var b=r(94663),H=r(80112);function Y(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var z=r(18597);function j(I,Z,E){return(0,z.Z)()?j=Reflect.construct:j=function(M,w,U){var P=[null];P.push.apply(P,w);var h=Function.bind.apply(M,P),N=new h;return U&&(0,H.Z)(N,U.prototype),N},j.apply(null,arguments)}function T(I){var Z=typeof Map=="function"?new Map:void 0;return T=function(m){if(m===null||!Y(m))return m;if(typeof m!="function")throw new TypeError("Super expression must either be null or a function");if(typeof Z!="undefined"){if(Z.has(m))return Z.get(m);Z.set(m,M)}function M(){return j(m,arguments,(0,b.Z)(this).constructor)}return M.prototype=Object.create(m.prototype,{constructor:{value:M,enumerable:!1,writable:!0,configurable:!0}}),(0,H.Z)(M,m)},T(I)}},72285:function(B){B.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},33549:function(B,R,r){"use strict";r.r(R),r.d(R,{default:function(){return un}});var b=r(11849),H=r(57663),Y=r(71577),z=r(20228),j=r(11382),T=r(34669),I=r(54458),Z=r(34792),E=r(48086),m=r(2824),M=r(67294),w=r(72285),U=r.n(w),P=r(8088),h=r(61541),N=r(44434),W=r(5041),V=r(57436),Q=r(14836),e=r(85893),q=function(t){return(0,e.jsx)(h.Z,{active:t.active,imgSrc:t.imgSrc||"./pics/buttons/rectangle.png",onClick:t.onClick,children:t.children})},_=q,nn=r(91220),$=r(65031);function tn(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function G(n,t){if(!(!n||!t))return{tool:"rectangle",color:n,points:t}}function en(n,t,c,u,s,A,d,i){if(!n||!n.lines||!n.lines[0])return[(0,e.jsx)(e.Fragment,{})];var a=n.lines[0].points,g=n.lines[0].color,f=tn(g);if(!f)return[(0,e.jsx)(e.Fragment,{})];var v=(d==null?void 0:d.annotationId)==n.annotationId,C=v?.5:.1,p=void 0,x=[];return a.forEach(function(y,S){if(!p){p=y;return}x.push((0,e.jsx)($.Cd,{onMouseDown:function(){(s=="editor"||s=="mover")&&A(n)},draggable:s=="editor",onDragMove:function(k){if(s=="editor"){var D=(k.evt.offsetX+((i==null?void 0:i.x)||0))/u,l=(k.evt.offsetY+((i==null?void 0:i.y)||0))/u;a[S-1]=D,a[S]=l;var o=(0,b.Z)((0,b.Z)({},n),{},{lines:[{tool:"rectangle",color:g,points:a}]});t(o)}},onMouseOver:function(){s=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},x:p,y,radius:5,fill:g})),a.length>4&&a.splice(S+1,2),p=void 0}),[(0,e.jsxs)($.ZA,{children:[(0,e.jsx)($.UL,{onMouseOver:function(){s=="mover"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){s=="mover"&&A(n)},stroke:g,strokeWidth:2,globalCompositeOperation:"source-over",lineCap:"round",x:a[0],y:a[1],width:a[2]-a[0],height:a[3]-a[1],closed:!0,fill:"rgba(".concat(f.r,", ").concat(f.g,", ").concat(f.b,", ").concat(C,")")}),x]},n.annotationId)]}function on(n){var t=0,c=(0,nn.Z)(n),u;try{for(c.s();!(u=c.n()).done;){var s=u.value;!s||s.annotationId>t&&(t=s.annotationId)}}catch(A){c.e(A)}finally{c.f()}return t}function rn(n){console.log("currentAnnotation",n.currentAnnotation);var t=function(d,i,a,g){var f,v=d.evt.offsetX+i/g,C=d.evt.offsetY+a/g,p=G((f=n.currentLabel)===null||f===void 0?void 0:f.color,[v,C]);!p||n.onAnnotationAdd({tool:"rectangle",annotationId:on(n.annotations)+1,label:n.currentLabel,lines:[p]})},c=function(d,i,a,g){var f,v;if(!!n.currentAnnotation){var C=(d.evt.offsetX+i)/g,p=(d.evt.offsetY+a)/g,x=n.currentAnnotation.lines||[],y=G((f=n.currentLabel)===null||f===void 0?void 0:f.color,(v=x[0])===null||v===void 0?void 0:v.points.concat([C,p]));if(!!y){var S={tool:"rectangle",annotationId:n.currentAnnotation.annotationId,label:n.currentAnnotation.label,lines:[y]};n.onAnnotationModify(S)}}},u=function(d,i,a,g){n.currentTool=="rectangle"&&(n.currentAnnotation?c(d,i,a,g):t(d,i,a,g))},s=function(){n.currentTool=="rectangle"&&n.onMouseUp()};return{onMouseDown:u,onMouseMove:function(){},onMouseUp:s,createElementsFunc:en}}var an=r(64322),F=40;function K(){localStorage.removeItem("history"),X([])}function X(n){var t=localStorage.getItem("history"),c=t?JSON.parse(t):{index:-1,items:[]};if(JSON.stringify(c.items[c.index])!=JSON.stringify(n)){var u=c.index>F?c.index-F:0,s=c.items.splice(u,c.index==0?1:c.index+1);c.items=s.concat([n]),c.index<=F?c.index++:c.index=F+1,localStorage.setItem("history",JSON.stringify(c))}}function sn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!!t&&!(t.index>=t.items.length-1))return t.index++,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}function cn(){var n=localStorage.getItem("history");if(!!n){var t=JSON.parse(n);if(!(!t||!t.index)&&!(t.index<=0))return t.index--,localStorage.setItem("history",JSON.stringify(t)),t.items[t.index]}}var ln=function(){var t,c=(0,an.$L)(M.useState,M.useEffect,{label:{oneHot:!0},effectTrigger:{postTaskChange:K}}),u=(0,m.Z)(c,8),s=u[0],A=u[1],d=u[2],i=u[3],a=u[4],g=u[5],f=u[6],v=u[7],C=(0,M.useState)([]),p=(0,m.Z)(C,2),x=p[0],y=p[1],S=function(o){console.log("setCurrentAnnotation",o,"anno.label:",o==null?void 0:o.label),i.setCurr(o),o!=null&&o.label&&v.setCurr(o.label)};(0,M.useEffect)(function(){K()},[]);var O=function(o){o.taskId=a.currIdx;for(var L=[],J=0;J<x.length;J++)x[J].annotationId==o.annotationId?L.push(o):L.push(x[J]);S(o),y(L)},k=rn({currentLabel:v.curr,currentTool:s.curr,annotations:x,currentAnnotation:i.curr,onAnnotationAdd:function(o){o.taskId=a.currIdx;var L=x.concat([o]);y(L),i.curr||S(o)},onAnnotationModify:O,onMouseUp:function(){X({annos:x,currAnno:i.curr})}}),D=k;return(0,e.jsxs)(P.Z,{className:U().det,children:[(0,e.jsxs)(N.Z,{children:[(0,e.jsx)(_,{active:s.curr=="rectangle",onClick:function(){if(!v.curr){E.default.error("Please choose a label category first!");return}s.setCurr("rectangle"),S(void 0)},children:"Rectangle"}),(0,e.jsx)(h.Z,{active:s.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){s.setCurr("editor")},children:"Edit"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){d.change(.1)},children:"Zoom in"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){d.change(-.1)},children:"Zoom out"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){E.default.info("Annotations are saved automatically. You don't need to click save.")},children:"Save"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/move.png",active:s.curr=="mover",onClick:function(){s.setCurr("mover")},children:"Move"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=cn();!o||(y(o.annos),S(o.currAnno))},children:"Undo"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=sn();!o||(y(o.annos),S(o.currAnno))},children:"Redo"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){return console.log("clear")},children:"Clear Mark"})]}),(0,e.jsx)("div",{id:"dr",className:"mainStage",children:(0,e.jsxs)(j.Z,{tip:"loading",spinning:!!A.curr,children:[(0,e.jsx)("div",{className:"draw",children:(0,e.jsx)(V.Z,{scale:d.curr,annotations:x,currentTool:s.curr,currentAnnotation:i.curr,setCurrentAnnotation:S,onAnnotationModify:O,onAnnotationModifyComplete:function(){X({annos:x,currAnno:i.curr}),i.modify()},onMouseDown:D.onMouseDown,onMouseMove:D.onMouseMove,onMouseUp:D.onMouseUp,createRectangleFunc:k.createElementsFunc,imgSrc:g.imgSrc})}),(0,e.jsx)("div",{className:"pblock",children:(0,e.jsxs)("div",{className:"progress",children:[(0,e.jsx)(I.Z,{className:"progressBar",percent:f.progress,status:"active",showInfo:!1})," ",(0,e.jsxs)("span",{className:"progressDesc",children:["Current labeling ",a.currIdx==null?1:a.currIdx+1," of"," ",(t=a.all)===null||t===void 0?void 0:t.length,". Already labeled ",a.finished(f.progress)||0,"."]})]})}),(0,e.jsx)("div",{className:"prevTask",onClick:a.prevTask}),(0,e.jsx)("div",{className:"nextTask",onClick:a.nextTask})]})}),(0,e.jsxs)(N.Z,{disLoc:"right",children:[(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/data_division.png",children:"Divide Data"}),(0,e.jsx)(h.Z,{imgSrc:"./pics/buttons/export.png",children:"Export"})]}),(0,e.jsxs)("div",{className:"rightSideBar",children:[(0,e.jsx)("div",{className:"determinOutline",children:(0,e.jsx)(Y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){i.setCurr(void 0)},children:"Determine Outline"})}),(0,e.jsx)(W.Z,{labels:v.all,activeIds:v.activeIds,onLabelSelect:function(o){v.onSelect(o),i.setCurr(void 0)},onLabelModify:function(){},onLabelDelete:v.remove,onLabelAdd:function(o){return v.create((0,b.Z)((0,b.Z)({},o),{},{projectId:f.curr.projectId}))}}),(0,e.jsx)(Q.Z,{annotations:i.all,activeIds:i.activeIds,onAnnotationSelect:i.setCurr,onAnnotationAdd:function(){},onAnnotationModify:function(){},onAnnotationDelete:function(o){i.remove(o),i.setCurr(void 0)}})]})]})},un=ln}}]);
